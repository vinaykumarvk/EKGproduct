{"file_contents":{"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4050},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"â€¦\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2066},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"replit.md":{"content":"# WealthForce Knowledge Agent - Enterprise AI Assistant\n\n## Overview\nThe WealthForce Knowledge Agent is an enterprise-grade conversational AI chatbot designed for wealth management professionals. Its core purpose is to act as an intelligent knowledge base, offering a sophisticated interface with full conversational threading, context maintenance, and persistent chat history. The project aims to enhance knowledge retrieval, boost efficiency, and improve knowledge accessibility for financial experts through a professional, intuitive, and highly functional AI assistant.\n\n## User Preferences\nI prefer simple language and detailed explanations. I want iterative development with frequent, small updates rather than large, infrequent ones. Ask before making major changes to the architecture or core functionalities. Do not make changes to the `shared/` folder without explicit instruction.\n\n## System Architecture\nThe application employs a professional, enterprise-grade architecture focused on conversational AI, inspired by ChatGPT's UI/UX, prioritizing a clean, functional design and robust technical implementation.\n\n### UI/UX Decisions\nThe UI features a comprehensive layout comprising a Global Top Header, Main Navigation Sidebar, Thread Sidebar, flexible Main Content Area, and a collapsible AI Configuration Sidebar. It utilizes a vibrant blue for primary actions, gray tones for assistant messages, and a deep charcoal background for dark mode. Typography includes Inter for UI text and system fonts for messages. Message display uses blue bubbles for users and gray for the assistant, supporting markdown, HTML, and syntax-highlighted code blocks. The system supports light/dark mode with preferences saved in local storage.\n\n### Technical Implementations\n-   **Session-Based Authentication System**: Complete authentication with HTTP-only cookies, bcrypt hashing, `users` and `sessions` database tables, and protected API endpoints. Frontend uses React auth context.\n-   **Conversational Threading**: Hybrid approach using API-driven context chaining and PostgreSQL for persistent storage.\n-   **Sliding Window Context**: Retrieves the last 3 Q&A pairs for LLM input.\n-   **Context Cleaning Pipeline**: Strips noise from chat history.\n-   **Meta-Instruction Enhancement & Focus Directives**: Questions include meta-instructions for pronoun resolution and explicit directives for LLM focus.\n-   **Frontend State Management**: React with TanStack Query for data fetching and caching.\n-   **Thread Management**: Supports automatic creation, title generation, switching, searching, and deletion of conversation threads (last 30 days).\n-   **Database**: PostgreSQL with Drizzle ORM.\n-   **Approval System (Phase 1 - Database Foundation)**: Enhanced database schema for manager-based approval workflows. Added `managerId` field to users table for manager-employee relationships (BA â†’ M1, Pre-sales â†’ M2). Enhanced approvals table with `rejectionReason` and `editHistory` fields for detailed tracking. Implemented storage methods: `getUserManager`, `getApprovalsByApproverId`, and `updateApprovalStatus`. Updated investmentRequests status workflow states: draft, submitted, under_review, approved, rejected, revision_requested.\n\n### Feature Specifications\n-   **Global Header**: Displays \"Questions Asked\" and \"Quizzes Completed\" counters, global search, and user menu.\n-   **Multi-Section Navigation**: Includes \"Conversation\", \"Launchpad\", \"Quiz\", and \"Atlas\" sections.\n-   **Launchpad Templates**: 6 pre-developed templates including Investment Portal and RFP Generator.\n-   **Investment Portal**: Complete unified investment management system accessible from Launchpad. Features dedicated left sidebar navigation with 5 sections: Dashboard (overview & analytics), New Investment (AI-assisted proposal creation), My Investments (request tracking), My Tasks (approvals & actions), Templates (proposal templates). Built as self-contained application with 15 database tables, 45+ storage CRUD methods, 280+ lines of REST API routes. Supports document upload, AI-generated investment memos, approval workflows, and comprehensive tracking.\n-   **RFP Response Generator**: Full-stack system with Excel upload for requirements, tab-based viewing, reference panel, export functionality (Markdown, Excel, PDF, Email), PostgreSQL tables, RESTful API, and AI response generation (OpenAI GPT-5 via Replit AI Integrations). Features a Two-Tier RAG Architecture using `pgvector` for historical RFP similarity search and an EKG fallback.\n-   **Quiz Question Bank**: 100 Order Management questions across 10 topics in PostgreSQL, with 4 difficulty levels and randomized attempts.\n-   **Quiz & Assessment Dual-Mode System**: Offers Structured Quizzes (topic-based, real-time fetching, multiple choice, difficulty indicators, scoring, review, retake) and Flashcards (self-paced study decks).\n-   **Quiz Progress Tracking System**: Backend API (`/api/quiz/history`) aggregates quiz attempts. Quiz cards display performance badges, best/average scores, attempt count, and last attempt date. Scores persist in `quiz_attempts` table.\n-   **AI Model Configuration**: Collapsible sidebar for LLM model, temperature, knowledge graph hops, token limits, and custom system prompts.\n-   **Core Conversational Interface**: ChatGPT-style scrolling view with fixed input.\n-   **Markdown Rendering**: Robust rendering for assistant messages (GitHub-flavored, HTML).\n-   **Professional Formatting**: Reformats API output for readability.\n-   **Sources Display**: Shows up to 3 source documents.\n-   **Download & Export**: Individual answers exportable as Markdown or PDF.\n-   **Regenerate Functionality**: Resubmits questions while maintaining context.\n-   **Wealth Mastery Tracking System**: Tracks user proficiency across five levels based on quiz performance.\n-   **Interactive Knowledge Graph Visualization**: Dual-mode visualization (Network View with topic bubbles and Hierarchy View with tree-based categories) for exploring wealth management concepts. Both use React Flow for visualization.\n\n### System Design Choices\n-   **Schema-first development**: Uses TypeScript and Zod.\n-   **Optimistic UI updates**: Enhances responsiveness.\n-   **Component composition**: Structures the UI with reusable components.\n-   **Fixed Layout**: Ensures the input area is always visible.\n\n## External Dependencies\n\n-   **EKG REST Service**: `https://ekg-service-47249889063.europe-west6.run.app/v1/answer` (AI-powered answers, context, source documents).\n-   **OpenAI GPT-4o-mini**: (Quiz question generation via Replit AI Integrations).\n-   **PostgreSQL**: (Primary database for persistence).\n-   **NPM Packages**: `react-markdown`, `rehype-raw`, `remark-gfm` (Markdown), `@tanstack/react-query` (Data fetching), `wouter` (Routing), `zod` (Schema validation), `lucide-react` (Icons), `shadcn/ui` (UI components), `date-fns` (Date formatting), `jspdf` (PDF generation), `drizzle-orm`, `@neondatabase/serverless` (PostgreSQL integration).","size_bytes":7009},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 0 0% 100%;\n\n  --foreground: 220 20% 15%;\n\n  --border: 210 15% 90%;\n\n  --card: 210 20% 98%;\n\n  --card-foreground: 220 20% 15%;\n\n  --card-border: 210 15% 92%;\n\n  --sidebar: 210 18% 96%;\n\n  --sidebar-foreground: 220 20% 15%;\n\n  --sidebar-border: 210 15% 90%;\n\n  --sidebar-primary: 210 100% 50%;\n\n  --sidebar-primary-foreground: 0 0% 98%;\n\n  --sidebar-accent: 210 20% 94%;\n\n  --sidebar-accent-foreground: 220 20% 15%;\n\n  --sidebar-ring: 210 100% 50%;\n\n  --popover: 210 20% 98%;\n\n  --popover-foreground: 220 20% 15%;\n\n  --popover-border: 210 15% 90%;\n\n  --primary: 210 100% 50%;\n\n  --primary-foreground: 0 0% 98%;\n\n  --secondary: 210 15% 92%;\n\n  --secondary-foreground: 220 20% 15%;\n\n  --muted: 210 18% 95%;\n\n  --muted-foreground: 220 15% 45%;\n\n  --accent: 200 90% 48%;\n\n  --accent-foreground: 0 0% 98%;\n\n  --destructive: 0 72% 51%;\n\n  --destructive-foreground: 0 0% 98%;\n\n  --input: 0 0% 80%;\n  --ring: 210 100% 50%;\n  --chart-1: 210 100% 50%;\n  --chart-2: 145 70% 40%;\n  --chart-3: 280 65% 60%;\n  --chart-4: 30 80% 55%;\n  --chart-5: 340 75% 55%;\n\n  --font-sans: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: 'JetBrains Mono', Menlo, monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 1px 2px 0px hsl(0 0% 0% / 0.05);\n  --shadow-xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.06);\n  --shadow-sm: 0px 2px 4px -1px hsl(0 0% 0% / 0.06), 0px 1px 2px -1px hsl(0 0% 0% / 0.04);\n  --shadow: 0px 4px 6px -1px hsl(0 0% 0% / 0.08), 0px 2px 4px -2px hsl(0 0% 0% / 0.05);\n  --shadow-md: 0px 6px 12px -2px hsl(0 0% 0% / 0.10), 0px 3px 7px -3px hsl(0 0% 0% / 0.08);\n  --shadow-lg: 0px 10px 20px -3px hsl(0 0% 0% / 0.12), 0px 4px 10px -4px hsl(0 0% 0% / 0.10);\n  --shadow-xl: 0px 20px 25px -5px hsl(0 0% 0% / 0.14), 0px 8px 15px -6px hsl(0 0% 0% / 0.12);\n  --shadow-2xl: 0px 25px 50px -12px hsl(0 0% 0% / 0.20);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 220 20% 10%;\n\n  --foreground: 210 20% 98%;\n\n  --border: 220 15% 25%;\n\n  --card: 220 18% 14%;\n\n  --card-foreground: 210 20% 98%;\n\n  --card-border: 220 15% 20%;\n\n  --sidebar: 220 20% 12%;\n\n  --sidebar-foreground: 210 20% 98%;\n\n  --sidebar-border: 220 15% 22%;\n\n  --sidebar-primary: 210 100% 50%;\n\n  --sidebar-primary-foreground: 0 0% 98%;\n\n  --sidebar-accent: 220 15% 18%;\n\n  --sidebar-accent-foreground: 210 20% 98%;\n\n  --sidebar-ring: 210 100% 50%;\n\n  --popover: 220 18% 14%;\n\n  --popover-foreground: 210 20% 98%;\n\n  --popover-border: 220 15% 25%;\n\n  --primary: 210 100% 50%;\n\n  --primary-foreground: 0 0% 98%;\n\n  --secondary: 220 15% 18%;\n\n  --secondary-foreground: 210 20% 98%;\n\n  --muted: 220 15% 16%;\n\n  --muted-foreground: 210 15% 70%;\n\n  --accent: 200 90% 48%;\n\n  --accent-foreground: 0 0% 98%;\n\n  --destructive: 0 72% 51%;\n\n  --destructive-foreground: 0 0% 98%;\n\n  --input: 220 15% 22%;\n  --ring: 210 100% 50%;\n  --chart-1: 210 100% 50%;\n  --chart-2: 145 70% 45%;\n  --chart-3: 280 65% 70%;\n  --chart-4: 30 80% 65%;\n  --chart-5: 340 75% 65%;\n\n  --shadow-2xs: 0px 1px 2px 0px hsl(0 0% 0% / 0.15);\n  --shadow-xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.20);\n  --shadow-sm: 0px 2px 4px -1px hsl(0 0% 0% / 0.25), 0px 1px 2px -1px hsl(0 0% 0% / 0.15);\n  --shadow: 0px 4px 6px -1px hsl(0 0% 0% / 0.30), 0px 2px 4px -2px hsl(0 0% 0% / 0.20);\n  --shadow-md: 0px 6px 12px -2px hsl(0 0% 0% / 0.35), 0px 3px 7px -3px hsl(0 0% 0% / 0.25);\n  --shadow-lg: 0px 10px 20px -3px hsl(0 0% 0% / 0.40), 0px 4px 10px -4px hsl(0 0% 0% / 0.30);\n  --shadow-xl: 0px 20px 25px -5px hsl(0 0% 0% / 0.45), 0px 8px 15px -6px hsl(0 0% 0% / 0.35);\n  --shadow-2xl: 0px 25px 50px -12px hsl(0 0% 0% / 0.50);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n  \n  /* Custom markdown formatting for AI responses */\n  .prose sup {\n    @apply text-primary font-medium;\n  }\n  \n  .prose sup a {\n    @apply text-primary hover:text-primary/80 transition-colors;\n    text-decoration: none;\n  }\n  \n  /* Better spacing for bullet points */\n  .prose ul {\n    @apply space-y-1;\n  }\n  \n  .prose li {\n    @apply leading-relaxed;\n  }\n  \n  /* Style paragraphs in prose */\n  .prose p {\n    @apply mb-3;\n  }\n  \n  /* Ensure code blocks have proper background */\n  .prose code {\n    @apply bg-muted/50 px-1.5 py-0.5 rounded text-sm;\n  }\n  \n  .prose pre code {\n    @apply bg-transparent px-0 py-0;\n  }\n  \n  /* Compact citations display - remove ALL gaps between items */\n  .prose h2#citations + p,\n  .prose h2 + p:has(a[id^=\"cite-\"]) {\n    @apply mb-0 leading-tight;\n  }\n  \n  /* Make citation entries completely compact - no gaps */\n  .prose p:has(a[id^=\"cite-\"]) {\n    @apply mb-0 leading-tight;\n  }\n  \n  /* Also target citations section heading */\n  .prose h2:has(+ p a[id^=\"cite-\"]),\n  .prose h2#citations {\n    @apply mb-1;\n  }\n  \n  /* Remove bold from citation filenames */\n  .prose p:has(a[id^=\"cite-\"]) strong {\n    @apply font-normal;\n  }\n  \n  /* Ensure tight spacing for citation lines */\n  .prose :is(h2 + p, p + p):has(a[id^=\"cite-\"]) {\n    @apply mt-0;\n  }\n}","size_bytes":11141},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { querySchema, insertConversationSchema } from \"@shared/schema\";\nimport { storage } from \"./storage\";\nimport OpenAI from \"openai\";\nimport { verifyPassword, generateSessionToken, getSessionExpiry } from \"./auth\";\nimport { z } from \"zod\";\nimport multer from \"multer\";\nimport fs from \"fs/promises\";\n\nconst EKG_API_URL = \"https://ekg-service-47249889063.europe-west6.run.app\";\n\n// Initialize OpenAI client for quiz generation using Replit AI Integrations\nconst openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n});\n\n// Configure multer for audio file uploads (memory storage)\nconst upload = multer({ \n  storage: multer.memoryStorage(),\n  limits: {\n    fileSize: 10 * 1024 * 1024, // 10MB max\n  },\n});\n\n// Configure multer for document uploads (disk storage)\nconst documentStorage = multer.diskStorage({\n  destination: async (req, file, cb) => {\n    const uploadDir = 'uploads/documents';\n    await fs.mkdir(uploadDir, { recursive: true });\n    cb(null, uploadDir);\n  },\n  filename: (req, file, cb) => {\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n    const sanitizedName = file.originalname.replace(/[^a-zA-Z0-9.-]/g, '_');\n    cb(null, uniqueSuffix + '-' + sanitizedName);\n  }\n});\n\nconst documentUpload = multer({\n  storage: documentStorage,\n  limits: {\n    fileSize: 50 * 1024 * 1024, // 50MB max per file\n  },\n});\n\n// Helper function to clean answer text by removing formatting noise\nfunction cleanAnswer(markdown: string): string {\n  return markdown\n    .replace(/^#.*KG \\+ VectorStore Answer.*$/gm, '')  // Remove KG answer headers\n    .replace(/^_Generated:.*$/gm, '')                   // Remove timestamp lines\n    .replace(/^##\\s*\\*\\*Answer\\*\\*\\s*$/gm, '')         // Remove \"## **Answer**\" subheader\n    .replace(/<sup>.*?<\\/sup>/g, '')                    // Remove citation superscripts (includes links)\n    .replace(/<a\\s+id=\"cite-\\d+\">\\s*<\\/a>/g, '')       // Remove citation anchor definitions\n    .replace(/<a[^>]*>(.*?)<\\/a>/g, '$1')              // Extract text from remaining anchor tags\n    .replace(/<[^>]*>/g, '')                            // Remove remaining HTML tags\n    .replace(/\\*\\*([^*]+)\\*\\*/g, '$1')                  // Remove bold (**text** -> text)\n    .replace(/\\[[\\d,\\s]+\\]/g, '')                       // Remove inline citations [1], [2]\n    .replace(/\\[KG:.*?\\]/gi, '')                        // Remove Knowledge Graph tags\n    .replace(/---\\s*##\\s*\\*\\*Sources by File\\*\\*[\\s\\S]*$/, '') // Remove citations section\n    .replace(/\\n{3,}/g, '\\n\\n')                         // Collapse multiple newlines\n    .trim();\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // TEMPORARY: Database initialization endpoint\n  app.get(\"/api/init-db\", async (req, res) => {\n    try {\n      const { db } = await import(\"./db\");\n      const { users, sessions } = await import(\"@shared/schema\");\n      const { sql } = await import(\"drizzle-orm\");\n      const { hashPassword } = await import(\"./auth\");\n      \n      // Create users table\n      await db.execute(sql`\n        CREATE TABLE IF NOT EXISTS users (\n          id SERIAL PRIMARY KEY,\n          username VARCHAR(255) UNIQUE NOT NULL,\n          password VARCHAR(255) NOT NULL,\n          full_name VARCHAR(255) NOT NULL,\n          email VARCHAR(255),\n          team VARCHAR(50) NOT NULL,\n          is_active BOOLEAN DEFAULT true NOT NULL,\n          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n          last_login TIMESTAMP\n        )\n      `);\n      \n      // Create sessions table\n      await db.execute(sql`\n        CREATE TABLE IF NOT EXISTS sessions (\n          id VARCHAR(255) PRIMARY KEY,\n          user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n          expires_at TIMESTAMP NOT NULL\n        )\n      `);\n      \n      // Seed sample users\n      const sampleUsers = [\n        { username: \"admin\", password: \"Admin@2025\", fullName: \"Admin User\", team: \"admin\", email: \"admin@wealthforce.com\" },\n        { username: \"presales\", password: \"Presales@2025\", fullName: \"John Smith\", team: \"presales\", email: \"john.smith@wealthforce.com\" },\n        { username: \"ba_analyst\", password: \"BA@2025\", fullName: \"Sarah Johnson\", team: \"ba\", email: \"sarah.johnson@wealthforce.com\" },\n        { username: \"manager\", password: \"Manager@2025\", fullName: \"Michael Chen\", team: \"management\", email: \"michael.chen@wealthforce.com\" },\n      ];\n      \n      for (const userData of sampleUsers) {\n        const hashedPassword = await hashPassword(userData.password);\n        await db.execute(sql`\n          INSERT INTO users (username, password, full_name, email, team, is_active)\n          VALUES (${userData.username}, ${hashedPassword}, ${userData.fullName}, ${userData.email}, ${userData.team}, true)\n          ON CONFLICT (username) DO NOTHING\n        `);\n      }\n      \n      res.json({ \n        success: true, \n        message: \"Database initialized successfully! You can now login with: admin/Admin@2025, presales/Presales@2025, ba_analyst/BA@2025, or manager/Manager@2025\" \n      });\n    } catch (error: any) {\n      console.error(\"Database initialization error:\", error);\n      res.status(500).json({ error: \"Failed to initialize database\", details: error.message });\n    }\n  });\n\n  // Authentication middleware to check if user is logged in\n  const requireAuth = async (req: any, res: any, next: any) => {\n    const sessionId = req.cookies?.wf_session;\n    \n    if (!sessionId) {\n      return res.status(401).json({ error: \"Not authenticated\" });\n    }\n    \n    const sessionWithUser = await storage.getSessionWithUser(sessionId);\n    \n    if (!sessionWithUser) {\n      return res.status(401).json({ error: \"Invalid or expired session\" });\n    }\n    \n    req.user = sessionWithUser.user;\n    req.sessionId = sessionId;\n    next();\n  };\n\n  // Login endpoint\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const loginSchema = z.object({\n        username: z.string().min(1),\n        password: z.string().min(1),\n      });\n      \n      const { username, password } = loginSchema.parse(req.body);\n      \n      // Get user by username\n      const user = await storage.getUserByUsername(username);\n      \n      if (!user) {\n        return res.status(401).json({ error: \"Invalid credentials\" });\n      }\n      \n      // Verify password\n      const isValid = await verifyPassword(password, user.password);\n      \n      if (!isValid) {\n        return res.status(401).json({ error: \"Invalid credentials\" });\n      }\n      \n      // Check if user is active\n      if (!user.isActive) {\n        return res.status(403).json({ error: \"Account is inactive\" });\n      }\n      \n      // Create session\n      const sessionToken = generateSessionToken();\n      const expiresAt = getSessionExpiry();\n      \n      await storage.createSession({\n        id: sessionToken,\n        userId: user.id,\n        expiresAt,\n      });\n      \n      // Update last login\n      await storage.updateUserLastLogin(user.id);\n      \n      // Set HTTP-only cookie\n      res.cookie(\"wf_session\", sessionToken, {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === \"production\",\n        sameSite: \"lax\",\n        expires: expiresAt,\n      });\n      \n      // Return user data (without password)\n      const { password: _, ...userWithoutPassword } = user;\n      res.json({ user: userWithoutPassword });\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ error: \"Login failed\" });\n    }\n  });\n\n  // Logout endpoint\n  app.post(\"/api/auth/logout\", async (req, res) => {\n    try {\n      const sessionId = req.cookies?.wf_session;\n      \n      if (sessionId) {\n        await storage.deleteSession(sessionId);\n      }\n      \n      // Clear cookie with same security attributes as login\n      res.clearCookie(\"wf_session\", {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === \"production\",\n        sameSite: \"lax\",\n      });\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n      res.status(500).json({ error: \"Logout failed\" });\n    }\n  });\n\n  // Get current user endpoint\n  app.get(\"/api/auth/me\", requireAuth, async (req: any, res) => {\n    try {\n      const { password: _, ...userWithoutPassword } = req.user;\n      res.json({ user: userWithoutPassword });\n    } catch (error) {\n      console.error(\"Get user error:\", error);\n      res.status(500).json({ error: \"Failed to get user\" });\n    }\n  });\n\n  // Voice transcription endpoint using OpenAI Whisper\n  app.post(\"/api/voice/transcribe\", upload.single('audio'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"No audio file provided\" });\n      }\n\n      console.log(\"Received audio file for transcription:\", {\n        originalname: req.file.originalname,\n        mimetype: req.file.mimetype,\n        size: req.file.size,\n      });\n\n      // Create a temporary file from the buffer\n      const tempFilePath = `/tmp/audio-${Date.now()}.webm`;\n      await fs.writeFile(tempFilePath, req.file.buffer);\n\n      try {\n        // Use OpenAI Whisper API for transcription\n        // OpenAI SDK accepts ReadStream for file parameter in Node.js\n        const fileStream = await import('fs').then(fs => fs.createReadStream(tempFilePath));\n        \n        const transcription = await openai.audio.transcriptions.create({\n          file: fileStream,\n          model: \"whisper-1\",\n          language: \"en\",\n          response_format: \"json\",\n        });\n\n        // Clean up temp file\n        await fs.unlink(tempFilePath).catch(() => {});\n\n        console.log(\"Transcription successful:\", transcription.text.substring(0, 100));\n\n        res.json({ \n          text: transcription.text,\n          success: true,\n        });\n      } catch (whisperError) {\n        // Clean up temp file on error\n        await fs.unlink(tempFilePath).catch(() => {});\n        throw whisperError;\n      }\n    } catch (error) {\n      console.error(\"Transcription error:\", error);\n      res.status(500).json({ \n        error: \"Failed to transcribe audio\",\n        message: error instanceof Error ? error.message : \"Unknown error\",\n      });\n    }\n  });\n\n  // Main query endpoint - handles both new threads and follow-up questions\n  app.post(\"/api/query\", async (req, res) => {\n    try {\n      const validatedData = querySchema.parse(req.body);\n      let threadId = validatedData.threadId;\n      let previousResponseId: string | undefined;\n      let existingConversationId: string | undefined;\n      \n      // If threadId provided, get conversation context\n      let chatHistory: Array<{question: string; answer: string}> = [];\n      \n      if (threadId) {\n        const thread = await storage.getThread(threadId);\n        if (thread && thread.conversationId) {\n          existingConversationId = thread.conversationId;\n        }\n        \n        const lastMessage = await storage.getLastAssistantMessage(threadId);\n        if (lastMessage && lastMessage.responseId) {\n          previousResponseId = lastMessage.responseId;\n        }\n        \n        // Get last 3 Q&A pairs for focused context window\n        const recentMessages = await storage.getRecentMessagePairs(threadId, 3);\n        console.log(`Retrieved ${recentMessages.length} messages for context (expecting ${3 * 2} for ${3} pairs)`);\n        \n        // Format as Q&A pairs with cleaned answers\n        for (let i = 0; i < recentMessages.length; i += 2) {\n          const userMsg = recentMessages[i];\n          const assistantMsg = recentMessages[i + 1];\n          \n          if (userMsg && assistantMsg && userMsg.role === \"user\" && assistantMsg.role === \"assistant\") {\n            const cleanedAnswer = cleanAnswer(assistantMsg.content);\n            chatHistory.push({\n              question: userMsg.content,\n              answer: cleanedAnswer\n            });\n            console.log(`Added Q&A pair ${Math.floor(i/2) + 1}: Q=\"${userMsg.content.substring(0, 50)}...\" A=\"${cleanedAnswer.substring(0, 50)}...\"`);\n          } else {\n            console.warn(`Skipping invalid message pair at index ${i}: user=${userMsg?.role}, assistant=${assistantMsg?.role}`);\n          }\n        }\n        console.log(`Final chatHistory has ${chatHistory.length} pairs`);\n      } else {\n        // Create a new thread with title from question (truncated)\n        const title = validatedData.question.length > 60 \n          ? validatedData.question.substring(0, 60) + \"...\"\n          : validatedData.question;\n        const thread = await storage.createThread({ title });\n        threadId = thread.id;\n      }\n      \n      // Prepare the question with meta-instructions for focused responses\n      let questionToSend = validatedData.question;\n      \n      if (chatHistory.length > 0) {\n        // Add meta-instructions for context understanding and focused responses\n        questionToSend = `[Context-Aware Follow-up Question with Focus Directives]\n\nPrevious conversation history is provided for context. Please follow these instructions:\n\nSTEP 1 - Context Understanding:\nâ€¢ Evaluate if this question contains pronouns or unclear references (e.g., \"this\", \"it\", \"that\", \"these\", \"the above\")\nâ€¢ If such references exist, identify what they refer to based on the conversation history\nâ€¢ Internally clarify the question to make it self-contained and explicit\n\nSTEP 2 - Focused Response Generation:\nâ€¢ Answer ONLY the specific question asked - be precise and direct\nâ€¢ Include ONLY information that is immediately relevant to this specific question\nâ€¢ Exclude tangential details, background context, or loosely related information\nâ€¢ Be concise while remaining comprehensive on the core topic\nâ€¢ Prioritize clarity and relevance over exhaustive coverage\n\nUser's Question: ${validatedData.question}`;\n      } else {\n        // Add focus directives for initial questions\n        questionToSend = `[Focused Response Directive]\n\nPlease follow these instructions when answering:\nâ€¢ Answer ONLY the specific question asked - be precise and direct\nâ€¢ Include ONLY information that is immediately relevant to this specific question\nâ€¢ Exclude tangential details, background context, or loosely related information\nâ€¢ Be concise while remaining comprehensive on the core topic\nâ€¢ Prioritize clarity and relevance over exhaustive coverage\n\nUser's Question: ${validatedData.question}`;\n      }\n      \n      // Prepare API request payload with correct structure\n      const apiPayload: any = {\n        question: questionToSend,\n        domain: \"wealth_management\",\n        params: {\n          _mode: validatedData.mode || \"balanced\"  // Send mode in params object\n        }\n      };\n      \n      // Add conversation_id for long-running context (prioritize this over response_id)\n      if (existingConversationId) {\n        apiPayload.conversation_id = existingConversationId;\n      } else if (previousResponseId) {\n        // Add response_id if this is a follow-up question without conversation_id\n        apiPayload.response_id = previousResponseId;\n      }\n      \n      // Add chat history (last 3 Q&A pairs) for better context\n      if (chatHistory.length > 0) {\n        apiPayload.chat_history = chatHistory;\n        console.log(`Including ${chatHistory.length} previous Q&A pairs with meta-instructions`);\n      }\n      \n      console.log(\"EKG API request payload:\", JSON.stringify(apiPayload, null, 2));\n      \n      // Call the EKG API\n      const response = await fetch(`${EKG_API_URL}/v1/answer`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"User-Agent\": \"WealthForce-Knowledge-Agent/1.0\"\n        },\n        body: JSON.stringify(apiPayload),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error(\"EKG API error:\", response.status, errorText);\n        throw new Error(`EKG API error: ${response.status} - ${errorText}`);\n      }\n\n      const result = await response.json();\n      console.log(\"EKG API response:\", JSON.stringify(result, null, 2));\n\n      // Handle both 'answer' and 'markdown' fields (API documentation shows 'markdown', but actual API returns 'answer')\n      const responseText = result.markdown || result.answer;\n      \n      if (result && responseText) {\n        \n        // Format sources if available\n        let sources = \"\";\n        if (result.sources && Array.isArray(result.sources) && result.sources.length > 0) {\n          sources = JSON.stringify(result.sources);\n        }\n        \n        // Format metadata\n        let metadata = \"\";\n        if (result.meta) {\n          metadata = JSON.stringify(result.meta);\n        }\n        \n        // Save user message\n        await storage.createMessage({\n          threadId: threadId!,\n          role: \"user\",\n          content: validatedData.question,\n          responseId: null,\n          sources: null,\n          metadata: null,\n        });\n        \n        // Save assistant message with response_id\n        await storage.createMessage({\n          threadId: threadId!,\n          role: \"assistant\",\n          content: responseText,\n          responseId: result.response_id || null,\n          sources: sources || null,\n          metadata: metadata || null,\n        });\n        \n        // Capture and store conversation_id from API response for long-running context\n        const apiConversationId = result.meta?.conversation_id || result.conversation_id;\n        if (apiConversationId && !existingConversationId) {\n          await storage.updateThreadConversationId(threadId!, apiConversationId);\n        }\n        \n        // Update thread timestamp\n        await storage.updateThreadTimestamp(threadId!);\n        \n        res.json({\n          threadId: threadId,\n          data: responseText,\n          metadata: metadata || undefined,\n          citations: sources || undefined,\n          responseId: result.response_id,\n          isConversational: result.meta?.is_conversational || false,\n        });\n      } else {\n        res.status(500).json({\n          data: \"\",\n          error: \"No answer in response from the service\",\n        });\n      }\n    } catch (error) {\n      console.error(\"Query error:\", error);\n      res.status(500).json({\n        data: \"\",\n        error: error instanceof Error ? error.message : \"Failed to process query\",\n      });\n    }\n  });\n\n  // Generate flash quiz from conversation using OpenAI\n  app.post(\"/api/generate-quiz\", async (req, res) => {\n    try {\n      const { threadId } = req.body;\n      \n      if (!threadId) {\n        return res.status(400).json({ error: \"threadId is required\" });\n      }\n\n      // Get recent messages from the thread\n      const messages = await storage.getRecentMessagePairs(threadId, 10); // Get up to 10 Q&A pairs\n      \n      if (messages.length < 2) {\n        return res.status(400).json({ error: \"Not enough conversation history to generate a quiz\" });\n      }\n\n      // Format messages for context\n      const conversationContext = [];\n      for (let i = 0; i < messages.length; i += 2) {\n        const userMsg = messages[i];\n        const assistantMsg = messages[i + 1];\n        \n        if (userMsg && assistantMsg) {\n          conversationContext.push({\n            question: userMsg.content,\n            answer: cleanAnswer(assistantMsg.content)\n          });\n        }\n      }\n\n      // Create quiz generation prompt for OpenAI\n      const systemPrompt = `You are a quiz generation expert. Your task is to create engaging, accurate multiple-choice quiz questions based on conversation context. Generate 3-5 questions that test understanding of key concepts discussed.\n\nReturn your response as valid JSON in this EXACT format (no additional text before or after):\n{\n  \"questions\": [\n    {\n      \"question\": \"Question text here?\",\n      \"options\": {\n        \"A\": \"Option A text\",\n        \"B\": \"Option B text\",\n        \"C\": \"Option C text\",\n        \"D\": \"Option D text\"\n      },\n      \"correctAnswer\": \"A\",\n      \"explanation\": \"Explanation why A is correct.\"\n    }\n  ]\n}`;\n\n      const userPrompt = `Based on the following conversation about wealth management, generate 3-5 multiple-choice quiz questions to test understanding of the key concepts discussed.\n\nCONVERSATION HISTORY:\n${conversationContext.map((ctx, i) => `Q${i + 1}: ${ctx.question}\\nA${i + 1}: ${ctx.answer}`).join('\\n\\n')}\n\nGenerate quiz questions that:\n- Test understanding of key concepts from the conversation\n- Have 4 answer options (A, B, C, D)\n- Include the correct answer\n- Include a brief explanation (2-3 sentences) of why the answer is correct`;\n\n      // Call OpenAI to generate quiz\n      const completion = await openai.chat.completions.create({\n        model: \"gpt-4o-mini\",\n        messages: [\n          { role: \"system\", content: systemPrompt },\n          { role: \"user\", content: userPrompt }\n        ],\n        temperature: 0.7,\n        response_format: { type: \"json_object\" }\n      });\n\n      const quizData = completion.choices[0].message.content;\n      \n      if (!quizData) {\n        console.error(\"No quiz data in OpenAI response\");\n        return res.status(500).json({ error: \"Failed to generate quiz - no response from AI\" });\n      }\n\n      // Parse the quiz data\n      let parsedQuiz;\n      try {\n        parsedQuiz = JSON.parse(quizData);\n        \n        // Validate structure\n        if (!parsedQuiz.questions || !Array.isArray(parsedQuiz.questions) || parsedQuiz.questions.length === 0) {\n          throw new Error(\"Invalid quiz structure: missing or empty questions array\");\n        }\n      } catch (parseError) {\n        console.error(\"Failed to parse quiz JSON:\", quizData);\n        console.error(\"Parse error:\", parseError);\n        return res.status(500).json({ \n          error: \"Failed to parse quiz data. Please try again.\" \n        });\n      }\n\n      res.json(parsedQuiz);\n      \n    } catch (error) {\n      console.error(\"Quiz generation error:\", error);\n      res.status(500).json({\n        error: error instanceof Error ? error.message : \"Failed to generate quiz\",\n      });\n    }\n  });\n\n  // Get current mastery score\n  app.get(\"/api/mastery\", async (req, res) => {\n    try {\n      let mastery = await storage.getUserMastery();\n      \n      if (!mastery) {\n        // Initialize mastery if it doesn't exist\n        mastery = await storage.updateUserMastery({\n          overallScore: 0,\n          currentLevel: \"Novice\",\n          quizPerformanceScore: 0,\n          topicCoverageScore: 0,\n          retentionScore: 0,\n          topicsMastered: 0,\n          totalQuizzesTaken: 0,\n        });\n      }\n      \n      res.json(mastery);\n    } catch (error) {\n      console.error(\"Error fetching mastery:\", error);\n      res.status(500).json({ error: \"Failed to fetch mastery score\" });\n    }\n  });\n\n  // Helper function to calculate mastery score\n  async function calculateMasteryScore() {\n    // Get recent quiz attempts (last 20 for performance calculation)\n    const recentQuizzes = await storage.getRecentQuizzes(20);\n    \n    if (recentQuizzes.length === 0) {\n      return await storage.updateUserMastery({\n        overallScore: 0,\n        currentLevel: \"Novice\",\n        quizPerformanceScore: 0,\n        topicCoverageScore: 0,\n        retentionScore: 0,\n        topicsMastered: 0,\n        totalQuizzesTaken: 0,\n      });\n    }\n\n    // 1. Quiz Performance Score (50 points max)\n    // Weight: Recent 20 quizzes at 70%, older at 30%\n    const avgScore = recentQuizzes.reduce((sum, q) => sum + q.scorePercentage, 0) / recentQuizzes.length;\n    const quizPerformanceScore = Math.round((avgScore / 100) * 50);\n\n    // 2. Topic Coverage Score (30 points max)\n    // For Phase 1, give partial credit based on number of quizzes taken\n    const totalQuizzes = recentQuizzes.length;\n    const topicCoverageScore = Math.min(30, Math.round((totalQuizzes / 10) * 30));\n\n    // 3. Retention & Consistency Score (20 points max)\n    // For Phase 1, give credit based on consistency\n    const retentionScore = Math.min(20, Math.round((totalQuizzes / 15) * 20));\n\n    // Calculate overall mastery score\n    const overallScore = quizPerformanceScore + topicCoverageScore + retentionScore;\n\n    // Determine level based on score\n    let currentLevel = \"Novice\";\n    if (overallScore >= 91) currentLevel = \"Expert\";\n    else if (overallScore >= 76) currentLevel = \"Advanced\";\n    else if (overallScore >= 51) currentLevel = \"Intermediate\";\n    else if (overallScore >= 26) currentLevel = \"Learning\";\n\n    return await storage.updateUserMastery({\n      overallScore,\n      currentLevel,\n      quizPerformanceScore,\n      topicCoverageScore,\n      retentionScore,\n      topicsMastered: 0, // Will implement in Phase 2\n      totalQuizzesTaken: totalQuizzes,\n    });\n  }\n\n  // Thread endpoints\n  \n  // Get all threads\n  app.get(\"/api/threads\", async (req, res) => {\n    try {\n      const threads = await storage.getThreads();\n      res.json(threads);\n    } catch (error) {\n      console.error(\"Error fetching threads:\", error);\n      res.status(500).json({ error: \"Failed to fetch threads\" });\n    }\n  });\n\n  // Get single thread\n  app.get(\"/api/threads/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const thread = await storage.getThread(id);\n      if (thread) {\n        res.json(thread);\n      } else {\n        res.status(404).json({ error: \"Thread not found\" });\n      }\n    } catch (error) {\n      console.error(\"Error fetching thread:\", error);\n      res.status(500).json({ error: \"Failed to fetch thread\" });\n    }\n  });\n\n  // Get messages for a thread\n  app.get(\"/api/threads/:id/messages\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const messages = await storage.getMessages(id);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching messages:\", error);\n      res.status(500).json({ error: \"Failed to fetch messages\" });\n    }\n  });\n\n  // Delete thread\n  app.delete(\"/api/threads/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteThread(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting thread:\", error);\n      res.status(500).json({ error: \"Failed to delete thread\" });\n    }\n  });\n\n  // Legacy conversation endpoints (kept for backward compatibility)\n  app.get(\"/api/conversations\", async (req, res) => {\n    try {\n      const conversations = await storage.getConversations();\n      res.json(conversations);\n    } catch (error) {\n      console.error(\"Error fetching conversations:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversations\" });\n    }\n  });\n\n  app.get(\"/api/conversations/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const conversation = await storage.getConversation(id);\n      if (conversation) {\n        res.json(conversation);\n      } else {\n        res.status(404).json({ error: \"Conversation not found\" });\n      }\n    } catch (error) {\n      console.error(\"Error fetching conversation:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversation\" });\n    }\n  });\n\n  app.delete(\"/api/conversations/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteConversation(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting conversation:\", error);\n      res.status(500).json({ error: \"Failed to delete conversation\" });\n    }\n  });\n\n  // Get quiz question bank summary - grouped by topic\n  app.get(\"/api/quiz/categories\", async (req, res) => {\n    try {\n      const categories = await storage.getQuizCategories();\n      res.json(categories);\n    } catch (error) {\n      console.error(\"Error fetching quiz categories:\", error);\n      res.status(500).json({ error: \"Failed to fetch quiz categories\" });\n    }\n  });\n\n  // Get quiz questions for a specific topic\n  app.get(\"/api/quiz/questions/:topic\", async (req, res) => {\n    try {\n      const topic = decodeURIComponent(req.params.topic);\n      const questions = await storage.getQuizQuestions(topic);\n      res.json(questions);\n    } catch (error) {\n      console.error(\"Error fetching quiz questions:\", error);\n      res.status(500).json({ error: \"Failed to fetch quiz questions\" });\n    }\n  });\n\n  // Get quiz stats for all topics\n  app.get(\"/api/quiz/stats\", async (req, res) => {\n    try {\n      const stats = await storage.getAllQuizStats();\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching quiz stats:\", error);\n      res.status(500).json({ error: \"Failed to fetch quiz stats\" });\n    }\n  });\n\n  // Get quiz history with best scores and attempts per topic\n  app.get(\"/api/quiz/history\", async (req, res) => {\n    try {\n      const history = await storage.getQuizHistory();\n      res.json(history);\n    } catch (error) {\n      console.error(\"Error fetching quiz history:\", error);\n      res.status(500).json({ error: \"Failed to fetch quiz history\" });\n    }\n  });\n\n  // Submit quiz results and update mastery score\n  app.post(\"/api/quiz/submit\", async (req, res) => {\n    try {\n      console.log(\"ðŸ“ QUIZ SUBMIT received:\", req.body);\n      const { topic, category, score, totalQuestions, correctAnswers } = req.body;\n      \n      if (!topic || !category || typeof score !== 'number' || !totalQuestions || typeof correctAnswers !== 'number') {\n        console.log(\"âŒ Missing required fields:\", { topic, category, score, totalQuestions, correctAnswers });\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      console.log(\"âœ… Saving quiz attempt...\");\n      const result = await storage.saveQuizAttemptAndUpdateMastery(\n        topic,\n        category,\n        score,\n        totalQuestions,\n        correctAnswers\n      );\n\n      console.log(\"âœ… Quiz saved successfully:\", result);\n      res.json(result);\n    } catch (error) {\n      console.error(\"âŒ Error submitting quiz:\", error);\n      res.status(500).json({ error: \"Failed to submit quiz\" });\n    }\n  });\n\n  // ===== RFP Response Generator Routes =====\n\n  // Get all RFP requirement responses\n  app.get(\"/api/rfp/responses\", async (req, res) => {\n    try {\n      const responses = await storage.getAllRfpResponses();\n      res.json(responses);\n    } catch (error) {\n      console.error(\"Error fetching RFP responses:\", error);\n      res.status(500).json({ error: \"Failed to fetch RFP responses\" });\n    }\n  });\n\n  // Get a single RFP requirement response by ID\n  app.get(\"/api/rfp/responses/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const response = await storage.getRfpResponseById(id);\n      if (!response) {\n        return res.status(404).json({ error: \"Response not found\" });\n      }\n      res.json(response);\n    } catch (error) {\n      console.error(\"Error fetching RFP response:\", error);\n      res.status(500).json({ error: \"Failed to fetch RFP response\" });\n    }\n  });\n\n  // Store a new RFP requirement response\n  app.post(\"/api/rfp/responses\", async (req, res) => {\n    try {\n      const response = await storage.createRfpResponse(req.body);\n      res.status(201).json(response);\n    } catch (error) {\n      console.error(\"Error creating RFP response:\", error);\n      res.status(500).json({ error: \"Failed to create RFP response\" });\n    }\n  });\n\n  // Update an existing RFP response\n  app.patch(\"/api/rfp/responses/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const response = await storage.updateRfpResponse(id, req.body);\n      res.json(response);\n    } catch (error) {\n      console.error(\"Error updating RFP response:\", error);\n      res.status(500).json({ error: \"Failed to update RFP response\" });\n    }\n  });\n\n  // Delete an RFP response\n  app.delete(\"/api/rfp/responses/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteRfpResponse(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting RFP response:\", error);\n      res.status(500).json({ error: \"Failed to delete RFP response\" });\n    }\n  });\n\n  // Get references for a specific RFP response (for ReferencePanel component)\n  app.get(\"/api/excel-requirements/:id/references\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const references = await storage.getReferencesForResponse(id);\n      res.json(references);\n    } catch (error) {\n      console.error(\"Error fetching references:\", error);\n      res.status(500).json({ error: \"Failed to fetch references\" });\n    }\n  });\n\n  // Process Excel file upload and store requirements\n  app.post(\"/api/analyze-excel\", async (req, res) => {\n    try {\n      const { data, replaceExisting } = req.body;\n      \n      if (!data || !Array.isArray(data)) {\n        return res.status(400).json({ error: \"Invalid data format\" });\n      }\n\n      // If replaceExisting is true, delete all existing records first\n      if (replaceExisting) {\n        // Get all existing responses and delete them\n        const existingResponses = await storage.getAllRfpResponses();\n        for (const response of existingResponses) {\n          await storage.deleteRfpResponse(response.id);\n        }\n      }\n\n      // Insert new records\n      let recordsAdded = 0;\n      for (const row of data) {\n        await storage.createRfpResponse({\n          rfpName: row.rfpName,\n          requirementId: row.requirementId,\n          category: row.category,\n          requirement: row.requirement,\n          finalResponse: row.finalResponse || \"\",\n          uploadedBy: row.uploadedBy,\n          rating: row.rating || null\n        });\n        recordsAdded++;\n      }\n\n      res.json({ \n        success: true, \n        recordsAdded,\n        message: `Successfully ${replaceExisting ? 'replaced' : 'added'} ${recordsAdded} records`\n      });\n    } catch (error) {\n      console.error(\"Error processing Excel data:\", error);\n      res.status(500).json({ error: \"Failed to process Excel data\" });\n    }\n  });\n\n  // Get all Excel requirements (alias for getAllRfpResponses)\n  app.get(\"/api/excel-requirements\", async (req, res) => {\n    try {\n      const responses = await storage.getAllRfpResponses();\n      res.json(responses);\n    } catch (error) {\n      console.error(\"Error fetching Excel requirements:\", error);\n      res.status(500).json({ error: \"Failed to fetch Excel requirements\" });\n    }\n  });\n\n  // Generate AI response for a requirement using OpenAI\n  app.post(\"/api/generate-response\", async (req, res) => {\n    try {\n      const { requirement_id, model } = req.body;\n      \n      console.log(`Generate response request for requirement ${requirement_id} with model ${model}`);\n      \n      // Get the requirement from the database\n      const requirement = await storage.getRfpResponseById(parseInt(requirement_id));\n      \n      if (!requirement) {\n        return res.status(404).json({ error: \"Requirement not found\" });\n      }\n      \n      // Import OpenAI SDK dynamically\n      const { default: OpenAI } = await import(\"openai\");\n      \n      // Initialize OpenAI client using Replit AI Integrations\n      const openai = new OpenAI({\n        baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n        apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY\n      });\n      \n      // Create prompt for RFP response generation\n      const prompt = `You are an expert RFP (Request for Proposal) response writer for a wealth management and financial services company.\n\nCategory: ${requirement.category}\nRequirement: ${requirement.requirement}\n\nPlease write a comprehensive, professional RFP response that:\n1. Directly addresses the requirement\n2. Demonstrates expertise and capability\n3. Uses specific examples where appropriate\n4. Maintains a professional, confident tone\n5. Is concise but thorough (200-400 words)\n\nWrite the response now:`;\n      \n      // Call OpenAI API\n      const response = await openai.chat.completions.create({\n        model: \"gpt-5\", // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025\n        messages: [{ role: \"user\", content: prompt }],\n        max_completion_tokens: 8192,\n        temperature: 1,\n      });\n      \n      const generatedResponse = response.choices[0]?.message?.content || \"\";\n      \n      // Update the requirement with the generated response\n      await storage.updateRfpResponse(parseInt(requirement_id), {\n        finalResponse: generatedResponse,\n        modelProvider: \"openai\"\n      });\n      \n      res.json({ \n        success: true,\n        requirement_id,\n        model,\n        response: generatedResponse,\n        message: \"Response generated successfully\"\n      });\n    } catch (error) {\n      console.error(\"Error in generate-response:\", error);\n      res.status(500).json({ \n        error: \"Failed to generate response\", \n        details: error instanceof Error ? error.message : String(error)\n      });\n    }\n  });\n\n  // ===== Investment Portal API Routes =====\n  \n  // Investment routes\n  app.get(\"/api/investments\", requireAuth, async (req: any, res) => {\n    try {\n      // Only show investments created by the logged-in user\n      const userId = req.user.id;\n      const status = req.query.status as string;\n      const investments = await storage.getInvestmentRequests({ userId, status });\n      res.json(investments);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch investments\" });\n    }\n  });\n\n  app.get(\"/api/investments/:id\", requireAuth, async (req: any, res) => {\n    try {\n      const investmentId = parseInt(req.params.id);\n      const userId = req.user.id;\n      \n      const investment = await storage.getInvestmentRequest(investmentId);\n      if (!investment) return res.status(404).json({ error: \"Investment not found\" });\n      \n      // Allow access if user created it OR if user is the assigned approver\n      const approvals = await storage.getApprovalsByRequest('investment', investmentId);\n      const isApprover = approvals.some(approval => approval.approverId === userId);\n      \n      if (investment.createdBy !== userId && !isApprover) {\n        return res.status(403).json({ error: \"Unauthorized: You don't have access to this investment\" });\n      }\n      \n      res.json(investment);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch investment\" });\n    }\n  });\n\n  app.post(\"/api/investments\", requireAuth, async (req: any, res) => {\n    try {\n      // Override createdBy with the authenticated user's ID\n      const investmentData = {\n        ...req.body,\n        createdBy: req.user.id\n      };\n      console.log(\"Creating investment with data:\", investmentData);\n      const investment = await storage.createInvestmentRequest(investmentData);\n      res.json(investment);\n    } catch (error) {\n      console.error(\"Failed to create investment:\", error);\n      res.status(500).json({ \n        error: \"Failed to create investment\",\n        details: error instanceof Error ? error.message : String(error)\n      });\n    }\n  });\n\n  app.put(\"/api/investments/:id\", requireAuth, async (req: any, res) => {\n    try {\n      const investmentId = parseInt(req.params.id);\n      const userId = req.user.id;\n      \n      // Verify the user owns this investment\n      const existingInvestment = await storage.getInvestmentRequest(investmentId);\n      if (!existingInvestment) {\n        return res.status(404).json({ error: \"Investment not found\" });\n      }\n      \n      if (existingInvestment.createdBy !== userId) {\n        return res.status(403).json({ error: \"Unauthorized: You can only edit your own investments\" });\n      }\n      \n      const investment = await storage.updateInvestmentRequest(investmentId, req.body);\n      res.json(investment);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update investment\" });\n    }\n  });\n\n  app.post(\"/api/investments/:id/submit\", requireAuth, async (req: any, res) => {\n    try {\n      const investmentId = parseInt(req.params.id);\n      const userId = req.user.id;\n\n      // Get the user's manager\n      const manager = await storage.getUserManager(userId);\n      if (!manager) {\n        return res.status(400).json({ error: \"No manager assigned. Cannot submit for approval.\" });\n      }\n\n      // Update investment status to submitted\n      await storage.updateInvestmentRequest(investmentId, { status: 'submitted' });\n\n      // Create approval record for the manager\n      const approval = await storage.createApproval({\n        requestType: 'investment',\n        requestId: investmentId,\n        approverId: manager.id,\n        status: 'pending',\n        stage: 1,\n      });\n\n      res.json({ success: true, approval });\n    } catch (error) {\n      console.error(\"Failed to submit investment:\", error);\n      res.status(500).json({ error: \"Failed to submit investment\" });\n    }\n  });\n\n  app.delete(\"/api/investments/:id\", async (req, res) => {\n    try {\n      await storage.softDeleteInvestmentRequest(parseInt(req.params.id));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete investment\" });\n    }\n  });\n\n  // Document upload route\n  app.post(\"/api/documents/upload\", documentUpload.array('documents'), async (req, res) => {\n    try {\n      const { requestType, requestId, categories, categoryId, subcategoryId } = req.body;\n      const files = req.files as Express.Multer.File[];\n      \n      console.log(`Document upload request: requestType: ${requestType}, requestId: ${requestId}, files: ${files?.length || 0}`);\n      \n      if (!files || files.length === 0) {\n        console.warn('No files provided in upload request');\n        return res.status(400).json({ message: 'No files uploaded' });\n      }\n\n      if (!requestType || !requestId) {\n        console.warn('Missing required parameters: requestType or requestId');\n        return res.status(400).json({ message: 'Missing required parameters: requestType and requestId are required' });\n      }\n      \n      const documents = [];\n      const errors = [];\n      \n      // Process files individually to handle partial failures\n      for (let i = 0; i < files.length; i++) {\n        const file = files[i];\n        try {\n          console.log(`Processing file ${i + 1}/${files.length}: ${file.originalname} (${file.size} bytes)`);\n          \n          // Validate file\n          if (!file.originalname || file.size === 0) {\n            throw new Error(`Invalid file: ${file.originalname || 'unknown'}`);\n          }\n          \n          const documentData: any = {\n            fileName: file.filename,\n            originalName: file.originalname,\n            fileSize: file.size,\n            mimeType: file.mimetype,\n            fileUrl: file.path,\n            uploaderId: null, // Nullable since auth is bypassed\n            requestType,\n            requestId: parseInt(requestId),\n          };\n          \n          // Add single category information if provided\n          if (categoryId) {\n            documentData.categoryId = parseInt(categoryId);\n          }\n          if (subcategoryId) {\n            documentData.subcategoryId = parseInt(subcategoryId);\n          }\n          \n          const document = await storage.createDocument(documentData);\n          console.log(`Document record created: ${document.id} for file ${file.originalname}`);\n          \n          documents.push(document);\n        } catch (fileError) {\n          console.error(`Failed to process file ${file.originalname}:`, fileError);\n          errors.push({\n            fileName: file.originalname,\n            error: fileError instanceof Error ? fileError.message : String(fileError)\n          });\n        }\n      }\n      \n      // If no documents were successfully processed, return error\n      if (documents.length === 0) {\n        console.error('No documents were successfully processed');\n        return res.status(500).json({ \n          message: 'Failed to upload any documents',\n          errors \n        });\n      }\n      \n      // Return success response with documents\n      const response: any = { \n        documents,\n        successful: documents.length,\n        total: files.length\n      };\n      \n      if (errors.length > 0) {\n        response.errors = errors;\n        response.message = `${documents.length}/${files.length} documents uploaded successfully`;\n        console.warn(`Partial upload success: ${documents.length}/${files.length} files processed`);\n      } else {\n        console.log(`All ${documents.length} documents uploaded successfully`);\n      }\n      \n      res.json(response);\n    } catch (error) {\n      console.error(\"Failed to upload documents:\", error);\n      res.status(500).json({ \n        error: \"Failed to upload documents\",\n        details: error instanceof Error ? error.message : String(error)\n      });\n    }\n  });\n\n  // Task routes\n  app.get(\"/api/tasks\", async (req, res) => {\n    try {\n      const userId = req.query.userId as string;\n      const tasks = await storage.getTasksByUser(userId);\n      res.json(tasks);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch tasks\" });\n    }\n  });\n\n  app.get(\"/api/tasks/:id\", async (req, res) => {\n    try {\n      const task = await storage.getTaskById(parseInt(req.params.id));\n      if (!task) return res.status(404).json({ error: \"Task not found\" });\n      res.json(task);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch task\" });\n    }\n  });\n\n  app.post(\"/api/tasks\", async (req, res) => {\n    try {\n      const task = await storage.createTask(req.body);\n      res.json(task);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create task\" });\n    }\n  });\n\n  app.put(\"/api/tasks/:id\", async (req, res) => {\n    try {\n      const task = await storage.updateTask(parseInt(req.params.id), req.body);\n      res.json(task);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update task\" });\n    }\n  });\n\n  // Approval routes\n  app.get(\"/api/approvals/my-tasks\", requireAuth, async (req: any, res) => {\n    try {\n      // Only show approvals where the logged-in user is the approver (manager)\n      const approverId = req.user.id;\n      const status = req.query.status as string;\n      const approvals = await storage.getApprovalsByApproverId(approverId, status);\n      res.json(approvals);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch approvals\" });\n    }\n  });\n\n  app.get(\"/api/approvals/:requestType/:requestId\", async (req, res) => {\n    try {\n      const approvals = await storage.getApprovalsByRequest(req.params.requestType, parseInt(req.params.requestId));\n      res.json(approvals);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch approvals\" });\n    }\n  });\n\n  app.post(\"/api/approvals\", async (req, res) => {\n    try {\n      const approval = await storage.createApproval(req.body);\n      res.json(approval);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create approval\" });\n    }\n  });\n\n  app.put(\"/api/approvals/:id\", requireAuth, async (req: any, res) => {\n    try {\n      const approvalId = parseInt(req.params.id);\n      const userId = req.user.id;\n      \n      // First, fetch the approval to verify authorization\n      const existingApproval = await storage.getApprovalById(approvalId);\n      if (!existingApproval) {\n        return res.status(404).json({ error: \"Approval not found\" });\n      }\n      \n      // Verify that the logged-in user is the assigned approver\n      if (existingApproval.approverId !== userId) {\n        return res.status(403).json({ error: \"Unauthorized: You are not the assigned approver for this request\" });\n      }\n      \n      const { status, rejectionReason, editHistory, comments } = req.body;\n      \n      // Update approval with status, rejection reason, and comments\n      const approval = await storage.updateApprovalStatus(\n        approvalId,\n        status,\n        rejectionReason,\n        editHistory,\n        comments\n      );\n      \n      res.json(approval);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update approval\" });\n    }\n  });\n\n  // Document routes\n  app.get(\"/api/documents/:requestType/:requestId\", async (req, res) => {\n    try {\n      const documents = await storage.getDocumentsByRequest(req.params.requestType, parseInt(req.params.requestId));\n      res.json(documents);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch documents\" });\n    }\n  });\n\n  app.get(\"/api/documents/download/:id\", async (req, res) => {\n    try {\n      const doc = await storage.getDocument(parseInt(req.params.id));\n      if (!doc) return res.status(404).json({ error: \"Document not found\" });\n      res.json(doc);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch document\" });\n    }\n  });\n\n  app.post(\"/api/documents\", async (req, res) => {\n    try {\n      const document = await storage.createDocument(req.body);\n      res.json(document);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create document\" });\n    }\n  });\n\n  app.delete(\"/api/documents/:id\", async (req, res) => {\n    try {\n      await storage.deleteDocument(parseInt(req.params.id));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete document\" });\n    }\n  });\n\n  // AI Document Analysis route\n  app.post(\"/api/documents/:id/analyze\", async (req, res) => {\n    try {\n      const documentId = parseInt(req.params.id);\n      const { question } = req.body;\n\n      // Get document details\n      const document = await storage.getDocument(documentId);\n      if (!document) {\n        return res.status(404).json({ error: \"Document not found\" });\n      }\n\n      // Read document content (simplified - in production you'd extract text from PDF, DOCX, etc.)\n      let documentContent = '';\n      try {\n        const fileContent = await fs.readFile(document.fileUrl, 'utf-8');\n        documentContent = fileContent.substring(0, 15000); // Limit to ~15K chars\n      } catch (error) {\n        documentContent = `Document: ${document.originalName} (${document.mimeType})`;\n      }\n\n      // Use OpenAI to analyze the document\n      const completion = await openai.chat.completions.create({\n        model: \"gpt-4o-mini\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are an expert document analyst. Analyze the provided document and answer questions about it with detailed, accurate information. Focus on key insights, important data, and actionable information.\"\n          },\n          {\n            role: \"user\",\n            content: `Document Name: ${document.originalName}\\n\\nDocument Content:\\n${documentContent}\\n\\nQuestion: ${question || 'Please provide a comprehensive summary of this document, highlighting key points, important data, and main takeaways.'}`\n          }\n        ],\n        temperature: 0.7,\n        max_tokens: 2000\n      });\n\n      const analysis = completion.choices[0].message.content;\n\n      res.json({ \n        documentName: document.originalName,\n        question: question || 'Document summary',\n        analysis: analysis,\n        success: true \n      });\n    } catch (error) {\n      console.error(\"Document analysis error:\", error);\n      res.status(500).json({ \n        error: \"Failed to analyze document\",\n        message: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // Market Regulation Research route\n  app.post(\"/api/research/regulation\", async (req, res) => {\n    try {\n      const { question, projectContext } = req.body;\n\n      if (!question) {\n        return res.status(400).json({ error: \"Question is required\" });\n      }\n\n      // Use OpenAI to research market regulations\n      const completion = await openai.chat.completions.create({\n        model: \"gpt-4o-mini\",\n        messages: [\n          {\n            role: \"system\",\n            content: `You are an expert in market regulations, compliance, and financial industry standards. Provide detailed, accurate answers about regulations, compliance requirements, and industry best practices. Focus on:\n- Specific regulatory requirements\n- Compliance obligations\n- Recent regulatory changes\n- Industry standards and guidelines\n- Practical implementation advice\n\nAlways cite relevant regulations and provide actionable guidance.`\n          },\n          {\n            role: \"user\",\n            content: projectContext \n              ? `Project Context: ${projectContext}\\n\\nRegulation Question: ${question}`\n              : `Regulation Question: ${question}`\n          }\n        ],\n        temperature: 0.3, // Lower temperature for more factual responses\n        max_tokens: 2500\n      });\n\n      const answer = completion.choices[0].message.content;\n\n      res.json({ \n        question,\n        answer,\n        projectContext: projectContext || null,\n        timestamp: new Date().toISOString(),\n        success: true \n      });\n    } catch (error) {\n      console.error(\"Market regulation research error:\", error);\n      res.status(500).json({ \n        error: \"Failed to research regulation\",\n        message: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // Document category routes\n  app.get(\"/api/document-categories\", async (req, res) => {\n    try {\n      const categories = await storage.getDocumentCategories();\n      res.json(categories);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch categories\" });\n    }\n  });\n\n  app.post(\"/api/document-categories\", async (req, res) => {\n    try {\n      const category = await storage.createDocumentCategory(req.body);\n      res.json(category);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create category\" });\n    }\n  });\n\n  // Template routes\n  app.get(\"/api/templates/investment\", async (req, res) => {\n    try {\n      const templates = await storage.getTemplatesByType(\"investment\");\n      res.json(templates);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch templates\" });\n    }\n  });\n\n  app.get(\"/api/templates/:id\", async (req, res) => {\n    try {\n      const template = await storage.getTemplate(parseInt(req.params.id));\n      if (!template) return res.status(404).json({ error: \"Template not found\" });\n      res.json(template);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch template\" });\n    }\n  });\n\n  app.post(\"/api/templates\", async (req, res) => {\n    try {\n      const template = await storage.createTemplate(req.body);\n      res.json(template);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create template\" });\n    }\n  });\n\n  app.put(\"/api/templates/:id\", async (req, res) => {\n    try {\n      const template = await storage.updateTemplate(parseInt(req.params.id), req.body);\n      res.json(template);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update template\" });\n    }\n  });\n\n  app.delete(\"/api/templates/:id\", async (req, res) => {\n    try {\n      await storage.deleteTemplate(parseInt(req.params.id));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete template\" });\n    }\n  });\n\n  // Investment rationale routes\n  app.get(\"/api/investments/:id/rationales\", async (req, res) => {\n    try {\n      const rationales = await storage.getInvestmentRationales(parseInt(req.params.id));\n      res.json(rationales);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch rationales\" });\n    }\n  });\n\n  app.post(\"/api/investments/:id/rationales\", async (req, res) => {\n    try {\n      const rationale = await storage.createInvestmentRationale(req.body);\n      res.json(rationale);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create rationale\" });\n    }\n  });\n\n  app.put(\"/api/investments/:investmentId/rationales/:id\", async (req, res) => {\n    try {\n      const rationale = await storage.updateInvestmentRationale(parseInt(req.params.id), req.body);\n      res.json(rationale);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update rationale\" });\n    }\n  });\n\n  app.delete(\"/api/investments/:investmentId/rationales/:id\", async (req, res) => {\n    try {\n      await storage.deleteInvestmentRationale(parseInt(req.params.id));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete rationale\" });\n    }\n  });\n\n  // Report Work Chat - AI-powered collaborative report drafting\n  app.post(\"/api/reports/:id/chat\", async (req, res) => {\n    try {\n      const reportId = parseInt(req.params.id);\n      const { question, templateId, sectionName, conversationHistory } = req.body;\n\n      // 1. Fetch report details\n      const report = await storage.getInvestmentRequest(reportId);\n      if (!report) {\n        return res.status(404).json({ error: \"Report not found\" });\n      }\n\n      // 2. Fetch attached documents\n      const documents = await storage.getDocumentsByRequest('investment', reportId);\n\n      // 3. Build comprehensive context\n      let contextParts: string[] = [];\n\n      // Add report description\n      if (report.description) {\n        contextParts.push(`Report Description: ${report.description}`);\n      }\n\n      // Add report metadata\n      contextParts.push(`Subject/Client: ${report.targetCompany}`);\n      contextParts.push(`Report Type: ${report.investmentType}`);\n      if (report.reportTitle) {\n        contextParts.push(`Report Title: ${report.reportTitle}`);\n      }\n\n      // Add template context if selected\n      if (templateId) {\n        const template = await storage.getTemplate(templateId);\n        if (template) {\n          contextParts.push(`\\nSelected Template: ${template.name}`);\n          \n          // Parse template data to get sections and structure\n          try {\n            // Handle both string and pre-parsed object formats\n            const templateData = typeof template.templateData === 'string'\n              ? JSON.parse(template.templateData)\n              : template.templateData;\n            if (templateData.sections && Array.isArray(templateData.sections)) {\n              const sectionNames = templateData.sections.map((s: any) => \n                s.name || s.title || s\n              );\n              contextParts.push(`Template Sections: ${sectionNames.join(', ')}`);\n              \n              // If a specific section is selected, add its details\n              if (sectionName) {\n                const selectedSectionData = templateData.sections.find((s: any) => \n                  (s.name || s.title || s) === sectionName\n                );\n                if (selectedSectionData) {\n                  if (selectedSectionData.wordLimit) {\n                    contextParts.push(`Section Word Limit: ${selectedSectionData.wordLimit} words`);\n                  }\n                  if (selectedSectionData.description) {\n                    contextParts.push(`Section Description: ${selectedSectionData.description}`);\n                  }\n                }\n              }\n            }\n          } catch (e) {\n            console.error(\"Failed to parse template data:\", e);\n          }\n        }\n      }\n\n      // Add section focus if selected\n      if (sectionName) {\n        contextParts.push(`\\nCurrent Section: ${sectionName}`);\n      }\n\n      // Add document information\n      if (documents && documents.length > 0) {\n        contextParts.push(`\\nAttached Documents (${documents.length}):`);\n        documents.forEach((doc: any, idx: number) => {\n          contextParts.push(`${idx + 1}. ${doc.fileName} (${doc.categoryName || 'Uncategorized'})`);\n        });\n      }\n\n      const reportContext = contextParts.join('\\n');\n\n      // 4. Query EKG for additional context\n      let ekgContext = \"\";\n      try {\n        const ekgResponse = await fetch(`${EKG_API_URL}/v1/answer`, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ question }),\n        });\n\n        if (ekgResponse.ok) {\n          const ekgData = await ekgResponse.json();\n          if (ekgData.answer) {\n            ekgContext = `\\n\\nKnowledge Base Context:\\n${cleanAnswer(ekgData.answer)}`;\n          }\n        }\n      } catch (error) {\n        console.log(\"EKG service unavailable, continuing without it\");\n      }\n\n      // 5. Build AI prompt\n      const systemPrompt = `You are an expert business analyst and report writing assistant. You help users draft comprehensive, professional reports using templates.\n\nYou have access to:\n- The report's description and metadata\n- All attached documents for analysis and reference\n- External knowledge from the EKG service\n- Historical best practices from the vector store\n${templateId ? '- The selected template structure and section requirements' : ''}\n\nYour role is to:\n- Help users draft content for specific template sections\n- Analyze and incorporate insights from attached documents\n- Provide context-aware suggestions based on template requirements\n- Respect word limits and section descriptions when provided\n- Suggest improvements and best practices\n- Generate professional, well-structured content\n\nReport Context:\n${reportContext}${ekgContext}\n\nWhen drafting content:\n1. If a template section is selected, tailor your response to that section's requirements\n2. Reference the attached documents when relevant to provide evidence-based content\n3. Follow professional business writing standards\n4. Respect any word limits specified in the template\n5. Provide actionable, clear, and comprehensive responses`;\n\n      // 6. Build conversation messages\n      const messages = [\n        { role: \"system\", content: systemPrompt },\n        ...(conversationHistory || []).slice(-6), // Keep last 6 messages for context\n        { role: \"user\", content: question }\n      ];\n\n      // 7. Call OpenAI\n      const completion = await openai.chat.completions.create({\n        model: \"gpt-4o-mini\",\n        messages: messages as any,\n        temperature: 0.7,\n        max_tokens: 2000,\n      });\n\n      const answer = completion.choices[0]?.message?.content || \"I apologize, but I couldn't generate a response. Please try again.\";\n\n      res.json({ \n        answer,\n        context: {\n          reportTitle: report.reportTitle,\n          documentCount: documents?.length || 0,\n          hasEkgContext: ekgContext.length > 0\n        }\n      });\n\n    } catch (error: any) {\n      console.error(\"Error in report chat:\", error);\n      res.status(500).json({ \n        error: \"Failed to process chat request\",\n        details: error.message \n      });\n    }\n  });\n\n  // Notification routes\n  app.get(\"/api/notifications\", async (req, res) => {\n    try {\n      const userId = req.query.userId as string;\n      const notifications = await storage.getUserNotifications(userId);\n      res.json(notifications);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch notifications\" });\n    }\n  });\n\n  app.patch(\"/api/notifications/:id/read\", async (req, res) => {\n    try {\n      await storage.markNotificationAsRead(parseInt(req.params.id));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to mark notification as read\" });\n    }\n  });\n\n  app.delete(\"/api/notifications/:id\", async (req, res) => {\n    try {\n      await storage.deleteNotification(parseInt(req.params.id));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete notification\" });\n    }\n  });\n\n  // Solution Template routes\n  app.post(\"/api/solution-templates/init\", async (req, res) => {\n    try {\n      // Create default template\n      const template = await storage.createSolutionTemplate({\n        title: \"Standard Solution Document\",\n        description: \"Business Analyst standard format for system change documentation\",\n        isDefault: true\n      });\n\n      // Create sections in order\n      const sectionsData = [\n        { type: \"heading\", title: \"Document Header\", orderIndex: 0 },\n        { type: \"revisionHistory\", title: \"Revision History\", orderIndex: 1 },\n        { type: \"tableOfContents\", title: \"Table of Contents\", orderIndex: 2 },\n        { type: \"changeRequirement\", title: \"1. Change Requirement\", orderIndex: 3 },\n        { type: \"pdaReference\", title: \"2. PDA Reference Number\", orderIndex: 4 },\n        { type: \"pfasReference\", title: \"3. PFAS Document Reference\", orderIndex: 5 },\n        { type: \"businessImpact\", title: \"4. Business Impact\", orderIndex: 6 },\n        { type: \"affectedSystems\", title: \"5. Affected Systems\", orderIndex: 7 },\n        { type: \"solution\", title: \"6. Solution\", orderIndex: 8 },\n        { type: \"testScenarios\", title: \"7. Test Scenarios\", orderIndex: 9 }\n      ];\n\n      const sections = [];\n      for (const sectionData of sectionsData) {\n        const section = await storage.createTemplateSection({\n          templateId: template.id,\n          sectionType: sectionData.type,\n          title: sectionData.title,\n          content: null,\n          orderIndex: sectionData.orderIndex,\n          isEditable: true\n        });\n        sections.push(section);\n      }\n\n      // Add default work items to Solution section\n      const solutionSection = sections.find(s => s.sectionType === \"solution\");\n      if (solutionSection) {\n        const workItemsData = [\n          { title: \"Description of Change\", orderIndex: 0 },\n          { title: \"Logic and Validations\", orderIndex: 1 },\n          { title: \"UI Changes\", orderIndex: 2 },\n          { title: \"Batch Processing\", orderIndex: 3 },\n          { title: \"API Changes\", orderIndex: 4 },\n          { title: \"Field-Level Changes\", orderIndex: 5 }\n        ];\n\n        for (const workItemData of workItemsData) {\n          await storage.createTemplateWorkItem({\n            sectionId: solutionSection.id,\n            title: workItemData.title,\n            content: null,\n            orderIndex: workItemData.orderIndex,\n            isIncluded: true\n          });\n        }\n      }\n\n      // Add pre-populated content for Affected Systems\n      const affectedSystemsSection = sections.find(s => s.sectionType === \"affectedSystems\");\n      if (affectedSystemsSection) {\n        await storage.updateTemplateSection(affectedSystemsSection.id, {\n          content: `- RM Office\n- Operations Office\n- Client Portal\n- Revenue Desk\n- Sigma (Reports Module)\n- APIs`\n        });\n      }\n\n      res.json(template);\n    } catch (error) {\n      console.error(\"Failed to initialize template:\", error);\n      res.status(500).json({ error: \"Failed to initialize template\" });\n    }\n  });\n\n  app.get(\"/api/solution-templates\", async (req, res) => {\n    try {\n      const templates = await storage.getAllSolutionTemplates();\n      res.json(templates);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch solution templates\" });\n    }\n  });\n\n  app.get(\"/api/solution-templates/default\", async (req, res) => {\n    try {\n      const template = await storage.getDefaultSolutionTemplate();\n      if (!template) {\n        res.status(404).json({ error: \"No default template found\" });\n        return;\n      }\n      res.json(template);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch default template\" });\n    }\n  });\n\n  app.get(\"/api/solution-templates/:id\", async (req, res) => {\n    try {\n      const template = await storage.getSolutionTemplate(parseInt(req.params.id));\n      if (!template) {\n        res.status(404).json({ error: \"Template not found\" });\n        return;\n      }\n      res.json(template);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch solution template\" });\n    }\n  });\n\n  app.get(\"/api/solution-templates/:id/complete\", async (req, res) => {\n    try {\n      const completeTemplate = await storage.getCompleteTemplate(parseInt(req.params.id));\n      if (!completeTemplate) {\n        res.status(404).json({ error: \"Template not found\" });\n        return;\n      }\n      res.json(completeTemplate);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch complete template\" });\n    }\n  });\n\n  app.post(\"/api/solution-templates\", async (req, res) => {\n    try {\n      const template = await storage.createSolutionTemplate(req.body);\n      res.json(template);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create solution template\" });\n    }\n  });\n\n  app.put(\"/api/solution-templates/:id\", async (req, res) => {\n    try {\n      const template = await storage.updateSolutionTemplate(parseInt(req.params.id), req.body);\n      res.json(template);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update solution template\" });\n    }\n  });\n\n  app.delete(\"/api/solution-templates/:id\", async (req, res) => {\n    try {\n      await storage.deleteSolutionTemplate(parseInt(req.params.id));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete solution template\" });\n    }\n  });\n\n  app.get(\"/api/template-sections/:templateId\", async (req, res) => {\n    try {\n      const sections = await storage.getTemplateSections(parseInt(req.params.templateId));\n      res.json(sections);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch template sections\" });\n    }\n  });\n\n  app.post(\"/api/template-sections\", async (req, res) => {\n    try {\n      const section = await storage.createTemplateSection(req.body);\n      res.json(section);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create template section\" });\n    }\n  });\n\n  app.put(\"/api/template-sections/:id\", async (req, res) => {\n    try {\n      const section = await storage.updateTemplateSection(parseInt(req.params.id), req.body);\n      res.json(section);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update template section\" });\n    }\n  });\n\n  app.delete(\"/api/template-sections/:id\", async (req, res) => {\n    try {\n      await storage.deleteTemplateSection(parseInt(req.params.id));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete template section\" });\n    }\n  });\n\n  app.get(\"/api/template-work-items/:sectionId\", async (req, res) => {\n    try {\n      const workItems = await storage.getTemplateWorkItems(parseInt(req.params.sectionId));\n      res.json(workItems);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch template work items\" });\n    }\n  });\n\n  app.post(\"/api/template-work-items\", async (req, res) => {\n    try {\n      const workItem = await storage.createTemplateWorkItem(req.body);\n      res.json(workItem);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create template work item\" });\n    }\n  });\n\n  app.put(\"/api/template-work-items/:id\", async (req, res) => {\n    try {\n      const workItem = await storage.updateTemplateWorkItem(parseInt(req.params.id), req.body);\n      res.json(workItem);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to update template work item\" });\n    }\n  });\n\n  app.delete(\"/api/template-work-items/:id\", async (req, res) => {\n    try {\n      await storage.deleteTemplateWorkItem(parseInt(req.params.id));\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to delete template work item\" });\n    }\n  });\n\n  app.get(\"/api/template-revisions/:templateId\", async (req, res) => {\n    try {\n      const revisions = await storage.getTemplateRevisions(parseInt(req.params.templateId));\n      res.json(revisions);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to fetch template revisions\" });\n    }\n  });\n\n  app.post(\"/api/template-revisions\", async (req, res) => {\n    try {\n      const revision = await storage.createTemplateRevision(req.body);\n      res.json(revision);\n    } catch (error) {\n      res.status(500).json({ error: \"Failed to create template revision\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","size_bytes":72337},"client/src/pages/chatbot.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { \n  Loader2, \n  Send, \n  Sparkles,\n  User,\n  Download,\n  RefreshCw,\n  FileText,\n  FileType,\n  Zap,\n  ShoppingCart,\n  Users,\n  Package,\n  ArrowRightLeft,\n  Network,\n  Shield,\n  FileBarChart\n} from \"lucide-react\";\nimport jsPDF from \"jspdf\";\nimport ReactMarkdown from \"react-markdown\";\nimport rehypeRaw from \"rehype-raw\";\nimport remarkGfm from \"remark-gfm\";\nimport { ThreadSidebar } from \"@/components/thread-sidebar\";\nimport { AIConfigSidebar, type AIConfig } from \"@/components/ai-config-sidebar\";\nimport { QuizMessage } from \"@/components/quiz-message\";\nimport type { Thread, Message } from \"@shared/schema\";\nimport type { QuizData } from \"@/types/quiz\";\n\n// Helper function to decode HTML entities\nfunction decodeHTMLEntities(text: string): string {\n  const textarea = document.createElement('textarea');\n  textarea.innerHTML = text;\n  return textarea.value;\n}\n\n// Helper function to remove Knowledge Graph tags like [KG: otp]\nfunction removeKGTags(text: string): string {\n  return text.replace(/\\s*\\[KG:\\s*[^\\]]+\\]/gi, '');\n}\n\n// Helper function to remove \"Sources by File\" section and clean up citations\nfunction cleanupCitations(text: string): string {\n  // Remove the entire \"Sources by File\" section\n  let cleaned = text.replace(/---\\s*##\\s*\\*\\*Sources by File\\*\\*[\\s\\S]*$/i, '');\n  \n  // Remove bold formatting from citation filenames (e.g., **[1]** â†’ [1])\n  cleaned = cleaned.replace(/\\*\\*\\[(\\d+)\\]\\*\\*/g, '[$1]');\n  \n  // Remove bold from citation filenames (e.g., **filename.pdf** â†’ filename.pdf)\n  cleaned = cleaned.replace(/\\*\\*([^*]+\\.(pdf|docx|doc|xlsx)[^*]*)\\*\\*/gi, '$1');\n  \n  return cleaned;\n}\n\n// Conversation starter prompts organized by category (top 6 most relevant)\nconst conversationStarters = [\n  {\n    category: \"Order Journey\",\n    icon: ShoppingCart,\n    color: \"from-blue-500/10 to-blue-500/5 border-blue-500/20 hover:border-blue-500/40\",\n    iconColor: \"text-blue-500\",\n    prompts: [\n      \"How does the order placement workflow work?\",\n      \"What's the difference between buy and sell orders?\",\n      \"Explain the order settlement process\"\n    ]\n  },\n  {\n    category: \"Customer Management\",\n    icon: Users,\n    color: \"from-purple-500/10 to-purple-500/5 border-purple-500/20 hover:border-purple-500/40\",\n    iconColor: \"text-purple-500\",\n    prompts: [\n      \"Explain the KYC verification process\",\n      \"How are customer accounts categorized?\",\n      \"What is customer onboarding workflow?\"\n    ]\n  },\n  {\n    category: \"Products & Securities\",\n    icon: Package,\n    color: \"from-green-500/10 to-green-500/5 border-green-500/20 hover:border-green-500/40\",\n    iconColor: \"text-green-500\",\n    prompts: [\n      \"What types of mutual funds are available?\",\n      \"How does portfolio rebalancing work?\",\n      \"Explain different security types\"\n    ]\n  },\n  {\n    category: \"Transactions\",\n    icon: ArrowRightLeft,\n    color: \"from-amber-500/10 to-amber-500/5 border-amber-500/20 hover:border-amber-500/40\",\n    iconColor: \"text-amber-500\",\n    prompts: [\n      \"What's the difference between SIP and SWP?\",\n      \"How do redemption transactions work?\",\n      \"Explain systematic transfer plans\"\n    ]\n  },\n  {\n    category: \"Compliance\",\n    icon: Shield,\n    color: \"from-red-500/10 to-red-500/5 border-red-500/20 hover:border-red-500/40\",\n    iconColor: \"text-red-500\",\n    prompts: [\n      \"What are SEBI regulations for wealth management?\",\n      \"Explain AML compliance requirements\",\n      \"What are KYC documentation standards?\"\n    ]\n  },\n  {\n    category: \"Reports\",\n    icon: FileBarChart,\n    color: \"from-indigo-500/10 to-indigo-500/5 border-indigo-500/20 hover:border-indigo-500/40\",\n    iconColor: \"text-indigo-500\",\n    prompts: [\n      \"What reports are generated for clients?\",\n      \"How to interpret portfolio statements?\",\n      \"Explain transaction confirmation documents\"\n    ]\n  }\n];\n\n// Helper function to format API responses professionally\nfunction formatProfessionally(text: string): string {\n  let formatted = text;\n  \n  // Remove the KG + VectorStore header and context ID\n  formatted = formatted.replace(/^#\\s*\\*\\*KG \\+ VectorStore Answer[\\s\\S]*?\\*\\*\\n*/im, '');\n  \n  // Remove \"Question:\" label and keep just the question text\n  formatted = formatted.replace(/Question:\\s*/gi, '');\n  \n  // Move \"Generated:\" timestamp to the end - first capture it, then move it\n  let generatedTimestamp = '';\n  formatted = formatted.replace(/_Generated:\\s*([^\\n]+)_\\n*/gi, (match, timestamp) => {\n    generatedTimestamp = `\\n\\n---\\n\\n*Generated: ${timestamp}*`;\n    return '';\n  });\n  \n  // Remove \"Direct Answer:\" label and just show the content\n  formatted = formatted.replace(/^##?\\s*\\*?\\*?Direct Answer:?\\*?\\*?\\s*/im, '');\n  formatted = formatted.replace(/\\n##?\\s*\\*?\\*?Direct Answer:?\\*?\\*?\\s*/im, '\\n');\n  \n  // Remove \"Answer:\" or \"Answer\" heading (user already knows it's an answer)\n  formatted = formatted.replace(/^##?\\s*\\*?\\*?Answer:?\\*?\\*?\\s*\\n*/im, '');\n  formatted = formatted.replace(/\\n##?\\s*\\*?\\*?Answer:?\\*?\\*?\\s*/im, '\\n');\n  \n  // Convert \"Point 1:\", \"Point 2:\" etc. to bullet points\n  formatted = formatted.replace(/^Point\\s+(\\d+):\\s*/gim, '- ');\n  formatted = formatted.replace(/\\n\\s*Point\\s+(\\d+):\\s*/gim, '\\n- ');\n  \n  // Convert \"Finding 1/\", \"Finding 2/\" etc. to bullet points\n  formatted = formatted.replace(/^Finding\\s+(\\d+)\\/?\\s*/gim, '- ');\n  formatted = formatted.replace(/\\n\\s*Finding\\s+(\\d+)\\/?\\s*/gim, '\\n- ');\n  \n  // Convert numbered list format \"1.\", \"2.\" at start of line to bullet points (only if standalone)\n  formatted = formatted.replace(/^\\d+\\.\\s+/gm, '- ');\n  \n  // Clean up any \"**Direct Answer**\" that might still be in the text\n  formatted = formatted.replace(/\\*\\*Direct Answer:?\\*\\*/gi, '');\n  \n  // Append the timestamp at the end if we found one\n  if (generatedTimestamp) {\n    formatted += generatedTimestamp;\n  }\n  \n  return formatted;\n}\n\n// Helper function to download a single message exchange as Markdown\nfunction downloadMessageMarkdown(userMessage: string, assistantMessage: string, timestamp: string) {\n  const content = `# WealthForce Knowledge Agent - Conversation Export\n\n**Generated:** ${new Date(timestamp).toLocaleString()}\n\n---\n\n## Question\n\n${userMessage}\n\n---\n\n## Answer\n\n${assistantMessage}\n\n---\n`;\n\n  const blob = new Blob([content], { type: 'text/markdown' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = `answer-${new Date(timestamp).toISOString().slice(0, 10)}.md`;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n  URL.revokeObjectURL(url);\n}\n\n// Helper function to download a single message exchange as PDF\nfunction downloadMessagePDF(userMessage: string, assistantMessage: string, timestamp: string) {\n  const pdf = new jsPDF();\n  const margin = 20;\n  const pageWidth = pdf.internal.pageSize.getWidth();\n  const maxWidth = pageWidth - (margin * 2);\n  let yPosition = margin;\n\n  // Title\n  pdf.setFontSize(16);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('WealthForce Knowledge Agent', margin, yPosition);\n  yPosition += 10;\n\n  pdf.setFontSize(10);\n  pdf.setFont('helvetica', 'normal');\n  pdf.text(`Generated: ${new Date(timestamp).toLocaleString()}`, margin, yPosition);\n  yPosition += 15;\n\n  // Question\n  pdf.setFontSize(12);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('Question:', margin, yPosition);\n  yPosition += 7;\n\n  pdf.setFontSize(10);\n  pdf.setFont('helvetica', 'normal');\n  const questionLines = pdf.splitTextToSize(userMessage, maxWidth);\n  pdf.text(questionLines, margin, yPosition);\n  yPosition += (questionLines.length * 5) + 10;\n\n  // Answer\n  pdf.setFontSize(12);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('Answer:', margin, yPosition);\n  yPosition += 7;\n\n  pdf.setFontSize(10);\n  pdf.setFont('helvetica', 'normal');\n  \n  // Clean the assistant message for PDF (remove markdown)\n  const cleanAnswer = assistantMessage\n    .replace(/[#*_`]/g, '')\n    .replace(/\\[(\\d+)\\]/g, '[$1]')\n    .replace(/<[^>]*>/g, '');\n  \n  const answerLines = pdf.splitTextToSize(cleanAnswer, maxWidth);\n  const lineHeight = 5;\n  const pageHeight = pdf.internal.pageSize.getHeight();\n  \n  // Write answer with pagination\n  for (let i = 0; i < answerLines.length; i++) {\n    // Check if we need a new page\n    if (yPosition + lineHeight > pageHeight - margin) {\n      pdf.addPage();\n      yPosition = margin;\n    }\n    \n    pdf.text(answerLines[i], margin, yPosition);\n    yPosition += lineHeight;\n  }\n\n  pdf.save(`answer-${new Date(timestamp).toISOString().slice(0, 10)}.pdf`);\n}\n\n// Helper function to download entire thread conversation as text\nfunction downloadThreadAsText(messages: Message[], threadTitle: string) {\n  let content = `WealthForce Knowledge Agent - Full Conversation Export\nThread: ${threadTitle}\nGenerated: ${new Date().toLocaleString()}\n\n========================================\\n\\n`;\n\n  for (let i = 0; i < messages.length; i += 2) {\n    const userMsg = messages[i];\n    const assistantMsg = messages[i + 1];\n    \n    if (userMsg && assistantMsg) {\n      content += `[${new Date(userMsg.createdAt).toLocaleString()}]\\n`;\n      content += `Question:\\n${userMsg.content}\\n\\n`;\n      content += `Answer:\\n${assistantMsg.content}\\n\\n`;\n      content += `========================================\\n\\n`;\n    }\n  }\n\n  const blob = new Blob([content], { type: 'text/plain' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = `conversation-${threadTitle.replace(/[^a-z0-9]/gi, '-').toLowerCase()}-${new Date().toISOString().slice(0, 10)}.txt`;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n  URL.revokeObjectURL(url);\n}\n\n// Helper function to download entire thread conversation as PDF\nfunction downloadThreadAsPDF(messages: Message[], threadTitle: string) {\n  const pdf = new jsPDF();\n  const margin = 15;\n  const maxWidth = pdf.internal.pageSize.getWidth() - 2 * margin;\n  const pageHeight = pdf.internal.pageSize.getHeight();\n  let yPosition = margin;\n\n  // Title\n  pdf.setFontSize(16);\n  pdf.setFont('helvetica', 'bold');\n  pdf.text('WealthForce Knowledge Agent', margin, yPosition);\n  yPosition += 10;\n\n  pdf.setFontSize(12);\n  pdf.setFont('helvetica', 'normal');\n  pdf.text(`Thread: ${threadTitle}`, margin, yPosition);\n  yPosition += 6;\n  pdf.text(`Generated: ${new Date().toLocaleString()}`, margin, yPosition);\n  yPosition += 12;\n\n  // Process each Q&A pair\n  for (let i = 0; i < messages.length; i += 2) {\n    const userMsg = messages[i];\n    const assistantMsg = messages[i + 1];\n    \n    if (userMsg && assistantMsg) {\n      // Check if we need a new page for this Q&A\n      if (yPosition + 40 > pageHeight - margin) {\n        pdf.addPage();\n        yPosition = margin;\n      }\n\n      // Timestamp\n      pdf.setFontSize(9);\n      pdf.setFont('helvetica', 'italic');\n      pdf.text(`[${new Date(userMsg.createdAt).toLocaleString()}]`, margin, yPosition);\n      yPosition += 8;\n\n      // Question\n      pdf.setFontSize(12);\n      pdf.setFont('helvetica', 'bold');\n      pdf.text('Question:', margin, yPosition);\n      yPosition += 7;\n\n      pdf.setFontSize(10);\n      pdf.setFont('helvetica', 'normal');\n      const questionLines = pdf.splitTextToSize(userMsg.content, maxWidth);\n      for (let j = 0; j < questionLines.length; j++) {\n        if (yPosition + 5 > pageHeight - margin) {\n          pdf.addPage();\n          yPosition = margin;\n        }\n        pdf.text(questionLines[j], margin, yPosition);\n        yPosition += 5;\n      }\n      yPosition += 5;\n\n      // Answer\n      pdf.setFontSize(12);\n      pdf.setFont('helvetica', 'bold');\n      pdf.text('Answer:', margin, yPosition);\n      yPosition += 7;\n\n      pdf.setFontSize(10);\n      pdf.setFont('helvetica', 'normal');\n      \n      // Clean the assistant message for PDF\n      const cleanAnswer = assistantMsg.content\n        .replace(/[#*_`]/g, '')\n        .replace(/\\[(\\d+)\\]/g, '[$1]')\n        .replace(/<[^>]*>/g, '');\n      \n      const answerLines = pdf.splitTextToSize(cleanAnswer, maxWidth);\n      for (let j = 0; j < answerLines.length; j++) {\n        if (yPosition + 5 > pageHeight - margin) {\n          pdf.addPage();\n          yPosition = margin;\n        }\n        pdf.text(answerLines[j], margin, yPosition);\n        yPosition += 5;\n      }\n      \n      // Separator\n      yPosition += 8;\n      if (yPosition + 5 > pageHeight - margin) {\n        pdf.addPage();\n        yPosition = margin;\n      }\n      pdf.setLineWidth(0.5);\n      pdf.line(margin, yPosition, pdf.internal.pageSize.getWidth() - margin, yPosition);\n      yPosition += 10;\n    }\n  }\n\n  pdf.save(`conversation-${threadTitle.replace(/[^a-z0-9]/gi, '-').toLowerCase()}-${new Date().toISOString().slice(0, 10)}.pdf`);\n}\n\nexport default function ChatbotPage() {\n  const [question, setQuestion] = useState(\"\");\n  const [currentThreadId, setCurrentThreadId] = useState<number | undefined>();\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [quizzes, setQuizzes] = useState<QuizData[]>([]);\n  const [mode, setMode] = useState<\"concise\" | \"balanced\" | \"deep\">(\"concise\"); // Short is default\n  const [showDownloadDialog, setShowDownloadDialog] = useState(false);\n  const [aiConfig, setAIConfig] = useState<AIConfig>({\n    model: \"GPT-4o\",\n    temperature: 0.7,\n    hops: 3,\n    tokenLimit: 2048,\n    systemPrompt: \"You are a helpful wealth management AI assistant.\",\n  });\n  const scrollAreaRef = useRef<HTMLDivElement>(null);\n  const lastAssistantMessageRef = useRef<HTMLDivElement>(null);\n  const { toast } = useToast();\n\n  // Fetch current thread details\n  const { data: currentThread } = useQuery<Thread>({\n    queryKey: [`/api/threads/${currentThreadId}`],\n    enabled: !!currentThreadId,\n  });\n\n  // Fetch messages when thread is selected\n  const { data: fetchedMessages, refetch: refetchMessages } = useQuery<Message[]>({\n    queryKey: [`/api/threads/${currentThreadId}/messages`],\n    enabled: !!currentThreadId,\n  });\n\n  // Update messages when thread changes\n  useEffect(() => {\n    if (fetchedMessages) {\n      setMessages(fetchedMessages);\n    } else {\n      setMessages([]);\n    }\n    // Clear quizzes when thread changes\n    setQuizzes([]);\n  }, [fetchedMessages]);\n\n  // Auto-scroll to show top of new assistant messages\n  useEffect(() => {\n    if (lastAssistantMessageRef.current && messages.length > 0) {\n      const lastMessage = messages[messages.length - 1];\n      \n      // Only scroll if the last message is an assistant message (new answer)\n      if (lastMessage.role === \"assistant\") {\n        lastAssistantMessageRef.current.scrollIntoView({ \n          behavior: \"smooth\", \n          block: \"start\" \n        });\n      }\n    }\n  }, [messages]);\n\n  const queryMutation = useMutation({\n    mutationFn: async (payload: { question: string; threadId?: number }) => {\n      const response = await apiRequest(\"POST\", \"/api/query\", {\n        question: payload.question,\n        mode: mode,\n        refresh: false,\n        threadId: payload.threadId,\n      });\n      const result = await response.json();\n      return result;\n    },\n    onSuccess: (data, variables) => {\n      if (data.error) {\n        toast({\n          title: \"Error\",\n          description: data.error,\n          variant: \"destructive\",\n        });\n      } else {\n        // Set the thread ID if this was a new conversation\n        if (!currentThreadId && data.threadId) {\n          setCurrentThreadId(data.threadId);\n        }\n        \n        // Add user message - use the question from variables instead of state\n        const userMessage: Message = {\n          id: Date.now(),\n          threadId: data.threadId,\n          role: \"user\",\n          content: variables.question,\n          responseId: null,\n          sources: null,\n          metadata: null,\n          createdAt: new Date(),\n        };\n        \n        // Add assistant message\n        const assistantMessage: Message = {\n          id: Date.now() + 1,\n          threadId: data.threadId,\n          role: \"assistant\",\n          content: data.data,\n          responseId: data.responseId || null,\n          sources: data.citations || null,\n          metadata: data.metadata || null,\n          createdAt: new Date(),\n        };\n        \n        setMessages((prev) => [...prev, userMessage, assistantMessage]);\n        setQuestion(\"\");\n        \n        // Invalidate queries to refresh thread list\n        queryClient.invalidateQueries({ queryKey: [\"/api/threads\"] });\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to send message\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (promptText?: string) => {\n    const questionToSubmit = promptText || question;\n    \n    if (!questionToSubmit.trim()) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please enter a question\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    queryMutation.mutate({\n      question: questionToSubmit,\n      threadId: currentThreadId,\n    });\n    \n    // Clear the input if submitting from the textarea\n    if (!promptText) {\n      setQuestion(\"\");\n    }\n  };\n\n  const quizMutation = useMutation({\n    mutationFn: async (threadId: number) => {\n      const response = await apiRequest(\"POST\", \"/api/generate-quiz\", {\n        threadId,\n      });\n      const result = await response.json();\n      return result;\n    },\n    onSuccess: (data) => {\n      if (data.error) {\n        toast({\n          title: \"Error\",\n          description: data.error,\n          variant: \"destructive\",\n        });\n      } else if (data.questions && data.questions.length > 0) {\n        // Add quiz to the list\n        const newQuiz: QuizData = {\n          id: Date.now(),\n          questions: data.questions,\n        };\n        setQuizzes(prev => [...prev, newQuiz]);\n        \n        toast({\n          title: \"Quiz Generated!\",\n          description: `${data.questions.length} questions ready to test your knowledge.`,\n        });\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to generate quiz\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleGenerateQuiz = () => {\n    if (!currentThreadId) {\n      toast({\n        title: \"No Conversation\",\n        description: \"Start a conversation before generating a quiz\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (messages.length < 4) {\n      toast({\n        title: \"Not Enough Content\",\n        description: \"Have at least 2 Q&A exchanges before generating a quiz\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    quizMutation.mutate(currentThreadId);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSubmit();\n    }\n  };\n\n  const handleSelectThread = async (thread: Thread) => {\n    setCurrentThreadId(thread.id);\n  };\n\n  const handleNewChat = () => {\n    setCurrentThreadId(undefined);\n    setMessages([]);\n    setQuestion(\"\");\n  };\n\n  const handleDeleteThread = async (id: number) => {\n    try {\n      await apiRequest(\"DELETE\", `/api/threads/${id}`);\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\"] });\n      \n      if (currentThreadId === id) {\n        handleNewChat();\n      }\n      \n      toast({\n        title: \"Thread Deleted\",\n        description: \"Conversation has been deleted\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete thread\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const isLoading = queryMutation.isPending;\n  const hasMessages = messages.length > 0;\n\n  const handleConfigChange = (config: AIConfig) => {\n    setAIConfig(config);\n    // Future: Send config to backend or use in API calls\n  };\n\n  return (\n    <div className=\"flex flex-1 bg-background\">\n      <ThreadSidebar\n        onSelectThread={handleSelectThread}\n        onNewChat={handleNewChat}\n        onDeleteThread={handleDeleteThread}\n        selectedThreadId={currentThreadId}\n      />\n      \n      <div className=\"flex-1 flex flex-col\">\n        {/* Header */}\n        <header className=\"border-b border-border bg-card/30 backdrop-blur-sm px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <Sparkles className=\"w-6 h-6 text-primary\" />\n              <div>\n                <h1 className=\"text-2xl font-bold text-foreground\" data-testid=\"text-title\">\n                  WealthForce Knowledge Agent\n                </h1>\n                <p className=\"text-sm text-muted-foreground\">\n                  Conversational Wealth Management Knowledge\n                </p>\n              </div>\n            </div>\n            \n            {/* Mode Selector and Actions */}\n            <div className=\"flex items-center gap-3\">\n              {/* Download Thread Button */}\n              {currentThreadId && hasMessages && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  data-testid=\"button-download-thread\"\n                  onClick={() => setShowDownloadDialog(true)}\n                >\n                  <Download className=\"w-4 h-4 mr-2\" />\n                  Download Thread\n                </Button>\n              )}\n              \n              <span className=\"text-sm text-muted-foreground\">Mode:</span>\n              <Select value={mode} onValueChange={(value) => setMode(value as \"concise\" | \"balanced\" | \"deep\")}>\n                <SelectTrigger className=\"w-[160px]\" data-testid=\"select-mode\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"concise\" data-testid=\"option-short\">\n                    Short\n                  </SelectItem>\n                  <SelectItem value=\"balanced\" data-testid=\"option-standard\">\n                    Standard\n                  </SelectItem>\n                  <SelectItem value=\"deep\" data-testid=\"option-comprehensive\">\n                    Comprehensive\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </header>\n\n        {/* Messages Area */}\n        <ScrollArea ref={scrollAreaRef} className=\"flex-1\">\n          <div className=\"max-w-4xl mx-auto px-6 py-8\">\n            {!hasMessages && !isLoading && (\n              <div className=\"flex flex-col items-center justify-center space-y-5 py-6\">\n                <div className=\"text-center space-y-2\">\n                  <Sparkles className=\"w-12 h-12 text-primary/50 mx-auto\" />\n                  <h2 className=\"text-xl font-semibold text-foreground\">\n                    Start a New Conversation\n                  </h2>\n                  <p className=\"text-sm text-muted-foreground max-w-md\">\n                    Choose a topic below or ask your own question\n                  </p>\n                </div>\n\n                {/* Conversation Starter Cards */}\n                <div className=\"w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n                  {conversationStarters.map((starter, categoryIndex) => {\n                    const Icon = starter.icon;\n                    // Randomly pick one prompt from each category to display\n                    const randomPrompt = starter.prompts[Math.floor(Math.random() * starter.prompts.length)];\n                    \n                    return (\n                      <button\n                        key={categoryIndex}\n                        onClick={() => {\n                          handleSubmit(randomPrompt);\n                        }}\n                        className={`group relative p-4 rounded-lg border bg-gradient-to-br transition-all hover:shadow-lg hover:scale-[1.02] text-left ${starter.color}`}\n                        data-testid={`starter-card-${categoryIndex}`}\n                      >\n                        <div className=\"flex items-start gap-2.5\">\n                          <div className={`flex-shrink-0 w-9 h-9 rounded-lg bg-background/50 flex items-center justify-center ${starter.iconColor}`}>\n                            <Icon className=\"w-4 h-4\" />\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <h3 className=\"text-sm font-semibold text-foreground mb-1.5 line-clamp-1\">\n                              {starter.category}\n                            </h3>\n                            <p className=\"text-xs text-muted-foreground line-clamp-2 leading-snug\">\n                              {randomPrompt}\n                            </p>\n                          </div>\n                        </div>\n                        \n                        {/* Hover indicator */}\n                        <div className=\"absolute bottom-2.5 right-2.5 opacity-0 group-hover:opacity-100 transition-opacity\">\n                          <Send className=\"w-3.5 h-3.5 text-muted-foreground\" />\n                        </div>\n                      </button>\n                    );\n                  })}\n                </div>\n\n                {/* Additional help text */}\n                <p className=\"text-xs text-muted-foreground/70 text-center\">\n                  ðŸ’¡ Click any card to start, or type your own question below\n                </p>\n              </div>\n            )}\n\n            {messages.map((message, index) => {\n              // Find the corresponding user message for this assistant message\n              const userMessage = message.role === \"assistant\" && index > 0 ? messages[index - 1] : null;\n              \n              // Check if this is the last assistant message\n              const isLastAssistantMessage = message.role === \"assistant\" && index === messages.length - 1;\n              \n              return (\n                <div\n                  key={message.id}\n                  ref={isLastAssistantMessage ? lastAssistantMessageRef : null}\n                  className={`mb-6 flex gap-4 ${\n                    message.role === \"user\" ? \"justify-end\" : \"justify-start\"\n                  }`}\n                  data-testid={`message-${message.role}-${message.id}`}\n                >\n                  {message.role === \"assistant\" && (\n                    <div className=\"flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center\">\n                      <Sparkles className=\"w-4 h-4 text-primary\" />\n                    </div>\n                  )}\n                  \n                  <div className=\"flex-1 max-w-[80%]\">\n                    <div\n                      className={`rounded-lg px-4 py-3 ${\n                        message.role === \"user\"\n                          ? \"bg-primary text-primary-foreground\"\n                          : \"bg-muted\"\n                      }`}\n                    >\n                      {message.role === \"user\" ? (\n                        <p className=\"text-sm whitespace-pre-wrap\">{message.content}</p>\n                      ) : (\n                        <div className=\"prose prose-sm max-w-none dark:prose-invert prose-a:text-primary prose-a:no-underline hover:prose-a:underline\">\n                          <ReactMarkdown \n                            rehypePlugins={[rehypeRaw]}\n                            remarkPlugins={[remarkGfm]}\n                          >\n                            {formatProfessionally(cleanupCitations(removeKGTags(decodeHTMLEntities(message.content))))}\n                          </ReactMarkdown>\n                        </div>\n                      )}\n                    </div>\n                    \n                    {/* Action buttons for assistant messages */}\n                    {message.role === \"assistant\" && userMessage && (\n                      <div className=\"flex gap-2 mt-2\">\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              className=\"h-8 text-xs\"\n                              data-testid={`button-download-message-${message.id}`}\n                            >\n                              <Download className=\"w-3 h-3 mr-1\" />\n                              Download\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent>\n                            <DropdownMenuItem \n                              onClick={() => downloadMessageMarkdown(\n                                userMessage.content,\n                                message.content,\n                                typeof message.createdAt === 'string' ? message.createdAt : message.createdAt.toISOString()\n                              )}\n                            >\n                              <FileText className=\"w-4 h-4 mr-2\" />\n                              Download as Markdown (.md)\n                            </DropdownMenuItem>\n                            <DropdownMenuItem \n                              onClick={() => downloadMessagePDF(\n                                userMessage.content,\n                                message.content,\n                                typeof message.createdAt === 'string' ? message.createdAt : message.createdAt.toISOString()\n                              )}\n                            >\n                              <FileType className=\"w-4 h-4 mr-2\" />\n                              Download as PDF (.pdf)\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                        \n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-8 text-xs\"\n                          data-testid={`button-refresh-message-${message.id}`}\n                          onClick={() => {\n                            if (userMessage) {\n                              // Directly call mutation with the stored question\n                              queryMutation.mutate({\n                                question: userMessage.content,\n                                threadId: currentThreadId,\n                              });\n                            }\n                          }}\n                        >\n                          <RefreshCw className=\"w-3 h-3 mr-1\" />\n                          Regenerate\n                        </Button>\n                      </div>\n                    )}\n                  </div>\n\n                  {message.role === \"user\" && (\n                    <div className=\"flex-shrink-0 w-8 h-8 rounded-full bg-muted flex items-center justify-center\">\n                      <User className=\"w-4 h-4 text-foreground\" />\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n\n            {/* Render quizzes inline */}\n            {quizzes.map((quiz) => (\n              <div key={quiz.id} className=\"mb-6\" data-testid={`quiz-${quiz.id}`}>\n                <QuizMessage questions={quiz.questions} threadId={currentThreadId!} shouldSaveResults={false} />\n              </div>\n            ))}\n\n            {isLoading && (\n              <div className=\"mb-6 flex gap-4 justify-start\" data-testid=\"loading-indicator\">\n                <div className=\"flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center\">\n                  <Sparkles className=\"w-4 h-4 text-primary\" />\n                </div>\n                <div className=\"max-w-[80%] rounded-lg px-4 py-3 bg-muted\">\n                  <div className=\"flex items-center gap-2\">\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                    <span className=\"text-sm text-muted-foreground\">Thinking...</span>\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n        </ScrollArea>\n\n        {/* Input Area - Fixed at bottom */}\n        <div className=\"border-t border-border bg-card/30 backdrop-blur-sm p-4\">\n          <div className=\"max-w-4xl mx-auto\">\n            <div className=\"flex gap-3 items-end\">\n              <Textarea\n                data-testid=\"input-question\"\n                placeholder=\"Ask a follow-up question...\"\n                value={question}\n                onChange={(e) => setQuestion(e.target.value)}\n                onKeyDown={handleKeyDown}\n                className=\"flex-1 min-h-[60px] max-h-[200px] resize-none\"\n                disabled={isLoading}\n              />\n              \n              {/* Quiz Me Button - Shows when there's enough conversation */}\n              {hasMessages && messages.length >= 2 && (\n                <Button\n                  data-testid=\"button-quiz-me\"\n                  onClick={handleGenerateQuiz}\n                  disabled={quizMutation.isPending}\n                  size=\"lg\"\n                  variant=\"outline\"\n                  className=\"h-[60px] px-4 gap-2\"\n                >\n                  {quizMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"w-5 h-5 animate-spin\" />\n                      <span className=\"hidden sm:inline\">Generating...</span>\n                    </>\n                  ) : (\n                    <>\n                      <Zap className=\"w-5 h-5\" />\n                      <span className=\"hidden sm:inline\">Quiz Me</span>\n                    </>\n                  )}\n                </Button>\n              )}\n              \n              <Button\n                data-testid=\"button-submit\"\n                onClick={() => handleSubmit()}\n                disabled={!question.trim() || isLoading}\n                size=\"lg\"\n                className=\"h-[60px] w-[60px] p-0\"\n              >\n                {isLoading ? (\n                  <Loader2 className=\"w-5 h-5 animate-spin\" />\n                ) : (\n                  <Send className=\"w-5 h-5\" />\n                )}\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <AIConfigSidebar onConfigChange={handleConfigChange} />\n      \n      {/* Download Format Selection Dialog */}\n      <Dialog open={showDownloadDialog} onOpenChange={setShowDownloadDialog}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Download Conversation</DialogTitle>\n            <DialogDescription>\n              Choose your preferred format to download this conversation thread.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"flex flex-col gap-3 py-4\">\n            <Button\n              variant=\"outline\"\n              size=\"lg\"\n              className=\"w-full justify-start gap-3\"\n              data-testid=\"button-download-text\"\n              onClick={() => {\n                downloadThreadAsText(messages, currentThread?.title || \"Conversation\");\n                setShowDownloadDialog(false);\n                toast({\n                  title: \"Download Started\",\n                  description: \"Your conversation is being downloaded as a text file.\",\n                });\n              }}\n            >\n              <FileText className=\"w-5 h-5\" />\n              <div className=\"text-left\">\n                <div className=\"font-semibold\">Text File (.txt)</div>\n                <div className=\"text-xs text-muted-foreground\">Plain text format, easy to edit</div>\n              </div>\n            </Button>\n            \n            <Button\n              variant=\"outline\"\n              size=\"lg\"\n              className=\"w-full justify-start gap-3\"\n              data-testid=\"button-download-pdf\"\n              onClick={() => {\n                downloadThreadAsPDF(messages, currentThread?.title || \"Conversation\");\n                setShowDownloadDialog(false);\n                toast({\n                  title: \"Download Started\",\n                  description: \"Your conversation is being downloaded as a PDF file.\",\n                });\n              }}\n            >\n              <FileType className=\"w-5 h-5\" />\n              <div className=\"text-left\">\n                <div className=\"font-semibold\">PDF Document (.pdf)</div>\n                <div className=\"text-xs text-muted-foreground\">Professional format, ready to share</div>\n              </div>\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":37354},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"design_guidelines.md":{"content":"# Design Guidelines: WealthForce Knowledge Agent\n\n## Design Approach: Enterprise AI Chat Interface\n\n**Selected Approach**: Intellect Design Arena-inspired enterprise FinTech design system combined with Claude/ChatGPT modern AI chat patterns - professional, trustworthy, and intelligence-focused.\n\n**Rationale**: This is an enterprise knowledge agent requiring a professional, authoritative appearance that builds trust with financial institution users. Drawing inspiration from Intellect's clean FinTech aesthetic, Claude's conversational clarity, and ChatGPT's card-based information density.\n\n## Core Design Elements\n\n### A. Color Palette (Intellect-Inspired Professional Blues)\n\n**Dark Mode (Primary)**\n- Background: 220 20% 10% (deep professional blue-black)\n- Surface: 220 18% 14% (elevated blue-tinted cards)\n- Border: 220 15% 25% (subtle blue separation)\n- Primary: 210 100% 50% (corporate blue - trust & intelligence)\n- Primary Hover: 210 100% 45%\n- Accent: 200 90% 48% (bright info blue)\n- Text Primary: 210 20% 98%\n- Text Secondary: 210 15% 70%\n- Success: 145 70% 45% (process complete, cache enabled)\n- Warning: 38 92% 50% (attention needed)\n- Error: 0 72% 51% (API failures)\n\n**Light Mode**\n- Background: 0 0% 100% (pure white)\n- Surface: 210 20% 98% (subtle blue tint)\n- Border: 210 15% 90%\n- Primary: 210 100% 50% (corporate blue)\n- Accent: 200 90% 48%\n- Text Primary: 220 20% 15%\n- Text Secondary: 220 15% 45%\n- Success: 145 70% 40%\n\n### B. Typography (Professional Enterprise Stack)\n\n**Font Stack**: \n- Primary: 'Inter' (400, 500, 600, 700) - Modern, professional sans-serif\n- Display/Headers: 'Inter' (600, 700) - Clean, authoritative\n- Code/Technical: 'JetBrains Mono' (400, 500) - Developer-friendly monospace\n\n**Hierarchy**:\n- Main Title: text-3xl font-bold (30px) - Enterprise authority\n- Page Title: text-2xl font-semibold (24px)\n- Section Headers: text-base font-semibold uppercase tracking-wider (16px)\n- Card Titles: text-lg font-semibold (18px)\n- Labels: text-sm font-medium (14px)\n- Body/Input: text-base (16px)\n- Helper/Meta: text-xs text-secondary (12px)\n\n### C. Layout System (Claude/ChatGPT-Inspired)\n\n**Spacing Primitives**: Tailwind units\n- Micro spacing: 2, 3, 4\n- Component padding: 4, 6, 8\n- Card spacing: 6, 8, 12\n- Section spacing: 12, 16, 20\n- Page margins: 8, 12, 16\n\n**Container Strategy**:\n- Main container: max-w-7xl mx-auto with px-6\n- Chat area: max-w-4xl mx-auto (optimal reading width)\n- Sidebar: w-80 fixed (consistent with ChatGPT)\n- Clean white space usage (ChatGPT pattern)\n\n**Layout Structure**:\n- Sidebar + Main Content (Claude/ChatGPT standard)\n- Card-based information display (ChatGPT Pulse style)\n- Clean conversational flow\n- Sticky header with branding\n\n### D. Component Library (Modern AI Chat Patterns)\n\n**1. Suggested Prompts (ChatGPT-Inspired Onboarding)**\n- Display 3-4 starter questions when empty\n- Card-based layout with hover effects\n- Icon + text combination\n- Examples:\n  - \"What are the steps in mutual funds order placement?\"\n  - \"How does the OTP verification process work?\"\n  - \"Explain the compliance requirements for transactions\"\n  - \"What is the risk profiling process?\"\n\n**2. Input Section Components**\n\n- **Question Input**\n  - Clean textarea with min-h-24\n  - Subtle border with focus: ring-2 ring-primary\n  - Placeholder: \"Ask about wealth management processes...\"\n  - Character count (bottom-right, text-xs)\n  - Send button integrated (ChatGPT style)\n\n- **Controls Row** \n  - Mode selector + Cache toggle (compact, same row)\n  - Icon-based indicators\n  - Professional blue accents\n\n**3. Response Display (Claude-Style Clean Display)**\n\n- **Message Cards**\n  - Clean white/surface background cards\n  - Subtle shadow for depth\n  - Rounded corners (rounded-xl)\n  - Markdown rendering with professional styling\n  \n- **Metadata Section**\n  - Small card below response\n  - Mode, Model, Generated timestamp\n  - Light background, subtle text\n  \n- **Sources Section**\n  - Separate card with clear heading\n  - Icon + document name format\n  - \"**[1]** â†’ filename.pdf\" style\n  - Only shown when sources available\n\n**4. Header (Professional Enterprise)**\n- Logo/Brand: \"WealthForce Knowledge Agent\"\n- Icon: Intelligence/knowledge symbol\n- Subtitle: \"Query WealthForce Product Knowledge\"\n- Settings and export actions\n- Theme toggle\n\n**5. History Sidebar (ChatGPT Pattern)**\n- Fixed width sidebar (w-80)\n- Collapsible\n- Search and filters\n- Conversation list with timestamps\n- Clean card-based items\n\n### E. Card-Based Information Design (Intellect/ChatGPT Style)\n\n**Response Cards**:\n- Background: surface color\n- Border: subtle (1px)\n- Padding: p-6\n- Shadow: shadow-sm\n- Border radius: rounded-xl\n- Hover: subtle elevation increase\n\n**Info Cards** (Metadata, Sources):\n- Smaller padding: p-4\n- Lighter background\n- Clear visual hierarchy\n- Icon + text combinations\n\n**Suggested Prompt Cards**:\n- Interactive hover states\n- Icon on left\n- Text on right\n- Background: surface\n- Border: subtle\n- Hover: border-primary\n\n### F. Professional Visual Polish\n\n**Shadows & Elevation**:\n- Level 1 (cards): shadow-sm\n- Level 2 (modals): shadow-lg\n- Level 3 (dropdown): shadow-xl\n\n**Border Radius**:\n- Cards: rounded-xl (0.75rem)\n- Buttons: rounded-lg (0.5rem)\n- Inputs: rounded-lg (0.5rem)\n- Small elements: rounded-md (0.375rem)\n\n**Icons** (Lucide React):\n- Consistent outline style\n- 20px default size\n- Primary color for actions\n- Secondary color for decorative\n\n**Animations**:\n- Smooth transitions: 200ms ease-in-out\n- Loading states: pulse animation\n- Hover states: transform scale-102\n- Fade-in for responses: opacity + translate\n\n### G. Interaction Patterns\n\n**ChatGPT-Inspired**:\n- Suggested prompts on empty state\n- Card-based layouts for scanning\n- Inline actions on hover\n- Smooth scrolling to responses\n\n**Claude-Inspired**:\n- Clean conversational layout\n- Clear visual hierarchy\n- Focus on content readability\n- Subtle, professional interactions\n\n**Intellect-Inspired**:\n- Professional blue color scheme\n- Enterprise-grade appearance\n- Icon-based navigation\n- Clean, minimal aesthetic\n- Trust-building design elements\n\n### H. Accessibility & Responsiveness\n\n- WCAG AA contrast ratios (minimum)\n- Focus indicators: ring-2 ring-primary ring-offset-2\n- Keyboard navigation support\n- Screen reader friendly\n- Mobile-responsive breakpoints\n- Dark mode with proper contrast\n- Reduced motion support\n\n## Implementation Notes\n\n1. **Color Variables**: Use HSL format in index.css (e.g., `220 100% 50%`)\n2. **Font Loading**: Google Fonts with display=swap\n3. **Icons**: Lucide React throughout\n4. **Components**: Shadcn/ui base with custom styling\n5. **Animations**: Framer Motion for complex animations (optional)\n6. **Testing**: Verify dark mode, responsive layouts, accessibility\n\n## Visual Identity\n\n**Brand Personality**: \n- Professional & Trustworthy (Intellect)\n- Intelligent & Helpful (Claude)\n- Modern & Accessible (ChatGPT)\n\n**Key Design Principles**:\n- Clarity over complexity\n- Professional over flashy\n- Functional over decorative\n- Trust through design quality\n","size_bytes":7040},"shared/schema.ts":{"content":"import { pgTable, text, varchar, timestamp, boolean, serial, integer, date, real } from \"drizzle-orm/pg-core\";\nimport { vector } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { relations } from \"drizzle-orm\";\n\n// Threads table - represents conversation threads (like chat sessions)\nexport const threads = pgTable(\"threads\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(), // Generated from first question\n  conversationId: text(\"conversation_id\"), // EKG API conversation_id for long-running context\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertThreadSchema = createInsertSchema(threads).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertThread = z.infer<typeof insertThreadSchema>;\nexport type Thread = typeof threads.$inferSelect;\n\n// Messages table - individual messages within threads\nexport const messages = pgTable(\"messages\", {\n  id: serial(\"id\").primaryKey(),\n  threadId: integer(\"thread_id\").notNull().references(() => threads.id, { onDelete: \"cascade\" }),\n  role: text(\"role\").notNull(), // \"user\" | \"assistant\"\n  content: text(\"content\").notNull(),\n  responseId: text(\"response_id\"), // EKG API response_id for conversational chaining\n  sources: text(\"sources\"), // JSON string of sources/citations\n  metadata: text(\"metadata\"), // JSON string of metadata\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\nexport type Message = typeof messages.$inferSelect;\n\n// Old conversations table - kept for backward compatibility\nexport const conversations = pgTable(\"conversations\", {\n  id: serial(\"id\").primaryKey(),\n  question: text(\"question\").notNull(),\n  mode: text(\"mode\").notNull(), // \"balanced\" | \"deep\" | \"concise\"\n  useCache: boolean(\"use_cache\").notNull().default(true),\n  response: text(\"response\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertConversationSchema = createInsertSchema(conversations).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertConversation = z.infer<typeof insertConversationSchema>;\nexport type Conversation = typeof conversations.$inferSelect;\n\n// Query schema for graph database chatbot\nexport const querySchema = z.object({\n  question: z.string().min(1, \"Question is required\"),\n  mode: z.enum([\"balanced\", \"deep\", \"concise\"]),\n  refresh: z.boolean(),\n  threadId: z.number().optional(), // Optional thread ID for conversational mode\n});\n\nexport type Query = z.infer<typeof querySchema>;\n\n// Response schema\nexport const responseSchema = z.object({\n  data: z.string(), // Markdown formatted response\n  metadata: z.string().optional(), // Metadata (mode, model, timestamp)\n  citations: z.string().optional(), // Sources/citations if available\n  error: z.string().optional(),\n});\n\nexport type QueryResponse = z.infer<typeof responseSchema>;\n\n// User schema - for authentication and authorization\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(), // bcrypt hashed\n  fullName: text(\"full_name\").notNull(),\n  team: text(\"team\").notNull(), // 'admin' | 'presales' | 'ba' | 'management'\n  managerId: varchar(\"manager_id\").references(() => users.id), // Links to manager (M1 for BA, M2 for Pre-sales)\n  email: text(\"email\"),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  lastLogin: timestamp(\"last_login\"),\n});\n\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n  lastLogin: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\n// Sessions table - for managing user login sessions\nexport const sessions = pgTable(\"sessions\", {\n  id: text(\"id\").primaryKey(), // UUID session token\n  userId: text(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertSessionSchema = createInsertSchema(sessions).omit({\n  createdAt: true,\n});\n\nexport type InsertSession = z.infer<typeof insertSessionSchema>;\nexport type Session = typeof sessions.$inferSelect;\n\n// Quiz Attempts - tracks each quiz completion\nexport const quizAttempts = pgTable(\"quiz_attempts\", {\n  id: serial(\"id\").primaryKey(),\n  threadId: integer(\"thread_id\").references(() => threads.id, { onDelete: \"cascade\" }),\n  topic: text(\"topic\").notNull(), // Quiz topic name\n  category: text(\"category\").notNull(), // Quiz category\n  totalQuestions: integer(\"total_questions\").notNull(),\n  correctAnswers: integer(\"correct_answers\").notNull(),\n  scorePercentage: integer(\"score_percentage\").notNull(), // 0-100\n  pointsEarned: integer(\"points_earned\").notNull(), // Points added to cumulative score\n  timeSpent: integer(\"time_spent\"), // seconds to complete (optional for now)\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertQuizAttemptSchema = createInsertSchema(quizAttempts).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertQuizAttempt = z.infer<typeof insertQuizAttemptSchema>;\nexport type QuizAttempt = typeof quizAttempts.$inferSelect;\n\n// Quiz Responses - individual question answers\nexport const quizResponses = pgTable(\"quiz_responses\", {\n  id: serial(\"id\").primaryKey(),\n  attemptId: integer(\"attempt_id\").notNull().references(() => quizAttempts.id, { onDelete: \"cascade\" }),\n  questionText: text(\"question_text\").notNull(),\n  userAnswer: text(\"user_answer\").notNull(), // A, B, C, or D\n  correctAnswer: text(\"correct_answer\").notNull(),\n  isCorrect: boolean(\"is_correct\").notNull(),\n  topic: text(\"topic\"), // Extracted topic (optional for now)\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertQuizResponseSchema = createInsertSchema(quizResponses).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertQuizResponse = z.infer<typeof insertQuizResponseSchema>;\nexport type QuizResponse = typeof quizResponses.$inferSelect;\n\n// User Mastery - calculated mastery scores\nexport const userMastery = pgTable(\"user_mastery\", {\n  id: serial(\"id\").primaryKey(),\n  overallScore: integer(\"overall_score\").notNull().default(0), // 0-100 percentage for UI display\n  totalCumulativePoints: integer(\"total_cumulative_points\").notNull().default(0), // Cumulative points (unbounded)\n  currentLevel: text(\"current_level\").notNull().default(\"Novice\"), // Novice, Learning, Intermediate, Advanced, Expert\n  quizPerformanceScore: integer(\"quiz_performance_score\").notNull().default(0), // 0-50\n  topicCoverageScore: integer(\"topic_coverage_score\").notNull().default(0), // 0-30\n  retentionScore: integer(\"retention_score\").notNull().default(0), // 0-20\n  topicsMastered: integer(\"topics_mastered\").notNull().default(0),\n  totalQuizzesTaken: integer(\"total_quizzes_taken\").notNull().default(0),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertUserMasterySchema = createInsertSchema(userMastery).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport type InsertUserMastery = z.infer<typeof insertUserMasterySchema>;\nexport type UserMastery = typeof userMastery.$inferSelect;\n\n// Quiz Questions - master quiz question bank\nexport const quizQuestions = pgTable(\"quiz_questions\", {\n  id: serial(\"id\").primaryKey(),\n  category: text(\"category\").notNull(), // \"Order Management\", etc.\n  topic: text(\"topic\").notNull(), // \"Introduction to Order Management\", \"SEBI Regulatory Changes\", etc.\n  difficulty: text(\"difficulty\").notNull(), // \"Easy\", \"Medium\", \"Hard\"\n  questionText: text(\"question_text\").notNull(),\n  optionA: text(\"option_a\"),\n  optionB: text(\"option_b\"),\n  optionC: text(\"option_c\"),\n  optionD: text(\"option_d\"),\n  correctAnswer: text(\"correct_answer\").notNull(), // \"a\", \"b\", \"c\", \"d\", or \"true\", \"false\"\n  questionType: text(\"question_type\").notNull(), // \"multiple_choice\" or \"true_false\"\n  explanation: text(\"explanation\"), // Optional explanation for the answer\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertQuizQuestionSchema = createInsertSchema(quizQuestions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertQuizQuestion = z.infer<typeof insertQuizQuestionSchema>;\nexport type QuizQuestion = typeof quizQuestions.$inferSelect;\n\n// ===== RFP Response Generator Tables =====\n\n// RFP Responses - tracks template-based RFP responses\nexport const rfpResponses = pgTable(\"rfp_responses\", {\n  id: serial(\"id\").primaryKey(),\n  clientName: text(\"client_name\").notNull(),\n  clientIndustry: text(\"client_industry\").notNull(),\n  rfpTitle: text(\"rfp_title\").notNull(),\n  rfpId: text(\"rfp_id\"),\n  submissionDate: date(\"submission_date\").notNull(),\n  budgetRange: text(\"budget_range\"),\n  projectSummary: text(\"project_summary\").notNull(),\n  companyName: text(\"company_name\").notNull(),\n  pointOfContact: text(\"point_of_contact\").notNull(),\n  companyStrengths: text(\"company_strengths\"),\n  selectedTemplate: text(\"selected_template\").notNull(),\n  customizations: text(\"customizations\"),\n  generatedContent: text(\"generated_content\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  lastUpdated: timestamp(\"last_updated\").defaultNow().notNull(),\n});\n\nexport const insertRfpResponseSchema = createInsertSchema(rfpResponses).omit({\n  id: true,\n  createdAt: true,\n  lastUpdated: true,\n});\n\nexport type InsertRfpResponse = z.infer<typeof insertRfpResponseSchema>;\nexport type RfpResponse = typeof rfpResponses.$inferSelect;\n\n// Excel Requirement Responses - stores individual requirement answers with AI responses\nexport const excelRequirementResponses = pgTable(\"excel_requirement_responses\", {\n  id: serial(\"id\").primaryKey(),\n  // RFP identification\n  rfpName: text(\"rfp_name\"),\n  requirementId: text(\"requirement_id\"),\n  uploadedBy: text(\"uploaded_by\"),\n  \n  // Requirement details\n  category: text(\"category\").notNull(),\n  requirement: text(\"requirement\").notNull(),\n  \n  // AI-generated responses from different models\n  finalResponse: text(\"final_response\"),\n  openaiResponse: text(\"openai_response\"),\n  anthropicResponse: text(\"anthropic_response\"),\n  deepseekResponse: text(\"deepseek_response\"),\n  moaResponse: text(\"moa_response\"), // Mixture of Agents synthesized response\n  \n  // Similar questions (stored as JSON string)\n  similarQuestions: text(\"similar_questions\"),\n  \n  // Metadata\n  timestamp: timestamp(\"timestamp\").defaultNow().notNull(),\n  rating: integer(\"rating\"),\n  feedback: text(\"feedback\"), // 'positive', 'negative', or null\n  modelProvider: text(\"model_provider\"),\n});\n\nexport const insertExcelRequirementResponseSchema = createInsertSchema(excelRequirementResponses).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport type InsertExcelRequirementResponse = z.infer<typeof insertExcelRequirementResponseSchema>;\nexport type ExcelRequirementResponse = typeof excelRequirementResponses.$inferSelect;\n\n// Reference Responses - stores similar past responses for each requirement\nexport const referenceResponses = pgTable(\"reference_responses\", {\n  id: serial(\"id\").primaryKey(),\n  // Link to the parent response\n  responseId: integer(\"response_id\").notNull().references(() => excelRequirementResponses.id, { onDelete: 'cascade' }),\n  // Reference information from vector similarity search\n  category: text(\"category\").notNull(),\n  requirement: text(\"requirement\").notNull(),\n  response: text(\"response\").notNull(),\n  reference: text(\"reference\"),\n  score: real(\"score\").notNull(), // Similarity score from vector search\n  timestamp: timestamp(\"timestamp\").defaultNow().notNull(),\n});\n\nexport const insertReferenceResponseSchema = createInsertSchema(referenceResponses).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport type InsertReferenceResponse = z.infer<typeof insertReferenceResponseSchema>;\nexport type ReferenceResponse = typeof referenceResponses.$inferSelect;\n\n// Historical RFPs - stores past RFP responses for RAG-based retrieval\nexport const historicalRfps = pgTable(\"historical_rfps\", {\n  id: serial(\"id\").primaryKey(),\n  \n  // RFP Metadata\n  rfpName: text(\"rfp_name\").notNull(),\n  clientName: text(\"client_name\"),\n  clientIndustry: text(\"client_industry\"),\n  submissionDate: date(\"submission_date\"),\n  \n  // Requirement Details\n  category: text(\"category\").notNull(),\n  requirement: text(\"requirement\").notNull(),\n  response: text(\"response\").notNull(), // The actual approved response used\n  \n  // Quality Metrics\n  successScore: integer(\"success_score\"), // 1-5 rating (did we win the RFP?)\n  responseQuality: text(\"response_quality\"), // \"excellent\", \"good\", \"average\"\n  \n  // Vector Embedding for similarity search (OpenAI text-embedding-3-small: 1536 dimensions)\n  embedding: vector(\"embedding\", { dimensions: 1536 }),\n  \n  // Metadata\n  uploadedBy: text(\"uploaded_by\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertHistoricalRfpSchema = createInsertSchema(historicalRfps).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertHistoricalRfp = z.infer<typeof insertHistoricalRfpSchema>;\nexport type HistoricalRfp = typeof historicalRfps.$inferSelect;\n\n// Relations for RFP tables\nexport const excelRequirementResponsesRelations = relations(excelRequirementResponses, ({ many }) => ({\n  references: many(referenceResponses),\n}));\n\nexport const referenceResponsesRelations = relations(referenceResponses, ({ one }) => ({\n  parentResponse: one(excelRequirementResponses, {\n    fields: [referenceResponses.responseId],\n    references: [excelRequirementResponses.id],\n  }),\n}));\n\n// ===== Investment Portal Tables =====\n\n// Investment requests table\nexport const investmentRequests = pgTable(\"investment_requests\", {\n  id: serial(\"id\").primaryKey(),\n  requestId: text(\"request_id\").notNull().unique(), // INV-2025-001\n  reportCode: text(\"report_code\").unique(), // Unique code like RPT-2025-001 for searching and filtering\n  requesterId: varchar(\"requester_id\").references(() => users.id), // Changed to varchar for UUID\n  targetCompany: text(\"target_company\").notNull(),\n  investmentType: text(\"investment_type\").notNull(), // equity, debt, real_estate, alternative, base_document\n  reportTitle: text(\"report_title\"), // Title of the report (for report drafting platform)\n  reportDate: text(\"report_date\"), // Date of the report\n  createdBy: text(\"created_by\"), // Name of the author/creator\n  description: text(\"description\"),\n  enhancedDescription: text(\"enhanced_description\"), // AI-enhanced version of description\n  status: text(\"status\").notNull().default(\"draft\"), // draft, submitted, under_review, approved, rejected, revision_requested\n  currentApprovalStage: integer(\"current_approval_stage\").default(0),\n  slaDeadline: timestamp(\"sla_deadline\"),\n  deletedAt: timestamp(\"deleted_at\"), // Soft delete timestamp\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n  currentApprovalCycle: integer(\"current_approval_cycle\").notNull().default(1), // Track current submission cycle\n});\n\n// Individual approval records\nexport const approvals = pgTable(\"approvals\", {\n  id: serial(\"id\").primaryKey(),\n  requestType: text(\"request_type\").notNull(), // investment, cash_request\n  requestId: integer(\"request_id\").notNull(),\n  stage: integer(\"stage\").notNull(),\n  approverId: varchar(\"approver_id\").references(() => users.id), // Changed to varchar for UUID\n  status: text(\"status\").notNull(), // pending, approved, rejected, revision_requested\n  comments: text(\"comments\"),\n  rejectionReason: text(\"rejection_reason\"), // Detailed reason for rejection or revision request\n  editHistory: text(\"edit_history\"), // JSON string tracking manager edits during review\n  approvedAt: timestamp(\"approved_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  approvalCycle: integer(\"approval_cycle\").notNull().default(1), // Track which submission cycle\n  isCurrentCycle: boolean(\"is_current_cycle\").notNull().default(true), // Whether this is part of current active cycle\n});\n\n// Tasks table\nexport const tasks = pgTable(\"tasks\", {\n  id: serial(\"id\").primaryKey(),\n  assigneeId: varchar(\"assignee_id\").references(() => users.id), // Changed to varchar for UUID\n  requestType: text(\"request_type\").notNull(), // investment, cash_request\n  requestId: integer(\"request_id\").notNull(),\n  taskType: text(\"task_type\").notNull(), // approval, review, changes_requested\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  status: text(\"status\").notNull().default(\"pending\"), // pending, completed, overdue\n  priority: text(\"priority\").default(\"medium\"), // low, medium, high\n  dueDate: timestamp(\"due_date\"),\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Document categories table\nexport const documentCategories = pgTable(\"document_categories\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull().unique(),\n  description: text(\"description\"),\n  icon: text(\"icon\").default(\"ðŸ“„\"), // emoji icon for display\n  isActive: boolean(\"is_active\").default(true),\n  isSystem: boolean(\"is_system\").default(false), // system vs user-created\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Documents table\nexport const documents = pgTable(\"documents\", {\n  id: serial(\"id\").primaryKey(),\n  fileName: text(\"file_name\").notNull(),\n  originalName: text(\"original_name\").notNull(),\n  fileSize: integer(\"file_size\").notNull(),\n  mimeType: text(\"mime_type\").notNull(),\n  fileUrl: text(\"file_url\").notNull(),\n  uploaderId: varchar(\"uploader_id\").references(() => users.id), // Changed to varchar for UUID\n  requestType: text(\"request_type\").notNull(), // investment, cash_request\n  requestId: integer(\"request_id\").notNull(),\n  categoryId: integer(\"category_id\").references(() => documentCategories.id),\n  subcategoryId: integer(\"subcategory_id\"),\n  isAutoCategorized: boolean(\"is_auto_categorized\").default(false), // AI vs manual categorization\n  analysisStatus: text(\"analysis_status\").default(\"pending\"), // pending, processing, completed, failed\n  analysisResult: text(\"analysis_result\"), // JSON string with analysis results\n  classification: text(\"classification\"), // document type classification\n  extractedText: text(\"extracted_text\"), // extracted text content\n  keyInformation: text(\"key_information\"), // JSON string with key extracted info\n  riskLevel: text(\"risk_level\"), // low, medium, high\n  confidence: text(\"confidence\"), // analysis confidence score\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  analyzedAt: timestamp(\"analyzed_at\"),\n});\n\n// Document-category associations table (for multiple categories per document)\nexport const documentCategoryAssociations = pgTable(\"document_category_associations\", {\n  id: serial(\"id\").primaryKey(),\n  documentId: integer(\"document_id\").references(() => documents.id).notNull(),\n  categoryId: integer(\"category_id\").references(() => documentCategories.id).notNull(),\n  customCategoryName: text(\"custom_category_name\"), // for \"Others\" category with custom name\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Notifications table\nexport const notifications = pgTable(\"notifications\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id), // Changed to varchar for UUID\n  title: text(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  type: text(\"type\").notNull(), // task_assigned, approval_needed, sla_warning, status_update\n  isRead: boolean(\"is_read\").default(false),\n  relatedType: text(\"related_type\"), // investment, cash_request, task\n  relatedId: integer(\"related_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Templates table\nexport const templates = pgTable(\"templates\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  type: text(\"type\").notNull(), // investment, cash_request\n  investmentType: text(\"investment_type\"), // equity, debt, real_estate, alternative\n  templateData: text(\"template_data\").notNull(), // JSON string with sections and word limits\n  createdBy: varchar(\"created_by\").references(() => users.id), // Changed to varchar for UUID\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Investment rationales table\nexport const investmentRationales = pgTable(\"investment_rationales\", {\n  id: serial(\"id\").primaryKey(),\n  investmentId: integer(\"investment_id\").references(() => investmentRequests.id).notNull(),\n  content: text(\"content\").notNull(),\n  type: text(\"type\").notNull(), // manual, ai_generated\n  templateId: integer(\"template_id\").references(() => templates.id),\n  authorId: varchar(\"author_id\").references(() => users.id), // Changed to varchar for UUID\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Background jobs table\nexport const backgroundJobs = pgTable(\"background_jobs\", {\n  id: serial(\"id\").primaryKey(),\n  jobType: varchar(\"job_type\", { length: 50 }).notNull(),\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"pending\"), // pending, processing, completed, failed\n  currentStep: varchar(\"current_step\", { length: 50 }).default(\"queued\"),\n  stepProgress: integer(\"step_progress\").default(0), // 0-100 percentage for current step\n  totalSteps: integer(\"total_steps\").default(4),\n  currentStepNumber: integer(\"current_step_number\").default(0),\n  documentId: integer(\"document_id\").references(() => documents.id),\n  requestType: varchar(\"request_type\", { length: 50 }),\n  requestId: integer(\"request_id\"),\n  priority: varchar(\"priority\", { length: 10 }).notNull().default(\"normal\"),\n  attempts: integer(\"attempts\").notNull().default(0),\n  maxAttempts: integer(\"max_attempts\").notNull().default(3),\n  errorMessage: text(\"error_message\"),\n  result: text(\"result\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  startedAt: timestamp(\"started_at\"),\n  completedAt: timestamp(\"completed_at\"),\n});\n\n// Document queries table\nexport const documentQueries = pgTable(\"document_queries\", {\n  id: serial(\"id\").primaryKey(),\n  documentId: integer(\"document_id\").references(() => documents.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(), // Changed to varchar for UUID\n  query: text(\"query\").notNull(),\n  response: text(\"response\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Cross-document queries table\nexport const crossDocumentQueries = pgTable(\"cross_document_queries\", {\n  id: serial(\"id\").primaryKey(),\n  requestType: text(\"request_type\").notNull(), // investment, cash_request\n  requestId: integer(\"request_id\").notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(), // Changed to varchar for UUID\n  query: text(\"query\").notNull(),\n  response: text(\"response\").notNull(),\n  documentCount: integer(\"document_count\").notNull().default(0),\n  openaiResponseId: text(\"openai_response_id\"),\n  openaiModel: text(\"openai_model\"),\n  inputTokens: integer(\"input_tokens\"),\n  outputTokens: integer(\"output_tokens\"),\n  totalTokens: integer(\"total_tokens\"),\n  processingTimeMs: integer(\"processing_time_ms\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Web search queries table\nexport const webSearchQueries = pgTable(\"web_search_queries\", {\n  id: serial(\"id\").primaryKey(),\n  requestType: text(\"request_type\").notNull(), // investment, cash_request\n  requestId: integer(\"request_id\").notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(), // Changed to varchar for UUID\n  query: text(\"query\").notNull(),\n  response: text(\"response\").notNull(),\n  searchType: text(\"search_type\").notNull().default(\"web_search\"),\n  openaiResponseId: text(\"openai_response_id\"),\n  openaiModel: text(\"openai_model\"),\n  inputTokens: integer(\"input_tokens\"),\n  outputTokens: integer(\"output_tokens\"),\n  totalTokens: integer(\"total_tokens\"),\n  processingTimeMs: integer(\"processing_time_ms\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Sequences table - for sequential ID generation\nexport const sequences = pgTable(\"sequences\", {\n  id: serial(\"id\").primaryKey(),\n  sequenceName: text(\"sequence_name\").notNull().unique(), // 'INV', 'CASH', etc.\n  currentValue: integer(\"current_value\").notNull().default(0),\n  year: integer(\"year\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Investment Portal Zod Schemas\nexport const insertInvestmentRequestSchema = createInsertSchema(investmentRequests).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertApprovalSchema = createInsertSchema(approvals).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertTaskSchema = createInsertSchema(tasks).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertDocumentCategorySchema = createInsertSchema(documentCategories).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertDocumentSchema = createInsertSchema(documents).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertTemplateSchema = createInsertSchema(templates).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertInvestmentRationaleSchema = createInsertSchema(investmentRationales).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Solution Templates - for Business Analyst solution documents\nexport const solutionTemplates = pgTable(\"solution_templates\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  createdBy: varchar(\"created_by\").references(() => users.id),\n  isDefault: boolean(\"is_default\").default(false), // Whether this is a default template\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Template Sections - individual sections within a template\nexport const templateSections = pgTable(\"template_sections\", {\n  id: serial(\"id\").primaryKey(),\n  templateId: integer(\"template_id\").references(() => solutionTemplates.id, { onDelete: \"cascade\" }),\n  sectionType: text(\"section_type\").notNull(), // heading, revisionHistory, tableOfContents, changeRequirement, businessImpact, affectedSystems, solution, testScenarios\n  title: text(\"title\").notNull(),\n  content: text(\"content\"), // Editable content for the section\n  orderIndex: integer(\"order_index\").notNull(), // For ordering sections\n  isEditable: boolean(\"is_editable\").default(true),\n});\n\n// Template Work Items - specific work items within Solution section\nexport const templateWorkItems = pgTable(\"template_work_items\", {\n  id: serial(\"id\").primaryKey(),\n  sectionId: integer(\"section_id\").references(() => templateSections.id, { onDelete: \"cascade\" }),\n  title: text(\"title\").notNull(), // e.g., \"Description of Change\", \"Logic and Validations\"\n  content: text(\"content\"), // Editable content\n  orderIndex: integer(\"order_index\").notNull(),\n  isIncluded: boolean(\"is_included\").default(true), // Whether this work item is included in current template\n});\n\n// Template Revisions - track changes to templates\nexport const templateRevisions = pgTable(\"template_revisions\", {\n  id: serial(\"id\").primaryKey(),\n  templateId: integer(\"template_id\").references(() => solutionTemplates.id, { onDelete: \"cascade\" }),\n  version: text(\"version\").notNull(), // e.g., \"1.0\", \"1.1\"\n  changedBy: varchar(\"changed_by\").references(() => users.id),\n  changeDate: timestamp(\"change_date\").defaultNow(),\n  changeDescription: text(\"change_description\"),\n});\n\n// Insert schemas for solution templates\nexport const insertSolutionTemplateSchema = createInsertSchema(solutionTemplates).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertTemplateSectionSchema = createInsertSchema(templateSections).omit({\n  id: true,\n});\n\nexport const insertTemplateWorkItemSchema = createInsertSchema(templateWorkItems).omit({\n  id: true,\n});\n\nexport const insertTemplateRevisionSchema = createInsertSchema(templateRevisions).omit({\n  id: true,\n  changeDate: true,\n});\n\n// Investment Portal Types\nexport type InsertInvestmentRequest = z.infer<typeof insertInvestmentRequestSchema>;\nexport type InvestmentRequest = typeof investmentRequests.$inferSelect;\n\nexport type InsertApproval = z.infer<typeof insertApprovalSchema>;\nexport type Approval = typeof approvals.$inferSelect;\n\nexport type InsertTask = z.infer<typeof insertTaskSchema>;\nexport type Task = typeof tasks.$inferSelect;\n\nexport type InsertDocumentCategory = z.infer<typeof insertDocumentCategorySchema>;\nexport type DocumentCategory = typeof documentCategories.$inferSelect;\n\nexport type InsertDocument = z.infer<typeof insertDocumentSchema>;\nexport type Document = typeof documents.$inferSelect;\n\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type Notification = typeof notifications.$inferSelect;\n\nexport type InsertTemplate = z.infer<typeof insertTemplateSchema>;\nexport type Template = typeof templates.$inferSelect;\n\nexport type InsertInvestmentRationale = z.infer<typeof insertInvestmentRationaleSchema>;\nexport type InvestmentRationale = typeof investmentRationales.$inferSelect;\n\n// Solution Template Types\nexport type InsertSolutionTemplate = z.infer<typeof insertSolutionTemplateSchema>;\nexport type SolutionTemplate = typeof solutionTemplates.$inferSelect;\n\nexport type InsertTemplateSection = z.infer<typeof insertTemplateSectionSchema>;\nexport type TemplateSection = typeof templateSections.$inferSelect;\n\nexport type InsertTemplateWorkItem = z.infer<typeof insertTemplateWorkItemSchema>;\nexport type TemplateWorkItem = typeof templateWorkItems.$inferSelect;\n\nexport type InsertTemplateRevision = z.infer<typeof insertTemplateRevisionSchema>;\nexport type TemplateRevision = typeof templateRevisions.$inferSelect;\n","size_bytes":30273},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ninterface ThemeContextType {\n  theme: Theme;\n  toggleTheme: () => void;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error(\"useTheme must be used within ThemeProvider\");\n  }\n  return context;\n}\n\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(\"theme\") as Theme) || \"dark\"\n  );\n\n  useEffect(() => {\n    const root = document.documentElement;\n    root.classList.remove(\"light\", \"dark\");\n    root.classList.add(theme);\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme((prev) => (prev === \"light\" ? \"dark\" : \"light\"));\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n","size_bytes":1048},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/App.tsx":{"content":"import { useState } from \"react\";\nimport { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider, useQuery } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { MainNavSidebar } from \"@/components/main-nav-sidebar\";\nimport { MobileNavDrawer } from \"@/components/mobile-nav-drawer\";\nimport { TopHeader } from \"@/components/top-header\";\nimport ChatbotPage from \"@/pages/chatbot\";\nimport WorkshopPage from \"@/pages/workshop\";\nimport QuizPage from \"@/pages/quiz\";\nimport AtlasPage from \"@/pages/atlas\";\nimport RfpPage from \"@/pages/rfp\";\nimport NotFound from \"@/pages/not-found\";\nimport type { UserMastery } from \"@shared/schema\";\n\nfunction Router() {\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n\n  // Fetch mastery data for header stats\n  const { data: masteryData } = useQuery<UserMastery>({\n    queryKey: [\"/api/mastery\"],\n  });\n\n  const handleSearch = (query: string) => {\n    console.log(\"Global search:\", query);\n    // Future: Implement global search functionality\n  };\n\n  const toggleMobileMenu = () => {\n    setIsMobileMenuOpen(!isMobileMenuOpen);\n  };\n\n  const closeMobileMenu = () => {\n    setIsMobileMenuOpen(false);\n  };\n\n  return (\n    <div className=\"flex flex-col h-screen\">\n      <TopHeader \n        questionsAsked={0}\n        quizzesCompleted={masteryData?.totalQuizzesTaken || 0}\n        onSearch={handleSearch}\n        onMenuClick={toggleMobileMenu}\n      />\n      <div className=\"flex flex-1 overflow-hidden\">\n        <MainNavSidebar className=\"hidden md:flex\" />\n        <MobileNavDrawer isOpen={isMobileMenuOpen} onClose={closeMobileMenu} />\n        <Switch>\n          <Route path=\"/\" component={ChatbotPage} />\n          <Route path=\"/workshop\" component={WorkshopPage} />\n          <Route path=\"/quiz\" component={QuizPage} />\n          <Route path=\"/atlas\" component={AtlasPage} />\n          <Route path=\"/rfp\" component={RfpPage} />\n          <Route component={NotFound} />\n        </Switch>\n      </div>\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <ThemeProvider>\n          <Toaster />\n          <Router />\n        </ThemeProvider>\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":2453},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/history-sidebar.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Trash2, MessageSquare, Search, X } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport type { Conversation } from \"@shared/schema\";\n\ninterface HistorySidebarProps {\n  onSelectConversation: (conversation: Conversation) => void;\n  selectedId?: number;\n}\n\nexport function HistorySidebar({ onSelectConversation, selectedId }: HistorySidebarProps) {\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [modeFilter, setModeFilter] = useState<string>(\"all\");\n\n  const { data: conversations = [], isLoading } = useQuery<Conversation[]>({\n    queryKey: [\"/api/conversations\"],\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await fetch(`/api/conversations/${id}`, {\n        method: \"DELETE\",\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to delete conversation\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/conversations\"] });\n      toast({\n        title: \"Deleted\",\n        description: \"Conversation removed from history\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete conversation\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDelete = (e: React.MouseEvent, id: number) => {\n    e.stopPropagation();\n    deleteMutation.mutate(id);\n  };\n\n  const filteredConversations = useMemo(() => {\n    return conversations.filter((conv) => {\n      const matchesSearch = conv.question.toLowerCase().includes(searchQuery.toLowerCase());\n      const matchesMode = modeFilter === \"all\" || conv.mode === modeFilter;\n      return matchesSearch && matchesMode;\n    });\n  }, [conversations, searchQuery, modeFilter]);\n\n  const handleClearSearch = () => {\n    setSearchQuery(\"\");\n    setModeFilter(\"all\");\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"w-80 border-r border-border bg-card p-4\">\n        <div className=\"space-y-2\">\n          <div className=\"h-16 bg-muted rounded animate-pulse\"></div>\n          <div className=\"h-16 bg-muted rounded animate-pulse\"></div>\n          <div className=\"h-16 bg-muted rounded animate-pulse\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-80 border-r border-border bg-card flex flex-col\">\n      <div className=\"p-4 border-b border-border space-y-3\">\n        <div>\n          <h2 className=\"text-sm font-medium uppercase tracking-wide\">Chat History</h2>\n          <p className=\"text-xs text-muted-foreground mt-1\">\n            {filteredConversations.length} of {conversations.length} conversations\n          </p>\n        </div>\n        \n        <div className=\"space-y-2\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-2.5 top-2.5 w-4 h-4 text-muted-foreground\" />\n            <Input\n              data-testid=\"input-search-history\"\n              placeholder=\"Search conversations...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-9 pr-9 h-9\"\n            />\n            {searchQuery && (\n              <Button\n                data-testid=\"button-clear-search\"\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"absolute right-0 top-0 h-9 w-9\"\n                onClick={handleClearSearch}\n              >\n                <X className=\"w-4 h-4\" />\n              </Button>\n            )}\n          </div>\n          \n          <Select value={modeFilter} onValueChange={setModeFilter}>\n            <SelectTrigger data-testid=\"select-mode-filter\" className=\"h-9\">\n              <SelectValue placeholder=\"Filter by mode\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Modes</SelectItem>\n              <SelectItem value=\"concise\">Concise</SelectItem>\n              <SelectItem value=\"balanced\">Balanced</SelectItem>\n              <SelectItem value=\"deep\">Deep</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n      \n      <ScrollArea className=\"flex-1\">\n        <div className=\"p-2 space-y-2\">\n          {conversations.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center h-64 text-muted-foreground\">\n              <MessageSquare className=\"w-12 h-12 mb-2\" />\n              <p className=\"text-sm\">No conversations yet</p>\n            </div>\n          ) : filteredConversations.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center h-64 text-muted-foreground\">\n              <Search className=\"w-12 h-12 mb-2\" />\n              <p className=\"text-sm text-center px-4\">No conversations match your filters</p>\n              <Button\n                data-testid=\"button-reset-filters\"\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={handleClearSearch}\n                className=\"mt-2\"\n              >\n                Clear filters\n              </Button>\n            </div>\n          ) : (\n            filteredConversations.map((conversation) => (\n              <div\n                key={conversation.id}\n                className={`w-full p-3 rounded-lg border transition-colors group hover-elevate ${\n                  selectedId === conversation.id\n                    ? \"border-primary bg-primary/10\"\n                    : \"border-card-border bg-background\"\n                }`}\n              >\n                <div className=\"flex items-start justify-between gap-2\">\n                  <button\n                    data-testid={`conversation-${conversation.id}`}\n                    onClick={() => onSelectConversation(conversation)}\n                    className=\"flex-1 min-w-0 text-left\"\n                  >\n                    <p className=\"text-sm font-medium truncate\">{conversation.question}</p>\n                    <div className=\"flex items-center gap-2 mt-1\">\n                      <span className=\"text-xs text-muted-foreground\">\n                        {format(new Date(conversation.createdAt), \"MMM d, h:mm a\")}\n                      </span>\n                      <span className=\"text-xs px-1.5 py-0.5 rounded bg-muted text-muted-foreground\">\n                        {conversation.mode}\n                      </span>\n                    </div>\n                  </button>\n                  <Button\n                    data-testid={`delete-conversation-${conversation.id}`}\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6\"\n                    onClick={(e) => handleDelete(e, conversation.id)}\n                  >\n                    <Trash2 className=\"w-3 h-3\" />\n                  </Button>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </ScrollArea>\n    </div>\n  );\n}\n","size_bytes":7400},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"server/storage.ts":{"content":"import { \n  users, \n  conversations, \n  threads,\n  messages,\n  quizAttempts,\n  quizResponses,\n  userMastery,\n  quizQuestions,\n  excelRequirementResponses,\n  referenceResponses,\n  historicalRfps,\n  sessions,\n  investmentRequests,\n  approvals,\n  tasks,\n  documents,\n  documentCategories,\n  documentCategoryAssociations,\n  notifications,\n  templates,\n  investmentRationales,\n  sequences,\n  type User, \n  type InsertUser, \n  type Conversation, \n  type InsertConversation,\n  type Thread,\n  type InsertThread,\n  type Message,\n  type InsertMessage,\n  type QuizAttempt,\n  type InsertQuizAttempt,\n  type QuizResponse,\n  type InsertQuizResponse,\n  type UserMastery,\n  type InsertUserMastery,\n  type QuizQuestion,\n  type ExcelRequirementResponse,\n  type InsertExcelRequirementResponse,\n  type HistoricalRfp,\n  type InsertHistoricalRfp,\n  type Session,\n  type InsertSession,\n  type InvestmentRequest,\n  type InsertInvestmentRequest,\n  type Approval,\n  type InsertApproval,\n  type Task,\n  type InsertTask,\n  type Document,\n  type InsertDocument,\n  type DocumentCategory,\n  type InsertDocumentCategory,\n  type Notification,\n  type InsertNotification,\n  type Template,\n  type InsertTemplate,\n  type InvestmentRationale,\n  type InsertInvestmentRationale,\n  solutionTemplates,\n  templateSections,\n  templateWorkItems,\n  templateRevisions,\n  type SolutionTemplate,\n  type InsertSolutionTemplate,\n  type TemplateSection,\n  type InsertTemplateSection,\n  type TemplateWorkItem,\n  type InsertTemplateWorkItem,\n  type TemplateRevision,\n  type InsertTemplateRevision\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, gte, sql, or, ne, isNull } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User methods\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUserLastLogin(id: string): Promise<void>;\n  getUserManager(userId: string): Promise<User | undefined>;\n  \n  // Session methods\n  createSession(session: InsertSession): Promise<Session>;\n  getSession(id: string): Promise<Session | undefined>;\n  getSessionWithUser(id: string): Promise<(Session & { user: User }) | undefined>;\n  deleteSession(id: string): Promise<void>;\n  deleteExpiredSessions(): Promise<void>;\n  \n  // Thread methods\n  getThreads(): Promise<Thread[]>;\n  getThread(id: number): Promise<Thread | undefined>;\n  createThread(thread: InsertThread): Promise<Thread>;\n  updateThreadTimestamp(id: number): Promise<void>;\n  updateThreadConversationId(id: number, conversationId: string): Promise<void>;\n  deleteThread(id: number): Promise<void>;\n  \n  // Message methods\n  getMessages(threadId: number): Promise<Message[]>;\n  createMessage(message: InsertMessage): Promise<Message>;\n  getLastAssistantMessage(threadId: number): Promise<Message | undefined>;\n  getRecentMessagePairs(threadId: number, pairCount: number): Promise<Message[]>;\n  \n  // Quiz tracking methods\n  createQuizAttempt(attempt: InsertQuizAttempt): Promise<QuizAttempt>;\n  createQuizResponse(response: InsertQuizResponse): Promise<QuizResponse>;\n  getQuizAttempts(limit?: number): Promise<QuizAttempt[]>;\n  getRecentQuizzes(count: number): Promise<QuizAttempt[]>;\n  \n  // User mastery methods\n  getUserMastery(): Promise<UserMastery | undefined>;\n  updateUserMastery(mastery: InsertUserMastery): Promise<UserMastery>;\n  \n  // Quiz question bank methods\n  getQuizCategories(): Promise<any[]>;\n  getQuizQuestions(topic: string): Promise<QuizQuestion[]>;\n  saveQuizAttemptAndUpdateMastery(\n    topic: string,\n    category: string,\n    score: number,\n    totalQuestions: number,\n    correctAnswers: number\n  ): Promise<{ mastery: UserMastery; attempt: QuizAttempt }>;\n  \n  // Old conversation methods (kept for backward compatibility)\n  getConversations(): Promise<Conversation[]>;\n  getConversation(id: number): Promise<Conversation | undefined>;\n  createConversation(conversation: InsertConversation): Promise<Conversation>;\n  deleteConversation(id: number): Promise<void>;\n  \n  // RFP Response methods\n  getAllRfpResponses(): Promise<ExcelRequirementResponse[]>;\n  getRfpResponseById(id: number): Promise<ExcelRequirementResponse | undefined>;\n  createRfpResponse(response: InsertExcelRequirementResponse): Promise<ExcelRequirementResponse>;\n  updateRfpResponse(id: number, updates: Partial<InsertExcelRequirementResponse>): Promise<ExcelRequirementResponse>;\n  deleteRfpResponse(id: number): Promise<void>;\n  getReferencesForResponse(responseId: number): Promise<any[]>;\n  getAllQuizStats(): Promise<Record<string, { bestScore: number; attempts: number }>>;\n  \n  // Investment Portal methods\n  // Investment operations\n  getInvestmentRequest(id: number): Promise<InvestmentRequest | undefined>;\n  getInvestmentRequests(filters?: { userId?: string; status?: string }): Promise<(InvestmentRequest & { documentCount: number })[]>;\n  createInvestmentRequest(request: InsertInvestmentRequest): Promise<InvestmentRequest>;\n  updateInvestmentRequest(id: number, request: Partial<InsertInvestmentRequest>): Promise<InvestmentRequest>;\n  softDeleteInvestmentRequest(id: number): Promise<boolean>;\n  \n  // Approval operations\n  createApproval(approval: InsertApproval): Promise<Approval>;\n  getApprovalById(id: number): Promise<Approval | undefined>;\n  getApprovalsByRequest(requestType: string, requestId: number): Promise<Approval[]>;\n  getApprovalsByApproverId(approverId: string, status?: string): Promise<Approval[]>;\n  updateApprovalStatus(id: number, status: string, rejectionReason?: string, editHistory?: string, comments?: string): Promise<Approval>;\n  \n  // Task operations\n  createTask(task: InsertTask): Promise<Task>;\n  updateTask(id: number, task: Partial<InsertTask>): Promise<Task>;\n  getTasksByUser(userId: string): Promise<Task[]>;\n  getTaskById(id: number): Promise<Task | undefined>;\n  \n  // Document operations\n  createDocument(document: InsertDocument): Promise<Document>;\n  updateDocument(id: number, document: Partial<InsertDocument>): Promise<Document>;\n  deleteDocument(id: number): Promise<void>;\n  getDocumentsByRequest(requestType: string, requestId: number): Promise<Document[]>;\n  getDocument(id: number): Promise<Document | undefined>;\n  \n  // Document category operations\n  getDocumentCategories(): Promise<DocumentCategory[]>;\n  createDocumentCategory(category: InsertDocumentCategory): Promise<DocumentCategory>;\n  \n  // Notification operations\n  createNotification(notification: InsertNotification): Promise<Notification>;\n  getUserNotifications(userId: string): Promise<Notification[]>;\n  markNotificationAsRead(id: number): Promise<void>;\n  deleteNotification(id: number): Promise<void>;\n  \n  // Template operations\n  createTemplate(template: InsertTemplate): Promise<Template>;\n  getTemplatesByType(type: string): Promise<Template[]>;\n  getTemplate(id: number): Promise<Template | undefined>;\n  updateTemplate(id: number, template: Partial<InsertTemplate>): Promise<Template>;\n  deleteTemplate(id: number): Promise<void>;\n  \n  // Investment rationale operations\n  createInvestmentRationale(rationale: InsertInvestmentRationale): Promise<InvestmentRationale>;\n  getInvestmentRationales(investmentId: number): Promise<InvestmentRationale[]>;\n  updateInvestmentRationale(id: number, rationale: Partial<InsertInvestmentRationale>): Promise<InvestmentRationale>;\n  deleteInvestmentRationale(id: number): Promise<void>;\n  \n  // Sequence operations\n  getNextSequenceValue(sequenceName: string, year: number): Promise<number>;\n  \n  // Historical RFP methods (for RAG-based retrieval)\n  getAllHistoricalRfps(): Promise<HistoricalRfp[]>;\n  getHistoricalRfpById(id: number): Promise<HistoricalRfp | undefined>;\n  createHistoricalRfp(rfp: InsertHistoricalRfp): Promise<HistoricalRfp>;\n  updateHistoricalRfp(id: number, updates: Partial<InsertHistoricalRfp>): Promise<HistoricalRfp>;\n  deleteHistoricalRfp(id: number): Promise<void>;\n  searchHistoricalRfpsBySimilarity(embedding: number[], topK: number): Promise<Array<HistoricalRfp & { similarity: number }>>;\n  \n  // Solution Template operations\n  createSolutionTemplate(template: InsertSolutionTemplate): Promise<SolutionTemplate>;\n  getSolutionTemplate(id: number): Promise<SolutionTemplate | undefined>;\n  getAllSolutionTemplates(): Promise<SolutionTemplate[]>;\n  updateSolutionTemplate(id: number, template: Partial<InsertSolutionTemplate>): Promise<SolutionTemplate>;\n  deleteSolutionTemplate(id: number): Promise<void>;\n  getDefaultSolutionTemplate(): Promise<SolutionTemplate | undefined>;\n  \n  // Template Section operations\n  createTemplateSection(section: InsertTemplateSection): Promise<TemplateSection>;\n  getTemplateSections(templateId: number): Promise<TemplateSection[]>;\n  updateTemplateSection(id: number, section: Partial<InsertTemplateSection>): Promise<TemplateSection>;\n  deleteTemplateSection(id: number): Promise<void>;\n  \n  // Template Work Item operations\n  createTemplateWorkItem(workItem: InsertTemplateWorkItem): Promise<TemplateWorkItem>;\n  getTemplateWorkItems(sectionId: number): Promise<TemplateWorkItem[]>;\n  updateTemplateWorkItem(id: number, workItem: Partial<InsertTemplateWorkItem>): Promise<TemplateWorkItem>;\n  deleteTemplateWorkItem(id: number): Promise<void>;\n  \n  // Template Revision operations\n  createTemplateRevision(revision: InsertTemplateRevision): Promise<TemplateRevision>;\n  getTemplateRevisions(templateId: number): Promise<TemplateRevision[]>;\n  \n  // Complete template with sections and work items\n  getCompleteTemplate(templateId: number): Promise<{\n    template: SolutionTemplate;\n    sections: Array<TemplateSection & { workItems: TemplateWorkItem[] }>;\n    revisions: TemplateRevision[];\n  } | undefined>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    return await db.query.users.findFirst({ \n      where: eq(users.id, id) \n    });\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return await db.query.users.findFirst({ \n      where: eq(users.username, username) \n    });\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(insertUser)\n      .returning();\n    return user;\n  }\n\n  async updateUserLastLogin(id: string): Promise<void> {\n    await db\n      .update(users)\n      .set({ lastLogin: new Date() })\n      .where(eq(users.id, id));\n  }\n\n  async getUserManager(userId: string): Promise<User | undefined> {\n    const user = await db.query.users.findFirst({ \n      where: eq(users.id, userId) \n    });\n    if (!user || !user.managerId) return undefined;\n    \n    return await db.query.users.findFirst({ \n      where: eq(users.id, user.managerId) \n    });\n  }\n\n  // Session methods\n  async createSession(insertSession: InsertSession): Promise<Session> {\n    const [session] = await db\n      .insert(sessions)\n      .values(insertSession)\n      .returning();\n    return session;\n  }\n\n  async getSession(id: string): Promise<Session | undefined> {\n    const [session] = await db\n      .select()\n      .from(sessions)\n      .where(and(eq(sessions.id, id), gte(sessions.expiresAt, new Date())));\n    return session || undefined;\n  }\n\n  async getSessionWithUser(id: string): Promise<(Session & { user: User }) | undefined> {\n    const result = await db\n      .select()\n      .from(sessions)\n      .innerJoin(users, eq(sessions.userId, users.id))\n      .where(and(eq(sessions.id, id), gte(sessions.expiresAt, new Date())));\n    \n    if (result.length === 0) return undefined;\n    \n    return {\n      ...result[0].sessions,\n      user: result[0].users,\n    };\n  }\n\n  async deleteSession(id: string): Promise<void> {\n    await db.delete(sessions).where(eq(sessions.id, id));\n  }\n\n  async deleteExpiredSessions(): Promise<void> {\n    await db.delete(sessions).where(sql`${sessions.expiresAt} < NOW()`);\n  }\n\n  // Thread methods\n  async getThreads(): Promise<Thread[]> {\n    // Only return threads from the last 30 days\n    const thirtyDaysAgo = new Date();\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n    \n    return await db\n      .select()\n      .from(threads)\n      .where(gte(threads.updatedAt, thirtyDaysAgo))\n      .orderBy(desc(threads.updatedAt));\n  }\n\n  async getThread(id: number): Promise<Thread | undefined> {\n    const [thread] = await db.select().from(threads).where(eq(threads.id, id));\n    return thread || undefined;\n  }\n\n  async createThread(insertThread: InsertThread): Promise<Thread> {\n    const [thread] = await db\n      .insert(threads)\n      .values(insertThread)\n      .returning();\n    return thread;\n  }\n\n  async updateThreadTimestamp(id: number): Promise<void> {\n    await db\n      .update(threads)\n      .set({ updatedAt: new Date() })\n      .where(eq(threads.id, id));\n  }\n\n  async updateThreadConversationId(id: number, conversationId: string): Promise<void> {\n    await db\n      .update(threads)\n      .set({ conversationId, updatedAt: new Date() })\n      .where(eq(threads.id, id));\n  }\n\n  async deleteThread(id: number): Promise<void> {\n    await db.delete(threads).where(eq(threads.id, id));\n  }\n\n  // Message methods\n  async getMessages(threadId: number): Promise<Message[]> {\n    return await db\n      .select()\n      .from(messages)\n      .where(eq(messages.threadId, threadId))\n      .orderBy(messages.createdAt);\n  }\n\n  async createMessage(insertMessage: InsertMessage): Promise<Message> {\n    const [message] = await db\n      .insert(messages)\n      .values(insertMessage)\n      .returning();\n    return message;\n  }\n\n  async getLastAssistantMessage(threadId: number): Promise<Message | undefined> {\n    const [message] = await db\n      .select()\n      .from(messages)\n      .where(and(eq(messages.threadId, threadId), eq(messages.role, \"assistant\")))\n      .orderBy(desc(messages.createdAt))\n      .limit(1);\n    return message || undefined;\n  }\n\n  async getRecentMessagePairs(threadId: number, pairCount: number): Promise<Message[]> {\n    // Get the last N*2 messages (pairs of user + assistant messages)\n    const recentMessages = await db\n      .select()\n      .from(messages)\n      .where(eq(messages.threadId, threadId))\n      .orderBy(desc(messages.createdAt))\n      .limit(pairCount * 2);\n    \n    // Reverse to get chronological order (oldest first)\n    return recentMessages.reverse();\n  }\n\n  // Old conversation methods (kept for backward compatibility)\n  async getConversations(): Promise<Conversation[]> {\n    return await db.select().from(conversations).orderBy(desc(conversations.createdAt));\n  }\n\n  async getConversation(id: number): Promise<Conversation | undefined> {\n    const [conversation] = await db.select().from(conversations).where(eq(conversations.id, id));\n    return conversation || undefined;\n  }\n\n  async createConversation(insertConversation: InsertConversation): Promise<Conversation> {\n    const [conversation] = await db\n      .insert(conversations)\n      .values(insertConversation)\n      .returning();\n    return conversation;\n  }\n\n  async deleteConversation(id: number): Promise<void> {\n    await db.delete(conversations).where(eq(conversations.id, id));\n  }\n\n  // Quiz tracking methods\n  async createQuizAttempt(insertAttempt: InsertQuizAttempt): Promise<QuizAttempt> {\n    const [attempt] = await db\n      .insert(quizAttempts)\n      .values(insertAttempt)\n      .returning();\n    return attempt;\n  }\n\n  async createQuizResponse(insertResponse: InsertQuizResponse): Promise<QuizResponse> {\n    const [response] = await db\n      .insert(quizResponses)\n      .values(insertResponse)\n      .returning();\n    return response;\n  }\n\n  async getQuizAttempts(limit?: number): Promise<QuizAttempt[]> {\n    const query = db\n      .select()\n      .from(quizAttempts)\n      .orderBy(desc(quizAttempts.createdAt));\n    \n    if (limit) {\n      return await query.limit(limit);\n    }\n    return await query;\n  }\n\n  async getRecentQuizzes(count: number): Promise<QuizAttempt[]> {\n    return await db\n      .select()\n      .from(quizAttempts)\n      .orderBy(desc(quizAttempts.createdAt))\n      .limit(count);\n  }\n\n  async getQuizStatsByTopic(topic: string): Promise<{ bestScore: number; attempts: number }> {\n    const attempts = await db\n      .select()\n      .from(quizAttempts)\n      .where(eq(quizAttempts.topic, topic))\n      .orderBy(desc(quizAttempts.scorePercentage));\n    \n    if (attempts.length === 0) {\n      return { bestScore: 0, attempts: 0 };\n    }\n    \n    return {\n      bestScore: attempts[0].scorePercentage,\n      attempts: attempts.length,\n    };\n  }\n\n  async getAllQuizStats(): Promise<Record<string, { bestScore: number; attempts: number }>> {\n    const allAttempts = await db\n      .select()\n      .from(quizAttempts)\n      .orderBy(desc(quizAttempts.scorePercentage));\n    \n    const stats: Record<string, { bestScore: number; attempts: number }> = {};\n    \n    for (const attempt of allAttempts) {\n      if (!stats[attempt.topic]) {\n        stats[attempt.topic] = {\n          bestScore: attempt.scorePercentage,\n          attempts: 0,\n        };\n      }\n      stats[attempt.topic].attempts += 1;\n      // Update best score if this one is higher\n      if (attempt.scorePercentage > stats[attempt.topic].bestScore) {\n        stats[attempt.topic].bestScore = attempt.scorePercentage;\n      }\n    }\n    \n    return stats;\n  }\n\n  // User mastery methods\n  async getUserMastery(): Promise<UserMastery | undefined> {\n    // For single-user system, get the first (and only) mastery record\n    const [mastery] = await db.select().from(userMastery).limit(1);\n    return mastery || undefined;\n  }\n\n  async updateUserMastery(insertMastery: InsertUserMastery): Promise<UserMastery> {\n    // Check if mastery record exists\n    const existing = await this.getUserMastery();\n    \n    if (existing) {\n      // Update existing record\n      const [updated] = await db\n        .update(userMastery)\n        .set({ ...insertMastery, updatedAt: new Date() })\n        .where(eq(userMastery.id, existing.id))\n        .returning();\n      return updated;\n    } else {\n      // Create new record\n      const [created] = await db\n        .insert(userMastery)\n        .values(insertMastery)\n        .returning();\n      return created;\n    }\n  }\n\n  // Quiz question bank methods\n  async getQuizCategories(): Promise<any[]> {\n    // Group questions by topic (not category) to show individual sub-topic quizzes\n    // Order topics in a logical learning progression\n    const result = await db\n      .select({\n        category: quizQuestions.category,\n        topic: quizQuestions.topic,\n        questionCount: sql<number>`count(*)::int`,\n        easyCount: sql<number>`count(*) FILTER (WHERE ${quizQuestions.difficulty} = 'Easy')::int`,\n        mediumCount: sql<number>`count(*) FILTER (WHERE ${quizQuestions.difficulty} = 'Medium')::int`,\n        hardCount: sql<number>`count(*) FILTER (WHERE ${quizQuestions.difficulty} = 'Hard')::int`,\n      })\n      .from(quizQuestions)\n      .groupBy(quizQuestions.category, quizQuestions.topic)\n      .orderBy(sql`\n        CASE ${quizQuestions.topic}\n          WHEN 'Order Flow Fundamentals' THEN 1\n          WHEN 'Order Capture & Document Validation' THEN 2\n          WHEN 'Order Modification & Cancellation' THEN 3\n          WHEN 'Partial Confirmations & Status' THEN 4\n          WHEN 'Account Management & FIFO' THEN 5\n          WHEN 'Reconciliation Process' THEN 6\n          WHEN 'Pre-Trade Validations' THEN 7\n          WHEN 'Order Execution & Settlement' THEN 8\n          WHEN 'Transaction Management & Alerts' THEN 9\n          WHEN 'Advanced Validations & Partial Confirmations' THEN 10\n          ELSE 99\n        END ASC\n      `);\n    \n    return result;\n  }\n\n  async getQuizQuestions(topic: string): Promise<QuizQuestion[]> {\n    return await db\n      .select()\n      .from(quizQuestions)\n      .where(eq(quizQuestions.topic, topic))\n      .orderBy(sql`RANDOM()`);\n  }\n\n  async getQuizHistory(): Promise<any[]> {\n    // Get quiz history grouped by topic with best scores and attempt counts\n    const result = await db\n      .select({\n        topic: quizAttempts.topic,\n        category: quizAttempts.category,\n        bestScore: sql<number>`MAX(${quizAttempts.scorePercentage})`,\n        totalAttempts: sql<number>`COUNT(*)`,\n        lastAttemptDate: sql<string>`MAX(${quizAttempts.createdAt})`,\n        averageScore: sql<number>`ROUND(AVG(${quizAttempts.scorePercentage}))`,\n        totalCorrect: sql<number>`SUM(${quizAttempts.correctAnswers})`,\n        totalQuestions: sql<number>`SUM(${quizAttempts.totalQuestions})`,\n      })\n      .from(quizAttempts)\n      .groupBy(quizAttempts.topic, quizAttempts.category)\n      .execute();\n    \n    // Convert aggregated values to proper types\n    return result.map(row => ({\n      topic: row.topic,\n      category: row.category,\n      bestScore: Number(row.bestScore) || 0,\n      totalAttempts: Number(row.totalAttempts) || 0,\n      lastAttemptDate: row.lastAttemptDate,\n      averageScore: Number(row.averageScore) || 0,\n      totalCorrect: Number(row.totalCorrect) || 0,\n      totalQuestions: Number(row.totalQuestions) || 0,\n    }));\n  }\n\n  async saveQuizAttemptAndUpdateMastery(\n    topic: string,\n    category: string,\n    score: number,\n    totalQuestions: number,\n    correctAnswers: number\n  ): Promise<{ mastery: UserMastery; attempt: QuizAttempt }> {\n    // Calculate points earned (score as percentage out of 100)\n    const pointsEarned = Math.round(score);\n\n    // Save quiz attempt\n    const [attempt] = await db\n      .insert(quizAttempts)\n      .values({\n        topic,\n        category,\n        totalQuestions,\n        correctAnswers,\n        scorePercentage: score,\n        pointsEarned,\n      })\n      .returning();\n\n    // Get current mastery or create new one\n    let mastery = await this.getUserMastery();\n    \n    if (!mastery) {\n      // Create initial mastery record\n      const percentage = Math.min(100, Math.round((pointsEarned / 600) * 100));\n      const [newMastery] = await db\n        .insert(userMastery)\n        .values({\n          totalCumulativePoints: pointsEarned,\n          overallScore: percentage,\n          currentLevel: this.calculateLevel(pointsEarned),\n          quizPerformanceScore: pointsEarned,\n          topicCoverageScore: 0,\n          retentionScore: 0,\n          topicsMastered: score >= 70 ? 1 : 0,\n          totalQuizzesTaken: 1,\n        })\n        .returning();\n      mastery = newMastery;\n    } else {\n      // Update existing mastery - add points cumulatively\n      const newTotalPoints = mastery.totalCumulativePoints + pointsEarned;\n      const newQuizCount = mastery.totalQuizzesTaken + 1;\n      const percentage = Math.min(100, Math.round((newTotalPoints / 600) * 100));\n      \n      // Check if this topic was passed (â‰¥70%)\n      const topicPassed = score >= 70;\n      \n      const [updatedMastery] = await db\n        .update(userMastery)\n        .set({\n          totalCumulativePoints: newTotalPoints,\n          overallScore: percentage,\n          currentLevel: this.calculateLevel(newTotalPoints),\n          quizPerformanceScore: newTotalPoints, // Simplified: all points go here\n          totalQuizzesTaken: newQuizCount,\n          topicsMastered: topicPassed ? mastery.topicsMastered + 1 : mastery.topicsMastered,\n          updatedAt: new Date(),\n        })\n        .where(eq(userMastery.id, mastery.id))\n        .returning();\n      mastery = updatedMastery;\n    }\n\n    return { mastery, attempt };\n  }\n\n  // RFP Response methods\n  async getAllRfpResponses(): Promise<ExcelRequirementResponse[]> {\n    return await db\n      .select()\n      .from(excelRequirementResponses)\n      .orderBy(desc(excelRequirementResponses.timestamp));\n  }\n\n  async getRfpResponseById(id: number): Promise<ExcelRequirementResponse | undefined> {\n    const [response] = await db\n      .select()\n      .from(excelRequirementResponses)\n      .where(eq(excelRequirementResponses.id, id));\n    return response || undefined;\n  }\n\n  async createRfpResponse(insertResponse: InsertExcelRequirementResponse): Promise<ExcelRequirementResponse> {\n    const [response] = await db\n      .insert(excelRequirementResponses)\n      .values(insertResponse)\n      .returning();\n    return response;\n  }\n\n  async updateRfpResponse(id: number, updates: Partial<InsertExcelRequirementResponse>): Promise<ExcelRequirementResponse> {\n    const [response] = await db\n      .update(excelRequirementResponses)\n      .set(updates)\n      .where(eq(excelRequirementResponses.id, id))\n      .returning();\n    return response;\n  }\n\n  async deleteRfpResponse(id: number): Promise<void> {\n    await db\n      .delete(excelRequirementResponses)\n      .where(eq(excelRequirementResponses.id, id));\n  }\n\n  async getReferencesForResponse(responseId: number): Promise<any[]> {\n    return await db\n      .select()\n      .from(referenceResponses)\n      .where(eq(referenceResponses.responseId, responseId))\n      .orderBy(desc(referenceResponses.score));\n  }\n\n  // Historical RFP methods (for RAG-based retrieval)\n  async getAllHistoricalRfps(): Promise<HistoricalRfp[]> {\n    return await db\n      .select()\n      .from(historicalRfps)\n      .orderBy(desc(historicalRfps.createdAt));\n  }\n\n  async getHistoricalRfpById(id: number): Promise<HistoricalRfp | undefined> {\n    const [rfp] = await db\n      .select()\n      .from(historicalRfps)\n      .where(eq(historicalRfps.id, id));\n    return rfp || undefined;\n  }\n\n  async createHistoricalRfp(insertRfp: InsertHistoricalRfp): Promise<HistoricalRfp> {\n    const [rfp] = await db\n      .insert(historicalRfps)\n      .values(insertRfp)\n      .returning();\n    return rfp;\n  }\n\n  async updateHistoricalRfp(id: number, updates: Partial<InsertHistoricalRfp>): Promise<HistoricalRfp> {\n    const [rfp] = await db\n      .update(historicalRfps)\n      .set(updates)\n      .where(eq(historicalRfps.id, id))\n      .returning();\n    return rfp;\n  }\n\n  async deleteHistoricalRfp(id: number): Promise<void> {\n    await db\n      .delete(historicalRfps)\n      .where(eq(historicalRfps.id, id));\n  }\n\n  async searchHistoricalRfpsBySimilarity(\n    embedding: number[], \n    topK: number = 5\n  ): Promise<Array<HistoricalRfp & { similarity: number }>> {\n    // Use pgvector's cosine distance operator (<=>)\n    // Similarity = 1 - distance (convert distance to similarity score)\n    const results = await db\n      .select({\n        id: historicalRfps.id,\n        rfpName: historicalRfps.rfpName,\n        clientName: historicalRfps.clientName,\n        clientIndustry: historicalRfps.clientIndustry,\n        submissionDate: historicalRfps.submissionDate,\n        category: historicalRfps.category,\n        requirement: historicalRfps.requirement,\n        response: historicalRfps.response,\n        successScore: historicalRfps.successScore,\n        responseQuality: historicalRfps.responseQuality,\n        embedding: historicalRfps.embedding,\n        uploadedBy: historicalRfps.uploadedBy,\n        createdAt: historicalRfps.createdAt,\n        distance: sql<number>`${historicalRfps.embedding} <=> ${JSON.stringify(embedding)}::vector`\n      })\n      .from(historicalRfps)\n      .orderBy(sql`${historicalRfps.embedding} <=> ${JSON.stringify(embedding)}::vector`)\n      .limit(topK);\n\n    // Convert distance to similarity score (1 - distance)\n    return results.map(r => ({\n      ...r,\n      similarity: 1 - r.distance\n    }));\n  }\n\n  private calculateLevel(points: number): string{\n    if (points >= 481) return \"Expert\";\n    if (points >= 361) return \"Advanced\";\n    if (points >= 241) return \"Intermediate\";\n    if (points >= 121) return \"Learning\";\n    return \"Novice\";\n  }\n\n  // ===== Investment Portal Methods =====\n  \n  async getInvestmentRequest(id: number): Promise<InvestmentRequest | undefined> {\n    const [request] = await db.select().from(investmentRequests).where(eq(investmentRequests.id, id));\n    return request;\n  }\n\n  async getInvestmentRequests(filters?: { userId?: string; status?: string }): Promise<(InvestmentRequest & { documentCount: number })[]> {\n    const conditions = [isNull(investmentRequests.deletedAt)];\n    if (filters?.userId) conditions.push(eq(investmentRequests.requesterId, filters.userId));\n    if (filters?.status) conditions.push(eq(investmentRequests.status, filters.status));\n    \n    // Use SQL to count documents in a single query\n    const requests = await db\n      .select({\n        id: investmentRequests.id,\n        requestId: investmentRequests.requestId,\n        reportCode: investmentRequests.reportCode,\n        requesterId: investmentRequests.requesterId,\n        targetCompany: investmentRequests.targetCompany,\n        investmentType: investmentRequests.investmentType,\n        description: investmentRequests.description,\n        enhancedDescription: investmentRequests.enhancedDescription,\n        status: investmentRequests.status,\n        currentApprovalStage: investmentRequests.currentApprovalStage,\n        slaDeadline: investmentRequests.slaDeadline,\n        deletedAt: investmentRequests.deletedAt,\n        createdAt: investmentRequests.createdAt,\n        updatedAt: investmentRequests.updatedAt,\n        currentApprovalCycle: investmentRequests.currentApprovalCycle,\n        reportTitle: investmentRequests.reportTitle,\n        reportDate: investmentRequests.reportDate,\n        createdBy: investmentRequests.createdBy,\n        documentCount: sql<number>`COALESCE(COUNT(${documents.id}), 0)`\n      })\n      .from(investmentRequests)\n      .leftJoin(\n        documents, \n        and(\n          eq(documents.requestId, investmentRequests.id),\n          eq(documents.requestType, 'investment')\n        )\n      )\n      .where(and(...conditions))\n      .groupBy(investmentRequests.id)\n      .orderBy(desc(investmentRequests.createdAt));\n    \n    return requests;\n  }\n\n  async createInvestmentRequest(request: InsertInvestmentRequest): Promise<InvestmentRequest> {\n    // Generate unique request ID if not provided (INV-YYYY-XXX format)\n    let requestId = request.requestId;\n    if (!requestId) {\n      const year = new Date().getFullYear();\n      const sequenceValue = await this.getNextSequenceValue('investment-request', year);\n      requestId = `INV-${year}-${String(sequenceValue).padStart(3, '0')}`;\n    }\n    \n    // Generate unique report code if not provided (RPT-YYYY-XXX format)\n    let reportCode = request.reportCode;\n    if (!reportCode) {\n      const year = new Date().getFullYear();\n      const sequenceValue = await this.getNextSequenceValue('report-code', year);\n      reportCode = `RPT-${year}-${String(sequenceValue).padStart(3, '0')}`;\n    }\n    \n    const requestData = {\n      ...request,\n      requestId,\n      reportCode\n    };\n    \n    const [newRequest] = await db.insert(investmentRequests).values(requestData).returning();\n    return newRequest;\n  }\n\n  async updateInvestmentRequest(id: number, request: Partial<InsertInvestmentRequest>): Promise<InvestmentRequest> {\n    const [updated] = await db.update(investmentRequests).set(request).where(eq(investmentRequests.id, id)).returning();\n    return updated;\n  }\n\n  async softDeleteInvestmentRequest(id: number): Promise<boolean> {\n    await db.update(investmentRequests).set({ deletedAt: new Date() }).where(eq(investmentRequests.id, id));\n    return true;\n  }\n\n  async createApproval(approval: InsertApproval): Promise<Approval> {\n    const [newApproval] = await db.insert(approvals).values(approval).returning();\n    return newApproval;\n  }\n\n  async getApprovalById(id: number): Promise<Approval | undefined> {\n    return await db.query.approvals.findFirst({ \n      where: eq(approvals.id, id) \n    });\n  }\n\n  async getApprovalsByRequest(requestType: string, requestId: number): Promise<Approval[]> {\n    return await db.select().from(approvals)\n      .where(and(eq(approvals.requestType, requestType), eq(approvals.requestId, requestId)))\n      .orderBy(desc(approvals.createdAt));\n  }\n\n  async getApprovalsByApproverId(approverId: string, status?: string): Promise<Approval[]> {\n    const conditions = status \n      ? and(eq(approvals.approverId, approverId), eq(approvals.status, status))\n      : eq(approvals.approverId, approverId);\n    \n    return await db.select().from(approvals)\n      .where(conditions)\n      .orderBy(desc(approvals.createdAt));\n  }\n\n  async updateApprovalStatus(id: number, status: string, rejectionReason?: string, editHistory?: string, comments?: string): Promise<Approval> {\n    const updateData: any = { status, approvedAt: status === 'approved' ? new Date() : null };\n    if (rejectionReason !== undefined) updateData.rejectionReason = rejectionReason;\n    if (editHistory !== undefined) updateData.editHistory = editHistory;\n    if (comments !== undefined) updateData.comments = comments;\n    \n    const [updated] = await db.update(approvals).set(updateData).where(eq(approvals.id, id)).returning();\n    return updated;\n  }\n\n  async createTask(task: InsertTask): Promise<Task> {\n    const [newTask] = await db.insert(tasks).values(task).returning();\n    return newTask;\n  }\n\n  async updateTask(id: number, task: Partial<InsertTask>): Promise<Task> {\n    const [updated] = await db.update(tasks).set(task).where(eq(tasks.id, id)).returning();\n    return updated;\n  }\n\n  async getTasksByUser(userId: string): Promise<Task[]> {\n    return await db.select().from(tasks)\n      .where(eq(tasks.assigneeId, userId))\n      .orderBy(desc(tasks.createdAt));\n  }\n\n  async getTaskById(id: number): Promise<Task | undefined> {\n    const [task] = await db.select().from(tasks).where(eq(tasks.id, id));\n    return task;\n  }\n\n  async createDocument(document: InsertDocument): Promise<Document> {\n    const [newDoc] = await db.insert(documents).values(document).returning();\n    return newDoc;\n  }\n\n  async updateDocument(id: number, document: Partial<InsertDocument>): Promise<Document> {\n    const [updated] = await db.update(documents).set(document).where(eq(documents.id, id)).returning();\n    return updated;\n  }\n\n  async deleteDocument(id: number): Promise<void> {\n    await db.delete(documents).where(eq(documents.id, id));\n  }\n\n  async getDocumentsByRequest(requestType: string, requestId: number): Promise<Document[]> {\n    return await db.select().from(documents)\n      .where(and(eq(documents.requestType, requestType), eq(documents.requestId, requestId)))\n      .orderBy(desc(documents.createdAt));\n  }\n\n  async getDocument(id: number): Promise<Document | undefined> {\n    const [doc] = await db.select().from(documents).where(eq(documents.id, id));\n    return doc;\n  }\n\n  async getDocumentCategories(): Promise<DocumentCategory[]> {\n    return await db.select().from(documentCategories).where(eq(documentCategories.isActive, true));\n  }\n\n  async createDocumentCategory(category: InsertDocumentCategory): Promise<DocumentCategory> {\n    const [newCategory] = await db.insert(documentCategories).values(category).returning();\n    return newCategory;\n  }\n\n  async createNotification(notification: InsertNotification): Promise<Notification> {\n    const [newNotification] = await db.insert(notifications).values(notification).returning();\n    return newNotification;\n  }\n\n  async getUserNotifications(userId: string): Promise<Notification[]> {\n    return await db.select().from(notifications)\n      .where(eq(notifications.userId, userId))\n      .orderBy(desc(notifications.createdAt));\n  }\n\n  async markNotificationAsRead(id: number): Promise<void> {\n    await db.update(notifications).set({ isRead: true }).where(eq(notifications.id, id));\n  }\n\n  async deleteNotification(id: number): Promise<void> {\n    await db.delete(notifications).where(eq(notifications.id, id));\n  }\n\n  async createTemplate(template: InsertTemplate): Promise<Template> {\n    const [newTemplate] = await db.insert(templates).values(template).returning();\n    return newTemplate;\n  }\n\n  async getTemplatesByType(type: string): Promise<Template[]> {\n    return await db.select().from(templates)\n      .where(and(eq(templates.type, type), eq(templates.isActive, true)))\n      .orderBy(desc(templates.createdAt));\n  }\n\n  async getTemplate(id: number): Promise<Template | undefined> {\n    const [template] = await db.select().from(templates).where(eq(templates.id, id));\n    return template;\n  }\n\n  async updateTemplate(id: number, template: Partial<InsertTemplate>): Promise<Template> {\n    const [updated] = await db.update(templates).set(template).where(eq(templates.id, id)).returning();\n    return updated;\n  }\n\n  async deleteTemplate(id: number): Promise<void> {\n    await db.delete(templates).where(eq(templates.id, id));\n  }\n\n  async createInvestmentRationale(rationale: InsertInvestmentRationale): Promise<InvestmentRationale> {\n    const [newRationale] = await db.insert(investmentRationales).values(rationale).returning();\n    return newRationale;\n  }\n\n  async getInvestmentRationales(investmentId: number): Promise<InvestmentRationale[]> {\n    return await db.select().from(investmentRationales)\n      .where(eq(investmentRationales.investmentId, investmentId))\n      .orderBy(desc(investmentRationales.createdAt));\n  }\n\n  async updateInvestmentRationale(id: number, rationale: Partial<InsertInvestmentRationale>): Promise<InvestmentRationale> {\n    const [updated] = await db.update(investmentRationales).set(rationale).where(eq(investmentRationales.id, id)).returning();\n    return updated;\n  }\n\n  async deleteInvestmentRationale(id: number): Promise<void> {\n    await db.delete(investmentRationales).where(eq(investmentRationales.id, id));\n  }\n\n  async getNextSequenceValue(sequenceName: string, year: number): Promise<number> {\n    const [existing] = await db.select().from(sequences)\n      .where(and(eq(sequences.sequenceName, sequenceName), eq(sequences.year, year)));\n    \n    if (existing) {\n      const nextValue = existing.currentValue + 1;\n      await db.update(sequences)\n        .set({ currentValue: nextValue, updatedAt: new Date() })\n        .where(eq(sequences.id, existing.id));\n      return nextValue;\n    } else {\n      const [newSeq] = await db.insert(sequences)\n        .values({ sequenceName, year, currentValue: 1 })\n        .returning();\n      return 1;\n    }\n  }\n\n  async createSolutionTemplate(template: InsertSolutionTemplate): Promise<SolutionTemplate> {\n    const [newTemplate] = await db.insert(solutionTemplates).values(template).returning();\n    return newTemplate;\n  }\n\n  async getSolutionTemplate(id: number): Promise<SolutionTemplate | undefined> {\n    const [template] = await db.select().from(solutionTemplates).where(eq(solutionTemplates.id, id));\n    return template;\n  }\n\n  async getAllSolutionTemplates(): Promise<SolutionTemplate[]> {\n    return await db.select().from(solutionTemplates).orderBy(desc(solutionTemplates.createdAt));\n  }\n\n  async updateSolutionTemplate(id: number, template: Partial<InsertSolutionTemplate>): Promise<SolutionTemplate> {\n    const [updated] = await db.update(solutionTemplates)\n      .set({ ...template, updatedAt: new Date() })\n      .where(eq(solutionTemplates.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteSolutionTemplate(id: number): Promise<void> {\n    await db.delete(solutionTemplates).where(eq(solutionTemplates.id, id));\n  }\n\n  async getDefaultSolutionTemplate(): Promise<SolutionTemplate | undefined> {\n    const [template] = await db.select().from(solutionTemplates)\n      .where(eq(solutionTemplates.isDefault, true));\n    return template;\n  }\n\n  async createTemplateSection(section: InsertTemplateSection): Promise<TemplateSection> {\n    const [newSection] = await db.insert(templateSections).values(section).returning();\n    return newSection;\n  }\n\n  async getTemplateSections(templateId: number): Promise<TemplateSection[]> {\n    return await db.select().from(templateSections)\n      .where(eq(templateSections.templateId, templateId))\n      .orderBy(templateSections.orderIndex);\n  }\n\n  async updateTemplateSection(id: number, section: Partial<InsertTemplateSection>): Promise<TemplateSection> {\n    const [updated] = await db.update(templateSections)\n      .set(section)\n      .where(eq(templateSections.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteTemplateSection(id: number): Promise<void> {\n    await db.delete(templateSections).where(eq(templateSections.id, id));\n  }\n\n  async createTemplateWorkItem(workItem: InsertTemplateWorkItem): Promise<TemplateWorkItem> {\n    const [newWorkItem] = await db.insert(templateWorkItems).values(workItem).returning();\n    return newWorkItem;\n  }\n\n  async getTemplateWorkItems(sectionId: number): Promise<TemplateWorkItem[]> {\n    return await db.select().from(templateWorkItems)\n      .where(eq(templateWorkItems.sectionId, sectionId))\n      .orderBy(templateWorkItems.orderIndex);\n  }\n\n  async updateTemplateWorkItem(id: number, workItem: Partial<InsertTemplateWorkItem>): Promise<TemplateWorkItem> {\n    const [updated] = await db.update(templateWorkItems)\n      .set(workItem)\n      .where(eq(templateWorkItems.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteTemplateWorkItem(id: number): Promise<void> {\n    await db.delete(templateWorkItems).where(eq(templateWorkItems.id, id));\n  }\n\n  async createTemplateRevision(revision: InsertTemplateRevision): Promise<TemplateRevision> {\n    const [newRevision] = await db.insert(templateRevisions).values(revision).returning();\n    return newRevision;\n  }\n\n  async getTemplateRevisions(templateId: number): Promise<TemplateRevision[]> {\n    return await db.select().from(templateRevisions)\n      .where(eq(templateRevisions.templateId, templateId))\n      .orderBy(desc(templateRevisions.changeDate));\n  }\n\n  async getCompleteTemplate(templateId: number): Promise<{\n    template: SolutionTemplate;\n    sections: Array<TemplateSection & { workItems: TemplateWorkItem[] }>;\n    revisions: TemplateRevision[];\n  } | undefined> {\n    const template = await this.getSolutionTemplate(templateId);\n    if (!template) return undefined;\n\n    const sections = await this.getTemplateSections(templateId);\n    const sectionsWithWorkItems = await Promise.all(\n      sections.map(async (section) => {\n        const workItems = await this.getTemplateWorkItems(section.id);\n        return { ...section, workItems };\n      })\n    );\n\n    const revisions = await this.getTemplateRevisions(templateId);\n\n    return {\n      template,\n      sections: sectionsWithWorkItems,\n      revisions,\n    };\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":42278},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/thread-sidebar.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Input } from \"@/components/ui/input\";\nimport { Trash2, MessageSquarePlus, Search, ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { useState } from \"react\";\nimport type { Thread } from \"@shared/schema\";\nimport { formatDistanceToNow } from \"date-fns\";\n\ninterface ThreadSidebarProps {\n  onSelectThread: (thread: Thread) => void;\n  onNewChat: () => void;\n  onDeleteThread: (id: number) => void;\n  selectedThreadId?: number;\n}\n\nexport function ThreadSidebar({ onSelectThread, onNewChat, onDeleteThread, selectedThreadId }: ThreadSidebarProps) {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isCollapsed, setIsCollapsed] = useState(false);\n\n  const { data: threads = [], isLoading } = useQuery<Thread[]>({\n    queryKey: [\"/api/threads\"],\n  });\n\n  const filteredThreads = threads.filter((thread) =>\n    thread.title.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  if (isCollapsed) {\n    return (\n      <div className=\"w-12 border-r border-border bg-card flex flex-col h-full items-center py-4\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={() => setIsCollapsed(false)}\n          data-testid=\"button-expand-sidebar\"\n          className=\"mb-4\"\n        >\n          <ChevronRight className=\"w-5 h-5\" />\n        </Button>\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={onNewChat}\n          data-testid=\"button-new-chat-collapsed\"\n        >\n          <MessageSquarePlus className=\"w-5 h-5\" />\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-64 border-r border-border bg-card flex flex-col h-full\">\n      <div className=\"p-4 border-b border-border space-y-3\">\n        <div className=\"flex items-center justify-between gap-2\">\n          <Button\n            data-testid=\"button-new-chat\"\n            onClick={onNewChat}\n            className=\"flex-1 gap-2\"\n            size=\"lg\"\n          >\n            <MessageSquarePlus className=\"w-5 h-5\" />\n            New Chat\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setIsCollapsed(true)}\n            data-testid=\"button-collapse-sidebar\"\n            title=\"Collapse sidebar\"\n          >\n            <ChevronLeft className=\"w-5 h-5\" />\n          </Button>\n        </div>\n\n        <div className=\"relative\">\n          <Search className=\"absolute left-2.5 top-2.5 w-4 h-4 text-muted-foreground\" />\n          <Input\n            data-testid=\"input-search-threads\"\n            placeholder=\"Search conversations...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-9\"\n          />\n        </div>\n      </div>\n\n      <ScrollArea className=\"flex-1\">\n        <div className=\"p-2 space-y-1.5\">\n          {isLoading ? (\n            <div className=\"p-4 text-center text-sm text-muted-foreground\">\n              Loading threads...\n            </div>\n          ) : filteredThreads.length === 0 ? (\n            <div className=\"p-4 text-center text-sm text-muted-foreground\">\n              {searchQuery ? \"No threads found\" : \"No conversations yet\"}\n            </div>\n          ) : (\n            filteredThreads.map((thread) => (\n              <div\n                key={thread.id}\n                className={`group relative flex items-start gap-2 rounded-lg p-2.5 cursor-pointer transition-colors ${\n                  selectedThreadId === thread.id\n                    ? \"bg-primary/10 border border-primary/20\"\n                    : \"hover:bg-muted/50\"\n                }`}\n                onClick={() => onSelectThread(thread)}\n                data-testid={`thread-item-${thread.id}`}\n              >\n                <div className=\"flex-1 min-w-0 overflow-hidden\">\n                  <p className=\"text-sm font-normal text-foreground break-words line-clamp-2\">\n                    {thread.title}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    {formatDistanceToNow(new Date(thread.updatedAt), { addSuffix: true })}\n                  </p>\n                </div>\n                <Button\n                  data-testid={`button-delete-thread-${thread.id}`}\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-8 w-8 p-0 flex-shrink-0 hover:bg-destructive hover:text-destructive-foreground text-destructive\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onDeleteThread(thread.id);\n                  }}\n                  title=\"Delete thread\"\n                >\n                  <Trash2 className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            ))\n          )}\n        </div>\n      </ScrollArea>\n    </div>\n  );\n}\n","size_bytes":4947},"attached_assets/INTEGRATION_GUIDE_1760876363773.md":{"content":"# ðŸ”— Third-Party Integration Guide\n\n**Complete guide for testing and integrating with EKG Agent API**\n\n---\n\n## ðŸš€ Quick Start\n\n### 1. Local Development Server\n```bash\n# Set your OpenAI API key\nexport OPENAI_API_KEY=sk-proj-your-actual-key-here\n\n# Start the server\nuvicorn api.main:app --host 0.0.0.0 --port 8000 --reload\n```\n\n### 2. Production Deployment\n```bash\n# Production URL (no setup required)\nhttps://ekg-service-47249889063.europe-west6.run.app\n```\n\n### 3. Test Connectivity\n```bash\n# Local health check\ncurl http://localhost:8000/health\n\n# Production health check\ncurl https://ekg-service-47249889063.europe-west6.run.app/health\n\n# List domains (local)\ncurl http://localhost:8000/domains\n\n# List domains (production)\ncurl https://ekg-service-47249889063.europe-west6.run.app/domains\n```\n\n---\n\n## ðŸ“‹ API Reference\n\n### Base URLs\n```\nLocal Development: http://localhost:8000\nProduction:       https://ekg-service-47249889063.europe-west6.run.app\n```\n\n### Available Endpoints\n| Method | Endpoint | Description | Response Time |\n|--------|----------|-------------|---------------|\n| `GET` | `/health` | Health check with domain status, OpenAI connectivity, cache status | <1 second |\n| `GET` | `/domains` | List all available domains with node/edge counts | <1 second |\n| `GET` | `/metrics` | Performance metrics, response times, cache status | <1 second |\n| `GET` | `/kg-status` | Knowledge graph file accessibility and validation | <1 second |\n| `POST` | `/v1/answer` | Main Q&A endpoint with conversational support | 30s-5min |\n\n### Endpoint Details\n\n#### `/health` - System Health Check\n```bash\n# Local\ncurl http://localhost:8000/health\n\n# Production\ncurl https://ekg-service-47249889063.europe-west6.run.app/health\n```\n**Response includes:**\n- System status (healthy/degraded)\n- OpenAI connectivity status\n- Domain loading status\n- Cache sizes\n- Available answer modes\n- Timestamp\n\n#### `/domains` - Available Domains\n```bash\n# Local\ncurl http://localhost:8000/domains\n\n# Production\ncurl https://ekg-service-47249889063.europe-west6.run.app/domains\n```\n**Response includes:**\n- Domain IDs and names\n- Knowledge graph node/edge counts\n- Vector store IDs\n- Domain status (loaded/error)\n\n#### `/metrics` - Performance Metrics\n```bash\n# Local\ncurl http://localhost:8000/metrics\n\n# Production\ncurl https://ekg-service-47249889063.europe-west6.run.app/metrics\n```\n**Response includes:**\n- Total request count\n- Average/max/min response times\n- Cache status (query cache, hits cache)\n- Timestamp\n\n#### `/kg-status` - Knowledge Graph Status\n```bash\n# Local\ncurl http://localhost:8000/kg-status\n\n# Production\ncurl https://ekg-service-47249889063.europe-west6.run.app/kg-status\n```\n**Response includes:**\n- Data directory accessibility\n- KG file existence and validation\n- File sizes and JSON validity\n- Error details if any\n\n#### `/v1/answer` - Main Q&A Endpoint\n```bash\n# Local\ncurl -X POST http://localhost:8000/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is OTP?\", \"domain\": \"wealth_management\"}'\n\n# Production\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is OTP?\", \"domain\": \"wealth_management\"}'\n```\n**Response includes:**\n- Unique response_id\n- Markdown-formatted answer\n- Source citations\n- Metadata (domain, model, mode, timing)\n- Conversational context flags\n\n### Request Format\n```json\n{\n  \"question\": \"Your question here\",\n  \"domain\": \"wealth_management\",\n  \"response_id\": \"optional-previous-response-id\",\n  \"conversation_id\": \"optional-conversation-id\",\n  \"vectorstore_id\": \"optional-vector-store-id\",\n  \"params\": {\n    \"_mode\": \"balanced\"\n  }\n}\n```\n\n### Response Format\n```json\n{\n  \"response_id\": \"uuid-string\",\n  \"markdown\": \"Answer content...\",\n  \"sources\": [...],\n  \"meta\": {\n    \"domain\": \"wealth_management\",\n    \"vectorstore_id\": \"vs_...\",\n    \"is_conversational\": false,\n    \"previous_response_id\": \"uuid-string\",\n    \"conversation_id\": \"conversation-id\",\n    \"model\": \"gpt-5-mini\",\n    \"mode\": \"balanced\"\n  }\n}\n```\n\n---\n\n## ðŸ§ª Testing Methods\n\n### Method 1: Python Testing Script\n```bash\n# Install dependencies\npip install requests\n\n# Run full test suite (local)\npython test_third_party.py\n\n# Run full test suite (production)\npython test_third_party.py --url https://ekg-service-47249889063.europe-west6.run.app\n\n# Run specific tests (local)\npython test_third_party.py --test health\npython test_third_party.py --test domains\npython test_third_party.py --test query\npython test_third_party.py --test conversational\npython test_third_party.py --test performance\n\n# Run specific tests (production)\npython test_third_party.py --url https://ekg-service-47249889063.europe-west6.run.app --test health\n```\n\n### Method 2: cURL Commands\n```bash\n# Basic query (local)\ncurl -X POST http://localhost:8000/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"question\": \"What is OTP verification?\",\n    \"domain\": \"wealth_management\"\n  }'\n\n# Basic query (production)\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"question\": \"What is OTP verification?\",\n    \"domain\": \"wealth_management\"\n  }'\n\n# Conversational follow-up (local)\ncurl -X POST http://localhost:8000/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"question\": \"How long is the OTP valid?\",\n    \"domain\": \"wealth_management\",\n    \"response_id\": \"YOUR_RESPONSE_ID_HERE\"\n  }'\n\n# Conversational follow-up (production)\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"question\": \"How long is the OTP valid?\",\n    \"domain\": \"wealth_management\",\n    \"response_id\": \"YOUR_RESPONSE_ID_HERE\"\n  }'\n```\n\n### Method 3: JavaScript/Node.js\n```bash\n# Install dependencies\nnpm install axios\n\n# Run JavaScript test (local)\nnode examples/javascript_test.js\n\n# Run JavaScript test (production)\nnode examples/javascript_test.js --url https://ekg-service-47249889063.europe-west6.run.app\n```\n\n### Method 4: cURL Script\n```bash\n# Run comprehensive cURL tests (local)\n./examples/curl_examples.sh\n\n# Run comprehensive cURL tests (production)\n./examples/curl_examples.sh --url https://ekg-service-47249889063.europe-west6.run.app\n```\n\n### Method 5: Postman Collection\n1. Import `examples/postman_collection.json` into Postman\n2. Set environment variable `base_url` to:\n   - Local: `http://localhost:8000`\n   - Production: `https://ekg-service-47249889063.europe-west6.run.app`\n3. Run the collection\n\n---\n\n## ðŸ”§ Integration Examples\n\n### Python Integration\n```python\nimport requests\n\nclass EkgApiClient:\n    def __init__(self, base_url=\"http://localhost:8000\"):\n        \"\"\"\n        Initialize EKG API client\n        \n        Args:\n            base_url: API base URL\n                - Local: http://localhost:8000\n                - Production: https://ekg-service-47249889063.europe-west6.run.app\n        \"\"\"\n        self.base_url = base_url\n        self.session = requests.Session()\n        self.session.headers.update({\n            'Content-Type': 'application/json'\n        })\n    \n    def ask(self, question, domain=\"wealth_management\", response_id=None, conversation_id=None):\n        payload = {\n            \"question\": question,\n            \"domain\": domain\n        }\n        \n        if response_id:\n            payload[\"response_id\"] = response_id\n        if conversation_id:\n            payload[\"conversation_id\"] = conversation_id\n        \n        response = self.session.post(f\"{self.base_url}/v1/answer\", json=payload)\n        return response.json()\n\n# Usage - Local Development\nclient = EkgApiClient()  # Defaults to http://localhost:8000\n\n# Usage - Production\n# client = EkgApiClient(\"https://ekg-service-47249889063.europe-west6.run.app\")\n\n# Initial question\nresult1 = client.ask(\"What is OTP verification?\")\nprint(f\"Response ID: {result1['response_id']}\")\n\n# Follow-up\nresult2 = client.ask(\n    \"How long is the OTP valid?\",\n    response_id=result1['response_id']\n)\nprint(f\"Follow-up response: {result2['markdown']}\")\n```\n\n### JavaScript Integration\n```javascript\nconst axios = require('axios');\n\nclass EkgApiClient {\n    constructor(baseUrl = 'http://localhost:8000') {\n        /**\n         * Initialize EKG API client\n         * \n         * @param {string} baseUrl - API base URL\n         *   - Local: http://localhost:8000\n         *   - Production: https://ekg-service-47249889063.europe-west6.run.app\n         */\n        this.client = axios.create({\n            baseURL: baseUrl,\n            headers: { 'Content-Type': 'application/json' }\n        });\n    }\n    \n    async ask(question, domain = 'wealth_management', responseId = null, conversationId = null) {\n        const payload = { question, domain };\n        if (responseId) payload.response_id = responseId;\n        if (conversationId) payload.conversation_id = conversationId;\n        \n        const response = await this.client.post('/v1/answer', payload);\n        return response.data;\n    }\n}\n\n// Usage - Local Development\nconst client = new EkgApiClient();  // Defaults to http://localhost:8000\n\n// Usage - Production\n// const client = new EkgApiClient('https://ekg-service-47249889063.europe-west6.run.app');\n\nasync function example() {\n    // Initial question\n    const result1 = await client.ask(\"What is OTP verification?\");\n    console.log(`Response ID: ${result1.response_id}`);\n    \n    // Follow-up\n    const result2 = await client.ask(\n        \"How long is the OTP valid?\",\n        \"wealth_management\",\n        result1.response_id\n    );\n    console.log(`Follow-up: ${result2.markdown}`);\n}\n```\n\n### Java Integration\n```java\nimport java.net.http.HttpClient;\nimport java.net.http.HttpRequest;\nimport java.net.http.HttpResponse;\nimport com.fasterxml.jackson.databind.ObjectMapper;\n\npublic class EkgApiClient {\n    private final HttpClient client;\n    private final ObjectMapper mapper;\n    private final String baseUrl;\n    \n    public EkgApiClient(String baseUrl) {\n        this.client = HttpClient.newHttpClient();\n        this.mapper = new ObjectMapper();\n        this.baseUrl = baseUrl;\n    }\n    \n    public ApiResponse ask(String question, String domain, String responseId, String conversationId) {\n        try {\n            Map<String, Object> payload = new HashMap<>();\n            payload.put(\"question\", question);\n            payload.put(\"domain\", domain);\n            if (responseId != null) payload.put(\"response_id\", responseId);\n            if (conversationId != null) payload.put(\"conversation_id\", conversationId);\n            \n            String jsonPayload = mapper.writeValueAsString(payload);\n            \n            HttpRequest request = HttpRequest.newBuilder()\n                .uri(URI.create(baseUrl + \"/v1/answer\"))\n                .header(\"Content-Type\", \"application/json\")\n                .POST(HttpRequest.BodyPublishers.ofString(jsonPayload))\n                .build();\n            \n            HttpResponse<String> response = client.send(request, HttpResponse.BodyHandlers.ofString());\n            return mapper.readValue(response.body(), ApiResponse.class);\n        } catch (Exception e) {\n            throw new RuntimeException(\"API call failed\", e);\n        }\n    }\n}\n```\n\n---\n\n## ðŸ” Testing Scenarios\n\n### Scenario 1: Basic Functionality\n```bash\n# Test all endpoints (local)\ncurl http://localhost:8000/health\ncurl http://localhost:8000/domains\ncurl http://localhost:8000/metrics\ncurl http://localhost:8000/kg-status\ncurl -X POST http://localhost:8000/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is OTP?\", \"domain\": \"wealth_management\"}'\n\n# Test all endpoints (production)\ncurl https://ekg-service-47249889063.europe-west6.run.app/health\ncurl https://ekg-service-47249889063.europe-west6.run.app/domains\ncurl https://ekg-service-47249889063.europe-west6.run.app/metrics\ncurl https://ekg-service-47249889063.europe-west6.run.app/kg-status\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is OTP?\", \"domain\": \"wealth_management\"}'\n```\n\n### Scenario 2: Multi-Domain Testing\n```bash\n# Test wealth_management domain (local)\ncurl -X POST http://localhost:8000/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is redemption?\", \"domain\": \"wealth_management\"}'\n\n# Test APF domain (local)\ncurl -X POST http://localhost:8000/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is project approval?\", \"domain\": \"apf\"}'\n\n# Test wealth_management domain (production)\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is redemption?\", \"domain\": \"wealth_management\"}'\n\n# Test APF domain (production)\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is project approval?\", \"domain\": \"apf\"}'\n```\n\n### Scenario 3: Conversational Flow\n```bash\n# Step 1: Initial question (local)\nRESPONSE=$(curl -s -X POST http://localhost:8000/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is OTP verification?\", \"domain\": \"wealth_management\"}')\n\n# Extract response_id\nRESPONSE_ID=$(echo $RESPONSE | jq -r '.response_id')\necho \"Response ID: $RESPONSE_ID\"\n\n# Step 2: Follow-up (local)\ncurl -X POST http://localhost:8000/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d \"{\\\"question\\\": \\\"How long is the OTP valid?\\\", \\\"domain\\\": \\\"wealth_management\\\", \\\"response_id\\\": \\\"$RESPONSE_ID\\\"}\"\n\n# Step 1: Initial question (production)\nRESPONSE=$(curl -s -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is OTP verification?\", \"domain\": \"wealth_management\"}')\n\n# Extract response_id\nRESPONSE_ID=$(echo $RESPONSE | jq -r '.response_id')\necho \"Response ID: $RESPONSE_ID\"\n\n# Step 2: Follow-up (production)\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d \"{\\\"question\\\": \\\"How long is the OTP valid?\\\", \\\"domain\\\": \\\"wealth_management\\\", \\\"response_id\\\": \\\"$RESPONSE_ID\\\"}\"\n```\n\n### Scenario 4: Error Handling\n```bash\n# Test invalid domain (local)\ncurl -X POST http://localhost:8000/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"Test question\", \"domain\": \"invalid_domain\"}'\n\n# Test malformed request (local)\ncurl -X POST http://localhost:8000/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"Test question\"}'\n\n# Test invalid domain (production)\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"Test question\", \"domain\": \"invalid_domain\"}'\n\n# Test malformed request (production)\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"Test question\"}'\n```\n\n---\n\n## ðŸ§ª Comprehensive Endpoint Testing\n\n### All Available Endpoints for Testing\n\n#### 1. Health Check Endpoint\n```bash\n# Local\ncurl -v http://localhost:8000/health\n\n# Production\ncurl -v https://ekg-service-47249889063.europe-west6.run.app/health\n```\n**Expected Response:**\n- Status: 200 OK\n- Content: JSON with system status, domains, OpenAI connectivity\n- Response Time: <1 second\n\n#### 2. Domains Endpoint\n```bash\n# Local\ncurl -v http://localhost:8000/domains\n\n# Production\ncurl -v https://ekg-service-47249889063.europe-west6.run.app/domains\n```\n**Expected Response:**\n- Status: 200 OK\n- Content: JSON with available domains (wealth_management, apf)\n- Response Time: <1 second\n\n#### 3. Metrics Endpoint\n```bash\n# Local\ncurl -v http://localhost:8000/metrics\n\n# Production\ncurl -v https://ekg-service-47249889063.europe-west6.run.app/metrics\n```\n**Expected Response:**\n- Status: 200 OK\n- Content: JSON with performance metrics, cache status\n- Response Time: <1 second\n\n#### 4. Knowledge Graph Status Endpoint\n```bash\n# Local\ncurl -v http://localhost:8000/kg-status\n\n# Production\ncurl -v https://ekg-service-47249889063.europe-west6.run.app/kg-status\n```\n**Expected Response:**\n- Status: 200 OK\n- Content: JSON with KG file accessibility and validation\n- Response Time: <1 second\n\n#### 5. Answer Endpoint (Main Q&A)\n```bash\n# Local - Basic Query\ncurl -v -X POST http://localhost:8000/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is OTP verification?\", \"domain\": \"wealth_management\"}'\n\n# Production - Basic Query\ncurl -v -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is OTP verification?\", \"domain\": \"wealth_management\"}'\n\n# Local - Conversational Query\ncurl -v -X POST http://localhost:8000/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"How long is OTP valid?\", \"domain\": \"wealth_management\", \"response_id\": \"YOUR_RESPONSE_ID\"}'\n\n# Production - Conversational Query\ncurl -v -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"How long is OTP valid?\", \"domain\": \"wealth_management\", \"response_id\": \"YOUR_RESPONSE_ID\"}'\n```\n**Expected Response:**\n- Status: 200 OK\n- Content: JSON with response_id, markdown answer, sources, metadata\n- Response Time: 30 seconds - 5 minutes (depending on mode)\n\n### Answer Modes Testing\n```bash\n# Concise Mode (GPT-5-nano, ~30-45 seconds)\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is OTP?\", \"domain\": \"wealth_management\", \"params\": {\"_mode\": \"concise\"}}'\n\n# Balanced Mode (GPT-5-mini, ~45-60 seconds)\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is OTP?\", \"domain\": \"wealth_management\", \"params\": {\"_mode\": \"balanced\"}}'\n\n# Deep Mode (GPT-5, ~2-5 minutes)\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is OTP?\", \"domain\": \"wealth_management\", \"params\": {\"_mode\": \"deep\"}}'\n```\n\n### Domain Testing\n```bash\n# Wealth Management Domain\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is mutual fund redemption?\", \"domain\": \"wealth_management\"}'\n\n# APF Domain\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is project approval process?\", \"domain\": \"apf\"}'\n```\n\n---\n\n## ðŸ“Š Response Validation\n\n### Expected Response Structure\n```json\n{\n  \"response_id\": \"uuid-string\",\n  \"markdown\": \"Answer content...\",\n  \"sources\": [...],\n  \"meta\": {\n    \"domain\": \"wealth_management\",\n    \"vectorstore_id\": \"vs_...\",\n    \"is_conversational\": false,\n    \"model\": \"gpt-5-mini\",\n    \"mode\": \"balanced\"\n  }\n}\n```\n\n### Validation Checklist\n- [ ] `response_id` is present and valid UUID\n- [ ] `markdown` contains answer content\n- [ ] `meta.domain` matches request domain\n- [ ] `meta.is_conversational` is boolean\n- [ ] `meta.model` is present\n- [ ] `meta.mode` is one of: concise, balanced, deep\n\n---\n\n## ðŸš¨ Troubleshooting\n\n### Common Issues\n\n**1. Connection Refused**\n```bash\n# Check if server is running\ncurl http://localhost:8000/health\n# If fails, start server:\nuvicorn api.main:app --host 0.0.0.0 --port 8000\n```\n\n**2. 401 Unauthorized**\n```bash\n# Check OpenAI API key\nexport OPENAI_API_KEY=sk-proj-your-actual-key-here\n```\n\n**3. 500 Internal Server Error**\n```bash\n# Check server logs\n# Usually indicates missing dependencies or configuration\n```\n\n**4. 400 Bad Request**\n```bash\n# Check request format\n# Ensure Content-Type: application/json\n# Validate required fields: question, domain\n```\n\n### Debug Commands\n```bash\n# Check server status\ncurl -v http://localhost:8000/health\n\n# Test with verbose output\ncurl -v -X POST http://localhost:8000/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"Test\", \"domain\": \"wealth_management\"}'\n\n# Check response headers\ncurl -I http://localhost:8000/health\n```\n\n---\n\n## ðŸ“± Mobile/App Integration\n\n### React Native\n```javascript\nimport axios from 'axios';\n\nconst ekgApi = axios.create({\n  baseURL: 'http://localhost:8000',\n  headers: { 'Content-Type': 'application/json' }\n});\n\nexport const askQuestion = async (question, domain = 'wealth_management', responseId = null) => {\n  try {\n    const payload = { question, domain };\n    if (responseId) payload.response_id = responseId;\n    \n    const response = await ekgApi.post('/v1/answer', payload);\n    return response.data;\n  } catch (error) {\n    throw new Error(`API call failed: ${error.message}`);\n  }\n};\n```\n\n### Flutter\n```dart\nimport 'package:http/http.dart' as http;\nimport 'dart:convert';\n\nclass EkgApiClient {\n  static const String baseUrl = 'http://localhost:8000';\n  \n  static Future<Map<String, dynamic>> askQuestion(\n    String question, \n    String domain, \n    String? responseId\n  ) async {\n    final payload = {\n      'question': question,\n      'domain': domain,\n      if (responseId != null) 'response_id': responseId,\n    };\n    \n    final response = await http.post(\n      Uri.parse('$baseUrl/v1/answer'),\n      headers: {'Content-Type': 'application/json'},\n      body: json.encode(payload),\n    );\n    \n    if (response.statusCode == 200) {\n      return json.decode(response.body);\n    } else {\n      throw Exception('Failed to load data: ${response.statusCode}');\n    }\n  }\n}\n```\n\n---\n\n## ðŸ”§ Production Testing\n\n### Load Testing with Apache Bench\n```bash\n# Install Apache Bench\n# Ubuntu: sudo apt-get install apache2-utils\n# macOS: brew install httpd\n\n# Test health endpoint\nab -n 100 -c 10 http://localhost:8000/health\n\n# Test answer endpoint\nab -n 50 -c 5 -p test_payload.json -T application/json http://localhost:8000/v1/answer\n```\n\n### Test Payload File (test_payload.json)\n```json\n{\n  \"question\": \"What is OTP verification?\",\n  \"domain\": \"wealth_management\"\n}\n```\n\n---\n\n## ðŸ“‹ Testing Checklist\n\n### Pre-Testing Setup\n- [ ] Server is running on correct port\n- [ ] OpenAI API key is configured\n- [ ] Knowledge graphs are loaded\n- [ ] Network connectivity is working\n\n### Basic Functionality\n- [ ] Health endpoint responds\n- [ ] Domains endpoint lists available domains\n- [ ] Answer endpoint returns valid responses\n- [ ] Response includes required fields\n\n### Conversational Features\n- [ ] response_id is included in responses\n- [ ] Follow-up queries work with response_id\n- [ ] conversation_id works for threading\n- [ ] Metadata includes conversational flags\n\n### Error Handling\n- [ ] Invalid domains return 400\n- [ ] Malformed requests return 400\n- [ ] Server errors return 500\n- [ ] Network timeouts are handled\n\n### Performance\n- [ ] Response times are acceptable\n- [ ] Concurrent requests work\n- [ ] Memory usage is stable\n- [ ] No memory leaks\n\n---\n\n## ðŸŽ¯ Ready for Integration\n\nYour EKG Agent API is ready for third-party integration with:\n- âœ… RESTful API endpoints\n- âœ… JSON request/response format\n- âœ… Conversational support\n- âœ… Multi-domain capability\n- âœ… Comprehensive error handling\n- âœ… Production-ready performance\n\n**Start testing and integrating!** ðŸš€\n","size_bytes":23467},"attached_assets/INTEGRATION_README_1760876363771.md":{"content":"# ðŸš€ EKG Agent API - Third-Party Integration Package\n\n**Complete integration package for EKG Agent API**\n\n---\n\n## ðŸ“‹ **What's Included**\n\n### **ðŸ“š Documentation**\n- `INTEGRATION_GUIDE.md` - Complete testing and integration guide\n- `CLIENT_INTEGRATION.md` - Client SDK examples and patterns\n- `CONVERSATIONAL_FEATURES.md` - Conversational features documentation\n- `README.md` - Project overview and quick start\n\n### **ðŸ§ª Testing Tools**\n- `test_third_party.py` - Python testing script\n- `test_kg_access.py` - Production testing script\n- `examples/javascript_test.js` - JavaScript integration example\n- `examples/postman_collection.json` - Postman collection\n\n---\n\n## ðŸš€ **Quick Start**\n\n### **1. Production API URL**\n```\nhttps://ekg-service-47249889063.europe-west6.run.app\n```\n\n### **2. Test Connectivity**\n```bash\n# Health check\ncurl https://ekg-service-47249889063.europe-west6.run.app/health\n\n# List domains\ncurl https://ekg-service-47249889063.europe-west6.run.app/domains\n```\n\n### **3. Basic Query**\n```bash\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"question\": \"What is OTP verification?\", \"domain\": \"wealth_management\"}'\n```\n\n---\n\n## ðŸ“– **Available Endpoints**\n\n| Endpoint | Method | Description | Response Time |\n|----------|--------|-------------|---------------|\n| `/health` | GET | System health check | <1 second |\n| `/domains` | GET | List available domains | <1 second |\n| `/metrics` | GET | Performance metrics | <1 second |\n| `/kg-status` | GET | Knowledge graph status | <1 second |\n| `/v1/answer` | POST | Main Q&A endpoint | 30s-5min |\n\n---\n\n## ðŸŽ¯ **Available Domains**\n\n- **wealth_management**: Mutual funds, orders, customer onboarding\n- **apf**: APF process data and workflows\n\n---\n\n## ðŸ”§ **Answer Modes**\n\n- **concise**: GPT-5-nano (~30-45 seconds) - Fast, focused answers\n- **balanced**: GPT-5-mini (~45-60 seconds) - Detailed answers\n- **deep**: GPT-5 (~2-5 minutes) - Comprehensive analysis\n\n---\n\n## ðŸ’¬ **Conversational Features**\n\n- **Response ID tracking**: Each response includes a unique `response_id`\n- **Conversational context**: Use `response_id` or `conversation_id` in follow-up questions\n- **Context awareness**: Maintains conversation history across requests\n\n---\n\n## ðŸ“š **Next Steps**\n\n1. **Read the documentation**: Start with `INTEGRATION_GUIDE.md`\n2. **Test the API**: Use the provided testing scripts\n3. **Choose your integration method**: Python, JavaScript, or other languages\n4. **Implement conversational features**: Use response_id for context\n5. **Deploy and monitor**: Use the metrics endpoint for monitoring\n\n---\n\n## ðŸ†˜ **Support**\n\n- **Documentation**: All guides include troubleshooting sections\n- **Testing**: Use the provided testing scripts to verify functionality\n- **Examples**: Multiple integration examples for different languages\n\n---\n\n**Ready to integrate!** ðŸš€\n\n*This package contains everything you need to integrate with the EKG Agent API.*\n","size_bytes":3012},"attached_assets/CLIENT_INTEGRATION_1760876363773.md":{"content":"# Client Integration Guide - Connecting to EKG Agent API\n\n## Overview\n\nThis guide shows how to integrate with your deployed EKG Agent API from:\n- Python applications\n- Replit UI/UX applications\n- Any other client\n\n## Current API Features\n\n### âœ… **Available Domains**\n- **wealth_management**: Mutual funds, orders, customer onboarding, and wealth management processes\n- **apf**: APF process data\n\n### âœ… **Answer Modes**\n- **concise**: Fast, focused answers using GPT-5-nano (~30-45 seconds)\n- **balanced**: Detailed answers using GPT-5-mini (~45-60 seconds)  \n- **deep**: Comprehensive analysis using GPT-5 (~2-5 minutes)\n\n### âœ… **Conversational Features**\n- **Response ID tracking**: Each response includes a unique `response_id`\n- **Conversational context**: Use `response_id` or `conversation_id` in follow-up questions\n- **Context awareness**: Maintains conversation history across requests\n\n### âœ… **API Endpoints**\n- `GET /health` - Health check and system status\n- `GET /domains` - List available domains\n- `GET /metrics` - Performance metrics\n- `GET /kg-status` - Knowledge graph status\n- `POST /v1/answer` - Main Q&A endpoint\n\n## Python Client Integration\n\n### Simple Python Client\n\n```python\nimport requests\nfrom typing import Optional, Dict, Any\n\nclass EKGAgentClient:\n    \"\"\"Client for EKG Agent API\"\"\"\n    \n    def __init__(self, base_url: str, api_key: Optional[str] = None):\n        \"\"\"\n        Initialize client\n        \n        Args:\n            base_url: API URL (e.g., https://ekg-agent-xxx.run.app)\n            api_key: Optional API key for authentication\n        \"\"\"\n        self.base_url = base_url.rstrip('/')\n        self.headers = {\"Content-Type\": \"application/json\"}\n        if api_key:\n            self.headers[\"X-API-Key\"] = api_key\n    \n    def list_domains(self) -> Dict[str, Any]:\n        \"\"\"List available domains\"\"\"\n        response = requests.get(f\"{self.base_url}/domains\", headers=self.headers)\n        response.raise_for_status()\n        return response.json()\n    \n    def health_check(self) -> Dict[str, Any]:\n        \"\"\"Check API health\"\"\"\n        response = requests.get(f\"{self.base_url}/health\", headers=self.headers)\n        response.raise_for_status()\n        return response.json()\n    \n    def ask(\n        self,\n        question: str,\n        domain: str = \"wealth_management\",\n        vectorstore_id: Optional[str] = None,\n        mode: str = \"balanced\"\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Ask a question\n        \n        Args:\n            question: The question to ask\n            domain: Domain to query (default: wealth_management)\n            vectorstore_id: Optional vector store ID (uses domain default if not provided)\n            mode: Answer mode - concise, balanced, or deep\n            \n        Returns:\n            Dictionary with markdown, sources, and meta\n        \"\"\"\n        payload = {\n            \"question\": question,\n            \"domain\": domain,\n            \"params\": {\"_mode\": mode}\n        }\n        \n        if vectorstore_id:\n            payload[\"vectorstore_id\"] = vectorstore_id\n        \n        response = requests.post(\n            f\"{self.base_url}/v1/answer\",\n            headers=self.headers,\n            json=payload\n        )\n        response.raise_for_status()\n        return response.json()\n\n\n# Usage Example\nif __name__ == \"__main__\":\n    # For local testing\n    client = EKGAgentClient(\"http://localhost:8000\")\n    \n    # For Cloud Run deployment\n    # client = EKGAgentClient(\"https://ekg-service-47249889063.europe-west6.run.app\")\n    \n    # List domains\n    domains = client.list_domains()\n    print(f\"Available domains: {[d['domain_id'] for d in domains['domains']]}\")\n    \n    # Ask a question\n    result = client.ask(\n        question=\"What is the OTP process?\",\n        domain=\"wealth_management\",\n        mode=\"concise\"\n    )\n    \n    print(f\"\\nAnswer Preview:\")\n    print(result['markdown'][:500])\n```\n\n### Advanced Python Client with Retry Logic\n\n```python\nimport requests\nfrom requests.adapters import HTTPAdapter\nfrom urllib3.util.retry import Retry\nfrom typing import Optional, Dict, Any\nimport time\n\n\nclass EKGAgentClient:\n    \"\"\"Production-ready client with retry logic and error handling\"\"\"\n    \n    def __init__(\n        self,\n        base_url: str,\n        api_key: Optional[str] = None,\n        timeout: int = 60,\n        max_retries: int = 3\n    ):\n        self.base_url = base_url.rstrip('/')\n        self.timeout = timeout\n        \n        # Set up session with retry logic\n        self.session = requests.Session()\n        retry_strategy = Retry(\n            total=max_retries,\n            backoff_factor=1,\n            status_forcelist=[429, 500, 502, 503, 504],\n            allowed_methods=[\"GET\", \"POST\"]\n        )\n        adapter = HTTPAdapter(max_retries=retry_strategy)\n        self.session.mount(\"http://\", adapter)\n        self.session.mount(\"https://\", adapter)\n        \n        # Set headers\n        self.session.headers.update({\"Content-Type\": \"application/json\"})\n        if api_key:\n            self.session.headers.update({\"X-API-Key\": api_key})\n    \n    def ask(\n        self,\n        question: str,\n        domain: str = \"wealth_management\",\n        vectorstore_id: Optional[str] = None,\n        mode: str = \"balanced\",\n        stream: bool = False\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Ask a question with error handling\n        \n        Raises:\n            requests.exceptions.HTTPError: For API errors\n            requests.exceptions.Timeout: For timeouts\n            ValueError: For invalid responses\n        \"\"\"\n        payload = {\n            \"question\": question,\n            \"domain\": domain,\n            \"params\": {\"_mode\": mode}\n        }\n        \n        if vectorstore_id:\n            payload[\"vectorstore_id\"] = vectorstore_id\n        \n        try:\n            response = self.session.post(\n                f\"{self.base_url}/v1/answer\",\n                json=payload,\n                timeout=self.timeout\n            )\n            response.raise_for_status()\n            return response.json()\n            \n        except requests.exceptions.Timeout:\n            raise TimeoutError(f\"Request timed out after {self.timeout}s\")\n        except requests.exceptions.HTTPError as e:\n            if e.response.status_code == 400:\n                raise ValueError(f\"Invalid request: {e.response.json().get('detail')}\")\n            elif e.response.status_code == 500:\n                raise RuntimeError(f\"Server error: {e.response.json().get('detail')}\")\n            else:\n                raise\n    \n    def batch_ask(\n        self,\n        questions: list[str],\n        domain: str = \"wealth_management\",\n        mode: str = \"concise\"\n    ) -> list[Dict[str, Any]]:\n        \"\"\"\n        Ask multiple questions\n        \n        Args:\n            questions: List of questions\n            domain: Domain to query\n            mode: Answer mode\n            \n        Returns:\n            List of answers in same order as questions\n        \"\"\"\n        results = []\n        for i, question in enumerate(questions, 1):\n            print(f\"Processing {i}/{len(questions)}: {question[:50]}...\")\n            try:\n                result = self.ask(question, domain=domain, mode=mode)\n                results.append(result)\n                time.sleep(0.5)  # Rate limiting\n            except Exception as e:\n                print(f\"  Error: {e}\")\n                results.append({\"error\": str(e), \"question\": question})\n        return results\n```\n\n## Replit Integration\n\n### Option 1: Python Backend on Replit\n\nCreate `main.py` on Replit:\n\n```python\nfrom flask import Flask, request, jsonify\nimport requests\nimport os\n\napp = Flask(__name__)\n\n# Your deployed Cloud Run URL\nEKG_API_URL = os.getenv(\"EKG_API_URL\", \"https://ekg-service-47249889063.europe-west6.run.app\")\n\n@app.route('/api/ask', methods=['POST'])\ndef ask_question():\n    \"\"\"Proxy endpoint for your UI\"\"\"\n    data = request.json\n    \n    # Forward to EKG Agent\n    response = requests.post(\n        f\"{EKG_API_URL}/v1/answer\",\n        json={\n            \"question\": data.get(\"question\"),\n            \"domain\": data.get(\"domain\", \"wealth_management\"),\n            \"params\": {\"_mode\": data.get(\"mode\", \"balanced\")}\n        }\n    )\n    \n    return jsonify(response.json())\n\n@app.route('/api/domains', methods=['GET'])\ndef get_domains():\n    \"\"\"Get available domains\"\"\"\n    response = requests.get(f\"{EKG_API_URL}/domains\")\n    return jsonify(response.json())\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000)\n```\n\n### Option 2: Direct JavaScript Integration\n\n```javascript\n// In your Replit frontend\nconst EKG_API_URL = 'https://ekg-service-47249889063.europe-west6.run.app';\n\nasync function askQuestion(question, domain = 'wealth_management') {\n  const response = await fetch(`${EKG_API_URL}/v1/answer`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      question: question,\n      domain: domain,\n      params: { _mode: 'balanced' }\n    })\n  });\n  \n  if (!response.ok) {\n    throw new Error(`API error: ${response.status}`);\n  }\n  \n  return await response.json();\n}\n\n// Usage\naskQuestion(\"What is OTP verification?\", \"wealth_management\")\n  .then(result => {\n    console.log(\"Answer:\", result.markdown);\n    console.log(\"Sources:\", result.sources);\n  })\n  .catch(error => {\n    console.error(\"Error:\", error);\n  });\n```\n\n## Example: Replit Chat UI\n\nComplete Replit example with UI:\n\n```python\n# main.py\nimport streamlit as st\nimport requests\n\n# Your deployed Cloud Run URL\nAPI_URL = \"https://ekg-service-47249889063.europe-west6.run.app\"\n\nst.title(\"ðŸ¤– EKG Agent - Multi-Domain Q&A\")\n\n# Get available domains\n@st.cache_data\ndef get_domains():\n    response = requests.get(f\"{API_URL}/domains\")\n    return response.json()[\"domains\"]\n\n# Sidebar for domain selection\ndomains = get_domains()\ndomain_options = {d[\"name\"]: d[\"domain_id\"] for d in domains}\n\nst.sidebar.header(\"Configuration\")\nselected_domain_name = st.sidebar.selectbox(\n    \"Select Domain\",\n    options=list(domain_options.keys())\n)\nselected_domain = domain_options[selected_domain_name]\n\n# Show domain info\nst.sidebar.info(f\"\"\"\n**{selected_domain_name}**  \nNodes: {next(d['kg_nodes'] for d in domains if d['domain_id'] == selected_domain)}  \nEdges: {next(d['kg_edges'] for d in domains if d['domain_id'] == selected_domain)}\n\"\"\")\n\nmode = st.sidebar.radio(\"Answer Mode\", [\"concise\", \"balanced\", \"deep\"])\n\n# Main chat interface\nquestion = st.text_input(\"Ask a question:\", placeholder=\"What is OTP verification?\")\n\nif st.button(\"Get Answer\") and question:\n    with st.spinner(\"Generating answer...\"):\n        try:\n            response = requests.post(\n                f\"{API_URL}/v1/answer\",\n                json={\n                    \"question\": question,\n                    \"domain\": selected_domain,\n                    \"params\": {\"_mode\": mode}\n                },\n                timeout=60\n            )\n            \n            if response.status_code == 200:\n                result = response.json()\n                \n                # Display answer\n                st.markdown(\"### Answer\")\n                st.markdown(result[\"markdown\"])\n                \n                # Show metadata\n                with st.expander(\"Metadata\"):\n                    st.json(result[\"meta\"])\n                    \n            else:\n                st.error(f\"Error: {response.status_code} - {response.text}\")\n                \n        except Exception as e:\n            st.error(f\"Error: {str(e)}\")\n\n# Chat history (optional)\nif \"history\" not in st.session_state:\n    st.session_state.history = []\n\nif question and st.button(\"Add to History\"):\n    st.session_state.history.append({\n        \"question\": question,\n        \"domain\": selected_domain,\n        \"mode\": mode\n    })\n\nif st.session_state.history:\n    st.sidebar.markdown(\"### Recent Questions\")\n    for i, item in enumerate(reversed(st.session_state.history[-5:]), 1):\n        st.sidebar.text(f\"{i}. [{item['domain']}] {item['question'][:30]}...\")\n```\n\n## Testing the Deployed API\n\n### Test Script (`test_deployment.py`)\n\n```python\n#!/usr/bin/env python3\n\"\"\"\nTest deployed EKG Agent API\nUsage: python test_deployment.py <service_url>\n\"\"\"\nimport sys\nimport requests\n\ndef test_api(base_url: str):\n    \"\"\"Run comprehensive API tests\"\"\"\n    \n    print(f\"Testing EKG Agent at: {base_url}\")\n    print(\"=\" * 70)\n    \n    # Test 1: Health\n    print(\"\\n1. Health Check...\")\n    r = requests.get(f\"{base_url}/health\")\n    assert r.status_code == 200, f\"Health check failed: {r.status_code}\"\n    health = r.json()\n    print(f\"   âœ“ Status: {health['status']}\")\n    print(f\"   âœ“ Domains: {list(health['domains'].keys())}\")\n    \n    # Test 2: List domains\n    print(\"\\n2. List Domains...\")\n    r = requests.get(f\"{base_url}/domains\")\n    assert r.status_code == 200\n    domains = r.json()[\"domains\"]\n    print(f\"   âœ“ Found {len(domains)} domains:\")\n    for d in domains:\n        print(f\"     - {d['domain_id']}: {d['kg_nodes']} nodes\")\n    \n    # Test 3: Query each domain\n    print(\"\\n3. Testing Each Domain...\")\n    for domain in domains:\n        domain_id = domain['domain_id']\n        print(f\"\\n   Testing {domain_id}...\")\n        \n        r = requests.post(\n            f\"{base_url}/v1/answer\",\n            json={\n                \"question\": f\"What is the main process in {domain_id}?\",\n                \"domain\": domain_id,\n                \"params\": {\"_mode\": \"concise\"}\n            },\n            timeout=60\n        )\n        \n        if r.status_code == 200:\n            result = r.json()\n            print(f\"   âœ“ Answer received ({len(result['markdown'])} chars)\")\n            print(f\"   âœ“ Domain: {result['meta']['domain']}\")\n            print(f\"   âœ“ Vector Store: {result['meta']['vectorstore_id']}\")\n        else:\n            print(f\"   âœ— Error: {r.status_code}\")\n    \n    print(\"\\n\" + \"=\" * 70)\n    print(\"âœ… All tests passed!\")\n\nif __name__ == \"__main__\":\n    if len(sys.argv) < 2:\n        print(\"Usage: python test_deployment.py <service_url>\")\n        print(\"Example: python test_deployment.py https://ekg-service-47249889063.europe-west6.run.app\")\n        sys.exit(1)\n    \n    test_api(sys.argv[1])\n```\n\n## Integration Patterns\n\n### Pattern 1: Direct API Calls\n\n```python\nimport requests\n\nAPI_URL = \"https://ekg-service-47249889063.europe-west6.run.app\"\n\n# Query wealth management\nresponse = requests.post(\n    f\"{API_URL}/v1/answer\",\n    json={\n        \"question\": \"What is OTP verification?\",\n        \"domain\": \"wealth_management\"\n    }\n)\n\nanswer = response.json()[\"markdown\"]\n```\n\n### Pattern 2: SDK Wrapper\n\n```python\n# ekg_sdk.py\nimport requests\nfrom typing import Optional, List\nfrom dataclasses import dataclass\n\n@dataclass\nclass Answer:\n    markdown: str\n    sources: list\n    domain: str\n    vectorstore_id: str\n    export_path: Optional[str]\n\nclass EKGAgent:\n    def __init__(self, api_url: str):\n        self.api_url = api_url\n    \n    def ask(\n        self,\n        question: str,\n        domain: str = \"wealth_management\",\n        mode: str = \"balanced\"\n    ) -> Answer:\n        response = requests.post(\n            f\"{self.api_url}/v1/answer\",\n            json={\"question\": question, \"domain\": domain, \"params\": {\"_mode\": mode}}\n        )\n        response.raise_for_status()\n        data = response.json()\n        \n        return Answer(\n            markdown=data[\"markdown\"],\n            sources=data.get(\"sources\", []),\n            domain=data[\"meta\"][\"domain\"],\n            vectorstore_id=data[\"meta\"][\"vectorstore_id\"],\n            export_path=data[\"meta\"].get(\"export_path\")\n        )\n    \n    def batch_ask(self, questions: List[str], domain: str) -> List[Answer]:\n        return [self.ask(q, domain=domain, mode=\"concise\") for q in questions]\n\n# Usage\nagent = EKGAgent(\"https://ekg-service-47249889063.europe-west6.run.app\")\nanswer = agent.ask(\"What is redemption?\", domain=\"wealth_management\")\nprint(answer.markdown)\n```\n\n### Pattern 3: Async Client (for high throughput)\n\n```python\nimport asyncio\nimport aiohttp\nfrom typing import List, Dict, Any\n\nclass AsyncEKGClient:\n    def __init__(self, api_url: str):\n        self.api_url = api_url\n    \n    async def ask(\n        self,\n        session: aiohttp.ClientSession,\n        question: str,\n        domain: str = \"wealth_management\"\n    ) -> Dict[str, Any]:\n        async with session.post(\n            f\"{self.api_url}/v1/answer\",\n            json={\"question\": question, \"domain\": domain}\n        ) as response:\n            return await response.json()\n    \n    async def batch_ask(\n        self,\n        questions: List[str],\n        domain: str = \"wealth_management\"\n    ) -> List[Dict[str, Any]]:\n        \"\"\"Ask multiple questions concurrently\"\"\"\n        async with aiohttp.ClientSession() as session:\n            tasks = [self.ask(session, q, domain) for q in questions]\n            return await asyncio.gather(*tasks)\n\n# Usage\nasync def main():\n    client = AsyncEKGClient(\"https://ekg-service-47249889063.europe-west6.run.app\")\n    questions = [\n        \"What is OTP?\",\n        \"What is redemption?\",\n        \"What is order placement?\"\n    ]\n    answers = await client.batch_ask(questions, domain=\"wealth_management\")\n    for q, a in zip(questions, answers):\n        print(f\"Q: {q}\")\n        print(f\"A: {a['markdown'][:100]}...\\n\")\n\nasyncio.run(main())\n```\n\n## Replit Specific Setup\n\n### Step 1: Create Replit Python Project\n\n1. Go to https://replit.com\n2. Create new Python project\n3. Add dependencies in `pyproject.toml` or `requirements.txt`:\n\n```txt\nrequests==2.32.0\nstreamlit==1.28.0\n```\n\n### Step 2: Add Secret (Replit Secrets)\n\nIn Replit:\n1. Click \"Secrets\" (lock icon) in left sidebar\n2. Add:\n   - Key: `EKG_API_URL`\n   - Value: `https://ekg-service-47249889063.europe-west6.run.app`\n\n### Step 3: Create UI\n\n```python\n# main.py on Replit\nimport streamlit as st\nimport requests\nimport os\n\nAPI_URL = os.getenv(\"EKG_API_URL\")\n\nst.title(\"ðŸ” Knowledge Graph Q&A\")\n\n# Domain selector\ndomains_resp = requests.get(f\"{API_URL}/domains\")\ndomains = {d[\"name\"]: d[\"domain_id\"] for d in domains_resp.json()[\"domains\"]}\n\ndomain_name = st.selectbox(\"Select Domain\", list(domains.keys()))\ndomain_id = domains[domain_name]\n\n# Question input\nquestion = st.text_area(\"Your Question:\", height=100)\n\nif st.button(\"Get Answer\", type=\"primary\"):\n    if question:\n        with st.spinner(\"Thinking...\"):\n            response = requests.post(\n                f\"{API_URL}/v1/answer\",\n                json={\n                    \"question\": question,\n                    \"domain\": domain_id,\n                    \"params\": {\"_mode\": \"balanced\"}\n                }\n            )\n            \n            if response.status_code == 200:\n                result = response.json()\n                st.markdown(result[\"markdown\"])\n            else:\n                st.error(f\"Error: {response.text}\")\n```\n\n### Step 4: Run on Replit\n\n```bash\nstreamlit run main.py --server.port 5000 --server.address 0.0.0.0\n```\n\n## CORS Configuration (for Browser Apps)\n\nIf calling from browser-based apps, CORS is already configured in `api/main.py`:\n\n```python\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],  # Change to specific origins in production\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n```\n\nFor production, restrict origins:\n\n```python\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\n        \"https://your-replit-app.repl.co\",\n        \"https://your-frontend.com\"\n    ],\n    allow_methods=[\"GET\", \"POST\"],\n    allow_headers=[\"Content-Type\", \"X-API-Key\"],\n)\n```\n\n## Example: Complete Integration\n\n```python\n# complete_example.py\nimport requests\nfrom typing import Dict, Any\n\nclass KnowledgeBaseApp:\n    \"\"\"Example application using EKG Agent\"\"\"\n    \n    def __init__(self, api_url: str):\n        self.api_url = api_url\n        self.domains = self._load_domains()\n    \n    def _load_domains(self) -> Dict[str, str]:\n        \"\"\"Load available domains\"\"\"\n        r = requests.get(f\"{self.api_url}/domains\")\n        return {d[\"domain_id\"]: d[\"name\"] for d in r.json()[\"domains\"]}\n    \n    def ask_wealth_question(self, question: str) -> str:\n        \"\"\"Ask wealth management question\"\"\"\n        r = requests.post(\n            f\"{self.api_url}/v1/answer\",\n            json={\n                \"question\": question,\n                \"domain\": \"wealth_management\",\n                \"params\": {\"_mode\": \"balanced\"}\n            }\n        )\n        return r.json()[\"markdown\"]\n    \n    def ask_apf_question(self, question: str) -> str:\n        \"\"\"Ask APF question\"\"\"\n        r = requests.post(\n            f\"{self.api_url}/v1/answer\",\n            json={\n                \"question\": question,\n                \"domain\": \"apf\",\n                \"params\": {\"_mode\": \"balanced\"}\n            }\n        )\n        return r.json()[\"markdown\"]\n    \n    def search_across_domains(self, question: str) -> Dict[str, str]:\n        \"\"\"Search same question across all domains\"\"\"\n        results = {}\n        for domain_id in self.domains.keys():\n            r = requests.post(\n                f\"{self.api_url}/v1/answer\",\n                json={\n                    \"question\": question,\n                    \"domain\": domain_id,\n                    \"params\": {\"_mode\": \"concise\"}\n                }\n            )\n            if r.status_code == 200:\n                results[domain_id] = r.json()[\"markdown\"]\n        return results\n\n# Usage\nif __name__ == \"__main__\":\n    # For local testing\n    app = KnowledgeBaseApp(\"http://localhost:8000\")\n    \n    # For production\n    # app = KnowledgeBaseApp(\"https://ekg-service-47249889063.europe-west6.run.app\")\n    \n    # Ask wealth management question\n    answer1 = app.ask_wealth_question(\"What is OTP verification?\")\n    print(\"Wealth Management Answer:\")\n    print(answer1[:200])\n    \n    # Ask APF question\n    answer2 = app.ask_apf_question(\"How to create a project?\")\n    print(\"\\nAPF Answer:\")\n    print(answer2[:200])\n    \n    # Search across domains\n    results = app.search_across_domains(\"What is the approval process?\")\n    print(\"\\nCross-Domain Search:\")\n    for domain, answer in results.items():\n        print(f\"\\n{domain}:\")\n        print(answer[:150])\n```\n\n## Error Handling Best Practices\n\n```python\ndef ask_with_error_handling(question: str, domain: str, api_url: str):\n    \"\"\"Robust error handling example\"\"\"\n    try:\n        response = requests.post(\n            f\"{api_url}/v1/answer\",\n            json={\"question\": question, \"domain\": domain},\n            timeout=60\n        )\n        \n        # Check status\n        if response.status_code == 400:\n            error = response.json().get(\"detail\", \"Bad request\")\n            return {\"error\": f\"Invalid request: {error}\"}\n        \n        elif response.status_code == 500:\n            return {\"error\": \"Server error. Please try again.\"}\n        \n        elif response.status_code == 200:\n            return response.json()\n        \n        else:\n            return {\"error\": f\"Unexpected status: {response.status_code}\"}\n            \n    except requests.exceptions.Timeout:\n        return {\"error\": \"Request timed out. Try a simpler question.\"}\n    \n    except requests.exceptions.ConnectionError:\n        return {\"error\": \"Cannot connect to API. Check URL and network.\"}\n    \n    except Exception as e:\n        return {\"error\": f\"Unexpected error: {str(e)}\"}\n```\n\n## Rate Limiting (Client-Side)\n\n```python\nimport time\nfrom functools import wraps\n\ndef rate_limit(calls_per_minute: int = 10):\n    \"\"\"Rate limiting decorator\"\"\"\n    min_interval = 60.0 / calls_per_minute\n    last_called = [0.0]\n    \n    def decorator(func):\n        @wraps(func)\n        def wrapper(*args, **kwargs):\n            elapsed = time.time() - last_called[0]\n            left_to_wait = min_interval - elapsed\n            if left_to_wait > 0:\n                time.sleep(left_to_wait)\n            result = func(*args, **kwargs)\n            last_called[0] = time.time()\n            return result\n        return wrapper\n    return decorator\n\nclass RateLimitedClient:\n    def __init__(self, api_url: str):\n        self.api_url = api_url\n    \n    @rate_limit(calls_per_minute=10)\n    def ask(self, question: str, domain: str) -> Dict[str, Any]:\n        response = requests.post(\n            f\"{self.api_url}/v1/answer\",\n            json={\"question\": question, \"domain\": domain}\n        )\n        return response.json()\n```\n\n## Next Steps\n\n1. **Deploy to Cloud Run** (see `DEPLOYMENT_GCLOUD.md`)\n2. **Test the deployment** using `test_deployment.py`\n3. **Create your Replit UI** using the examples above\n4. **Integrate with your application** using the Python client\n5. **Monitor and optimize** based on usage patterns\n\n## Conversational Features\n\n### Basic Conversational Flow\n\n```python\nimport requests\n\nAPI_URL = \"https://ekg-service-47249889063.europe-west6.run.app\"\n\n# First question\nresponse1 = requests.post(f\"{API_URL}/v1/answer\", json={\n    \"question\": \"What is OTP verification?\",\n    \"domain\": \"wealth_management\",\n    \"params\": {\"_mode\": \"concise\"}\n})\n\nresult1 = response1.json()\nresponse_id = result1[\"response_id\"]\nprint(f\"Answer: {result1['markdown']}\")\nprint(f\"Response ID: {response_id}\")\n\n# Follow-up question using response_id\nresponse2 = requests.post(f\"{API_URL}/v1/answer\", json={\n    \"question\": \"How long is the OTP valid?\",\n    \"domain\": \"wealth_management\", \n    \"response_id\": response_id,  # Links to previous response\n    \"params\": {\"_mode\": \"concise\"}\n})\n\nresult2 = response2.json()\nprint(f\"Follow-up Answer: {result2['markdown']}\")\nprint(f\"Is conversational: {result2['meta']['is_conversational']}\")\n```\n\n### Conversation Management\n\n```python\nclass ConversationManager:\n    def __init__(self, api_url: str):\n        self.api_url = api_url\n        self.conversation_id = None\n        self.history = []\n    \n    def ask(self, question: str, domain: str = \"wealth_management\", mode: str = \"balanced\"):\n        \"\"\"Ask a question with conversation context\"\"\"\n        payload = {\n            \"question\": question,\n            \"domain\": domain,\n            \"params\": {\"_mode\": mode}\n        }\n        \n        # Add conversation context if available\n        if self.conversation_id:\n            payload[\"conversation_id\"] = self.conversation_id\n        \n        response = requests.post(f\"{self.api_url}/v1/answer\", json=payload)\n        result = response.json()\n        \n        # Update conversation tracking\n        if not self.conversation_id:\n            self.conversation_id = result[\"response_id\"]\n        \n        # Store in history\n        self.history.append({\n            \"question\": question,\n            \"answer\": result[\"markdown\"],\n            \"response_id\": result[\"response_id\"],\n            \"timestamp\": result[\"meta\"][\"timestamp\"]\n        })\n        \n        return result\n    \n    def get_history(self):\n        \"\"\"Get conversation history\"\"\"\n        return self.history\n\n# Usage\nconversation = ConversationManager(\"https://ekg-service-47249889063.europe-west6.run.app\")\n\n# Start conversation\nresult1 = conversation.ask(\"What is mutual fund redemption?\")\nprint(\"Answer 1:\", result1[\"markdown\"][:100])\n\n# Continue conversation\nresult2 = conversation.ask(\"What are the fees involved?\")\nprint(\"Answer 2:\", result2[\"markdown\"][:100])\n\n# Check conversation history\nprint(\"History:\", len(conversation.get_history()), \"exchanges\")\n```\n\n## Production Deployment Status\n\n### âœ… **Current Deployment**\n- **URL**: `https://ekg-service-47249889063.europe-west6.run.app`\n- **Status**: Fully operational\n- **Domains**: wealth_management, apf\n- **Models**: GPT-5-nano, GPT-5-mini, GPT-5\n- **Timeout**: 5 minutes for deep analysis\n- **File Export**: Disabled (handled by React frontend)\n\n### âœ… **Performance Metrics**\n- **Concise Mode**: ~30-45 seconds\n- **Balanced Mode**: ~45-60 seconds  \n- **Deep Mode**: ~2-5 minutes\n- **Health Check**: <1 second\n- **Domain Loading**: Both domains fully loaded\n\nYour API is ready for integration! ðŸš€\n\n\n\n","size_bytes":27916},"attached_assets/test_kg_access_1760876363772.py":{"content":"#!/usr/bin/env python3\n\"\"\"\nTest script to verify KG file accessibility in deployed container\n\"\"\"\nimport requests\nimport json\nimport os\n\ndef test_kg_access():\n    \"\"\"Test KG file accessibility through the deployed API\"\"\"\n    base_url = os.getenv(\"BASE_URL\", \"https://ekg-service-47249889063.europe-west6.run.app\")\n    \n    print(\"ðŸ” Testing KG file accessibility in deployed container...\")\n    \n    # Test 1: Health endpoint\n    print(\"\\n1. Testing health endpoint...\")\n    try:\n        response = requests.get(f\"{base_url}/health\", timeout=10)\n        response.raise_for_status()\n        health_data = response.json()\n        print(\"âœ… Health endpoint accessible\")\n        print(f\"   Status: {health_data.get('status')}\")\n        \n        # Check domains status\n        domains_status = health_data.get('domains', {})\n        print(f\"   Domains: {list(domains_status.keys())}\")\n        for domain_id, status in domains_status.items():\n            print(f\"   {domain_id}: loaded={status.get('loaded')}, nodes={status.get('nodes')}\")\n            \n    except requests.exceptions.RequestException as e:\n        print(f\"âŒ Health check failed: {e}\")\n        return False\n    \n    # Test 2: KG status endpoint\n    print(\"\\n2. Testing KG status endpoint...\")\n    try:\n        response = requests.get(f\"{base_url}/kg-status\", timeout=10)\n        response.raise_for_status()\n        kg_status_data = response.json()\n        print(\"âœ… KG status endpoint accessible\")\n        \n        # Check data directory\n        print(f\"   Data directory exists: {kg_status_data.get('data_directory_exists')}\")\n        print(f\"   KG directory exists: {kg_status_data.get('kg_directory_exists')}\")\n        \n        # Check KG files\n        kg_files = kg_status_data.get('kg_files', {})\n        print(f\"   KG files found: {len(kg_files)}\")\n        for domain_id, file_status in kg_files.items():\n            print(f\"   {domain_id}: exists={file_status.get('exists')}, valid_json={file_status.get('valid_json')}\")\n            \n        # Check for errors\n        errors = kg_status_data.get('errors', [])\n        if errors:\n            print(\"   âš ï¸  Errors found:\")\n            for error in errors:\n                print(f\"     - {error}\")\n                \n    except requests.exceptions.RequestException as e:\n        print(f\"âŒ KG status check failed: {e}\")\n        return False\n    \n    # Test 3: Simple API call\n    print(\"\\n3. Testing simple API call...\")\n    try:\n        test_payload = {\n            \"question\": \"What is OTP?\",\n            \"domain\": \"wealth_management\",\n            \"params\": {\"_mode\": \"concise\"}\n        }\n        \n        response = requests.post(f\"{base_url}/v1/answer\", json=test_payload, timeout=300)  # 5 minutes\n        response.raise_for_status()\n        answer_data = response.json()\n        \n        print(\"âœ… API call successful\")\n        print(f\"   Response ID: {answer_data.get('response_id')}\")\n        print(f\"   Mode: {answer_data.get('meta', {}).get('mode')}\")\n        print(f\"   Processing time: {answer_data.get('meta', {}).get('processing_time_seconds')}s\")\n        \n        # Check if response contains actual content\n        markdown = answer_data.get('markdown', '')\n        if len(markdown) > 50:\n            print(\"âœ… Response contains substantial content\")\n        else:\n            print(\"âš ï¸  Response seems short, might indicate KG access issues\")\n            \n    except requests.exceptions.RequestException as e:\n        print(f\"âŒ API call failed: {e}\")\n        return False\n    \n    print(\"\\nðŸŽ‰ All KG access tests passed!\")\n    return True\n\nif __name__ == \"__main__\":\n    success = test_kg_access()\n    if not success:\n        print(\"\\nðŸ’¥ Some KG access tests failed!\")\n        exit(1)","size_bytes":3735},"attached_assets/javascript_test_1760876391766.js":{"content":"#!/usr/bin/env node\n/**\n * JavaScript/Node.js testing example for EKG Agent API\n */\n\nconst axios = require('axios');\n\nclass EkgApiClient {\n    constructor(baseUrl = 'http://localhost:8000') {\n        this.baseUrl = baseUrl;\n        this.client = axios.create({\n            baseURL: baseUrl,\n            timeout: 30000,\n            headers: {\n                'Content-Type': 'application/json',\n                'User-Agent': 'EKG-API-Client/1.0'\n            }\n        });\n    }\n\n    async testHealth() {\n        console.log('ðŸ” Testing health endpoint...');\n        try {\n            const response = await this.client.get('/health');\n            console.log('âœ… Health check passed');\n            console.log(`   Status: ${response.data.status}`);\n            console.log(`   Domains: ${Object.keys(response.data.domains || {})}`);\n            return true;\n        } catch (error) {\n            console.log('âŒ Health check failed:', error.message);\n            return false;\n        }\n    }\n\n    async testDomains() {\n        console.log('\\nðŸ” Testing domains endpoint...');\n        try {\n            const response = await this.client.get('/domains');\n            console.log('âœ… Domains endpoint passed');\n            console.log(`   Found ${response.data.domains.length} domains:`);\n            response.data.domains.forEach(domain => {\n                console.log(`   - ${domain.domain_id}: ${domain.name}`);\n            });\n            return response.data.domains;\n        } catch (error) {\n            console.log('âŒ Domains endpoint failed:', error.message);\n            return [];\n        }\n    }\n\n    async testBasicQuery(domain = 'wealth_management') {\n        console.log(`\\nðŸ” Testing basic query for domain: ${domain}`);\n        try {\n            const response = await this.client.post('/v1/answer', {\n                question: 'What is OTP verification?',\n                domain: domain\n            });\n            \n            console.log('âœ… Basic query passed');\n            console.log(`   Response ID: ${response.data.response_id}`);\n            console.log(`   Answer length: ${response.data.markdown.length}`);\n            console.log(`   Sources: ${response.data.sources?.length || 0}`);\n            console.log(`   Is Conversational: ${response.data.meta?.is_conversational || false}`);\n            return response.data;\n        } catch (error) {\n            console.log('âŒ Basic query failed:', error.response?.data || error.message);\n            return null;\n        }\n    }\n\n    async testConversationalFlow(domain = 'wealth_management') {\n        console.log(`\\nðŸ” Testing conversational flow for domain: ${domain}`);\n        \n        // Step 1: Initial question\n        console.log('   Step 1: Initial question...');\n        const initialResponse = await this.testBasicQuery(domain);\n        if (!initialResponse) return false;\n\n        // Step 2: Follow-up with response_id\n        console.log('   Step 2: Follow-up with response_id...');\n        try {\n            const response = await this.client.post('/v1/answer', {\n                question: 'How long is the OTP valid?',\n                domain: domain,\n                response_id: initialResponse.response_id\n            });\n            \n            console.log('âœ… Follow-up query passed');\n            console.log(`   Response ID: ${response.data.response_id}`);\n            console.log(`   Is Conversational: ${response.data.meta?.is_conversational || false}`);\n            console.log(`   Previous Response ID: ${response.data.meta?.previous_response_id}`);\n            return true;\n        } catch (error) {\n            console.log('âŒ Follow-up query failed:', error.response?.data || error.message);\n            return false;\n        }\n    }\n\n    async testConversationId(domain = 'wealth_management') {\n        console.log(`\\nðŸ” Testing conversation_id flow for domain: ${domain}`);\n        try {\n            const response = await this.client.post('/v1/answer', {\n                question: 'What is the redemption process?',\n                domain: domain,\n                conversation_id: 'test-conversation-123'\n            });\n            \n            console.log('âœ… Conversation ID query passed');\n            console.log(`   Response ID: ${response.data.response_id}`);\n            console.log(`   Is Conversational: ${response.data.meta?.is_conversational || false}`);\n            console.log(`   Conversation ID: ${response.data.meta?.conversation_id}`);\n            return true;\n        } catch (error) {\n            console.log('âŒ Conversation ID query failed:', error.response?.data || error.message);\n            return false;\n        }\n    }\n\n    async testPerformance(numRequests = 5) {\n        console.log(`\\nðŸ” Testing performance with ${numRequests} requests...`);\n        \n        const startTime = Date.now();\n        let successfulRequests = 0;\n        \n        for (let i = 0; i < numRequests; i++) {\n            try {\n                const response = await this.client.post('/v1/answer', {\n                    question: `Test question ${i + 1}`,\n                    domain: 'wealth_management'\n                });\n                if (response.status === 200) {\n                    successfulRequests++;\n                }\n            } catch (error) {\n                console.log(`âŒ Request ${i + 1} failed: ${error.message}`);\n            }\n        }\n        \n        const endTime = Date.now();\n        const totalTime = (endTime - startTime) / 1000;\n        const avgTime = totalTime / numRequests;\n        \n        console.log('âœ… Performance test completed');\n        console.log(`   Successful requests: ${successfulRequests}/${numRequests}`);\n        console.log(`   Total time: ${totalTime.toFixed(2)}s`);\n        console.log(`   Average time per request: ${avgTime.toFixed(2)}s`);\n        \n        return successfulRequests === numRequests;\n    }\n\n    async runFullTestSuite() {\n        console.log('='.repeat(80));\n        console.log('ðŸ§ª EKG AGENT API - JAVASCRIPT TESTING SUITE');\n        console.log('='.repeat(80));\n        \n        let testsPassed = 0;\n        let totalTests = 0;\n        \n        // Test 1: Health check\n        totalTests++;\n        if (await this.testHealth()) testsPassed++;\n        \n        // Test 2: Domains\n        totalTests++;\n        const domains = await this.testDomains();\n        if (domains.length > 0) testsPassed++;\n        \n        // Test 3: Basic query for each domain\n        for (const domain of domains) {\n            totalTests++;\n            if (await this.testBasicQuery(domain.domain_id)) testsPassed++;\n        }\n        \n        // Test 4: Conversational flow\n        totalTests++;\n        if (await this.testConversationalFlow()) testsPassed++;\n        \n        // Test 5: Conversation ID\n        totalTests++;\n        if (await this.testConversationId()) testsPassed++;\n        \n        // Test 6: Performance\n        totalTests++;\n        if (await this.testPerformance()) testsPassed++;\n        \n        // Summary\n        console.log('\\n' + '='.repeat(80));\n        console.log(`ðŸ“Š TEST RESULTS: ${testsPassed}/${totalTests} tests passed`);\n        console.log('='.repeat(80));\n        \n        if (testsPassed === totalTests) {\n            console.log('âœ… ALL TESTS PASSED - API is ready for third-party integration!');\n            return true;\n        } else {\n            console.log('âš ï¸  Some tests failed - Please check the issues above');\n            return false;\n        }\n    }\n}\n\n// Usage examples\nasync function main() {\n    const client = new EkgApiClient();\n    \n    // Run full test suite\n    await client.runFullTestSuite();\n    \n    // Example: Single query\n    console.log('\\nðŸ“ Example: Single query');\n    const result = await client.testBasicQuery('wealth_management');\n    if (result) {\n        console.log('Query successful!');\n        console.log(`Response ID: ${result.response_id}`);\n    }\n}\n\n// Run if called directly\nif (require.main === module) {\n    main().catch(console.error);\n}\n\nmodule.exports = EkgApiClient;\n","size_bytes":8067},"attached_assets/CONVERSATIONAL_FEATURES_1760876363772.md":{"content":"# ðŸ’¬ Conversational Response Features\n\n**Date:** October 19, 2025  \n**Status:** âœ… **IMPLEMENTED AND DEPLOYED**\n\n---\n\n## ðŸŽ¯ Overview\n\nThe EKG Agent now supports conversational responses through response IDs and conversation IDs, enabling context-aware follow-up queries and multi-turn conversations.\n\n---\n\n## ðŸ”§ Implementation Details\n\n### Request Schema Updates\n\n```python\nclass AskRequest(BaseModel):\n    question: str\n    domain: str = \"wealth_management\"\n    vectorstore_id: Optional[str] = None\n    response_id: Optional[str] = None      # NEW: Links to previous response\n    conversation_id: Optional[str] = None  # NEW: Alternative conversation tracking\n    params: Optional[Dict[str, Any]] = None\n```\n\n### Response Schema Updates\n\n```python\nclass AskResponse(BaseModel):\n    response_id: str                       # NEW: Unique identifier for this response\n    markdown: str\n    sources: Optional[Any] = None\n    meta: Optional[Dict[str, Any]] = None  # Enhanced with conversational metadata\n```\n\n### Enhanced Metadata\n\nThe `meta` field now includes:\n- `response_id` - Unique identifier for this response\n- `is_conversational` - Boolean flag indicating conversational context\n- `previous_response_id` - ID of the previous response (if provided)\n- `conversation_id` - Conversation identifier (if provided)\n- `domain` - Domain used for the query\n- `vectorstore_id` - Vector store used\n- `model` - AI model used (gpt-5-nano, gpt-5-mini, gpt-5)\n- `mode` - Answer mode (concise/balanced/deep)\n\n---\n\n## ðŸ“‹ Usage Examples\n\n### 1. Initial Question (No Context)\n\n```bash\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"question\": \"What is OTP verification?\",\n    \"domain\": \"wealth_management\"\n  }'\n```\n\n**Response:**\n```json\n{\n  \"response_id\": \"123e4567-e89b-12d3-a456-426614174000\",\n  \"markdown\": \"OTP verification is a two-factor authentication process...\",\n  \"sources\": [...],\n  \"meta\": {\n    \"domain\": \"wealth_management\",\n    \"vectorstore_id\": \"vs_689b49252a4c8191a12a1528a475fbd8\",\n    \"is_conversational\": false,\n    \"model\": \"gpt-5-mini\",\n    \"mode\": \"balanced\"\n  }\n}\n```\n\n### 2. Follow-up Using response_id\n\n```bash\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"question\": \"How long is the OTP valid?\",\n    \"domain\": \"wealth_management\",\n    \"response_id\": \"123e4567-e89b-12d3-a456-426614174000\"\n  }'\n```\n\n**Response:**\n```json\n{\n  \"response_id\": \"123e4567-e89b-12d3-a456-426614174000\",\n  \"markdown\": \"The OTP is typically valid for 5-10 minutes...\",\n  \"sources\": [...],\n  \"meta\": {\n    \"domain\": \"wealth_management\",\n    \"vectorstore_id\": \"vs_689b49252a4c8191a12a1528a475fbd8\",\n    \"is_conversational\": true,\n    \"previous_response_id\": \"123e4567-e89b-12d3-a456-426614174000\",\n    \"model\": \"gpt-5-mini\",\n    \"mode\": \"balanced\"\n  }\n}\n```\n\n### 3. Follow-up Using conversation_id\n\n```bash\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"question\": \"What if I don't receive the OTP?\",\n    \"domain\": \"wealth_management\",\n    \"conversation_id\": \"conv-abc123-def456\"\n  }'\n```\n\n**Response:**\n```json\n{\n  \"response_id\": \"conv-abc123-def456\",\n  \"markdown\": \"If you don't receive the OTP, you can request a new one...\",\n  \"sources\": [...],\n  \"meta\": {\n    \"domain\": \"wealth_management\",\n    \"vectorstore_id\": \"vs_689b49252a4c8191a12a1528a475fbd8\",\n    \"is_conversational\": true,\n    \"conversation_id\": \"conv-abc123-def456\",\n    \"model\": \"gpt-5-mini\",\n    \"mode\": \"balanced\"\n  }\n}\n```\n\n---\n\n## ðŸ”„ Conversation Flow\n\n### Pattern 1: Response ID Chain\n```\nQuery 1 â†’ response_id: A\nQuery 2 (response_id: A) â†’ response_id: A (same ID maintained)\nQuery 3 (response_id: A) â†’ response_id: A (continues chain)\n```\n\n### Pattern 2: Conversation ID Thread\n```\nQuery 1 â†’ conversation_id: conv-123\nQuery 2 (conversation_id: conv-123) â†’ response_id: conv-123\nQuery 3 (conversation_id: conv-123) â†’ response_id: conv-123\n```\n\n### Pattern 3: Mixed Usage\n```\nQuery 1 â†’ response_id: A\nQuery 2 (response_id: A) â†’ response_id: A\nQuery 3 (conversation_id: conv-123) â†’ response_id: conv-123 (new thread)\n```\n\n---\n\n## ðŸŽ¯ Key Features\n\n### âœ… Response ID Support\n- **Unique UUIDs** - Each response gets a unique identifier\n- **Context Linking** - Links to previous responses for context\n- **ID Reuse** - Can reuse response_id for conversation continuity\n- **Metadata Tracking** - Tracks previous response relationships\n\n### âœ… Conversation ID Support\n- **Alternative Tracking** - Different from response_id approach\n- **Thread Management** - Maintains conversation threads\n- **Flexible Usage** - Can be used alongside response_id\n- **Custom Identifiers** - Allows custom conversation IDs\n\n### âœ… Enhanced Question Context\n- **Context Injection** - Previous context ID added to question\n- **Transparent Processing** - Context visible in enhanced question\n- **Backward Compatible** - Works with existing question processing\n\n### âœ… Metadata Enrichment\n- **Conversational Flags** - `is_conversational` boolean\n- **Relationship Tracking** - `previous_response_id` field\n- **Thread Identification** - `conversation_id` field\n- **Full Context** - Complete metadata for debugging\n\n---\n\n## ðŸ”§ Technical Implementation\n\n### Request Processing\n1. **ID Resolution** - Uses `response_id` or `conversation_id` or generates new UUID\n2. **Context Enhancement** - Adds previous context ID to question\n3. **Agent Processing** - Processes enhanced question through agent\n4. **Metadata Enrichment** - Adds conversational metadata to response\n\n### Response Generation\n1. **ID Assignment** - Assigns resolved ID to response\n2. **Metadata Population** - Populates conversational metadata\n3. **Context Tracking** - Tracks previous response relationships\n4. **Flag Setting** - Sets conversational flags appropriately\n\n---\n\n## ðŸ“Š Usage Patterns\n\n### 1. Simple Follow-up\n```python\n# Initial query\nresponse1 = requests.post(\"/v1/answer\", json={\n    \"question\": \"What is OTP?\",\n    \"domain\": \"wealth_management\"\n})\n\n# Follow-up using response_id\nresponse2 = requests.post(\"/v1/answer\", json={\n    \"question\": \"How long is it valid?\",\n    \"domain\": \"wealth_management\",\n    \"response_id\": response1.json()[\"response_id\"]\n})\n```\n\n### 2. Conversation Thread\n```python\n# Start conversation\nresponse1 = requests.post(\"/v1/answer\", json={\n    \"question\": \"What is OTP?\",\n    \"domain\": \"wealth_management\",\n    \"conversation_id\": \"my-conversation-123\"\n})\n\n# Continue conversation\nresponse2 = requests.post(\"/v1/answer\", json={\n    \"question\": \"What are the requirements?\",\n    \"domain\": \"wealth_management\",\n    \"conversation_id\": \"my-conversation-123\"\n})\n```\n\n### 3. Mixed Context\n```python\n# Initial with conversation_id\nresponse1 = requests.post(\"/v1/answer\", json={\n    \"question\": \"What is OTP?\",\n    \"domain\": \"wealth_management\",\n    \"conversation_id\": \"conv-123\"\n})\n\n# Follow-up with response_id\nresponse2 = requests.post(\"/v1/answer\", json={\n    \"question\": \"How long is it valid?\",\n    \"domain\": \"wealth_management\",\n    \"response_id\": response1.json()[\"response_id\"]\n})\n```\n\n---\n\n## âœ… Benefits\n\n### For Developers\n- **Easy Integration** - Simple request/response pattern\n- **Flexible Tracking** - Multiple ID types for different use cases\n- **Rich Metadata** - Complete context information\n- **Backward Compatible** - Existing code continues to work\n\n### For Users\n- **Contextual Responses** - Better follow-up answers\n- **Conversation Continuity** - Maintains context across queries\n- **Flexible Threading** - Multiple conversation patterns\n- **Transparent Tracking** - Clear ID relationships\n\n### For Analytics\n- **Conversation Tracking** - Track user interaction patterns\n- **Response Relationships** - Understand query dependencies\n- **Usage Analytics** - Analyze conversational flows\n- **Debugging Support** - Rich metadata for troubleshooting\n\n---\n\n## ðŸš€ Production Deployment Status\n\n### âœ… **Current Deployment**\n- **URL**: `https://ekg-service-47249889063.europe-west6.run.app`\n- **Status**: âœ… **FULLY OPERATIONAL**\n- **Domains**: wealth_management, apf\n- **Models**: GPT-5-nano (concise), GPT-5-mini (balanced), GPT-5 (deep)\n- **Timeout**: 5 minutes for deep analysis\n- **File Export**: Disabled (handled by React frontend)\n\n### âœ… **Conversational Features Status**\n- âœ… **Fully Implemented** - All functionality working\n- âœ… **Tested** - Comprehensive test coverage\n- âœ… **Documented** - Complete usage documentation\n- âœ… **Backward Compatible** - Existing clients unaffected\n- âœ… **Production Ready** - Deployed and operational\n- âœ… **Response ID Tracking** - Working with UUID generation\n- âœ… **Conversation Context** - Context injection functional\n- âœ… **Metadata Enrichment** - Full conversational metadata\n\n---\n\n## ðŸ“ž Quick Reference\n\n**Start Conversation:**\n```bash\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -d '{\"question\": \"What is OTP?\", \"domain\": \"wealth_management\"}'\n```\n\n**Continue Conversation:**\n```bash\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -d '{\"question\": \"How long is it valid?\", \"domain\": \"wealth_management\", \"response_id\": \"YOUR_RESPONSE_ID\"}'\n```\n\n**Start New Thread:**\n```bash\ncurl -X POST https://ekg-service-47249889063.europe-west6.run.app/v1/answer \\\n  -d '{\"question\": \"What is redemption?\", \"domain\": \"wealth_management\", \"conversation_id\": \"new-thread-123\"}'\n```\n\n---\n\n## ðŸ”§ Current API Capabilities\n\n### **Available Domains**\n- **wealth_management**: Mutual funds, orders, customer onboarding, and wealth management processes\n- **apf**: APF process data and workflows\n\n### **Answer Modes & Models**\n- **concise**: GPT-5-nano (~30-45 seconds) - Fast, focused answers\n- **balanced**: GPT-5-mini (~45-60 seconds) - Detailed answers  \n- **deep**: GPT-5 (~2-5 minutes) - Comprehensive analysis\n\n### **API Endpoints**\n- `GET /health` - Health check and system status\n- `GET /domains` - List available domains\n- `GET /metrics` - Performance metrics\n- `GET /kg-status` - Knowledge graph status\n- `POST /v1/answer` - Main Q&A endpoint with conversational support\n\n### **Performance Metrics**\n- **Health Check**: <1 second response time\n- **Domain Loading**: Both domains fully loaded and operational\n- **Cache Status**: Query and hits caching active\n- **Error Handling**: Comprehensive error responses\n- **Monitoring**: Real-time metrics and logging\n\n---\n\n*Conversational features implemented and ready for production use!* ðŸš€\n","size_bytes":10601},"attached_assets/test_third_party_1760876363772.py":{"content":"#!/usr/bin/env python3\n\"\"\"\nThird-party testing script for EKG Agent API\n\"\"\"\nimport requests\nimport json\nimport time\nimport sys\n\nclass EkgApiTester:\n    def __init__(self, base_url=\"http://localhost:8000\"):\n        self.base_url = base_url\n        self.session = requests.Session()\n        self.session.headers.update({\n            'Content-Type': 'application/json',\n            'User-Agent': 'EKG-API-Tester/1.0'\n        })\n    \n    def test_health(self):\n        \"\"\"Test health endpoint\"\"\"\n        print(\"ðŸ” Testing health endpoint...\")\n        try:\n            response = self.session.get(f\"{self.base_url}/health\")\n            if response.status_code == 200:\n                data = response.json()\n                print(f\"âœ… Health check passed\")\n                print(f\"   Status: {data.get('status')}\")\n                print(f\"   Domains: {list(data.get('domains', {}).keys())}\")\n                return True\n            else:\n                print(f\"âŒ Health check failed: {response.status_code}\")\n                return False\n        except Exception as e:\n            print(f\"âŒ Health check error: {e}\")\n            return False\n    \n    def test_domains(self):\n        \"\"\"Test domains endpoint\"\"\"\n        print(\"\\nðŸ” Testing domains endpoint...\")\n        try:\n            response = self.session.get(f\"{self.base_url}/domains\")\n            if response.status_code == 200:\n                data = response.json()\n                domains = data.get('domains', [])\n                print(f\"âœ… Domains endpoint passed\")\n                print(f\"   Found {len(domains)} domains:\")\n                for domain in domains:\n                    print(f\"   - {domain['domain_id']}: {domain['name']}\")\n                return domains\n            else:\n                print(f\"âŒ Domains endpoint failed: {response.status_code}\")\n                return []\n        except Exception as e:\n            print(f\"âŒ Domains endpoint error: {e}\")\n            return []\n    \n    def test_basic_query(self, domain=\"wealth_management\"):\n        \"\"\"Test basic query\"\"\"\n        print(f\"\\nðŸ” Testing basic query for domain: {domain}\")\n        try:\n            payload = {\n                \"question\": \"What is OTP verification?\",\n                \"domain\": domain\n            }\n            \n            response = self.session.post(f\"{self.base_url}/v1/answer\", json=payload)\n            if response.status_code == 200:\n                data = response.json()\n                print(f\"âœ… Basic query passed\")\n                print(f\"   Response ID: {data.get('response_id')}\")\n                print(f\"   Answer length: {len(data.get('markdown', ''))}\")\n                print(f\"   Sources: {len(data.get('sources', []))}\")\n                print(f\"   Is Conversational: {data.get('meta', {}).get('is_conversational', False)}\")\n                return data\n            else:\n                print(f\"âŒ Basic query failed: {response.status_code}\")\n                print(f\"   Error: {response.text}\")\n                return None\n        except Exception as e:\n            print(f\"âŒ Basic query error: {e}\")\n            return None\n    \n    def test_conversational_flow(self, domain=\"wealth_management\"):\n        \"\"\"Test conversational flow\"\"\"\n        print(f\"\\nðŸ” Testing conversational flow for domain: {domain}\")\n        \n        # Step 1: Initial question\n        print(\"   Step 1: Initial question...\")\n        initial_response = self.test_basic_query(domain)\n        if not initial_response:\n            return False\n        \n        response_id = initial_response.get('response_id')\n        if not response_id:\n            print(\"âŒ No response_id in initial response\")\n            return False\n        \n        # Step 2: Follow-up with response_id\n        print(\"   Step 2: Follow-up with response_id...\")\n        try:\n            payload = {\n                \"question\": \"How long is the OTP valid?\",\n                \"domain\": domain,\n                \"response_id\": response_id\n            }\n            \n            response = self.session.post(f\"{self.base_url}/v1/answer\", json=payload)\n            if response.status_code == 200:\n                data = response.json()\n                print(f\"âœ… Follow-up query passed\")\n                print(f\"   Response ID: {data.get('response_id')}\")\n                print(f\"   Is Conversational: {data.get('meta', {}).get('is_conversational', False)}\")\n                print(f\"   Previous Response ID: {data.get('meta', {}).get('previous_response_id')}\")\n                return True\n            else:\n                print(f\"âŒ Follow-up query failed: {response.status_code}\")\n                return False\n        except Exception as e:\n            print(f\"âŒ Follow-up query error: {e}\")\n            return False\n    \n    def test_conversation_id(self, domain=\"wealth_management\"):\n        \"\"\"Test conversation_id flow\"\"\"\n        print(f\"\\nðŸ” Testing conversation_id flow for domain: {domain}\")\n        \n        try:\n            payload = {\n                \"question\": \"What is the redemption process?\",\n                \"domain\": domain,\n                \"conversation_id\": \"test-conversation-123\"\n            }\n            \n            response = self.session.post(f\"{self.base_url}/v1/answer\", json=payload)\n            if response.status_code == 200:\n                data = response.json()\n                print(f\"âœ… Conversation ID query passed\")\n                print(f\"   Response ID: {data.get('response_id')}\")\n                print(f\"   Is Conversational: {data.get('meta', {}).get('is_conversational', False)}\")\n                print(f\"   Conversation ID: {data.get('meta', {}).get('conversation_id')}\")\n                return True\n            else:\n                print(f\"âŒ Conversation ID query failed: {response.status_code}\")\n                return False\n        except Exception as e:\n            print(f\"âŒ Conversation ID query error: {e}\")\n            return False\n    \n    def test_error_handling(self):\n        \"\"\"Test error handling\"\"\"\n        print(\"\\nðŸ” Testing error handling...\")\n        \n        # Test invalid domain\n        print(\"   Testing invalid domain...\")\n        try:\n            payload = {\n                \"question\": \"Test question\",\n                \"domain\": \"invalid_domain\"\n            }\n            \n            response = self.session.post(f\"{self.base_url}/v1/answer\", json=payload)\n            if response.status_code == 400:\n                print(\"âœ… Invalid domain correctly rejected\")\n            else:\n                print(f\"âŒ Invalid domain not rejected: {response.status_code}\")\n        except Exception as e:\n            print(f\"âŒ Invalid domain test error: {e}\")\n        \n        # Test malformed request\n        print(\"   Testing malformed request...\")\n        try:\n            response = self.session.post(f\"{self.base_url}/v1/answer\", json={})\n            if response.status_code == 422:  # Validation error\n                print(\"âœ… Malformed request correctly rejected\")\n            else:\n                print(f\"âŒ Malformed request not rejected: {response.status_code}\")\n        except Exception as e:\n            print(f\"âŒ Malformed request test error: {e}\")\n    \n    def test_performance(self, num_requests=5):\n        \"\"\"Test performance with multiple requests\"\"\"\n        print(f\"\\nðŸ” Testing performance with {num_requests} requests...\")\n        \n        start_time = time.time()\n        successful_requests = 0\n        \n        for i in range(num_requests):\n            try:\n                payload = {\n                    \"question\": f\"Test question {i+1}\",\n                    \"domain\": \"wealth_management\"\n                }\n                \n                response = self.session.post(f\"{self.base_url}/v1/answer\", json=payload)\n                if response.status_code == 200:\n                    successful_requests += 1\n                \n            except Exception as e:\n                print(f\"âŒ Request {i+1} failed: {e}\")\n        \n        end_time = time.time()\n        total_time = end_time - start_time\n        avg_time = total_time / num_requests\n        \n        print(f\"âœ… Performance test completed\")\n        print(f\"   Successful requests: {successful_requests}/{num_requests}\")\n        print(f\"   Total time: {total_time:.2f}s\")\n        print(f\"   Average time per request: {avg_time:.2f}s\")\n        \n        return successful_requests == num_requests\n    \n    def run_full_test_suite(self):\n        \"\"\"Run complete test suite\"\"\"\n        print(\"=\"*80)\n        print(\"ðŸ§ª EKG AGENT API - THIRD PARTY TESTING SUITE\")\n        print(\"=\"*80)\n        \n        tests_passed = 0\n        total_tests = 0\n        \n        # Test 1: Health check\n        total_tests += 1\n        if self.test_health():\n            tests_passed += 1\n        \n        # Test 2: Domains\n        total_tests += 1\n        domains = self.test_domains()\n        if domains:\n            tests_passed += 1\n        \n        # Test 3: Basic query for each domain\n        for domain in domains:\n            total_tests += 1\n            if self.test_basic_query(domain['domain_id']):\n                tests_passed += 1\n        \n        # Test 4: Conversational flow\n        total_tests += 1\n        if self.test_conversational_flow():\n            tests_passed += 1\n        \n        # Test 5: Conversation ID\n        total_tests += 1\n        if self.test_conversation_id():\n            tests_passed += 1\n        \n        # Test 6: Error handling\n        total_tests += 1\n        self.test_error_handling()\n        tests_passed += 1  # Error handling tests don't fail the suite\n        \n        # Test 7: Performance\n        total_tests += 1\n        if self.test_performance():\n            tests_passed += 1\n        \n        # Summary\n        print(\"\\n\" + \"=\"*80)\n        print(f\"ðŸ“Š TEST RESULTS: {tests_passed}/{total_tests} tests passed\")\n        print(\"=\"*80)\n        \n        if tests_passed == total_tests:\n            print(\"âœ… ALL TESTS PASSED - API is ready for third-party integration!\")\n            return True\n        else:\n            print(\"âš ï¸  Some tests failed - Please check the issues above\")\n            return False\n\ndef main():\n    \"\"\"Main function\"\"\"\n    import argparse\n    \n    parser = argparse.ArgumentParser(description='Test EKG Agent API from third-party systems')\n    parser.add_argument('--url', default='http://localhost:8000', help='API base URL')\n    parser.add_argument('--test', choices=['health', 'domains', 'query', 'conversational', 'performance', 'all'], \n                       default='all', help='Specific test to run')\n    \n    args = parser.parse_args()\n    \n    tester = EkgApiTester(args.url)\n    \n    if args.test == 'all':\n        success = tester.run_full_test_suite()\n        sys.exit(0 if success else 1)\n    elif args.test == 'health':\n        success = tester.test_health()\n    elif args.test == 'domains':\n        success = bool(tester.test_domains())\n    elif args.test == 'query':\n        success = bool(tester.test_basic_query())\n    elif args.test == 'conversational':\n        success = tester.test_conversational_flow()\n    elif args.test == 'performance':\n        success = tester.test_performance()\n    \n    sys.exit(0 if success else 1)\n\nif __name__ == \"__main__\":\n    main()\n","size_bytes":11252},"client/src/pages/atlas.tsx":{"content":"import { Map, Globe, BookMarked, Database } from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\n\nexport default function AtlasPage() {\n  const resources = [\n    {\n      category: \"Knowledge Base\",\n      items: [\"Market Analysis Reports\", \"Investment Guidelines\", \"Compliance Documents\", \"Best Practices\"]\n    },\n    {\n      category: \"Regulatory\",\n      items: [\"SEC Regulations\", \"FINRA Rules\", \"Tax Guidelines\", \"Compliance Frameworks\"]\n    },\n    {\n      category: \"Products\",\n      items: [\"Mutual Funds\", \"ETFs\", \"Bonds\", \"Alternative Investments\"]\n    }\n  ];\n\n  return (\n    <div className=\"flex-1 flex flex-col bg-background\">\n      <header className=\"border-b border-border bg-card/30 backdrop-blur-sm px-6 py-4\">\n        <div className=\"flex items-center gap-3\">\n          <Map className=\"w-6 h-6 text-primary\" />\n          <div>\n            <h1 className=\"text-2xl font-bold text-foreground\" data-testid=\"text-atlas-title\">\n              Atlas\n            </h1>\n            <p className=\"text-sm text-muted-foreground\">\n              Navigate the complete knowledge map and resource library\n            </p>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"flex-1 overflow-auto p-6\">\n        <div className=\"max-w-6xl mx-auto\">\n          <Tabs defaultValue=\"overview\" className=\"w-full\">\n            <TabsList className=\"mb-6\" data-testid=\"tabs-atlas\">\n              <TabsTrigger value=\"overview\" data-testid=\"tab-overview\">\n                <Globe className=\"w-4 h-4 mr-2\" />\n                Overview\n              </TabsTrigger>\n              <TabsTrigger value=\"resources\" data-testid=\"tab-resources\">\n                <BookMarked className=\"w-4 h-4 mr-2\" />\n                Resources\n              </TabsTrigger>\n              <TabsTrigger value=\"data\" data-testid=\"tab-data\">\n                <Database className=\"w-4 h-4 mr-2\" />\n                Data Sources\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"overview\" className=\"space-y-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Knowledge Map</CardTitle>\n                  <CardDescription>\n                    Visual representation of the wealth management knowledge base\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"h-[400px] rounded-lg bg-muted flex items-center justify-center\">\n                    <div className=\"text-center space-y-3\">\n                      <Map className=\"w-16 h-16 text-muted-foreground mx-auto\" />\n                      <p className=\"text-muted-foreground\">\n                        Interactive knowledge map coming soon\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"resources\" className=\"space-y-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                {resources.map((resource) => (\n                  <Card key={resource.category} data-testid={`card-resource-${resource.category.toLowerCase().replace(/\\s+/g, '-')}`}>\n                    <CardHeader>\n                      <CardTitle className=\"text-lg\">{resource.category}</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <ul className=\"space-y-2\">\n                        {resource.items.map((item) => (\n                          <li key={item} className=\"text-sm text-muted-foreground flex items-start gap-2\">\n                            <span className=\"w-1 h-1 rounded-full bg-primary mt-2 flex-shrink-0\" />\n                            <span>{item}</span>\n                          </li>\n                        ))}\n                      </ul>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"data\" className=\"space-y-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Connected Data Sources</CardTitle>\n                  <CardDescription>\n                    Information repositories powering the knowledge agent\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-3\">\n                    {[\"Vector Database\", \"Knowledge Graph\", \"Document Repository\", \"Market Data Feeds\"].map((source) => (\n                      <div\n                        key={source}\n                        className=\"flex items-center gap-3 p-3 rounded-lg border border-border\"\n                        data-testid={`data-source-${source.toLowerCase().replace(/\\s+/g, '-')}`}\n                      >\n                        <div className=\"w-2 h-2 rounded-full bg-green-500\" />\n                        <span className=\"text-sm font-medium\">{source}</span>\n                        <span className=\"text-xs text-muted-foreground ml-auto\">Connected</span>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":5392},"client/src/components/top-header.tsx":{"content":"import { useState } from \"react\";\nimport { Search, MessageSquare, Trophy, User, Sun, Moon, Menu } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useTheme } from \"@/components/theme-provider\";\nimport { MasteryBar } from \"@/components/mastery-bar\";\n\ninterface TopHeaderProps {\n  questionsAsked?: number;\n  quizzesCompleted?: number;\n  onSearch?: (query: string) => void;\n  onMenuClick?: () => void;\n}\n\nexport function TopHeader({ questionsAsked = 0, quizzesCompleted = 0, onSearch, onMenuClick }: TopHeaderProps) {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const { theme, toggleTheme } = useTheme();\n\n  const handleSearch = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSearch?.(searchQuery);\n  };\n\n  return (\n    <div className=\"h-14 border-b border-border bg-card flex items-center justify-between px-4 md:px-6\">\n      {/* Left: Hamburger Menu (Mobile) + Stats */}\n      <div className=\"flex items-center gap-3 md:gap-6\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={onMenuClick}\n          className=\"md:hidden w-9 h-9\"\n          data-testid=\"button-mobile-menu\"\n          title=\"Open menu\"\n        >\n          <Menu className=\"w-5 h-5\" />\n        </Button>\n        <div className=\"hidden sm:flex items-center gap-2\" data-testid=\"stat-questions\">\n          <div className=\"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center\">\n            <MessageSquare className=\"w-4 h-4 text-primary\" />\n          </div>\n          <div className=\"flex flex-col\">\n            <span className=\"text-xs text-muted-foreground\">Questions</span>\n            <span className=\"text-sm font-medium text-foreground\" data-testid=\"text-questions-count\">\n              {questionsAsked.toLocaleString()}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"hidden sm:flex items-center gap-2\" data-testid=\"stat-quizzes\">\n          <div className=\"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center\">\n            <Trophy className=\"w-4 h-4 text-primary\" />\n          </div>\n          <div className=\"flex flex-col\">\n            <span className=\"text-xs text-muted-foreground\">Quizzes</span>\n            <span className=\"text-sm font-medium text-foreground\" data-testid=\"text-quizzes-count\">\n              {quizzesCompleted.toLocaleString()}\n            </span>\n          </div>\n        </div>\n      </div>\n\n      {/* Center: Search Bar */}\n      <div className=\"flex-1 max-w-md mx-2 sm:mx-6\">\n        <form onSubmit={handleSearch} className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n          <Input\n            type=\"search\"\n            placeholder=\"Search conversations, topics, or documents...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10 pr-4 h-9 bg-background\"\n            data-testid=\"input-global-search\"\n          />\n        </form>\n      </div>\n\n      {/* Right: Mastery Bar, Theme Toggle and User Menu */}\n      <div className=\"flex items-center gap-3\">\n        <MasteryBar />\n        \n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={toggleTheme}\n          className=\"w-9 h-9\"\n          data-testid=\"button-theme-toggle\"\n          title={`Switch to ${theme === \"light\" ? \"dark\" : \"light\"} mode`}\n        >\n          {theme === \"light\" ? (\n            <Moon className=\"w-5 h-5\" />\n          ) : (\n            <Sun className=\"w-5 h-5\" />\n          )}\n        </Button>\n        \n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"rounded-full w-9 h-9\"\n              data-testid=\"button-user-menu\"\n            >\n              <div className=\"w-9 h-9 rounded-full bg-primary/10 flex items-center justify-center hover:bg-primary/20 transition-colors\">\n                <User className=\"w-5 h-5 text-primary\" />\n              </div>\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\" className=\"w-56\">\n            <DropdownMenuLabel>My Account</DropdownMenuLabel>\n            <DropdownMenuSeparator />\n            <DropdownMenuItem data-testid=\"menu-profile\">\n              Profile Settings\n            </DropdownMenuItem>\n            <DropdownMenuItem data-testid=\"menu-preferences\">\n              Preferences\n            </DropdownMenuItem>\n            <DropdownMenuItem data-testid=\"menu-history\">\n              View History\n            </DropdownMenuItem>\n            <DropdownMenuSeparator />\n            <DropdownMenuItem data-testid=\"menu-logout\" className=\"text-destructive\">\n              Log Out\n            </DropdownMenuItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </div>\n    </div>\n  );\n}\n","size_bytes":5116},"client/src/components/ai-config-sidebar.tsx":{"content":"import { useState } from \"react\";\nimport { Settings, ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface AIConfigSidebarProps {\n  onConfigChange?: (config: AIConfig) => void;\n}\n\nexport interface AIConfig {\n  model: string;\n  temperature: number;\n  hops: number;\n  tokenLimit: number;\n  systemPrompt: string;\n}\n\nexport function AIConfigSidebar({ onConfigChange }: AIConfigSidebarProps) {\n  const [isCollapsed, setIsCollapsed] = useState(true);\n  const [config, setConfig] = useState<AIConfig>({\n    model: \"GPT-4o\",\n    temperature: 0.7,\n    hops: 3,\n    tokenLimit: 2048,\n    systemPrompt: \"You are a helpful wealth management AI assistant.\",\n  });\n\n  const updateConfig = (updates: Partial<AIConfig>) => {\n    const newConfig = { ...config, ...updates };\n    setConfig(newConfig);\n    onConfigChange?.(newConfig);\n  };\n\n  if (isCollapsed) {\n    return (\n      <div className=\"w-12 border-l border-border bg-card flex flex-col h-full items-center py-4\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={() => setIsCollapsed(false)}\n          data-testid=\"button-expand-config-sidebar\"\n          className=\"mb-4\"\n          title=\"Expand configuration\"\n        >\n          <ChevronLeft className=\"w-5 h-5\" />\n        </Button>\n        <Settings className=\"w-5 h-5 text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-80 border-l border-border bg-card flex flex-col h-full\">\n      <div className=\"px-3 py-2.5 border-b border-border\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Settings className=\"w-4 h-4 text-primary\" />\n            <h3 className=\"text-xs font-medium text-foreground\" data-testid=\"text-config-title\">\n              AI Configuration\n            </h3>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setIsCollapsed(true)}\n            data-testid=\"button-collapse-config-sidebar\"\n            title=\"Collapse sidebar\"\n            className=\"h-6 w-6\"\n          >\n            <ChevronRight className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"flex-1 overflow-auto px-3 py-3 space-y-3\">\n        {/* Model Selection */}\n        <div className=\"space-y-1.5\">\n          <Label htmlFor=\"model-select\" className=\"text-xs font-normal\">\n            LLM Model\n          </Label>\n          <Select\n            value={config.model}\n            onValueChange={(value) => updateConfig({ model: value })}\n          >\n            <SelectTrigger id=\"model-select\" data-testid=\"select-model\" className=\"h-8\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"GraphRAG\" data-testid=\"option-graphrag\">\n                GraphRAG\n              </SelectItem>\n              <SelectItem value=\"OpenAI\" data-testid=\"option-openai\">\n                OpenAI\n              </SelectItem>\n              <SelectItem value=\"GPT-4o\" data-testid=\"option-gpt4o\">\n                GPT-4o\n              </SelectItem>\n              <SelectItem value=\"GPT-5\" data-testid=\"option-gpt5\">\n                GPT-5\n              </SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* Temperature Slider */}\n        <div className=\"space-y-1.5\">\n          <div className=\"flex items-center justify-between\">\n            <Label htmlFor=\"temperature-slider\" className=\"text-xs font-normal\">\n              Temperature\n            </Label>\n            <span className=\"text-xs font-mono text-muted-foreground\" data-testid=\"text-temperature-value\">\n              {config.temperature.toFixed(2)}\n            </span>\n          </div>\n          <Slider\n            id=\"temperature-slider\"\n            data-testid=\"slider-temperature\"\n            value={[config.temperature]}\n            onValueChange={([value]) => updateConfig({ temperature: value })}\n            min={0}\n            max={2}\n            step={0.01}\n            className=\"w-full\"\n          />\n        </div>\n\n        {/* Hops Slider */}\n        <div className=\"space-y-1.5\">\n          <div className=\"flex items-center justify-between\">\n            <Label htmlFor=\"hops-slider\" className=\"text-xs font-normal\">\n              Hops\n            </Label>\n            <span className=\"text-xs font-mono text-muted-foreground\" data-testid=\"text-hops-value\">\n              {config.hops}\n            </span>\n          </div>\n          <Slider\n            id=\"hops-slider\"\n            data-testid=\"slider-hops\"\n            value={[config.hops]}\n            onValueChange={([value]) => updateConfig({ hops: value })}\n            min={1}\n            max={10}\n            step={1}\n            className=\"w-full\"\n          />\n        </div>\n\n        {/* Token Limit */}\n        <div className=\"space-y-1.5\">\n          <div className=\"flex items-center justify-between\">\n            <Label htmlFor=\"token-limit\" className=\"text-xs font-normal\">\n              Token Limit\n            </Label>\n            <span className=\"text-xs font-mono text-muted-foreground\" data-testid=\"text-token-limit-value\">\n              {config.tokenLimit.toLocaleString()}\n            </span>\n          </div>\n          <Input\n            id=\"token-limit\"\n            type=\"number\"\n            data-testid=\"input-token-limit\"\n            value={config.tokenLimit}\n            onChange={(e) => updateConfig({ tokenLimit: parseInt(e.target.value) || 0 })}\n            min={128}\n            max={32000}\n            step={128}\n            className=\"w-full h-8\"\n          />\n        </div>\n\n        {/* System Prompt */}\n        <div className=\"space-y-1.5\">\n          <Label htmlFor=\"system-prompt\" className=\"text-xs font-normal\">\n            System Prompt\n          </Label>\n          <Textarea\n            id=\"system-prompt\"\n            data-testid=\"textarea-system-prompt\"\n            value={config.systemPrompt}\n            onChange={(e) => updateConfig({ systemPrompt: e.target.value })}\n            className=\"min-h-[70px] resize-none font-mono text-xs\"\n            placeholder=\"Enter custom system prompt...\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6584},"client/src/pages/workshop.tsx":{"content":"import { Wrench, FileText, Upload, Network, Presentation, Clipboard, BookOpen } from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useLocation } from \"wouter\";\n\nexport default function WorkshopPage() {\n  const [, setLocation] = useLocation();\n  const templates = [\n    {\n      name: \"New Report\",\n      description: \"Generate comprehensive financial or market analysis reports\",\n      icon: FileText,\n    },\n    {\n      name: \"Client Proposal\",\n      description: \"Craft compelling proposals for new clients or projects\",\n      icon: Upload,\n    },\n    {\n      name: \"Strategic Memo\",\n      description: \"Compose internal memos for strategic initiatives or announcements\",\n      icon: Network,\n    },\n    {\n      name: \"Presentation Deck\",\n      description: \"Create visually engaging presentations for meetings or conferences\",\n      icon: Presentation,\n    },\n    {\n      name: \"RFP Response\",\n      description: \"Develop detailed responses to Request for Proposals efficiently\",\n      icon: Clipboard,\n    },\n    {\n      name: \"Case Study\",\n      description: \"Document successful projects and client outcomes\",\n      icon: BookOpen,\n    }\n  ];\n\n  return (\n    <div className=\"flex-1 flex flex-col bg-background\">\n      <header className=\"border-b border-border bg-card/30 backdrop-blur-sm px-6 py-2.5\">\n        <div className=\"flex items-center gap-2.5\">\n          <Wrench className=\"w-5 h-5 text-primary\" />\n          <div>\n            <h1 className=\"text-xl font-bold text-foreground\" data-testid=\"text-launchpad-title\">\n              Launchpad\n            </h1>\n            <p className=\"text-xs text-muted-foreground\">\n              Pre-developed templates for wealth management professionals\n            </p>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"flex-1 overflow-auto p-4\">\n        <div className=\"max-w-6xl mx-auto\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {templates.map((template) => {\n              const Icon = template.icon;\n              const isRfpResponse = template.name === \"RFP Response\";\n              return (\n                <Card\n                  key={template.name}\n                  className=\"hover:shadow-lg hover:border-primary/50 transition-all cursor-pointer bg-card\"\n                  onClick={() => {\n                    if (isRfpResponse) {\n                      setLocation(\"/rfp\");\n                    }\n                  }}\n                  data-testid={`card-template-${template.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                >\n                  <CardHeader className=\"space-y-2.5 p-4\">\n                    <div className=\"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center\">\n                      <Icon className=\"w-5 h-5 text-primary\" />\n                    </div>\n                    <div>\n                      <CardTitle className=\"text-base font-semibold\">{template.name}</CardTitle>\n                      <CardDescription className=\"mt-1.5 text-sm leading-snug\">\n                        {template.description}\n                      </CardDescription>\n                    </div>\n                  </CardHeader>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":3370},"client/src/components/main-nav-sidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Compass, Wrench, Brain, Map } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nconst navItems = [\n  {\n    name: \"Conversation\",\n    path: \"/\",\n    icon: Compass,\n    description: \"Chat with the knowledge agent\"\n  },\n  {\n    name: \"Launchpad\",\n    path: \"/workshop\",\n    icon: Wrench,\n    description: \"Interactive tools and utilities\"\n  },\n  {\n    name: \"Quiz\",\n    path: \"/quiz\",\n    icon: Brain,\n    description: \"Test your knowledge\"\n  },\n  {\n    name: \"Atlas\",\n    path: \"/atlas\",\n    icon: Map,\n    description: \"Knowledge map and resources\"\n  }\n];\n\ninterface MainNavSidebarProps {\n  className?: string;\n}\n\nexport function MainNavSidebar({ className }: MainNavSidebarProps = {}) {\n  const [location] = useLocation();\n\n  return (\n    <div className={`w-20 border-r border-border bg-card flex flex-col items-center py-6 gap-6 ${className || ''}`}>\n      {navItems.map((item) => {\n        const Icon = item.icon;\n        const isActive = location === item.path;\n        \n        return (\n          <Link key={item.path} href={item.path}>\n            <div\n              className={cn(\n                \"flex flex-col items-center gap-2 p-3 rounded-lg transition-all cursor-pointer group\",\n                isActive\n                  ? \"bg-primary text-primary-foreground\"\n                  : \"text-muted-foreground hover:bg-muted hover:text-foreground\"\n              )}\n              data-testid={`nav-${item.name.toLowerCase()}`}\n              title={item.description}\n            >\n              <Icon className=\"w-6 h-6\" />\n              <span className=\"text-xs font-normal\">{item.name}</span>\n            </div>\n          </Link>\n        );\n      })}\n    </div>\n  );\n}\n","size_bytes":1733},"client/src/pages/quiz.tsx":{"content":"import { useState } from \"react\";\nimport { Brain, BookCheck, Layers, GraduationCap, FileText, Shield, TrendingUp, Users, Target, Sparkles, Award, BarChart3, ChevronDown, ChevronRight } from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \"@/components/ui/tabs\";\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from \"@/components/ui/accordion\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport QuizAssessment from \"@/components/quiz-assessment\";\n\ninterface QuizTopic {\n  category: string;\n  topic: string;\n  questionCount: number;\n  easyCount: number;\n  mediumCount: number;\n  hardCount: number;\n}\n\nconst categoryIcons: Record<string, any> = {\n  \"Order Management\": FileText,\n  \"Wealth Management Fundamentals\": BookCheck,\n  \"Investment Products & Strategies\": TrendingUp,\n  \"Client Relationship Management\": Users,\n  \"Regulatory & Compliance\": Shield,\n};\n\nfunction getDifficultyLevel(easy: number, medium: number, hard: number): string {\n  if (hard > easy && hard > medium) return \"Advanced\";\n  if (medium > easy) return \"Intermediate\";\n  return \"Beginner\";\n}\n\nfunction getEstimatedTime(questionCount: number): string {\n  const minutes = Math.round(questionCount * 0.7);\n  return `${minutes} min`;\n}\n\nexport default function QuizPage() {\n  const [activeQuizTopic, setActiveQuizTopic] = useState<string | null>(null);\n\n  const { data: topics, isLoading, error } = useQuery<QuizTopic[]>({\n    queryKey: [\"/api/quiz/categories\"],\n  });\n\n  const { data: quizStats } = useQuery<Record<string, { bestScore: number; attempts: number }>>({\n    queryKey: [\"/api/quiz/stats\"],\n  });\n\n  const flashcardDecks = [\n    {\n      name: \"Quick Concepts Review\",\n      description: \"Rapid-fire review of key wealth management terms\",\n      icon: Sparkles,\n      cardCount: 50,\n      category: \"All Topics\",\n      lastStudied: \"Never\"\n    },\n    {\n      name: \"Investment Terminology\",\n      description: \"Master essential investment vocabulary\",\n      icon: Target,\n      cardCount: 75,\n      category: \"Investments\",\n      lastStudied: \"2 days ago\"\n    },\n    {\n      name: \"Regulatory Definitions\",\n      description: \"Key compliance and regulatory terms\",\n      icon: Award,\n      cardCount: 60,\n      category: \"Compliance\",\n      lastStudied: \"1 week ago\"\n    },\n    {\n      name: \"Financial Ratios & Metrics\",\n      description: \"Common financial calculations and ratios\",\n      icon: BarChart3,\n      cardCount: 40,\n      category: \"Analysis\",\n      lastStudied: \"Never\"\n    }\n  ];\n\n  // Group topics by category\n  const categorizedTopics = topics?.reduce((acc, topic) => {\n    if (!acc[topic.category]) {\n      acc[topic.category] = [];\n    }\n    acc[topic.category].push(topic);\n    return acc;\n  }, {} as Record<string, QuizTopic[]>) || {};\n\n  if (activeQuizTopic) {\n    return (\n      <div className=\"flex-1 flex flex-col bg-background\">\n        <header className=\"border-b border-border bg-card/30 backdrop-blur-sm px-6 py-2.5\">\n          <div className=\"flex items-center gap-2.5\">\n            <Brain className=\"w-5 h-5 text-primary\" />\n            <div>\n              <h1 className=\"text-xl font-bold text-foreground\" data-testid=\"text-quiz-title\">\n                Quiz & Assessment\n              </h1>\n              <p className=\"text-xs text-muted-foreground\">\n                Test knowledge retention and enhance learning\n              </p>\n            </div>\n          </div>\n        </header>\n        <div className=\"flex-1 overflow-auto\">\n          <QuizAssessment topic={activeQuizTopic} onBack={() => setActiveQuizTopic(null)} />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex-1 flex flex-col bg-background\">\n      <header className=\"border-b border-border bg-card/30 backdrop-blur-sm px-6 py-2.5\">\n        <div className=\"flex items-center gap-2.5\">\n          <Brain className=\"w-5 h-5 text-primary\" />\n          <div>\n            <h1 className=\"text-xl font-bold text-foreground\" data-testid=\"text-quiz-title\">\n              Quiz & Assessment\n            </h1>\n            <p className=\"text-xs text-muted-foreground\">\n              Test knowledge retention and enhance learning\n            </p>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"flex-1 overflow-auto p-4\">\n        <div className=\"max-w-6xl mx-auto\">\n          <Tabs defaultValue=\"structured\" className=\"w-full\">\n            <TabsList className=\"grid w-full max-w-md mx-auto grid-cols-2 mb-6\">\n              <TabsTrigger value=\"structured\" className=\"gap-2\" data-testid=\"tab-structured\">\n                <Layers className=\"w-4 h-4\" />\n                Structured Quiz\n              </TabsTrigger>\n              <TabsTrigger value=\"flashcards\" className=\"gap-2\" data-testid=\"tab-flashcards\">\n                <GraduationCap className=\"w-4 h-4\" />\n                Flashcards\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"structured\" className=\"mt-0\">\n              <div className=\"mb-6 text-center\">\n                <h2 className=\"text-2xl font-bold mb-2\">Knowledge Assessment</h2>\n                <p className=\"text-sm text-muted-foreground\">\n                  {isLoading ? \"Loading...\" : `${topics?.reduce((sum, t) => sum + t.questionCount, 0) || 0} questions`} across {topics?.length || 0} topics â€¢ Track your progress and mastery\n                </p>\n              </div>\n\n              {isLoading && (\n                <div className=\"space-y-3\">\n                  {[1, 2].map((i) => (\n                    <Card key={i}>\n                      <CardHeader className=\"p-4\">\n                        <Skeleton className=\"h-6 w-1/3 mb-2\" />\n                        <Skeleton className=\"h-4 w-1/2\" />\n                      </CardHeader>\n                    </Card>\n                  ))}\n                </div>\n              )}\n\n              {error && (\n                <div className=\"text-center py-8\">\n                  <p className=\"text-destructive\">Failed to load quiz topics</p>\n                </div>\n              )}\n\n              {Object.keys(categorizedTopics).length > 0 && (\n                <div className=\"space-y-4\">\n                  {Object.entries(categorizedTopics).map(([category, categoryTopics]) => {\n                    const Icon = categoryIcons[category] || FileText;\n                    const totalQuestions = categoryTopics.reduce((sum, t) => sum + t.questionCount, 0);\n                    const totalEasy = categoryTopics.reduce((sum, t) => sum + t.easyCount, 0);\n                    const totalMedium = categoryTopics.reduce((sum, t) => sum + t.mediumCount, 0);\n                    const totalHard = categoryTopics.reduce((sum, t) => sum + t.hardCount, 0);\n\n                    return (\n                      <Card key={category} className=\"border-2\">\n                        <Accordion type=\"single\" collapsible defaultValue={category}>\n                          <AccordionItem value={category} className=\"border-none\">\n                            <AccordionTrigger \n                              className=\"px-4 py-3 hover:no-underline hover:bg-muted/50\"\n                              data-testid={`accordion-${category.toLowerCase().replace(/\\s+/g, '-')}`}\n                            >\n                              <div className=\"flex items-center gap-3 flex-1 text-left\">\n                                <div className=\"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                                  <Icon className=\"w-5 h-5 text-primary\" />\n                                </div>\n                                <div className=\"flex-1\">\n                                  <h3 className=\"font-semibold text-base mb-1\">{category}</h3>\n                                  <div className=\"flex flex-wrap gap-3 text-xs text-muted-foreground\">\n                                    <span className=\"flex items-center gap-1\">\n                                      <BookCheck className=\"w-3 h-3\" />\n                                      {categoryTopics.length} Topics\n                                    </span>\n                                    <span>â€¢</span>\n                                    <span>{totalQuestions} Questions</span>\n                                    <span>â€¢</span>\n                                    <span className=\"text-green-600\">Easy: {totalEasy}</span>\n                                    <span className=\"text-yellow-600\">Medium: {totalMedium}</span>\n                                    <span className=\"text-red-600\">Hard: {totalHard}</span>\n                                  </div>\n                                </div>\n                              </div>\n                            </AccordionTrigger>\n                            <AccordionContent className=\"px-4 pb-4 pt-2\">\n                              <div className=\"space-y-2 pl-2\">\n                                {categoryTopics.map((topic) => {\n                                  const difficulty = getDifficultyLevel(topic.easyCount, topic.mediumCount, topic.hardCount);\n                                  const estimatedTime = getEstimatedTime(topic.questionCount);\n\n                                  const stats = quizStats?.[topic.topic];\n                                  \n                                  return (\n                                    <div\n                                      key={topic.topic}\n                                      className=\"flex items-center justify-between p-3 rounded-lg border border-border hover:border-primary/50 hover:bg-muted/30 transition-all\"\n                                      data-testid={`card-quiz-${topic.topic.toLowerCase().replace(/\\s+/g, '-')}`}\n                                    >\n                                      <div className=\"flex-1 min-w-0\">\n                                        <div className=\"flex items-center gap-2 mb-1\">\n                                          <h4 className=\"font-medium text-sm\">{topic.topic}</h4>\n                                          {stats && stats.attempts > 0 && (\n                                            <div className=\"flex items-center gap-2\">\n                                              <span className=\"text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary font-medium\">\n                                                Best: {stats.bestScore}%\n                                              </span>\n                                              <span className=\"text-xs text-muted-foreground\">\n                                                {stats.attempts} {stats.attempts === 1 ? 'attempt' : 'attempts'}\n                                              </span>\n                                            </div>\n                                          )}\n                                        </div>\n                                        <div className=\"flex flex-wrap gap-2 text-xs text-muted-foreground\">\n                                          <span>{topic.questionCount} Questions</span>\n                                          <span>â€¢</span>\n                                          <span>{difficulty}</span>\n                                          <span>â€¢</span>\n                                          <span>{estimatedTime}</span>\n                                          <span>â€¢</span>\n                                          <span className=\"text-green-600\">Easy: {topic.easyCount}</span>\n                                          <span className=\"text-yellow-600\">Medium: {topic.mediumCount}</span>\n                                          <span className=\"text-red-600\">Hard: {topic.hardCount}</span>\n                                        </div>\n                                      </div>\n                                      <Button\n                                        size=\"sm\"\n                                        onClick={() => setActiveQuizTopic(topic.topic)}\n                                        data-testid={`button-start-${topic.topic.toLowerCase().replace(/\\s+/g, '-')}`}\n                                      >\n                                        Start\n                                      </Button>\n                                    </div>\n                                  );\n                                })}\n                              </div>\n                            </AccordionContent>\n                          </AccordionItem>\n                        </Accordion>\n                      </Card>\n                    );\n                  })}\n                </div>\n              )}\n\n              <div className=\"mt-6 p-4 rounded-lg bg-muted/50 border border-border\">\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                    <Target className=\"w-4 h-4 text-primary\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-semibold text-sm mb-1\">How Structured Quizzes Work</h3>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Expand a category to see available topics. Select a topic to begin your assessment. Questions are presented one at a time. \n                      Track your score, review incorrect answers, and retake quizzes to improve your knowledge.\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"flashcards\" className=\"mt-0\">\n              <div className=\"mb-6 text-center\">\n                <h2 className=\"text-2xl font-bold mb-2\">Self-Assessment Flashcards</h2>\n                <p className=\"text-sm text-muted-foreground\">\n                  Master key concepts through active recall â€¢ Study at your own pace\n                </p>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                {flashcardDecks.map((deck) => {\n                  const Icon = deck.icon;\n                  return (\n                    <Card\n                      key={deck.name}\n                      className=\"hover:shadow-lg hover:border-primary/50 transition-all cursor-pointer\"\n                      data-testid={`card-flashcard-${deck.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                    >\n                      <CardHeader className=\"p-4 space-y-2.5\">\n                        <div className=\"flex items-start gap-3\">\n                          <div className=\"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                            <Icon className=\"w-5 h-5 text-primary\" />\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <CardTitle className=\"text-base mb-1\">{deck.name}</CardTitle>\n                            <CardDescription className=\"text-xs\">\n                              {deck.description}\n                            </CardDescription>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center justify-between text-xs\">\n                          <div className=\"flex gap-2 text-muted-foreground\">\n                            <span className=\"px-2 py-0.5 rounded-full bg-muted\">\n                              {deck.cardCount} cards\n                            </span>\n                            <span className=\"px-2 py-0.5 rounded-full bg-muted\">\n                              {deck.category}\n                            </span>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center justify-between pt-2 border-t border-border\">\n                          <span className=\"text-xs text-muted-foreground\">\n                            Last studied: {deck.lastStudied}\n                          </span>\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            data-testid={`button-study-${deck.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                          >\n                            Study\n                          </Button>\n                        </div>\n                      </CardHeader>\n                    </Card>\n                  );\n                })}\n              </div>\n\n              <div className=\"mt-6 p-4 rounded-lg bg-muted/50 border border-border\">\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                    <GraduationCap className=\"w-4 h-4 text-primary\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-semibold text-sm mb-1\">How Flashcards Work</h3>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Click on any deck to start studying. Each card shows a question or term on the front. \n                      Think of your answer, then flip the card to check. Mark whether you knew it to track your mastery.\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":17544},"client/src/components/mastery-bar.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Trophy } from \"lucide-react\";\n\ninterface MasteryData {\n  overallScore: number;\n  currentLevel: string;\n  quizPerformanceScore: number;\n  topicCoverageScore: number;\n  retentionScore: number;\n  topicsMastered: number;\n  totalQuizzesTaken: number;\n}\n\nexport function MasteryBar() {\n  const { data: mastery, isLoading } = useQuery<MasteryData>({\n    queryKey: [\"/api/mastery\"],\n    refetchInterval: false, // Only refetch manually after quiz completion\n  });\n\n  if (isLoading || !mastery) {\n    return null;\n  }\n\n  const { overallScore, currentLevel } = mastery;\n\n  // Determine color based on score\n  const getColor = (score: number) => {\n    if (score >= 76) return \"from-green-600 to-emerald-500\"; // Advanced/Expert\n    if (score >= 51) return \"from-yellow-500 to-amber-400\"; // Intermediate\n    if (score >= 26) return \"from-orange-500 to-orange-400\"; // Learning\n    return \"from-red-600 to-red-500\"; // Novice\n  };\n\n  // Determine background track color based on score\n  const getTrackColor = (score: number) => {\n    if (score >= 76) return \"bg-green-900/20\";\n    if (score >= 51) return \"bg-yellow-900/20\";\n    if (score >= 26) return \"bg-orange-900/20\";\n    return \"bg-red-900/20\";\n  };\n\n  const gradient = getColor(overallScore);\n  const trackColor = getTrackColor(overallScore);\n\n  return (\n    <div \n      className=\"w-full bg-card/50 border-b border-border/40 px-6 py-2.5\"\n      data-testid=\"mastery-bar-container\"\n    >\n      <div className=\"flex items-center justify-between mb-1.5\">\n        <div className=\"flex items-center gap-2\">\n          <Trophy className=\"w-4 h-4 text-muted-foreground\" />\n          <span className=\"text-xs font-medium text-foreground\">\n            Wealth Knowledge Mastery: {overallScore}% - {currentLevel}\n          </span>\n        </div>\n        <button\n          className=\"text-xs text-muted-foreground hover:text-foreground transition-colors\"\n          data-testid=\"mastery-breakdown-button\"\n          title=\"View detailed breakdown\"\n        >\n          Details\n        </button>\n      </div>\n      \n      {/* Progress Bar */}\n      <div className=\"relative\">\n        {/* Track */}\n        <div className={`h-2.5 ${trackColor} rounded-full overflow-hidden`}>\n          {/* Fill */}\n          <div\n            className={`h-full bg-gradient-to-r ${gradient} transition-all duration-700 ease-out`}\n            style={{ width: `${overallScore}%` }}\n            data-testid=\"mastery-progress-fill\"\n          />\n        </div>\n        \n        {/* Milestone Markers */}\n        <div className=\"absolute top-0 left-0 right-0 h-2.5 flex justify-between pointer-events-none\">\n          <div className=\"w-px bg-border/30 h-full\" style={{ marginLeft: \"25%\" }} />\n          <div className=\"w-px bg-border/30 h-full\" style={{ marginLeft: \"0%\" }} />\n          <div className=\"w-px bg-border/30 h-full\" style={{ marginLeft: \"0%\" }} />\n          <div className=\"w-px bg-border/30 h-full\" style={{ marginLeft: \"-1px\" }} />\n        </div>\n      </div>\n      \n      {/* Labels */}\n      <div className=\"flex justify-between mt-1 text-[10px] text-muted-foreground\">\n        <span>Novice</span>\n        <span>Learning</span>\n        <span>Intermediate</span>\n        <span>Advanced</span>\n        <span>Expert</span>\n      </div>\n    </div>\n  );\n}\n","size_bytes":3331},"client/src/components/quiz-message.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Brain, CheckCircle2, XCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { QuizQuestion } from \"@/types/quiz\";\n\ninterface QuizMessageProps {\n  questions: QuizQuestion[];\n  threadId: number;\n  shouldSaveResults?: boolean; // If false, skip saving to database\n}\n\nexport function QuizMessage({ questions, threadId, shouldSaveResults = true }: QuizMessageProps) {\n  const [selectedAnswers, setSelectedAnswers] = useState<Record<number, string>>({});\n  const [revealedAnswers, setRevealedAnswers] = useState<Record<number, boolean>>({});\n  const [submitted, setSubmitted] = useState(false);\n  const { toast } = useToast();\n\n  const submitQuizMutation = useMutation({\n    mutationFn: async (results: any[]) => {\n      const response = await apiRequest(\"POST\", \"/api/quiz/submit\", {\n        threadId,\n        results,\n      });\n      return await response.json();\n    },\n    onSuccess: (data: any) => {\n      // Mark as successfully submitted only after API confirms success\n      setSubmitted(true);\n      \n      // Invalidate mastery query to trigger refresh\n      queryClient.invalidateQueries({ queryKey: [\"/api/mastery\"] });\n      \n      toast({\n        title: \"ðŸŽ‰ Quiz Results Saved!\",\n        description: `Your mastery increased to ${data.mastery.overallScore}% (${data.mastery.currentLevel})`,\n      });\n    },\n    onError: (error: Error) => {\n      console.error(\"Failed to submit quiz:\", error);\n      \n      // Reset submitted flag to allow retry\n      setSubmitted(false);\n      \n      toast({\n        variant: \"destructive\",\n        title: \"Failed to save results\",\n        description: \"Your quiz results couldn't be saved. Please try again.\",\n      });\n    },\n  });\n\n  const handleAnswerSelect = (questionIndex: number, answer: string) => {\n    setSelectedAnswers(prev => ({\n      ...prev,\n      [questionIndex]: answer\n    }));\n    setRevealedAnswers(prev => ({\n      ...prev,\n      [questionIndex]: true\n    }));\n  };\n\n  const correctCount = questions.reduce((count, question, index) => {\n    if (revealedAnswers[index] && selectedAnswers[index] === question.correctAnswer) {\n      return count + 1;\n    }\n    return count;\n  }, 0);\n\n  const totalAnswered = Object.keys(revealedAnswers).length;\n  const allAnswered = totalAnswered === questions.length;\n\n  // Submit quiz results when all questions are answered (only if shouldSaveResults is true)\n  useEffect(() => {\n    if (allAnswered && !submitted && !submitQuizMutation.isPending && shouldSaveResults) {\n      const results = questions.map((question, index) => ({\n        questionText: question.question,\n        userAnswer: selectedAnswers[index],\n        correctAnswer: question.correctAnswer,\n        isCorrect: selectedAnswers[index] === question.correctAnswer,\n      }));\n\n      submitQuizMutation.mutate(results);\n    } else if (allAnswered && !submitted && !shouldSaveResults) {\n      // Mark as submitted without saving to database\n      setSubmitted(true);\n    }\n  }, [allAnswered, submitted, questions, selectedAnswers, submitQuizMutation, shouldSaveResults]);\n\n  return (\n    <Card className=\"bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center gap-2\">\n          <Brain className=\"w-5 h-5 text-primary\" />\n          <CardTitle className=\"text-lg\">ðŸ“ Flash Quiz - Test Your Knowledge</CardTitle>\n        </div>\n        <CardDescription>\n          Based on the topics we've discussed. Select your answers to see immediate feedback!\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {questions.map((question, questionIndex) => {\n          const isRevealed = revealedAnswers[questionIndex];\n          const selectedAnswer = selectedAnswers[questionIndex];\n          const isCorrect = selectedAnswer === question.correctAnswer;\n\n          return (\n            <div\n              key={questionIndex}\n              className=\"p-4 rounded-lg bg-background border border-border\"\n              data-testid={`quiz-question-${questionIndex}`}\n            >\n              <h4 className=\"font-semibold mb-3 text-sm\">\n                {questionIndex + 1}. {question.question}\n              </h4>\n              \n              <div className=\"space-y-2 mb-3\">\n                {Object.entries(question.options).map(([optionKey, optionText]) => {\n                  const isSelected = selectedAnswer === optionKey;\n                  const isCorrectOption = optionKey === question.correctAnswer;\n                  \n                  let buttonVariant: \"outline\" | \"default\" | \"destructive\" | \"secondary\" = \"outline\";\n                  let extraClasses = \"\";\n                  \n                  if (isRevealed) {\n                    if (isCorrectOption) {\n                      buttonVariant = \"default\";\n                      extraClasses = \"bg-green-500 hover:bg-green-600 text-white border-green-500\";\n                    } else if (isSelected && !isCorrect) {\n                      buttonVariant = \"destructive\";\n                    }\n                  } else if (isSelected) {\n                    buttonVariant = \"secondary\";\n                  }\n\n                  return (\n                    <Button\n                      key={optionKey}\n                      variant={buttonVariant}\n                      className={`w-full justify-start text-left h-auto py-3 ${extraClasses}`}\n                      onClick={() => !isRevealed && handleAnswerSelect(questionIndex, optionKey)}\n                      disabled={isRevealed}\n                      data-testid={`quiz-option-${questionIndex}-${optionKey}`}\n                    >\n                      <span className=\"font-bold mr-2\">{optionKey}.</span>\n                      <span className=\"flex-1\">{optionText}</span>\n                      {isRevealed && isCorrectOption && (\n                        <CheckCircle2 className=\"w-4 h-4 ml-2\" />\n                      )}\n                      {isRevealed && isSelected && !isCorrect && (\n                        <XCircle className=\"w-4 h-4 ml-2\" />\n                      )}\n                    </Button>\n                  );\n                })}\n              </div>\n\n              {isRevealed && (\n                <div className={`p-3 rounded-md text-sm ${\n                  isCorrect \n                    ? \"bg-green-50 dark:bg-green-950/20 text-green-900 dark:text-green-100 border border-green-200 dark:border-green-900\" \n                    : \"bg-red-50 dark:bg-red-950/20 text-red-900 dark:text-red-100 border border-red-200 dark:border-red-900\"\n                }`}>\n                  <div className=\"flex items-start gap-2\">\n                    {isCorrect ? (\n                      <CheckCircle2 className=\"w-4 h-4 mt-0.5 flex-shrink-0\" />\n                    ) : (\n                      <XCircle className=\"w-4 h-4 mt-0.5 flex-shrink-0\" />\n                    )}\n                    <div>\n                      <p className=\"font-semibold mb-1\">\n                        {isCorrect ? \"Correct!\" : `Incorrect. The correct answer is ${question.correctAnswer}.`}\n                      </p>\n                      <p className=\"text-xs opacity-90\">{question.explanation}</p>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          );\n        })}\n\n        {allAnswered && (\n          <div className=\"mt-4 p-4 rounded-lg bg-primary/10 border border-primary/20 text-center\">\n            <p className=\"text-lg font-semibold\">\n              ðŸŽ‰ Quiz Complete! You scored {correctCount}/{questions.length}\n            </p>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              {correctCount === questions.length \n                ? \"Perfect score! You've mastered these concepts!\" \n                : correctCount >= questions.length * 0.7 \n                  ? \"Great job! You have a solid understanding.\" \n                  : \"Good effort! Review the explanations to strengthen your knowledge.\"}\n            </p>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":8414},"client/src/types/quiz.ts":{"content":"export interface QuizQuestion {\n  question: string;\n  options: {\n    A: string;\n    B: string;\n    C: string;\n    D: string;\n  };\n  correctAnswer: \"A\" | \"B\" | \"C\" | \"D\";\n  explanation: string;\n}\n\nexport interface QuizData {\n  id: number;\n  questions: QuizQuestion[];\n}\n","size_bytes":269},"client/src/components/quiz-assessment.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { CheckCircle, XCircle, ArrowLeft, ArrowRight } from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\n\ninterface QuizQuestion {\n  id: number;\n  category: string;\n  topic: string;\n  difficulty: string;\n  questionText: string;\n  optionA: string;\n  optionB: string;\n  optionC: string;\n  optionD: string;\n  correctAnswer: string;\n  explanation: string;\n  questionType: string;\n  createdAt: string;\n}\n\ninterface QuizAssessmentProps {\n  topic: string;\n  onBack: () => void;\n}\n\nexport default function QuizAssessment({ topic, onBack }: QuizAssessmentProps) {\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [selectedAnswers, setSelectedAnswers] = useState<Record<number, string>>({});\n  const [showResults, setShowResults] = useState(false);\n  const [submitted, setSubmitted] = useState(false);\n\n  const { data: questions, isLoading } = useQuery<QuizQuestion[]>({\n    queryKey: [\"/api/quiz/questions\", topic],\n    queryFn: async () => {\n      const response = await fetch(`/api/quiz/questions/${encodeURIComponent(topic)}`);\n      if (!response.ok) throw new Error(\"Failed to fetch questions\");\n      return response.json();\n    },\n  });\n\n  const submitQuizMutation = useMutation({\n    mutationFn: async (data: {\n      topic: string;\n      category: string;\n      score: number;\n      totalQuestions: number;\n      correctAnswers: number;\n    }) => {\n      return apiRequest(\"/api/quiz/submit\", \"POST\", data);\n    },\n    onSuccess: () => {\n      // Invalidate mastery query to update the status bar\n      queryClient.invalidateQueries({ queryKey: [\"/api/mastery\"] });\n    },\n  });\n\n  // Submit quiz results when showing results for the first time\n  useEffect(() => {\n    console.log(\"ðŸ” useEffect triggered:\", { showResults, submitted, questionsLength: questions?.length });\n    if (showResults && !submitted && questions && questions.length > 0) {\n      const score = calculateScore();\n      const category = questions[0].category; // All questions have the same category\n      \n      console.log(\"ðŸ“¤ Submitting quiz:\", {\n        topic,\n        category,\n        score: Math.round(score.percentage),\n        totalQuestions: questions.length,\n        correctAnswers: score.correct,\n      });\n      \n      submitQuizMutation.mutate({\n        topic,\n        category,\n        score: Math.round(score.percentage),\n        totalQuestions: questions.length,\n        correctAnswers: score.correct,\n      });\n      \n      setSubmitted(true);\n      console.log(\"âœ… Marked as submitted\");\n    }\n  }, [showResults, submitted, questions, topic, selectedAnswers]);\n\n  const calculateScore = () => {\n    if (!questions || questions.length === 0) {\n      return { correct: 0, total: 0, percentage: 0 };\n    }\n    let correct = 0;\n    questions.forEach((q, index) => {\n      const userAnswer = selectedAnswers[index];\n      const correctAnswer = q.correctAnswer.toLowerCase();\n      if (userAnswer && userAnswer.toLowerCase() === correctAnswer) {\n        correct++;\n      }\n    });\n    return { correct, total: questions.length, percentage: (correct / questions.length) * 100 };\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <Skeleton className=\"h-8 w-64 mb-6\" />\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-full mb-2\" />\n            <Skeleton className=\"h-4 w-3/4\" />\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {[1, 2, 3, 4].map((i) => (\n              <Skeleton key={i} className=\"h-12 w-full\" />\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!questions || questions.length === 0) {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <Button variant=\"ghost\" onClick={onBack} className=\"mb-4\" data-testid=\"button-back\">\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\n          Back to Quizzes\n        </Button>\n        <Card>\n          <CardContent className=\"p-8 text-center\">\n            <p className=\"text-muted-foreground\">No questions available for this topic.</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const currentQuestion = questions[currentQuestionIndex];\n  const selectedAnswer = selectedAnswers[currentQuestionIndex];\n  const progress = ((currentQuestionIndex + 1) / questions.length) * 100;\n\n  const handleAnswerSelect = (answer: string) => {\n    setSelectedAnswers((prev) => ({ ...prev, [currentQuestionIndex]: answer }));\n  };\n\n  const handleNext = () => {\n    if (currentQuestionIndex < questions.length - 1) {\n      setCurrentQuestionIndex((prev) => prev + 1);\n    } else {\n      setShowResults(true);\n    }\n  };\n\n  const handlePrevious = () => {\n    if (currentQuestionIndex > 0) {\n      setCurrentQuestionIndex((prev) => prev - 1);\n    }\n  };\n\n  if (showResults) {\n    const score = calculateScore();\n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <Card className=\"border-2 border-primary/20\">\n          <CardHeader className=\"text-center pb-4\">\n            <CardTitle className=\"text-2xl mb-2\">Quiz Complete!</CardTitle>\n            <div className=\"text-6xl font-bold text-primary mb-4\">\n              {score.percentage.toFixed(0)}%\n            </div>\n            <p className=\"text-lg text-muted-foreground\">\n              You answered {score.correct} out of {score.total} questions correctly\n            </p>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"p-4 rounded-lg bg-muted\">\n              <h3 className=\"font-semibold mb-3\">Your Answers:</h3>\n              <div className=\"space-y-3\">\n                {questions.map((q, index) => {\n                  const userAnswer = selectedAnswers[index];\n                  const correctAnswerKey = q.correctAnswer.toLowerCase();\n                  const isCorrect = userAnswer && userAnswer.toLowerCase() === correctAnswerKey;\n                  \n                  const getOptionText = (key: string) => {\n                    switch(key.toLowerCase()) {\n                      case 'a': return q.optionA;\n                      case 'b': return q.optionB;\n                      case 'c': return q.optionC;\n                      case 'd': return q.optionD;\n                      default: return key;\n                    }\n                  };\n                  \n                  return (\n                    <div key={index} className=\"flex items-start gap-3 p-3 rounded-lg bg-background\">\n                      <div className=\"flex-shrink-0 mt-0.5\">\n                        {isCorrect ? (\n                          <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                        ) : (\n                          <XCircle className=\"w-5 h-5 text-red-600\" />\n                        )}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm font-medium mb-1\">\n                          Question {index + 1}: {q.questionText}\n                        </p>\n                        {!isCorrect && (\n                          <div className=\"text-xs space-y-1\">\n                            <p className=\"text-red-600\">\n                              Your answer: {userAnswer ? `${userAnswer.toUpperCase()}. ${getOptionText(userAnswer)}` : \"Not answered\"}\n                            </p>\n                            <p className=\"text-green-600\">\n                              Correct answer: {correctAnswerKey.toUpperCase()}. {getOptionText(correctAnswerKey)}\n                            </p>\n                            {q.explanation && (\n                              <p className=\"text-muted-foreground mt-2\">{q.explanation}</p>\n                            )}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n            <div className=\"flex gap-3\">\n              <Button onClick={onBack} variant=\"outline\" className=\"flex-1\" data-testid=\"button-back-to-quizzes\">\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Back to Quizzes\n              </Button>\n              <Button\n                onClick={() => {\n                  setCurrentQuestionIndex(0);\n                  setSelectedAnswers({});\n                  setShowResults(false);\n                  setSubmitted(false);\n                }}\n                className=\"flex-1\"\n                data-testid=\"button-retake\"\n              >\n                Retake Quiz\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const options = [\n    { label: \"A\", value: currentQuestion.optionA },\n    { label: \"B\", value: currentQuestion.optionB },\n    { label: \"C\", value: currentQuestion.optionC },\n    { label: \"D\", value: currentQuestion.optionD },\n  ];\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6\">\n      <div className=\"mb-6\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <Button variant=\"ghost\" onClick={onBack} size=\"sm\" data-testid=\"button-back\">\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back\n          </Button>\n          <span className=\"text-sm text-muted-foreground\">\n            Question {currentQuestionIndex + 1} of {questions.length}\n          </span>\n        </div>\n        <Progress value={progress} className=\"h-2\" />\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"text-xs px-2 py-1 rounded-full bg-primary/10 text-primary font-medium\">\n              {currentQuestion.difficulty}\n            </span>\n            <span className=\"text-xs text-muted-foreground\">{topic}</span>\n          </div>\n          <CardTitle className=\"text-lg leading-relaxed\">{currentQuestion.questionText}</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-3\">\n          {options.map((option) => (\n            <button\n              key={option.label}\n              onClick={() => handleAnswerSelect(option.label)}\n              className={`w-full p-4 text-left rounded-lg border-2 transition-all ${\n                selectedAnswer === option.label\n                  ? \"border-primary bg-primary/10\"\n                  : \"border-border hover:border-primary/50\"\n              }`}\n              data-testid={`option-${option.label.toLowerCase()}`}\n            >\n              <div className=\"flex items-start gap-3\">\n                <span className=\"font-semibold text-primary\">{option.label}.</span>\n                <span className=\"flex-1\">{option.value}</span>\n              </div>\n            </button>\n          ))}\n\n          <div className=\"flex justify-between pt-4\">\n            <Button\n              variant=\"outline\"\n              onClick={handlePrevious}\n              disabled={currentQuestionIndex === 0}\n              data-testid=\"button-previous\"\n            >\n              Previous\n            </Button>\n            <Button\n              onClick={handleNext}\n              disabled={!selectedAnswer}\n              data-testid=\"button-next\"\n            >\n              {currentQuestionIndex === questions.length - 1 ? \"Finish\" : \"Next\"}\n              <ArrowRight className=\"w-4 h-4 ml-2\" />\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":11762},"client/src/pages/rfp.tsx":{"content":"import { FileSpreadsheet, FileText, ArrowLeft } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \"@/components/ui/tabs\";\nimport UploadRequirements from \"@/pages/rfp/UploadRequirements\";\nimport ViewData from \"@/pages/rfp/ViewData\";\nimport { useLocation } from \"wouter\";\n\nexport default function RfpPage() {\n  const [, setLocation] = useLocation();\n  return (\n    <div className=\"flex-1 flex flex-col bg-background\">\n      {/* Header */}\n      <header className=\"border-b border-border bg-card/30 backdrop-blur-sm px-6 py-2.5\">\n        <div className=\"flex items-center gap-3\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setLocation(\"/workshop\")}\n            className=\"flex items-center gap-2\"\n            data-testid=\"button-back-to-launchpad\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n            Back to Launchpad\n          </Button>\n          <FileText className=\"w-5 h-5 text-primary\" />\n          <div>\n            <h1 className=\"text-xl font-bold text-foreground\" data-testid=\"text-rfp-title\">\n              RFP Response Generator\n            </h1>\n            <p className=\"text-xs text-muted-foreground\">\n              Upload requirements and generate AI-powered RFP responses\n            </p>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <div className=\"flex-1 overflow-auto p-6\">\n        <Tabs defaultValue=\"upload\" className=\"w-full\">\n          <TabsList className=\"grid w-full max-w-md mx-auto grid-cols-2 mb-6\">\n            <TabsTrigger value=\"upload\" className=\"flex items-center gap-2\" data-testid=\"tab-upload\">\n              <FileSpreadsheet className=\"w-4 h-4\" />\n              Upload Requirements\n            </TabsTrigger>\n            <TabsTrigger value=\"view\" className=\"flex items-center gap-2\" data-testid=\"tab-view\">\n              <FileText className=\"w-4 h-4\" />\n              View Responses\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"upload\" className=\"mt-0\">\n            <UploadRequirements />\n          </TabsContent>\n\n          <TabsContent value=\"view\" className=\"mt-0\">\n            <ViewData />\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","size_bytes":2317},"client/src/components/rfp-templates/StandardTemplate.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { RfpFormData } from \"@/lib/types\";\n\ninterface StandardTemplateProps {\n  data: RfpFormData;\n}\n\nexport default function StandardTemplate({ data }: StandardTemplateProps) {\n  const formatDate = (dateString: string) => {\n    if (!dateString) return '';\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  };\n\n  const currentDate = new Date().toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric'\n  });\n\n  return (\n    <div className=\"space-y-6 p-6 bg-white rounded-lg shadow-sm\">\n      {/* Header */}\n      <div className=\"border-b pb-6\">\n        <h1 className=\"text-3xl font-bold text-center mb-2\">{data.rfpTitle}</h1>\n        <h2 className=\"text-xl text-center text-gray-600 mb-4\">Response to Request for Proposal</h2>\n        <div className=\"grid grid-cols-2 gap-4 text-sm\">\n          <div>\n            <p><strong>Submitted By:</strong> {data.companyName}</p>\n            <p><strong>Contact Person:</strong> {data.pointOfContact}</p>\n          </div>\n          <div className=\"text-right\">\n            <p><strong>Submitted To:</strong> {data.clientName}</p>\n            <p><strong>Date:</strong> {currentDate}</p>\n            <p><strong>RFP ID:</strong> {data.rfpId}</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Executive Summary */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Executive Summary</h3>\n        <p className=\"text-gray-700\">\n          {data.companyName} is pleased to submit this proposal in response to {data.clientName}'s \n          Request for Proposal for {data.rfpTitle}. We understand the importance of this project and are \n          committed to delivering a solution that meets all of your requirements and expectations.\n        </p>\n        <p className=\"text-gray-700 mt-2\">\n          As a leading provider in the {data.clientIndustry} industry, we bring extensive expertise and \n          a proven track record of success to this project. Our approach combines innovative thinking with \n          practical implementation strategies to ensure your objectives are met efficiently and effectively.\n        </p>\n      </section>\n\n      {/* Company Background */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Company Background</h3>\n        <p className=\"text-gray-700\">\n          {data.companyName} has established itself as a trusted partner for organizations seeking \n          {data.rfpTitle.toLowerCase().includes(\"implementation\") ? \" implementation services\" : \n          data.rfpTitle.toLowerCase().includes(\"development\") ? \" development solutions\" : \n          \" professional services\"} in the {data.clientIndustry} sector.\n        </p>\n        <p className=\"text-gray-700 mt-2\">\n          Our key strengths include:\n        </p>\n        <ul className=\"list-disc pl-6 mt-1 text-gray-700\">\n          {data.companyStrengths ? \n            data.companyStrengths.split('\\n').map((strength, index) => \n              <li key={index}>{strength}</li>\n            ) : \n            <li>Tailored solutions designed to meet specific client needs</li>\n          }\n        </ul>\n      </section>\n\n      {/* Understanding of Requirements */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Understanding of Requirements</h3>\n        <p className=\"text-gray-700\">\n          Based on your RFP, we understand that {data.clientName} is seeking a partner to help with:\n        </p>\n        <p className=\"text-gray-700 mt-2\">\n          {data.projectSummary}\n        </p>\n      </section>\n\n      {/* Proposed Solution */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Proposed Solution</h3>\n        <p className=\"text-gray-700\">\n          To address your needs, {data.companyName} proposes a comprehensive solution that includes:\n        </p>\n        <ul className=\"list-disc pl-6 mt-2 text-gray-700\">\n          <li>Detailed analysis of current processes and requirements</li>\n          <li>Custom development tailored to your specific needs</li>\n          <li>Integration with existing systems and workflows</li>\n          <li>Rigorous testing to ensure quality and performance</li>\n          <li>Comprehensive training and documentation</li>\n          <li>Ongoing support and maintenance</li>\n        </ul>\n      </section>\n\n      {/* Implementation Approach */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Implementation Approach</h3>\n        <p className=\"text-gray-700\">\n          Our implementation methodology follows industry best practices and includes the following phases:\n        </p>\n        <ol className=\"list-decimal pl-6 mt-2 text-gray-700\">\n          <li><strong>Discovery:</strong> Detailed requirements gathering and analysis</li>\n          <li><strong>Planning:</strong> Comprehensive project planning and resource allocation</li>\n          <li><strong>Design:</strong> Solution architecture and design</li>\n          <li><strong>Implementation:</strong> Development and configuration</li>\n          <li><strong>Testing:</strong> Quality assurance and user acceptance testing</li>\n          <li><strong>Deployment:</strong> Controlled rollout of the solution</li>\n          <li><strong>Support:</strong> Post-implementation support and maintenance</li>\n        </ol>\n      </section>\n\n      {/* Timeline */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Timeline</h3>\n        <p className=\"text-gray-700\">\n          We propose the following high-level timeline for this project:\n        </p>\n        <ul className=\"list-disc pl-6 mt-2 text-gray-700\">\n          <li><strong>Discovery & Planning:</strong> 2-3 weeks</li>\n          <li><strong>Design & Development:</strong> 6-8 weeks</li>\n          <li><strong>Testing & Quality Assurance:</strong> 2-3 weeks</li>\n          <li><strong>Deployment & Training:</strong> 2 weeks</li>\n          <li><strong>Post-Implementation Support:</strong> Ongoing</li>\n        </ul>\n        <p className=\"text-gray-700 mt-2\">\n          We are committed to meeting your deadline of {formatDate(data.submissionDate)}.\n        </p>\n      </section>\n\n      {/* Pricing */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Pricing</h3>\n        <p className=\"text-gray-700\">\n          Based on the information provided in the RFP, we estimate the following investment for this project:\n        </p>\n        <div className=\"mt-2 border rounded-md p-4\">\n          <p className=\"text-gray-700\">\n            <strong>Budget Range:</strong> {\n              data.budgetRange === 'under_50k' ? 'Under $50,000' : \n              data.budgetRange === '50k_100k' ? '$50,000 - $100,000' :\n              data.budgetRange === '100k_250k' ? '$100,000 - $250,000' :\n              data.budgetRange === '250k_500k' ? '$250,000 - $500,000' :\n              data.budgetRange === 'over_500k' ? 'Over $500,000' :\n              'To be determined based on final scope'\n            }\n          </p>\n          <p className=\"text-gray-700 mt-1\">\n            <strong>Payment Terms:</strong> 30% upon project initiation, 40% at midpoint milestones, 30% upon completion\n          </p>\n        </div>\n        <p className=\"text-gray-700 mt-2\">\n          A detailed cost breakdown will be provided upon request.\n        </p>\n      </section>\n\n      {/* Closing */}\n      <section className=\"border-t pt-6\">\n        <h3 className=\"text-xl font-bold mb-3\">Conclusion</h3>\n        <p className=\"text-gray-700\">\n          {data.companyName} appreciates the opportunity to submit this proposal and looks forward to \n          the possibility of working with {data.clientName} on this important project. We are confident \n          in our ability to deliver a solution that exceeds your expectations and provides lasting value \n          to your organization.\n        </p>\n        <p className=\"text-gray-700 mt-4\">\n          <strong>Contact:</strong> For any questions or clarifications regarding this proposal, \n          please contact {data.pointOfContact}.\n        </p>\n      </section>\n    </div>\n  );\n}\n","size_bytes":8210},"RFP_RAG_IMPLEMENTATION_ROADMAP.md":{"content":"# RFP RAG Implementation Roadmap\n\n## Overview\nThis document outlines the implementation steps for the **Two-Tier RAG (Retrieval-Augmented Generation)** system for RFP response generation. The database infrastructure is now complete and ready for historical RFP data and RAG implementation.\n\n---\n\n## âœ… Phase 1: Database Infrastructure (COMPLETED)\n\n### What Was Built:\n1. **`historical_rfps` Table** in PostgreSQL with:\n   - Metadata fields: `rfpName`, `clientName`, `clientIndustry`, `submissionDate`\n   - Content fields: `category`, `requirement`, `response`\n   - Quality metrics: `successScore` (1-5), `responseQuality` (\"excellent\", \"good\", \"average\")\n   - **pgvector embedding column** (1536 dimensions for OpenAI embeddings)\n   - Tracking fields: `uploadedBy`, `createdAt`\n\n2. **Storage Interface Methods** (in `server/storage.ts`):\n   - `getAllHistoricalRfps()` - Get all historical RFPs\n   - `getHistoricalRfpById(id)` - Get specific RFP by ID\n   - `createHistoricalRfp(rfp)` - Add new historical RFP\n   - `updateHistoricalRfp(id, updates)` - Update existing RFP\n   - `deleteHistoricalRfp(id)` - Remove historical RFP\n   - `searchHistoricalRfpsBySimilarity(embedding, topK)` - **Vector similarity search** using pgvector\n\n3. **pgvector Extension** - Enabled in PostgreSQL for vector operations\n\n---\n\n## ðŸš€ Phase 2: Populate Historical RFPs (NEXT STEP - User Action Required)\n\n### What You Need:\nPrepare 10-50 past RFP responses in Excel/CSV format with these columns:\n- `rfp_name` - Name/title of the RFP (e.g., \"Client Proposal 2025\")\n- `client_name` - Client company name (optional)\n- `client_industry` - Industry vertical (e.g., \"Financial Services\", \"Healthcare\")\n- `submission_date` - Date RFP was submitted\n- `category` - RFP category/section (e.g., \"Technical Capabilities\", \"Team Structure\")\n- `requirement` - The actual RFP question/requirement\n- `response` - Your company's approved response that was used\n- `success_score` - Rating 1-5 (Did you win? 5=Won, 3=Shortlisted, 1=Lost)\n- `response_quality` - Quality assessment (\"excellent\", \"good\", \"average\")\n- `uploaded_by` - Person who uploaded (for tracking)\n\n### Implementation Steps:\n\n#### Step 1: Create Admin Upload Interface\nBuild a simple UI page (similar to current RFP upload) that allows:\n- Excel/CSV file upload for historical RFPs\n- Preview of parsed data before insertion\n- Validation of required fields\n- Batch processing with progress indicator\n\n**Frontend:** `client/src/pages/rfp/UploadHistoricalRfps.tsx`\n**Backend Endpoint:** `POST /api/historical-rfps/upload`\n\n#### Step 2: Generate Embeddings During Upload\nWhen processing each historical RFP:\n```typescript\n// server/embeddings.ts (new file to create)\nimport OpenAI from \"openai\";\n\nconst openai = new OpenAI({\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY\n});\n\nexport async function generateEmbedding(text: string): Promise<number[]> {\n  const response = await openai.embeddings.create({\n    model: \"text-embedding-3-small\", // 1536 dimensions, $0.02 per 1M tokens\n    input: text,\n  });\n  return response.data[0].embedding;\n}\n\n// Combine requirement + category for better semantic matching\nexport async function generateRfpEmbedding(\n  category: string, \n  requirement: string\n): Promise<number[]> {\n  const combinedText = `Category: ${category}\\nRequirement: ${requirement}`;\n  return generateEmbedding(combinedText);\n}\n```\n\n#### Step 3: Batch Insert with Embeddings\n```typescript\n// In server/routes.ts\napp.post(\"/api/historical-rfps/upload\", async (req, res) => {\n  const { rfps } = req.body; // Array of RFP objects from Excel\n  \n  const insertedRfps = [];\n  \n  for (const rfp of rfps) {\n    // Generate embedding\n    const embedding = await generateRfpEmbedding(rfp.category, rfp.requirement);\n    \n    // Insert into database\n    const inserted = await storage.createHistoricalRfp({\n      ...rfp,\n      embedding: JSON.stringify(embedding) // Store as JSON string\n    });\n    \n    insertedRfps.push(inserted);\n  }\n  \n  res.json({ success: true, count: insertedRfps.length });\n});\n```\n\n---\n\n## ðŸ” Phase 3: Implement Two-Tier RAG Retrieval\n\n### Architecture:\n```\nIncoming RFP Requirement\n    â†“\n[Generate Embedding for Requirement]\n    â†“\nTIER 1: Search Historical RFPs (PostgreSQL + pgvector)\n    â†“\nSimilarity > 0.75 Threshold?\n    â”œâ”€ YES â†’ Use Historical RFPs as Context\n    â””â”€ NO  â†’ TIER 2: Query EKG Service\n              â†“\n         Retrieve Knowledge Graph Data\n    â†“\nCombine Retrieved Context + OpenAI GPT-5\n    â†“\nGenerate Knowledge-Grounded Response with Citations\n```\n\n### Implementation Steps:\n\n#### Step 1: Create Embedding Service\nCreate `server/embeddings.ts` (as shown in Phase 2, Step 2 above)\n\n#### Step 2: Update `/api/generate-response` Endpoint\n```typescript\n// In server/routes.ts\napp.post(\"/api/generate-response\", async (req, res) => {\n  const { requirement_id, model } = req.body;\n  \n  // 1. Get requirement from database\n  const requirement = await storage.getRfpResponseById(parseInt(requirement_id));\n  if (!requirement) return res.status(404).json({ error: \"Not found\" });\n  \n  // 2. Generate embedding for the requirement\n  const { generateRfpEmbedding } = await import(\"./embeddings\");\n  const embedding = await generateRfpEmbedding(\n    requirement.category, \n    requirement.requirement\n  );\n  \n  // 3. TIER 1: Search historical RFPs\n  const historicalMatches = await storage.searchHistoricalRfpsBySimilarity(\n    embedding, \n    5 // Top 5 matches\n  );\n  \n  const SIMILARITY_THRESHOLD = 0.75;\n  const highQualityMatches = historicalMatches.filter(\n    m => m.similarity >= SIMILARITY_THRESHOLD\n  );\n  \n  let context = \"\";\n  let source = \"\";\n  \n  if (highQualityMatches.length > 0) {\n    // TIER 1: Use historical RFPs\n    source = \"historical\";\n    context = buildHistoricalContext(highQualityMatches);\n  } else {\n    // TIER 2: Fallback to EKG service\n    source = \"ekg\";\n    context = await queryEKGService(requirement.requirement, requirement.category);\n  }\n  \n  // 4. Generate response with context\n  const { default: OpenAI } = await import(\"openai\");\n  const openai = new OpenAI({\n    baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n    apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY\n  });\n  \n  const prompt = buildContextualPrompt(requirement, context, source);\n  \n  const response = await openai.chat.completions.create({\n    model: \"gpt-5\",\n    messages: [{ role: \"user\", content: prompt }],\n    max_completion_tokens: 8192,\n    temperature: 0.7, // Lower for more consistent responses\n  });\n  \n  const generatedResponse = response.choices[0]?.message?.content || \"\";\n  \n  // 5. Update database with generated response and metadata\n  await storage.updateRfpResponse(parseInt(requirement_id), {\n    finalResponse: generatedResponse,\n    modelProvider: \"openai\",\n    // Store which tier was used (could add a new column)\n  });\n  \n  res.json({ \n    success: true,\n    response: generatedResponse,\n    source, // \"historical\" or \"ekg\"\n    similarityMatches: highQualityMatches.length,\n  });\n});\n```\n\n#### Step 3: Helper Functions\n\n**Build Historical Context:**\n```typescript\nfunction buildHistoricalContext(matches: Array<HistoricalRfp & { similarity: number }>): string {\n  const examples = matches.map((match, i) => `\nExample ${i+1} (Similarity: ${(match.similarity * 100).toFixed(1)}%, Success Score: ${match.successScore}/5):\nRFP: ${match.rfpName} (${match.clientIndustry})\nCategory: ${match.category}\nRequirement: ${match.requirement}\nOur Past Response: ${match.response}\n---`).join('\\n');\n  \n  return examples;\n}\n```\n\n**Build Contextual Prompt:**\n```typescript\nfunction buildContextualPrompt(\n  requirement: ExcelRequirementResponse,\n  context: string,\n  source: \"historical\" | \"ekg\"\n): string {\n  if (source === \"historical\") {\n    return `You are an expert RFP response writer for a wealth management company.\n\nSIMILAR PAST RFP RESPONSES (Use these as reference):\n${context}\n\nNEW REQUIREMENT TO ANSWER:\nCategory: ${requirement.category}\nRequirement: ${requirement.requirement}\n\nInstructions:\n1. Study the similar past responses above\n2. Adapt the best elements to this new requirement\n3. Maintain consistency with our proven approach\n4. Write a professional, comprehensive response (200-400 words)\n5. Do NOT copy verbatim - adapt and improve\n\nWrite the response now:`;\n  } else {\n    return `You are an expert RFP response writer for a wealth management company.\n\nRELEVANT KNOWLEDGE FROM OUR SYSTEMS:\n${context}\n\nNEW REQUIREMENT TO ANSWER:\nCategory: ${requirement.category}\nRequirement: ${requirement.requirement}\n\nInstructions:\n1. Use the knowledge above to ground your response\n2. Reference specific capabilities mentioned\n3. Maintain professional, confident tone\n4. Write 200-400 words\n\nWrite the response now:`;\n  }\n}\n```\n\n**Query EKG Service (Tier 2 Fallback):**\n```typescript\nasync function queryEKGService(requirement: string, category: string): Promise<string> {\n  try {\n    const response = await fetch(\n      \"https://ekg-service-47249889063.europe-west6.run.app/v1/answer\",\n      {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          question: `${category}: ${requirement}`,\n          chat_history: [],\n          model: \"openai\",\n          temperature: 0.7,\n        })\n      }\n    );\n    \n    const data = await response.json();\n    \n    // Format EKG response with sources\n    let context = data.answer || \"\";\n    \n    if (data.sources && data.sources.length > 0) {\n      context += \"\\n\\nSOURCES:\\n\";\n      data.sources.forEach((src: any) => {\n        context += `- ${src.filename} (Relevance: ${src.score})\\n`;\n      });\n    }\n    \n    return context;\n  } catch (error) {\n    console.error(\"EKG service error:\", error);\n    return \"\"; // Fallback to no context if EKG fails\n  }\n}\n```\n\n---\n\n## ðŸ“Š Phase 4: Testing & Refinement\n\n### Testing Checklist:\n1. **Upload 5-10 historical RFPs** with embeddings\n2. **Test similarity search** with known requirements\n3. **Verify threshold logic** (0.75 cutoff)\n4. **Test Tier 1** (historical matches) - should use past responses\n5. **Test Tier 2** (no matches) - should query EKG service\n6. **Compare response quality** between tiers\n7. **Monitor API costs** (OpenAI embeddings + GPT-5 generation)\n\n### Tuning Parameters:\n- **Similarity Threshold**: Adjust 0.75 threshold (test 0.70-0.85 range)\n- **Top-K Matches**: Try different values (3, 5, 10)\n- **Temperature**: Adjust for creativity vs consistency (0.5-1.0)\n- **Context Window**: How many past responses to include\n\n### Metrics to Track:\n- Which tier is used more often (historical vs EKG)\n- Response quality ratings by tier\n- API costs per response\n- Generation time per tier\n\n---\n\n## ðŸŽ¯ Success Criteria\n\n### System is ready when:\n1. âœ… Database can store 10-50 historical RFPs with embeddings\n2. âœ… Vector similarity search returns relevant past responses\n3. âœ… Tier 1 (historical) generates quality responses for similar requirements\n4. âœ… Tier 2 (EKG) provides fallback for novel requirements\n5. âœ… Response quality improves over baseline (current simple prompts)\n6. âœ… System tracks which tier was used for analytics\n\n---\n\n## ðŸ’° Cost Estimates\n\n### OpenAI Pricing (as of 2025):\n- **Embeddings** (text-embedding-3-small): $0.02 per 1M tokens\n  - Average requirement: ~100 tokens\n  - 50 historical RFPs: ~5,000 tokens = $0.0001 (one-time)\n  - Each new requirement: ~100 tokens = negligible\n\n- **GPT-5 Generation**: ~$0.10-$0.50 per response (depending on context length)\n  - Tier 1 (historical): Lower cost (shorter context)\n  - Tier 2 (EKG): Higher cost (knowledge graph retrieval)\n\n### Estimated Monthly Costs (100 RFP responses):\n- Embeddings: <$1\n- GPT-5 Generation: $10-$50\n- **Total: ~$15-$60/month** for 100 responses\n\n---\n\n## ðŸ“ Files to Create/Modify\n\n### New Files:\n- `server/embeddings.ts` - Embedding generation service\n- `client/src/pages/rfp/UploadHistoricalRfps.tsx` - Admin upload UI\n- `RFP_RAG_IMPLEMENTATION_ROADMAP.md` - This document\n\n### Files to Modify:\n- `server/routes.ts` - Update `/api/generate-response` endpoint\n- `client/src/pages/rfp.tsx` - Add \"Upload Historical RFPs\" tab (optional)\n\n### Existing Infrastructure (Ready to Use):\n- âœ… `shared/schema.ts` - `historicalRfps` table defined\n- âœ… `server/storage.ts` - CRUD methods implemented\n- âœ… PostgreSQL database - pgvector extension enabled\n\n---\n\n## ðŸš€ Quick Start (When Ready)\n\n1. **Prepare your historical RFPs** in Excel with required columns\n2. **Create embedding service** (`server/embeddings.ts`)\n3. **Build upload interface** for historical RFPs\n4. **Update generate-response endpoint** with two-tier RAG logic\n5. **Test with real requirements** and refine thresholds\n6. **Monitor performance** and iterate\n\n---\n\n## ðŸ“ž Need Help?\n\nIf you encounter issues:\n1. Check database connection (pgvector enabled?)\n2. Verify OpenAI integration (embeddings working?)\n3. Test similarity search (returning results?)\n4. Review EKG service response format\n5. Check logs for API errors\n\nThe foundation is built and ready. Just add your historical RFP data and implement the retrieval logic when you're ready!\n","size_bytes":13171},"client/src/hooks/useRfpForm.ts":{"content":"import { useEffect, useState } from 'react';\nimport { RfpFormData } from '@/lib/types';\nimport { useLocation } from 'wouter';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\n\n// Initial empty form data\nconst initialData: RfpFormData = {\n  clientName: '',\n  clientIndustry: '',\n  rfpTitle: '',\n  rfpId: '',\n  submissionDate: '',\n  budgetRange: '',\n  projectSummary: '',\n  companyName: '',\n  pointOfContact: '',\n  companyStrengths: '',\n  selectedTemplate: '',\n  customizations: '',\n  generatedContent: ''\n};\n\n// Hook for managing the RFP form data across steps\nexport function useRfpForm() {\n  const [formData, setFormData] = useState<RfpFormData>(() => {\n    // Try to load from localStorage on initial render\n    const savedData = localStorage.getItem('rfpFormData');\n    return savedData ? JSON.parse(savedData) : initialData;\n  });\n  \n  const [currentStep, setCurrentStep] = useState<number>(1);\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Auto-save form data to localStorage when it changes\n  useEffect(() => {\n    localStorage.setItem('rfpFormData', JSON.stringify(formData));\n  }, [formData]);\n  \n  // Create new RFP response\n  const createRfpResponse = useMutation({\n    mutationFn: async (data: RfpFormData) => {\n      const response = await apiRequest('POST', '/api/rfp-responses', data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/rfp-responses'] });\n      toast({\n        title: \"Success!\",\n        description: \"Your RFP response has been saved.\",\n        variant: \"default\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error saving RFP response\",\n        description: error.message || \"An error occurred while saving your RFP response.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n  \n  // Update existing RFP response\n  const updateRfpResponse = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: Partial<RfpFormData> }) => {\n      const response = await apiRequest('PATCH', `/api/rfp-responses/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/rfp-responses'] });\n      toast({\n        title: \"Success!\",\n        description: \"Your RFP response has been updated.\",\n        variant: \"default\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error updating RFP response\",\n        description: error.message || \"An error occurred while updating your RFP response.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n  \n  // Update form data\n  const updateFormData = (newData: Partial<RfpFormData>) => {\n    setFormData(prevData => ({ ...prevData, ...newData }));\n  };\n  \n  // Reset form data\n  const resetForm = () => {\n    setFormData(initialData);\n    setCurrentStep(1);\n    navigate('/');\n    toast({\n      title: \"Form Reset\",\n      description: \"Started a new RFP response\",\n      variant: \"default\",\n    });\n  };\n  \n  // Save progress (already auto-saved to localStorage, but this provides user feedback)\n  const saveProgress = () => {\n    toast({\n      title: \"Progress Saved\",\n      description: \"Your progress has been saved locally\",\n      variant: \"default\",\n    });\n  };\n  \n  // Navigate to next step\n  const nextStep = () => {\n    if (currentStep < 4) {\n      setCurrentStep(prevStep => prevStep + 1);\n      \n      // Navigate to the correct route based on step\n      switch (currentStep + 1) {\n        case 1:\n          navigate('/');\n          break;\n        case 2:\n          navigate('/template-selection');\n          break;\n        case 3:\n          navigate('/generate-response');\n          break;\n        case 4:\n          navigate('/preview-export');\n          break;\n      }\n    }\n  };\n  \n  // Navigate to previous step\n  const prevStep = () => {\n    if (currentStep > 1) {\n      setCurrentStep(prevStep => prevStep - 1);\n      \n      // Navigate to the correct route based on step\n      switch (currentStep - 1) {\n        case 1:\n          navigate('/');\n          break;\n        case 2:\n          navigate('/template-selection');\n          break;\n        case 3:\n          navigate('/generate-response');\n          break;\n      }\n    }\n  };\n  \n  // Navigate to specific step\n  const goToStep = (step: number) => {\n    if (step >= 1 && step <= 4) {\n      setCurrentStep(step);\n      \n      // Navigate to the correct route based on step\n      switch (step) {\n        case 1:\n          navigate('/');\n          break;\n        case 2:\n          navigate('/template-selection');\n          break;\n        case 3:\n          navigate('/generate-response');\n          break;\n        case 4:\n          navigate('/preview-export');\n          break;\n      }\n    }\n  };\n  \n  return {\n    formData,\n    updateFormData,\n    resetForm,\n    saveProgress,\n    currentStep,\n    nextStep,\n    prevStep,\n    goToStep,\n    createRfpResponse,\n    updateRfpResponse,\n  };\n}\n","size_bytes":5116},"client/src/pages/rfp/UploadRequirements.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { \n  Upload, \n  FileText, \n  AlertTriangle, \n  Check, \n  Plus, \n  RefreshCw, \n  FileInput, \n  User\n} from \"lucide-react\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport * as XLSX from 'xlsx';\n\n// Define the structure of our parsed Excel data\ninterface ExcelRow {\n  category: string;\n  requirement: string;\n  finalResponse?: string;\n  rating?: number;\n  // timestamp is set by the database\n}\n\nexport default function UploadRequirements() {\n  const [file, setFile] = useState<File | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadStatus, setUploadStatus] = useState<{\n    type: \"success\" | \"error\" | null;\n    message: string;\n  }>({ type: null, message: \"\" });\n  const [excelData, setExcelData] = useState<ExcelRow[]>([]);\n  const [showDialog, setShowDialog] = useState(false);\n  const [recordsAdded, setRecordsAdded] = useState<number | null>(null);\n  const [rfpName, setRfpName] = useState<string>(\"\");\n  const [uploadedBy, setUploadedBy] = useState<string>(\"\");\n  \n  // Reset the form when file upload is successful\n  const resetForm = () => {\n    setFile(null);\n    setExcelData([]);\n    const fileInput = document.getElementById('file-upload') as HTMLInputElement;\n    if (fileInput) {\n      fileInput.value = '';\n    }\n  };\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const selectedFile = e.target.files?.[0];\n    if (selectedFile) {\n      // We'll accept any file type for now and do the parsing client-side\n      // In a production environment, we'd validate more strictly\n      setFile(selectedFile);\n      setUploadStatus({\n        type: \"success\",\n        message: `File \"${selectedFile.name}\" selected successfully.`,\n      });\n      // Reset records added when a new file is selected\n      setRecordsAdded(null);\n    }\n  };\n\n  const handleUpload = () => {\n    if (!file) {\n      setUploadStatus({\n        type: \"error\",\n        message: \"Please select a file first.\",\n      });\n      return;\n    }\n    \n    if (!rfpName.trim()) {\n      setUploadStatus({\n        type: \"error\",\n        message: \"Please enter an RFP name.\",\n      });\n      return;\n    }\n    \n    if (!uploadedBy.trim()) {\n      setUploadStatus({\n        type: \"error\",\n        message: \"Please enter your name in the 'Uploaded By' field.\",\n      });\n      return;\n    }\n\n    // Show dialog to confirm append or replace\n    setShowDialog(true);\n  };\n  \n  const processFile = async (replaceExisting: boolean) => {\n    setShowDialog(false);\n    setIsUploading(true);\n    \n    // Make sure we have a file\n    if (!file) {\n      setUploadStatus({\n        type: \"error\",\n        message: \"No file selected. Please select a file first.\",\n      });\n      setIsUploading(false);\n      return;\n    }\n    \n    try {\n      // Use FileReader to read the file as an ArrayBuffer\n      const reader = new FileReader();\n      \n      // Process the file once it's loaded\n      const parseExcel = () => {\n        return new Promise<ExcelRow[]>((resolve, reject) => {\n          reader.onload = (e) => {\n            try {\n              const data = new Uint8Array(e.target?.result as ArrayBuffer);\n              const workbook = XLSX.read(data, { type: 'array' });\n              \n              // Check if workbook has any sheets\n              if (workbook.SheetNames.length === 0) {\n                reject(new Error(\"The Excel file is empty. Please upload a file with data.\"));\n                return;\n              }\n              \n              // Get the first worksheet\n              const firstSheetName = workbook.SheetNames[0];\n              const worksheet = workbook.Sheets[firstSheetName];\n              \n              // Convert to JSON\n              const jsonData = XLSX.utils.sheet_to_json(worksheet) as Record<string, any>[];\n              \n              // Check if file has any records\n              if (jsonData.length === 0) {\n                reject(new Error(\"The Excel file contains no records. Please upload a file with data.\"));\n                return;\n              }\n              \n              // Validate required columns exist\n              const requiredColumns = ['Category', 'Requirement'];\n              const alternateColumns = [\n                ['category'], // alternates for Category\n                ['requirement', 'text', 'Text', 'content', 'Content'] // alternates for Requirement\n              ];\n              \n              // Check the first row to see what columns are available\n              const firstRow = jsonData[0];\n              const availableColumns = Object.keys(firstRow);\n              \n              // For each required column, check if it or its alternates exist\n              const missingColumns = requiredColumns.filter((col, index) => {\n                // Check main column name\n                if (availableColumns.includes(col)) return false;\n                \n                // Check alternate column names\n                const alternates = alternateColumns[index];\n                return !alternates.some(alt => availableColumns.includes(alt));\n              });\n              \n              if (missingColumns.length > 0) {\n                reject(new Error(`Required columns missing: ${missingColumns.join(', ')}. File must contain both 'Category' and 'Requirement' columns.`));\n                return;\n              }\n              \n              // Check if file has extra columns not in our schema\n              const allowedColumns = [\n                'Category', 'category', \n                'Requirement', 'requirement', 'text', 'Text', 'content', 'Content',\n                'Response', 'response', 'finalResponse',\n                'Rating', 'rating'\n              ];\n              \n              const extraColumns = availableColumns.filter(col => !allowedColumns.includes(col));\n              if (extraColumns.length > 0) {\n                reject(new Error(`File contains extra columns: ${extraColumns.join(', ')}. Only 'Category' and 'Requirement' columns are supported.`));\n                return;\n              }\n              \n              // Map to our expected format\n              const parsedData: ExcelRow[] = jsonData.map(row => ({\n                category: row.Category || row.category || \"Uncategorized\",\n                requirement: row.Requirement || row.requirement || row.text || row.Text || row.content || row.Content || \"\",\n                finalResponse: row.Response || row.response || row.finalResponse || \"\",\n                rating: row.Rating || row.rating || undefined\n                // timestamp will be set automatically by the database\n              }));\n              \n              // Check if any requirements are empty\n              const emptyRequirements = parsedData.some(row => !row.requirement || row.requirement.trim() === '');\n              if (emptyRequirements) {\n                reject(new Error(\"Some requirements are empty. Please ensure all rows have a requirement.\"));\n                return;\n              }\n              \n              resolve(parsedData);\n            } catch (error) {\n              console.error(\"Error parsing Excel file:\", error);\n              reject(new Error(\"Failed to parse Excel file. Make sure the file is in a valid Excel format.\"));\n            }\n          };\n          \n          reader.onerror = () => {\n            reject(new Error(\"Error reading the file.\"));\n          };\n        });\n      };\n      \n      // Start reading the file\n      reader.readAsArrayBuffer(file);\n      \n      // Wait for the file to be parsed\n      const parsedData = await parseExcel();\n      \n      // Check if we have any data\n      if (parsedData.length === 0) {\n        throw new Error(\"No data found in the Excel file or required columns are missing.\");\n      }\n      \n      // Set the Excel data to display in the UI\n      setExcelData(parsedData);\n      \n      // Generate requirementId base for all rows\n      const requirementIdBase = rfpName.replace(/\\s+/g, '_').toLowerCase();\n      \n      // Add rfpName, requirementId, and uploadedBy to each row\n      const enhancedData = parsedData.map((row, index) => ({\n        ...row,\n        rfpName: rfpName,\n        requirementId: `${requirementIdBase}_${(index + 1).toString().padStart(3, '0')}`,\n        uploadedBy: uploadedBy\n      }));\n      \n      // Send the data to the backend to store in the database\n      const response = await fetch(\"/api/analyze-excel\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ \n          data: enhancedData,\n          replaceExisting: replaceExisting \n        })\n      });\n      \n      if (response.ok) {\n        const result = await response.json();\n        setRecordsAdded(result.recordsAdded || parsedData.length);\n        \n        setUploadStatus({\n          type: \"success\",\n          message: `File processed successfully. ${result.recordsAdded || parsedData.length} records ${replaceExisting ? 'replaced existing data' : 'added to the database'}.`,\n        });\n        \n        // Reset form on successful upload if desired\n        // resetForm();\n      } else {\n        const errorData = await response.json();\n        throw new Error(errorData.message || \"Failed to process file on the server\");\n      }\n    } catch (error) {\n      console.error(\"Error processing file:\", error);\n      setUploadStatus({\n        type: \"error\",\n        message: error instanceof Error ? error.message : \"Failed to process file. Please try again.\",\n      });\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  return (\n    <div className=\"h-full\">\n      <div className=\"p-4 sm:p-6\">\n        <h2 className=\"text-xl sm:text-2xl font-bold text-slate-800 dark:text-slate-100 mb-4 sm:mb-6 bg-gradient-to-r from-primary to-primary/70 text-transparent bg-clip-text\">Upload Requirements</h2>\n        \n        {/* Dialog for append/replace confirmation */}\n        <Dialog open={showDialog} onOpenChange={setShowDialog}>\n          <DialogContent className=\"sm:max-w-md\">\n            <DialogHeader>\n              <DialogTitle>Upload Options</DialogTitle>\n              <DialogDescription>\n                Would you like to append this data to the existing requirements or replace all existing data?\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 py-4\">\n              <Button \n                onClick={() => processFile(false)} \n                className=\"flex items-center justify-center\"\n                variant=\"outline\"\n              >\n                <Plus className=\"mr-2 h-4 w-4\" />\n                Append Data\n              </Button>\n              <Button \n                onClick={() => processFile(true)}\n                className=\"flex items-center justify-center\"\n                variant=\"default\"\n              >\n                <RefreshCw className=\"mr-2 h-4 w-4\" />\n                Replace All\n              </Button>\n            </div>\n            <DialogFooter>\n              <Button \n                variant=\"ghost\" \n                onClick={() => setShowDialog(false)}\n              >\n                Cancel\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n        \n        <div className=\"grid grid-cols-1 gap-6 sm:gap-8\">\n          <Card className=\"shadow-sm hover:shadow-md transition-shadow duration-300\">\n            <div className=\"px-4 sm:px-6 py-4 sm:py-5 border-b border-slate-200 dark:border-slate-700\">\n              <h3 className=\"text-base sm:text-lg font-medium text-slate-800 dark:text-slate-200\">Upload Requirements Excel File</h3>\n              <p className=\"mt-1 text-xs sm:text-sm text-slate-500 dark:text-slate-400\">\n                Upload an Excel file with 'Category' and 'Requirement' columns to view the content.\n              </p>\n            </div>\n            \n            <CardContent className=\"px-4 sm:px-6 py-4 sm:py-5\">\n              <div className=\"space-y-5 sm:space-y-6\">\n                <div className=\"space-y-5 sm:space-y-6\">\n                  {/* RFP Information Section */}\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"rfp-name\" className=\"text-sm font-medium\">RFP Name</Label>\n                      <div className=\"relative\">\n                        <FileInput className=\"absolute left-2 top-2.5 h-4 w-4 text-slate-500\" />\n                        <Input\n                          id=\"rfp-name\"\n                          value={rfpName}\n                          onChange={(e) => setRfpName(e.target.value)}\n                          className=\"pl-8\"\n                          placeholder=\"Enter RFP name\"\n                        />\n                      </div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"uploaded-by\" className=\"text-sm font-medium\">Uploaded By</Label>\n                      <div className=\"relative\">\n                        <User className=\"absolute left-2 top-2.5 h-4 w-4 text-slate-500\" />\n                        <Input\n                          id=\"uploaded-by\"\n                          value={uploadedBy}\n                          onChange={(e) => setUploadedBy(e.target.value)}\n                          className=\"pl-8\"\n                          placeholder=\"Enter your name\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n                \n                  {/* File Upload Section with Drag & Drop - improved for mobile */}\n                  <div \n                    className={`border-2 border-dashed ${file ? 'border-primary/60 bg-primary/5' : 'border-slate-200 dark:border-slate-700'} rounded-lg p-4 sm:p-10 text-center transition-colors duration-200 relative`}\n                    onDragOver={(e) => {\n                      e.preventDefault();\n                      e.stopPropagation();\n                    }}\n                    onDrop={(e) => {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      \n                      if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {\n                        // Get the first file\n                        const droppedFile = e.dataTransfer.files[0];\n                        \n                        // Check if it's an Excel file\n                        if (droppedFile.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' || \n                            droppedFile.type === 'application/vnd.ms-excel' ||\n                            droppedFile.name.endsWith('.xlsx') || \n                            droppedFile.name.endsWith('.xls')) {\n                          \n                          // Create a new change event\n                          const fileInput = document.getElementById('file-upload') as HTMLInputElement;\n                          if (fileInput) {\n                            // Create a DataTransfer object\n                            const dataTransfer = new DataTransfer();\n                            dataTransfer.items.add(droppedFile);\n                            fileInput.files = dataTransfer.files;\n                            \n                            // Trigger the change event\n                            const event = new Event('change', { bubbles: true });\n                            fileInput.dispatchEvent(event);\n                          }\n                          \n                          // Set the file directly\n                          setFile(droppedFile);\n                          setUploadStatus({\n                            type: \"success\",\n                            message: `File \"${droppedFile.name}\" selected successfully.`,\n                          });\n                          setRecordsAdded(null);\n                        } else {\n                          // Not an Excel file\n                          setUploadStatus({\n                            type: \"error\",\n                            message: \"Please upload only Excel files (.xlsx or .xls)\",\n                          });\n                        }\n                      }\n                    }}\n                  >\n                    <div className=\"flex flex-col items-center justify-center space-y-3 sm:space-y-4\">\n                      <div className={`h-14 w-14 ${file ? 'bg-primary/20' : 'bg-slate-100 dark:bg-slate-800'} rounded-full flex items-center justify-center transition-colors duration-200`}>\n                        <Upload className={`h-6 w-6 ${file ? 'text-primary' : 'text-slate-500 dark:text-slate-400'}`} />\n                      </div>\n                      <div>\n                        <h4 className=\"text-md font-medium text-slate-700 dark:text-slate-300\">Upload Excel File</h4>\n                        <p className=\"text-xs sm:text-sm text-slate-500 dark:text-slate-400 mt-1 max-w-md mx-auto\">\n                          <span className=\"hidden sm:inline\">Drag & drop your Excel file here or click to browse. File must contain 'Category' and 'Requirement' columns.</span>\n                          <span className=\"sm:hidden\">Select an Excel file with required columns.</span>\n                        </p>\n                      </div>\n                      <div className=\"mt-1 sm:mt-2 flex flex-col sm:flex-row gap-3 sm:gap-0\">\n                        <Input\n                          id=\"file-upload\"\n                          type=\"file\"\n                          accept=\".xlsx,.xls\"\n                          onChange={handleFileChange}\n                          className=\"hidden\"\n                        />\n                        <label htmlFor=\"file-upload\" className=\"w-full sm:w-auto\">\n                          <Button type=\"button\" variant=\"outline\" className=\"cursor-pointer w-full sm:w-auto\" asChild>\n                            <span>\n                              <FileText className=\"mr-2 h-4 w-4\" />\n                              Select File\n                            </span>\n                          </Button>\n                        </label>\n                        <Button\n                          type=\"button\"\n                          onClick={handleUpload}\n                          disabled={!file || isUploading || !rfpName || !uploadedBy}\n                          className=\"w-full sm:w-auto sm:ml-3\"\n                        >\n                          {isUploading ? (\n                            <>\n                              <RefreshCw className=\"mr-2 h-4 w-4 animate-spin\" />\n                              Processing...\n                            </>\n                          ) : (\n                            <>\n                              <Upload className=\"mr-2 h-4 w-4\" />\n                              Process File\n                            </>\n                          )}\n                        </Button>\n                      </div>\n                      <div className=\"text-xs sm:text-sm\">\n                        {file && (\n                          <p className=\"text-slate-600 dark:text-slate-400 bg-slate-50 dark:bg-slate-800 px-3 py-2 rounded-md\">\n                            <span className=\"font-medium\">Selected:</span> {file.name} ({(file.size / 1024).toFixed(1)} KB)\n                          </p>\n                        )}\n                        {(!rfpName || !uploadedBy) && file && (\n                          <p className=\"text-orange-500 dark:text-orange-400 mt-2 flex items-center\">\n                            <AlertTriangle className=\"h-3 w-3 mr-1\" />\n                            Please complete all required fields.\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                \n                {uploadStatus.type && (\n                  <Alert variant={uploadStatus.type === \"error\" ? \"destructive\" : \"default\"}>\n                    {uploadStatus.type === \"error\" ? (\n                      <AlertTriangle className=\"h-4 w-4\" />\n                    ) : (\n                      <Check className=\"h-4 w-4\" />\n                    )}\n                    <AlertTitle>\n                      {uploadStatus.type === \"error\" ? \"Error\" : \"Success\"}\n                    </AlertTitle>\n                    <AlertDescription>{uploadStatus.message}</AlertDescription>\n                    {recordsAdded !== null && uploadStatus.type === \"success\" && (\n                      <div className=\"mt-2 p-2 bg-slate-50 rounded-md border border-slate-200\">\n                        <p className=\"text-sm font-medium text-slate-700\">\n                          Records processed: {recordsAdded}\n                        </p>\n                      </div>\n                    )}\n                  </Alert>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n          \n          {/* Display uploaded Excel content with responsive table design */}\n          {excelData.length > 0 && (\n            <Card className=\"shadow-sm hover:shadow-md transition-shadow duration-300\">\n              <div className=\"px-4 sm:px-6 py-4 sm:py-5 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between\">\n                <div>\n                  <h3 className=\"text-base sm:text-lg font-medium text-slate-800 dark:text-slate-200\">Uploaded Content</h3>\n                  <p className=\"mt-1 text-xs sm:text-sm text-slate-500 dark:text-slate-400\">\n                    {excelData.length} requirement{excelData.length !== 1 ? 's' : ''} found\n                  </p>\n                </div>\n                <Button variant=\"ghost\" size=\"sm\" className=\"hidden sm:flex items-center\">\n                  <FileText className=\"mr-2 h-4 w-4\" />\n                  Export\n                </Button>\n              </div>\n              \n              {/* Mobile-optimized card view for smaller screens */}\n              <div className=\"md:hidden\">\n                {excelData.map((row, index) => (\n                  <div \n                    key={index} \n                    className=\"p-4 border-b border-slate-200 dark:border-slate-700 last:border-0\"\n                  >\n                    <div className=\"mb-2\">\n                      <span className=\"inline-block px-2 py-1 text-xs font-medium bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-slate-200 rounded-md\">\n                        {row.category}\n                      </span>\n                    </div>\n                    <p className=\"text-sm text-slate-800 dark:text-slate-200 mb-3\">\n                      {row.requirement}\n                    </p>\n                    <div className=\"flex justify-between text-xs text-slate-500 dark:text-slate-400\">\n                      <span>RFP: {rfpName || \"â€”\"}</span>\n                      <span>By: {uploadedBy || \"â€”\"}</span>\n                    </div>\n                  </div>\n                ))}\n              </div>\n              \n              {/* Desktop table view for larger screens */}\n              <div className=\"hidden md:block\">\n                <CardContent className=\"p-0 overflow-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead className=\"w-1/6\">Category</TableHead>\n                        <TableHead className=\"w-1/2\">Requirement</TableHead>\n                        <TableHead className=\"w-1/6\">RFP Name</TableHead>\n                        <TableHead className=\"w-1/6\">Uploaded By</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {excelData.map((row, index) => (\n                        <TableRow key={index}>\n                          <TableCell className=\"font-medium\">{row.category}</TableCell>\n                          <TableCell>{row.requirement}</TableCell>\n                          <TableCell>{rfpName || \"â€”\"}</TableCell>\n                          <TableCell>{uploadedBy || \"â€”\"}</TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </CardContent>\n              </div>\n            </Card>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":24844},"client/src/pages/rfp/ViewData.tsx":{"content":"import React, { useState, useMemo } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { format, formatDistanceToNow } from 'date-fns';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport { generateMarkdownContent, downloadMarkdownFile, sendEmailWithContent, downloadExcelFile } from '@/lib/exportUtils';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Dialog, DialogClose, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Button } from '@/components/ui/button';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  MessageSquare, \n  ArrowLeft, \n  BookOpen, \n  Eye, \n  RefreshCcw, \n  Trash2, \n  Printer, \n  Mail, \n  MoreHorizontal, \n  Sparkles,\n  CheckSquare,\n  Activity,\n  Zap,\n  Square,\n  Check,\n  Filter,\n  X,\n  ChevronRight,\n  Atom,\n  Bot,\n  Brain,\n  Network,\n  ArrowUpDown,\n  ArrowUp,\n  ArrowDown,\n  Calendar,\n  Hash,\n  Tag,\n  Hand,\n  FileText,\n  ThumbsUp,\n  ThumbsDown\n} from 'lucide-react';\nimport { useIsMobile } from '@/hooks/use-mobile';\nimport { useToast } from '@/hooks/use-toast';\nimport { Progress } from '@/components/ui/progress';\nimport ReferencePanel from '@/components/ReferencePanel';\nimport { ExcelRequirementResponse } from '@shared/schema';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\n\nexport default function ViewData() {\n  const [showResponseDialog, setShowResponseDialog] = useState(false);\n  const [selectedResponse, setSelectedResponse] = useState<ExcelRequirementResponse | null>(null);\n  const [selectedResponseId, setSelectedResponseId] = useState<number | null>(null);\n  const [activeTab, setActiveTab] = useState('response');\n  const [selectedItems, setSelectedItems] = useState<number[]>([]);\n  const [selectAll, setSelectAll] = useState(false);\n  const [showFilters, setShowFilters] = useState(false);\n  const [isFeedbackSubmitting, setIsFeedbackSubmitting] = useState(false);\n  \n  // Filters\n  const [filters, setFilters] = useState({\n    rfpName: 'all',\n    category: 'all',\n    hasResponse: 'all', // 'all', 'yes', 'no'\n    generationMode: 'all', // 'all', 'openai', 'anthropic', 'deepseek', 'moa'\n  });\n  \n  // Sorting\n  const [sortConfig, setSortConfig] = useState({\n    key: 'timestamp',\n    direction: 'desc' as 'asc' | 'desc'\n  });\n  \n  const isMobile = useIsMobile();\n  const { toast } = useToast();\n  \n  const { data: excelData = [], isLoading: loading, refetch } = useQuery<ExcelRequirementResponse[]>({\n    queryKey: ['/api/excel-requirements'],\n  });\n  \n  // Extract unique RFP names and categories\n  const uniqueRfpNames = useMemo(() => {\n    const names = excelData\n      .map(item => item.rfpName || '')\n      .filter((value, index, self) => \n        value && self.indexOf(value) === index\n      );\n    return names.sort();\n  }, [excelData]);\n  \n  const uniqueCategories = useMemo(() => {\n    const categories = excelData\n      .map(item => item.category || '')\n      .filter((value, index, self) => \n        value && self.indexOf(value) === index\n      );\n    return categories.sort();\n  }, [excelData]);\n  \n  // Function to handle sort request\n  const requestSort = (key: string) => {\n    let direction: 'asc' | 'desc' = 'asc';\n    if (sortConfig.key === key && sortConfig.direction === 'asc') {\n      direction = 'desc';\n    }\n    setSortConfig({ key, direction });\n  };\n  \n  // Apply filters to the data\n  const filteredData = useMemo(() => {\n    // First filter the data\n    const filtered = excelData.filter(row => {\n      // Filter by RFP name\n      if (filters.rfpName && filters.rfpName !== 'all' && row.rfpName) {\n        if (row.rfpName !== filters.rfpName) {\n          return false;\n        }\n      }\n      \n      // Filter by category\n      if (filters.category && filters.category !== 'all' && row.category) {\n        if (row.category !== filters.category) {\n          return false;\n        }\n      }\n      \n      // Filter by response status\n      if (filters.hasResponse !== 'all') {\n        const hasResponse = !!row.finalResponse;\n        if ((filters.hasResponse === 'yes' && !hasResponse) || \n            (filters.hasResponse === 'no' && hasResponse)) {\n          return false;\n        }\n      }\n      \n      // Filter by generation mode/model provider\n      if (filters.generationMode !== 'all' && filters.generationMode) {\n        // First try using the modelProvider field (preferred approach)\n        if (row.modelProvider) {\n          if (row.modelProvider !== filters.generationMode) {\n            return false;\n          }\n        } \n        // Fallback to the legacy approach for backward compatibility\n        else {\n          if (filters.generationMode === 'openai' && !row.openaiResponse) {\n            return false;\n          }\n          else if (filters.generationMode === 'anthropic' && !row.anthropicResponse) {\n            return false;\n          }\n          else if (filters.generationMode === 'deepseek' && !row.deepseekResponse) {\n            return false;\n          }\n          else if (filters.generationMode === 'moa' && !row.moaResponse) {\n            return false;\n          }\n        }\n      }\n      \n      return true;\n    });\n    \n    // Sort the filtered data\n    return [...filtered].sort((a, b) => {\n      // Default to comparing by ID if key doesn't exist\n      if (!a[sortConfig.key as keyof ExcelRequirementResponse] || !b[sortConfig.key as keyof ExcelRequirementResponse]) {\n        return sortConfig.direction === 'asc' ? \n          (a.id || 0) - (b.id || 0) : \n          (b.id || 0) - (a.id || 0);\n      }\n      \n      // Handle timestamp specially since it needs date comparison\n      if (sortConfig.key === 'timestamp') {\n        const dateA = a.timestamp ? new Date(a.timestamp).getTime() : 0;\n        const dateB = b.timestamp ? new Date(b.timestamp).getTime() : 0;\n        return sortConfig.direction === 'asc' ? dateA - dateB : dateB - dateA;\n      }\n      \n      // Handle string comparisons\n      if (typeof a[sortConfig.key as keyof ExcelRequirementResponse] === 'string') {\n        const valueA = String(a[sortConfig.key as keyof ExcelRequirementResponse] || '').toLowerCase();\n        const valueB = String(b[sortConfig.key as keyof ExcelRequirementResponse] || '').toLowerCase();\n        \n        return sortConfig.direction === 'asc' ?\n          valueA.localeCompare(valueB) :\n          valueB.localeCompare(valueA);\n      }\n      \n      // Handle numeric values\n      const valA = a[sortConfig.key as keyof ExcelRequirementResponse] || 0;\n      const valB = b[sortConfig.key as keyof ExcelRequirementResponse] || 0;\n      \n      return sortConfig.direction === 'asc' ? \n        Number(valA) - Number(valB) : \n        Number(valB) - Number(valA);\n    });\n  }, [excelData, filters, sortConfig]);\n  \n  const handleViewResponse = (row: ExcelRequirementResponse) => {\n    setSelectedResponse(row);\n    setSelectedResponseId(row.id);\n    setShowResponseDialog(true);\n  };\n  \n  const handleRefresh = () => {\n    refetch();\n  };\n  \n  const handleFeedbackSubmit = async (responseId: number, feedback: 'positive' | 'negative') => {\n    if (!responseId) return;\n    \n    try {\n      setIsFeedbackSubmitting(true);\n      \n      const response = await fetch(`/api/excel-requirements/${responseId}/feedback`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ feedback }),\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Failed to submit feedback: ${response.status} ${response.statusText}`);\n      }\n      \n      const result = await response.json();\n      \n      // Update the selected response with new feedback\n      if (selectedResponse && selectedResponse.id === responseId) {\n        setSelectedResponse({\n          ...selectedResponse,\n          feedback: feedback\n        });\n      }\n      \n      // Refresh the data to get updated feedback\n      await refetch();\n      \n      toast({\n        title: \"Feedback Submitted\",\n        description: \"Your feedback has been recorded successfully.\",\n      });\n    } catch (error) {\n      console.error('Error submitting feedback:', error);\n      toast({\n        title: \"Feedback Error\",\n        description: `Failed to submit feedback: ${error instanceof Error ? error.message : String(error)}`,\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsFeedbackSubmitting(false);\n    }\n  };\n  \n  const toggleSelectItem = (id: number) => {\n    setSelectedItems(prev => \n      prev.includes(id) \n        ? prev.filter(item => item !== id) \n        : [...prev, id]\n    );\n  };\n  \n  const toggleSelectAll = () => {\n    if (selectAll) {\n      setSelectedItems([]);\n    } else {\n      setSelectedItems(filteredData.map(item => item.id || 0).filter(id => id !== 0));\n    }\n    setSelectAll(!selectAll);\n  };\n  \n  const [processingItems, setProcessingItems] = useState<number[]>([]);\n  const [processedCount, setProcessedCount] = useState(0);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [generationError, setGenerationError] = useState<string | null>(null);\n  \n  // Function to generate response for a single requirement\n  const generateResponseForRequirement = async (\n    requirementId: number, \n    modelProvider: 'openai' | 'anthropic' | 'deepseek' | 'moa'\n  ) => {\n    try {\n      // Find the requirement data\n      const requirement = excelData.find(item => item.id === requirementId);\n      \n      if (!requirement) {\n        console.error(`Requirement with ID ${requirementId} not found`);\n        toast({\n          title: \"Requirement Not Found\",\n          description: `Could not find requirement with ID ${requirementId}`,\n          variant: \"destructive\"\n        });\n        return false;\n      }\n      \n      // Validate model provider\n      if (!['openai', 'anthropic', 'deepseek', 'moa'].includes(modelProvider)) {\n        console.error(`Invalid model provider: ${modelProvider}`);\n        toast({\n          title: \"Invalid Model Provider\",\n          description: `Model provider ${modelProvider} is not supported`,\n          variant: \"destructive\"\n        });\n        return false;\n      }\n      \n      // Make API call to generate response\n      const response = await fetch('/api/generate-response', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          requirement_id: requirementId,\n          model: modelProvider\n        }),\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.detail || `API returned ${response.status} ${response.statusText}`);\n      }\n      \n      const data = await response.json();\n      \n      if (data.error) {\n        throw new Error(data.error);\n      }\n      \n      console.log(`Response generated for requirement ID ${requirementId} with ${modelProvider}`);\n      toast({\n        title: \"Response Generated\",\n        description: `Successfully generated response for requirement ${requirementId}`,\n      });\n      return true;\n    } catch (error) {\n      console.error(`Error generating response for requirement ${requirementId}:`, error);\n      setGenerationError(error instanceof Error ? error.message : String(error));\n      toast({\n        title: \"Generation Error\",\n        description: error instanceof Error ? error.message : String(error),\n        variant: \"destructive\"\n      });\n      return false;\n    }\n  };\n  \n  // Function to handle bulk generation of responses\n  const handleGenerateResponses = async (modelProvider: 'openai' | 'anthropic' | 'deepseek' | 'moa') => {\n    setProcessingItems(selectedItems);\n    setProcessedCount(0);\n    setIsGenerating(true);\n    setGenerationError(null);\n    \n    const totalItems = selectedItems.length;\n    let successCount = 0;\n    \n    try {\n      // Process items sequentially to avoid overloading the API\n      for (let i = 0; i < selectedItems.length; i++) {\n        const requirementId = selectedItems[i];\n        const success = await generateResponseForRequirement(requirementId, modelProvider);\n        \n        if (success) {\n          successCount++;\n        }\n        \n        setProcessedCount(i + 1);\n      }\n      \n      // Refresh data after all items are processed\n      await refetch();\n      \n      toast({\n        title: \"Response Generation Complete\",\n        description: `Successfully generated responses for ${successCount} out of ${totalItems} requirements.`,\n        variant: successCount === totalItems ? \"default\" : \"destructive\",\n      });\n    } catch (error) {\n      console.error('Error in bulk generation:', error);\n      setGenerationError(error instanceof Error ? error.message : String(error));\n      \n      toast({\n        title: \"Generation Error\",\n        description: `Failed to complete response generation: ${error instanceof Error ? error.message : String(error)}`,\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsGenerating(false);\n      setProcessingItems([]);\n    }\n  };\n  \n  // Function to handle exporting selected items as markdown\n  const handleExportToMarkdown = () => {\n    // Get selected items data\n    const selectedData = excelData.filter(item => selectedItems.includes(item.id || 0));\n    \n    if (selectedData.length === 0) {\n      toast({\n        title: \"No Data Found\",\n        description: \"Could not find data for the selected items\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    // Generate markdown content\n    const markdownContent = generateMarkdownContent(selectedData);\n    \n    // Create filename based on RFP name if all items are from the same RFP\n    const rfpNames = new Set(selectedData.map(item => item.rfpName || 'unnamed'));\n    const filename = rfpNames.size === 1 \n      ? `${Array.from(rfpNames)[0]}-responses.md` \n      : `rfp-responses-${new Date().toISOString().split('T')[0]}.md`;\n    \n    // Download the file\n    downloadMarkdownFile(markdownContent, filename);\n    \n    toast({\n      title: \"Export Successful\",\n      description: `${selectedData.length} items exported to ${filename}`,\n    });\n  };\n  \n  // Function to email the selected responses directly with HTML formatting\n  // and simultaneously generate a markdown file for download\n  const handleEmailMarkdown = () => {\n    // Get selected items data\n    const selectedData = excelData.filter(item => selectedItems.includes(item.id || 0));\n    \n    if (selectedData.length === 0) {\n      toast({\n        title: \"No Data Found\",\n        description: \"Could not find data for the selected items\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    // Create a subject line based on RFP name if all items are from the same RFP\n    const rfpNames = new Set(selectedData.map(item => item.rfpName || 'unnamed'));\n    const rfpNameForFile = rfpNames.size === 1 \n      ? Array.from(rfpNames)[0] \n      : `multiple-rfps-${new Date().toISOString().split('T')[0]}`;\n    \n    const subject = rfpNames.size === 1 \n      ? `RFP Responses for ${Array.from(rfpNames)[0]}` \n      : `RFP Responses Export (${selectedData.length} items)`;\n    \n    try {\n      // Generate markdown content\n      const markdownContent = generateMarkdownContent(selectedData);\n      \n      // 1. Generate and download the markdown file\n      const filename = `${rfpNameForFile}-responses.md`;\n      downloadMarkdownFile(markdownContent, filename);\n      \n      // 2. Send email\n      sendEmailWithContent(markdownContent, subject);\n      \n      toast({\n        title: \"Email and Markdown Export\",\n        description: \"Email opened and markdown file downloaded. Please attach the markdown file to your email manually.\",\n      });\n    } catch (error) {\n      console.error('Error preparing email:', error);\n      toast({\n        title: \"Email Preparation Failed\",\n        description: \"Failed to prepare email content: \" + (error instanceof Error ? error.message : String(error)),\n        variant: \"destructive\"\n      });\n    }\n  };\n  \n  // Function to export selected items as Excel file\n  const handleExportToExcel = () => {\n    // Get selected items data\n    const selectedData = excelData.filter(item => selectedItems.includes(item.id || 0));\n    \n    if (selectedData.length === 0) {\n      toast({\n        title: \"No Data Found\",\n        description: \"Could not find data for the selected items\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    try {\n      // Create filename based on RFP name if all items are from the same RFP\n      const rfpNames = new Set(selectedData.map(item => item.rfpName || 'unnamed'));\n      const filename = rfpNames.size === 1 \n        ? `${Array.from(rfpNames)[0]}-responses.xlsx` \n        : `rfp-responses-${new Date().toISOString().split('T')[0]}.xlsx`;\n      \n      // Download the Excel file\n      downloadExcelFile(selectedData, filename);\n      \n      toast({\n        title: \"Excel Export Successful\",\n        description: `${selectedData.length} items exported to ${filename}`,\n      });\n    } catch (error) {\n      console.error('Error generating Excel file:', error);\n      toast({\n        title: \"Excel Export Failed\",\n        description: \"Failed to generate Excel file: \" + (error instanceof Error ? error.message : String(error)),\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const handleBulkAction = (action: string) => {\n    if (selectedItems.length === 0) {\n      toast({\n        title: \"No Items Selected\",\n        description: \"Please select at least one item first\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    switch (action) {\n      case 'generate-openai':\n        handleGenerateResponses('openai');\n        break;\n      case 'generate-anthropic':\n        handleGenerateResponses('anthropic');\n        break;\n      case 'generate-deepseek':\n        handleGenerateResponses('deepseek');\n        break;\n      case 'generate-moa':\n        handleGenerateResponses('moa');\n        break;\n      case 'print':\n        handleExportToMarkdown();\n        break;\n      case 'excel':\n        handleExportToExcel();\n        break;\n      case 'mail':\n        handleEmailMarkdown();\n        break;\n      case 'delete':\n        console.log('Delete items:', selectedItems);\n        alert(`Delete answers for ${selectedItems.length} selected items`);\n        break;\n      default:\n        console.log('Unknown action:', action);\n    }\n  };\n  \n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-xl sm:text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 text-transparent bg-clip-text\">View Requirements</h1>\n        \n        <div className=\"flex items-center gap-2\">\n          <Button \n            size=\"sm\" \n            onClick={handleRefresh}\n            className=\"h-8 px-3\"\n            variant=\"outline\"\n            title=\"Refresh all data from database\"\n            disabled={loading}\n          >\n            {loading ? (\n              <>\n                <RefreshCcw className=\"h-4 w-4 mr-1.5 animate-spin\" />\n                <span>Refreshing...</span>\n              </>\n            ) : (\n              <>\n                <RefreshCcw className=\"h-4 w-4 mr-1.5\" />\n                <span>Refresh Data</span>\n              </>\n            )}\n          </Button>\n        </div>\n      </div>\n      \n      <div>\n        <Card className=\"shadow-sm\">\n          {/* Unified Action Bar - Modern UI pattern with responsive design */}\n          <div className=\"border-b border-slate-200 dark:border-slate-700\">\n            {/* Data summary section with meta information */}\n            <div className=\"p-4 bg-white dark:bg-slate-900\">\n              <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n                <div>\n                  <p className=\"text-sm text-slate-500 dark:text-slate-400\">\n                    {filteredData.length} {filteredData.length === 1 ? 'item' : 'items'} \n                    {filteredData.length !== excelData.length ? \n                      <span className=\"ml-1\">\n                        <Badge variant=\"outline\" className=\"font-normal ml-1\">\n                          Filtered from {excelData.length}\n                        </Badge>\n                      </span> : ''\n                    }\n                  </p>\n                </div>\n\n                {/* Primary Action Row - Always visible on all screen sizes */}\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"flex items-center mr-2 border-r border-slate-200 dark:border-slate-700 pr-3\">\n                    <Checkbox \n                      id=\"select-all-universal\" \n                      checked={selectAll}\n                      onCheckedChange={toggleSelectAll}\n                    />\n                    <label htmlFor=\"select-all-universal\" className=\"ml-2 whitespace-nowrap text-sm font-medium text-slate-700 dark:text-slate-300\">\n                      Select All\n                    </label>\n                  </div>\n                  \n\n\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\" \n                        className=\"h-9 px-2 sm:px-3 flex gap-1.5 items-center\" \n                        disabled={selectedItems.length === 0}\n                      >\n                        <Sparkles className=\"h-4 w-4\" />\n                        <span className=\"hidden sm:inline\">Generate</span>\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\">\n                      <DropdownMenuLabel>Generate with LLM</DropdownMenuLabel>\n                      <DropdownMenuSeparator />\n                      <DropdownMenuItem onClick={() => handleBulkAction('generate-openai')} className=\"gap-2\">\n                        <Atom className=\"h-4 w-4 text-blue-500\" />\n                        <span>OpenAI</span>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => handleBulkAction('generate-anthropic')} className=\"gap-2\">\n                        <Bot className=\"h-4 w-4 text-purple-500\" />\n                        <span>Anthropic</span>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => handleBulkAction('generate-deepseek')} className=\"gap-2\">\n                        <Brain className=\"h-4 w-4 text-amber-500\" />\n                        <span>DeepSeek</span>\n                      </DropdownMenuItem>\n                      <DropdownMenuSeparator />\n                      <DropdownMenuItem onClick={() => handleBulkAction('generate-moa')} className=\"gap-2\">\n                        <Network className=\"h-4 w-4 text-green-500\" />\n                        <span>MOA (Mixture of Agents)</span>\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\" \n                    className=\"h-9 px-2 sm:px-3 flex gap-1.5 items-center\"\n                    title=\"Toggle filters\"\n                    onClick={() => setShowFilters(!showFilters)}\n                  >\n                    <Filter className=\"h-4 w-4\" />\n                    <span className=\"hidden sm:inline\">Filter</span>\n                    {Object.values(filters).some(val => val !== 'all') && (\n                      <Badge className=\"ml-1 h-5 bg-primary text-white\">{\n                        Object.values(filters).filter(val => val !== 'all').length\n                      }</Badge>\n                    )}\n                  </Button>\n\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\" \n                        className=\"h-9 px-2 sm:px-3 flex gap-1.5 items-center\"\n                      >\n                        <ArrowUpDown className=\"h-4 w-4\" />\n                        <span className=\"hidden sm:inline\">Sort</span>\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\">\n                      <DropdownMenuLabel>Sort By</DropdownMenuLabel>\n                      <DropdownMenuSeparator />\n                      <DropdownMenuItem onClick={() => requestSort('id')} className=\"gap-2\">\n                        <Hash className=\"h-4 w-4\" />\n                        <span>ID</span>\n                        {sortConfig.key === 'id' && (\n                          sortConfig.direction === 'asc' ? <ArrowUp className=\"h-4 w-4 ml-auto\" /> : <ArrowDown className=\"h-4 w-4 ml-auto\" />\n                        )}\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => requestSort('timestamp')} className=\"gap-2\">\n                        <Calendar className=\"h-4 w-4\" />\n                        <span>Date</span>\n                        {sortConfig.key === 'timestamp' && (\n                          sortConfig.direction === 'asc' ? <ArrowUp className=\"h-4 w-4 ml-auto\" /> : <ArrowDown className=\"h-4 w-4 ml-auto\" />\n                        )}\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => requestSort('rfpName')} className=\"gap-2\">\n                        <BookOpen className=\"h-4 w-4\" />\n                        <span>RFP Name</span>\n                        {sortConfig.key === 'rfpName' && (\n                          sortConfig.direction === 'asc' ? <ArrowUp className=\"h-4 w-4 ml-auto\" /> : <ArrowDown className=\"h-4 w-4 ml-auto\" />\n                        )}\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => requestSort('category')} className=\"gap-2\">\n                        <Tag className=\"h-4 w-4\" />\n                        <span>Category</span>\n                        {sortConfig.key === 'category' && (\n                          sortConfig.direction === 'asc' ? <ArrowUp className=\"h-4 w-4 ml-auto\" /> : <ArrowDown className=\"h-4 w-4 ml-auto\" />\n                        )}\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\" \n                        className=\"h-9 px-2 sm:px-3 flex gap-1.5 items-center ml-auto\"\n                        disabled={selectedItems.length === 0}\n                      >\n                        <MoreHorizontal className=\"h-4 w-4\" />\n                        <span className=\"hidden sm:inline\">More</span>\n                      </Button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"end\">\n                      <DropdownMenuLabel>More Actions</DropdownMenuLabel>\n                      <DropdownMenuSeparator />\n                      <DropdownMenuItem onClick={() => handleBulkAction('print')} className=\"gap-2\">\n                        <Printer className=\"h-4 w-4\" />\n                        <span>Export as Markdown</span>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => handleBulkAction('excel')} className=\"gap-2\">\n                        <FileText className=\"h-4 w-4\" />\n                        <span>Export as Excel</span>\n                      </DropdownMenuItem>\n                      <DropdownMenuItem onClick={() => handleBulkAction('mail')} className=\"gap-2\">\n                        <Mail className=\"h-4 w-4\" />\n                        <span>Email Responses</span>\n                      </DropdownMenuItem>\n                      <DropdownMenuSeparator />\n                      <DropdownMenuItem onClick={() => handleBulkAction('delete')} className=\"text-red-600 gap-2\">\n                        <Trash2 className=\"h-4 w-4\" />\n                        <span>Delete Selected</span>\n                      </DropdownMenuItem>\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                </div>\n              </div>\n            </div>\n            \n            {/* Expandable Filter Panel */}\n            {showFilters && (\n              <div className=\"p-4 bg-slate-50 dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 animate-in fade-in-50 duration-200\">\n                <div className=\"flex flex-col md:flex-row gap-3 items-end\">\n                  <div className=\"space-y-1 flex-1\">\n                    <Label htmlFor=\"filter-rfp-unified\">RFP Name</Label>\n                    <Select\n                      value={filters.rfpName}\n                      onValueChange={(value) => setFilters({...filters, rfpName: value})}\n                    >\n                      <SelectTrigger id=\"filter-rfp-unified\" className=\"max-w-xs h-9\">\n                        <SelectValue placeholder=\"Select RFP name\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All RFPs</SelectItem>\n                        {uniqueRfpNames.filter(name => name).map(name => (\n                          <SelectItem key={name} value={name}>{name}</SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  \n                  <div className=\"space-y-1 flex-1\">\n                    <Label htmlFor=\"filter-category-unified\">Category</Label>\n                    <Select\n                      value={filters.category}\n                      onValueChange={(value) => setFilters({...filters, category: value})}\n                    >\n                      <SelectTrigger id=\"filter-category-unified\" className=\"max-w-xs h-9\">\n                        <SelectValue placeholder=\"Select category\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All Categories</SelectItem>\n                        {uniqueCategories.filter(category => category).map(category => (\n                          <SelectItem key={category} value={category}>{category}</SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  \n                  <div className=\"space-y-1 flex-1\">\n                    <Label htmlFor=\"filter-response-unified\">Response Status</Label>\n                    <Select\n                      value={filters.hasResponse}\n                      onValueChange={(value) => setFilters({...filters, hasResponse: value})}\n                    >\n                      <SelectTrigger id=\"filter-response-unified\" className=\"max-w-xs h-9\">\n                        <SelectValue placeholder=\"Filter by response\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All Statuses</SelectItem>\n                        <SelectItem value=\"yes\">Has Response</SelectItem>\n                        <SelectItem value=\"no\">No Response</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  \n                  <div className=\"space-y-1 flex-1\">\n                    <Label htmlFor=\"filter-model-unified\">Generation Model</Label>\n                    <Select\n                      value={filters.generationMode}\n                      onValueChange={(value) => setFilters({...filters, generationMode: value})}\n                    >\n                      <SelectTrigger id=\"filter-model-unified\" className=\"max-w-xs h-9\">\n                        <SelectValue placeholder=\"Filter by model\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All Models</SelectItem>\n                        <SelectItem value=\"openai\">OpenAI</SelectItem>\n                        <SelectItem value=\"anthropic\">Anthropic</SelectItem>\n                        <SelectItem value=\"deepseek\">Deepseek</SelectItem>\n                        <SelectItem value=\"moa\">MOA</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  \n                  <Button \n                    variant=\"secondary\" \n                    size=\"sm\" \n                    onClick={() => setFilters({\n                      rfpName: 'all',\n                      category: 'all',\n                      hasResponse: 'all',\n                      generationMode: 'all',\n                    })}\n                    className=\"h-9 whitespace-nowrap\"\n                  >\n                    <X className=\"h-4 w-4 mr-1\" />\n                    Reset Filters\n                  </Button>\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Progress indicator for generation */}\n          {isGenerating && (\n            <div className=\"p-4 border-b border-slate-100 dark:border-slate-700 bg-white dark:bg-slate-900\">\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center\">\n                    <Sparkles className=\"h-4 w-4 text-blue-500 mr-2\" />\n                    <span className=\"font-medium text-sm\">\n                      Generating responses ({processedCount}/{processingItems.length})\n                    </span>\n                  </div>\n                  <span className=\"text-xs font-medium text-slate-500\">\n                    {Math.round((processedCount / processingItems.length) * 100)}%\n                  </span>\n                </div>\n                <Progress value={(processedCount / processingItems.length) * 100} className=\"h-2\" />\n                {generationError && (\n                  <div className=\"text-xs text-red-500 mt-1\">\n                    Error: {generationError}\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n          \n          <CardContent className=\"p-4\">\n            \n            {/* Content display */}\n            {loading ? (\n              <div className=\"space-y-4\">\n                <Skeleton className=\"h-40 w-full\" />\n                <Skeleton className=\"h-40 w-full\" />\n                <Skeleton className=\"h-40 w-full\" />\n              </div>\n            ) : filteredData.length > 0 ? (\n              <div className=\"space-y-4\">\n                {filteredData.map((row: ExcelRequirementResponse, index: number) => {\n                  const isSelected = row.id ? selectedItems.includes(row.id) : false;\n                  return (\n                    <Card \n                      key={row.id || index} \n                      className={`overflow-hidden border relative transition-all duration-200 ${isSelected ? 'border-blue-400 dark:border-blue-600 shadow-md' : 'border-slate-200 dark:border-slate-700'}`}\n                    >\n                      <CardContent className=\"p-3 sm:p-4\">\n                        <div className=\"flex items-start\">\n                          <div className=\"mr-2 sm:mr-3 pt-1\">\n                            {row.id && (\n                              <Checkbox \n                                id={`select-${row.id}`}\n                                checked={isSelected}\n                                onCheckedChange={() => toggleSelectItem(row.id || 0)}\n                              />\n                            )}\n                          </div>\n                          \n                          <div className=\"flex-1 min-w-0\">\n                            {/* Mobile view categories and badges */}\n                            <div className=\"flex flex-wrap items-center gap-1.5 mb-2\">\n                              {/* Status tag */}\n                              <Badge \n                                variant=\"outline\" \n                                className={`text-[10px] sm:text-xs px-1.5 py-0 ${row.finalResponse \n                                  ? \"bg-green-50 text-green-700 dark:bg-green-950 dark:text-green-200 border-green-200 dark:border-green-800\" \n                                  : \"bg-slate-50 text-slate-700 dark:bg-slate-800 dark:text-slate-200 border-slate-200 dark:border-slate-700\"}`}\n                              >\n                                {row.finalResponse ? \n                                  <><Check className=\"h-3 w-3 mr-0.5\" /> Generated</> : \n                                  'Not Generated'}\n                              </Badge>\n                              \n                              {/* RFP Badge */}\n                              {row.rfpName && (\n                                <Badge variant=\"outline\" className=\"text-[10px] sm:text-xs bg-blue-50 text-blue-700 dark:bg-blue-950 dark:text-blue-200 border-blue-200 dark:border-blue-800\">\n                                  {row.rfpName}\n                                </Badge>\n                              )}\n                              \n                              {/* Model Provider badge */}\n                              {row.finalResponse && (\n                                <Badge variant=\"outline\" className={`text-[10px] sm:text-xs \n                                  ${row.modelProvider === 'openai' ? 'bg-blue-50 text-blue-700 dark:bg-blue-950 dark:text-blue-200 border-blue-200 dark:border-blue-800' : \n                                    row.modelProvider === 'anthropic' ? 'bg-purple-50 text-purple-700 dark:bg-purple-950 dark:text-purple-200 border-purple-200 dark:border-purple-800' : \n                                    row.modelProvider === 'deepseek' ? 'bg-amber-50 text-amber-700 dark:bg-amber-950 dark:text-amber-200 border-amber-200 dark:border-amber-800' : \n                                    row.modelProvider === 'moa' ? 'bg-green-50 text-green-700 dark:bg-green-950 dark:text-green-200 border-green-200 dark:border-green-800' : \n                                    'bg-slate-50 text-slate-700 dark:bg-slate-800 dark:text-slate-200 border-slate-200 dark:border-slate-700'\n                                  }`}\n                                >\n                                  {row.modelProvider === 'moa' ? \n                                    <><Network className=\"h-3 w-3 mr-0.5\" /> MOA</> : \n                                    row.modelProvider === 'openai' ? 'OpenAI' : \n                                    row.modelProvider === 'anthropic' ? 'Anthropic' : \n                                    row.modelProvider === 'deepseek' ? 'DeepSeek' : \n                                    'Model'\n                                  }\n                                </Badge>\n                              )}\n                              \n                              {/* Category display and timestamp */}\n                              <div className=\"flex items-center justify-between w-full\">\n                                <Badge variant=\"outline\" className=\"text-[10px] sm:text-xs bg-slate-50 text-slate-700 dark:bg-slate-800 dark:text-slate-200 border-slate-200 dark:border-slate-700\">\n                                  {row.category}\n                                </Badge>\n                                \n                                {row.timestamp && (\n                                  <div className=\"text-[9px] sm:text-[10px] text-slate-500 dark:text-slate-400\">\n                                    {(() => {\n                                      try {\n                                        return formatDistanceToNow(new Date(row.timestamp), { addSuffix: true });\n                                      } catch (e) {\n                                        return String(row.timestamp);\n                                      }\n                                    })()}\n                                  </div>\n                                )}\n                              </div>\n                            </div>\n                            \n                            {/* Requirement text with hover interaction */}\n                            <div \n                              className={`group relative text-sm sm:text-base font-medium text-slate-800 dark:text-slate-100 line-clamp-3 cursor-pointer transition-all duration-200 ${!row.finalResponse ? 'opacity-70' : ''}`}\n                              onClick={() => row.finalResponse && handleViewResponse(row)}\n                              title={row.finalResponse ? \"Click to view full response\" : \"No response generated yet\"}\n                              aria-label={row.finalResponse ? \"Click to view full response\" : \"No response generated yet\"}\n                            >\n                              {row.requirement}\n                              \n                              {row.finalResponse && (\n                                <div className=\"absolute inset-0 bg-gradient-to-r from-transparent to-white/80 dark:to-black/80 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-end pr-4\">\n                                  <span className=\"absolute right-10 top-1/2 transform -translate-y-1/2 bg-slate-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200\">\n                                    Click to view\n                                  </span>\n                                  <Hand className=\"h-5 w-5 text-primary\" />\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  );\n                })}\n              </div>\n            ) : (\n              <div className=\"p-12 text-center\">\n                <p className=\"text-slate-700 dark:text-slate-300 font-medium\">No data available. Please upload Excel files first.</p>\n                <p className=\"text-slate-600 dark:text-slate-400 text-sm mt-2\">\n                  Go to the Upload Requirements page to add data.\n                </p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    \n      {/* Detail Dialog */}\n      <Dialog open={showResponseDialog} onOpenChange={setShowResponseDialog}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"text-slate-900 dark:text-white\">Response Details</DialogTitle>\n            <DialogDescription className=\"text-slate-700 dark:text-slate-300\">\n              View complete response and reference information\n            </DialogDescription>\n          </DialogHeader>\n          \n          {selectedResponse && (\n            <div className=\"space-y-4 py-2\">\n              <div className=\"p-4 bg-slate-50 dark:bg-slate-800 rounded-md mb-4\">\n                <h4 className=\"text-sm font-medium text-slate-600 dark:text-slate-300 mb-1\">Category:</h4>\n                <p className=\"text-slate-900 dark:text-slate-100 font-medium\">{selectedResponse.category}</p>\n              </div>\n              \n              <div className=\"p-4 bg-slate-50 dark:bg-slate-800 rounded-md mb-4\">\n                <h4 className=\"text-sm font-medium text-slate-600 dark:text-slate-300 mb-1\">Requirement:</h4>\n                <p className=\"text-slate-900 dark:text-slate-100\">{selectedResponse.requirement}</p>\n              </div>\n              \n              <div className=\"p-4 bg-slate-50 dark:bg-slate-800 rounded-md mb-4\">\n                <h4 className=\"text-sm font-medium text-slate-600 dark:text-slate-300 mb-1\">AI Model Used:</h4>\n                <p className=\"text-slate-900 dark:text-slate-100\">\n                  {selectedResponse.modelProvider === \"openai\" ? \"OpenAI\" :\n                   selectedResponse.modelProvider === \"anthropic\" ? \"Anthropic/Claude\" :\n                   selectedResponse.modelProvider === \"deepseek\" ? \"DeepSeek\" :\n                   selectedResponse.modelProvider === \"moa\" ? \"Mixture of Agents (MOA)\" :\n                   selectedResponse.modelProvider || \"Not specified\"}\n                </p>\n              </div>\n              \n              <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n                <TabsList className=\"grid w-full grid-cols-2 mb-6\">\n                  <TabsTrigger value=\"response\" className=\"flex items-center gap-2\">\n                    <MessageSquare className=\"h-4 w-4\" />\n                    Response\n                  </TabsTrigger>\n                  <TabsTrigger value=\"references\" className=\"flex items-center gap-2\">\n                    <BookOpen className=\"h-4 w-4\" />\n                    References\n                  </TabsTrigger>\n                </TabsList>\n                \n                <TabsContent value=\"response\">\n                  <div className=\"p-4 bg-slate-50 dark:bg-slate-900 rounded-md mb-4\">\n                    <h4 className=\"text-sm font-semibold text-slate-700 dark:text-slate-200 mb-3\">Response:</h4>\n                    <div className=\"prose prose-slate dark:prose-invert max-w-none text-slate-900 dark:text-slate-50 font-medium\">\n                      {selectedResponse.finalResponse && (\n                        <div className=\"bg-white dark:bg-slate-800 p-3 rounded-md border border-slate-200 dark:border-slate-700\">\n                          <ReactMarkdown remarkPlugins={[remarkGfm]}>\n                            {selectedResponse.finalResponse\n                              .replace(/\\\\n/g, '\\n')\n                              .replace(/\\\\\"/g, '\"')\n                              .replace(/\\\\\\\\/g, '\\\\')}\n                          </ReactMarkdown>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </TabsContent>\n                \n                <TabsContent value=\"references\">\n                  <ReferencePanel responseId={selectedResponseId || undefined} showTitle={false} />\n                </TabsContent>\n              </Tabs>\n            </div>\n          )}\n          \n          <DialogFooter className=\"flex items-center justify-between sm:justify-between\">\n            <DialogClose asChild>\n              <Button type=\"button\" variant=\"secondary\" className=\"flex items-center gap-2\">\n                <ArrowLeft className=\"h-4 w-4\" />\n                Back to List\n              </Button>\n            </DialogClose>\n            \n            {selectedResponse && selectedResponse.finalResponse && (\n              <div className=\"flex items-center space-x-2\">\n                <span className=\"text-sm text-slate-500 mr-1\">Feedback:</span>\n                <Button\n                  type=\"button\"\n                  size=\"sm\"\n                  variant={selectedResponse.feedback === 'positive' ? 'default' : 'outline'}\n                  className={`p-2 ${selectedResponse.feedback === 'positive' ? 'bg-green-600 hover:bg-green-700' : ''}`}\n                  onClick={() => handleFeedbackSubmit(selectedResponse.id || 0, 'positive')}\n                  disabled={isFeedbackSubmitting}\n                  title=\"I like this response\"\n                >\n                  <ThumbsUp className=\"h-4 w-4\" />\n                </Button>\n                <Button\n                  type=\"button\"\n                  size=\"sm\"\n                  variant={selectedResponse.feedback === 'negative' ? 'default' : 'outline'}\n                  className={`p-2 ${selectedResponse.feedback === 'negative' ? 'bg-red-600 hover:bg-red-700' : ''}`}\n                  onClick={() => handleFeedbackSubmit(selectedResponse.id || 0, 'negative')}\n                  disabled={isFeedbackSubmitting}\n                  title=\"I don't like this response\"\n                >\n                  <ThumbsDown className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            )}\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":48712},"client/src/components/rfp-templates/TechnicalTemplate.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { RfpFormData } from \"@/lib/types\";\n\ninterface TechnicalTemplateProps {\n  data: RfpFormData;\n}\n\nexport default function TechnicalTemplate({ data }: TechnicalTemplateProps) {\n  const formatDate = (dateString: string) => {\n    if (!dateString) return '';\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  };\n\n  const currentDate = new Date().toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric'\n  });\n\n  return (\n    <div className=\"space-y-6 p-6 bg-white rounded-lg shadow-sm\">\n      {/* Header */}\n      <div className=\"border-b pb-6\">\n        <h1 className=\"text-3xl font-bold text-center mb-2\">{data.rfpTitle}</h1>\n        <h2 className=\"text-xl text-center text-gray-600 mb-4\">Technical Proposal Response</h2>\n        <div className=\"grid grid-cols-2 gap-4 text-sm\">\n          <div>\n            <p><strong>Prepared By:</strong> {data.companyName}</p>\n            <p><strong>Technical Lead:</strong> {data.pointOfContact}</p>\n          </div>\n          <div className=\"text-right\">\n            <p><strong>Client:</strong> {data.clientName}</p>\n            <p><strong>Submission Date:</strong> {currentDate}</p>\n            <p><strong>RFP Reference:</strong> {data.rfpId}</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Executive Summary */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Executive Summary</h3>\n        <p className=\"text-gray-700\">\n          {data.companyName} is pleased to present this technical proposal in response to \n          {data.clientName}'s RFP for {data.rfpTitle}. As specialists in technical solutions for \n          the {data.clientIndustry} industry, we have developed a comprehensive approach to address \n          your specific requirements.\n        </p>\n        <p className=\"text-gray-700 mt-2\">\n          Our proposal outlines a robust technical solution that leverages modern technologies and \n          proven methodologies to deliver a scalable, secure, and efficient system that will meet your \n          current needs and support future growth.\n        </p>\n      </section>\n\n      {/* Technical Approach */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Technical Approach</h3>\n        <p className=\"text-gray-700\">\n          Our approach to the {data.rfpTitle} project is guided by the following principles:\n        </p>\n        <ul className=\"list-disc pl-6 mt-2 text-gray-700\">\n          <li>User-centered design focusing on simplicity and efficiency</li>\n          <li>Modular architecture to enable flexibility and scalability</li>\n          <li>Industry standard security practices and protocols</li>\n          <li>Performance optimization to ensure responsive user experience</li>\n          <li>Comprehensive testing strategy to ensure quality and reliability</li>\n        </ul>\n        <p className=\"text-gray-700 mt-2\">\n          Based on our understanding of your requirements as stated in the project summary:\n        </p>\n        <p className=\"text-gray-700 mt-2 italic\">\n          \"{data.projectSummary}\"\n        </p>\n      </section>\n\n      {/* Architecture Overview */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Architecture Overview</h3>\n        <p className=\"text-gray-700\">\n          We propose a multi-tiered architecture with the following components:\n        </p>\n        <ul className=\"list-disc pl-6 mt-2 text-gray-700\">\n          <li><strong>Presentation Layer:</strong> Responsive web interface optimized for all devices</li>\n          <li><strong>Application Layer:</strong> Business logic and process management</li>\n          <li><strong>Data Layer:</strong> Secure data storage and retrieval</li>\n          <li><strong>Integration Layer:</strong> APIs and connectors for third-party systems</li>\n        </ul>\n        <p className=\"text-gray-700 mt-2\">\n          This architecture provides clear separation of concerns, making the system easier to develop, \n          maintain, and scale as your needs evolve.\n        </p>\n      </section>\n\n      {/* Technology Stack */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Technology Stack</h3>\n        <p className=\"text-gray-700\">\n          Based on your project requirements, we recommend the following technology stack:\n        </p>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3\">\n          <div className=\"border rounded-md p-3\">\n            <h4 className=\"font-semibold mb-2\">Frontend</h4>\n            <ul className=\"list-disc pl-6 text-gray-700\">\n              <li>React for component-based UI development</li>\n              <li>TypeScript for type safety and code maintainability</li>\n              <li>Tailwind CSS for responsive design</li>\n              <li>Redux for state management</li>\n            </ul>\n          </div>\n          <div className=\"border rounded-md p-3\">\n            <h4 className=\"font-semibold mb-2\">Backend</h4>\n            <ul className=\"list-disc pl-6 text-gray-700\">\n              <li>Node.js with Express for API development</li>\n              <li>PostgreSQL for relational data storage</li>\n              <li>Redis for caching and performance</li>\n              <li>Docker for containerization</li>\n            </ul>\n          </div>\n          <div className=\"border rounded-md p-3\">\n            <h4 className=\"font-semibold mb-2\">Infrastructure</h4>\n            <ul className=\"list-disc pl-6 text-gray-700\">\n              <li>AWS for cloud hosting and services</li>\n              <li>Kubernetes for container orchestration</li>\n              <li>Terraform for infrastructure as code</li>\n              <li>GitHub Actions for CI/CD pipelines</li>\n            </ul>\n          </div>\n          <div className=\"border rounded-md p-3\">\n            <h4 className=\"font-semibold mb-2\">Monitoring & Support</h4>\n            <ul className=\"list-disc pl-6 text-gray-700\">\n              <li>Datadog for comprehensive monitoring</li>\n              <li>ELK stack for logging and analysis</li>\n              <li>PagerDuty for alerts and incidents</li>\n              <li>Zendesk for support ticketing</li>\n            </ul>\n          </div>\n        </div>\n      </section>\n\n      {/* Security Considerations */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Security Considerations</h3>\n        <p className=\"text-gray-700\">\n          Security is a top priority in our technical approach. We will implement:\n        </p>\n        <ul className=\"list-disc pl-6 mt-2 text-gray-700\">\n          <li><strong>Authentication:</strong> Multi-factor authentication and SSO integration</li>\n          <li><strong>Authorization:</strong> Role-based access control with fine-grained permissions</li>\n          <li><strong>Data Protection:</strong> Encryption at rest and in transit</li>\n          <li><strong>Audit Logging:</strong> Comprehensive logging of all system activities</li>\n          <li><strong>Vulnerability Management:</strong> Regular security scans and penetration testing</li>\n          <li><strong>Compliance:</strong> Adherence to industry standards and regulations</li>\n        </ul>\n      </section>\n\n      {/* Implementation Methodology */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Implementation Methodology</h3>\n        <p className=\"text-gray-700\">\n          We follow an Agile development methodology with the following phases:\n        </p>\n        <ol className=\"list-decimal pl-6 mt-2 text-gray-700\">\n          <li><strong>Sprint 0:</strong> Project setup, team onboarding, and detailed planning</li>\n          <li><strong>Development Sprints:</strong> 2-week iterations with daily standups</li>\n          <li><strong>Sprint Reviews:</strong> Demonstrations of completed features</li>\n          <li><strong>Sprint Retrospectives:</strong> Continuous improvement of process</li>\n          <li><strong>Release Planning:</strong> Coordinated deployments to production</li>\n        </ol>\n        <p className=\"text-gray-700 mt-2\">\n          This approach ensures transparency, allows for regular feedback, and enables us to adapt \n          to changing requirements while maintaining project momentum.\n        </p>\n      </section>\n\n      {/* Testing Strategy */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Testing Strategy</h3>\n        <p className=\"text-gray-700\">\n          Our comprehensive testing strategy includes:\n        </p>\n        <ul className=\"list-disc pl-6 mt-2 text-gray-700\">\n          <li><strong>Unit Testing:</strong> Testing individual components in isolation</li>\n          <li><strong>Integration Testing:</strong> Verifying interactions between components</li>\n          <li><strong>Performance Testing:</strong> Ensuring the system meets performance requirements</li>\n          <li><strong>Security Testing:</strong> Identifying and addressing vulnerabilities</li>\n          <li><strong>User Acceptance Testing:</strong> Validation against business requirements</li>\n        </ul>\n        <p className=\"text-gray-700 mt-2\">\n          We employ automated testing wherever possible to ensure consistency and enable continuous integration.\n        </p>\n      </section>\n\n      {/* Technical Team */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Technical Team</h3>\n        <p className=\"text-gray-700\">\n          {data.companyName} will assign a dedicated team of technical experts to this project, including:\n        </p>\n        <ul className=\"list-disc pl-6 mt-2 text-gray-700\">\n          <li><strong>Technical Project Manager:</strong> Overall technical leadership and coordination</li>\n          <li><strong>Solution Architect:</strong> System design and technical decisions</li>\n          <li><strong>Senior Developers:</strong> Implementation of core functionality</li>\n          <li><strong>QA Engineers:</strong> Quality assurance and testing</li>\n          <li><strong>DevOps Engineer:</strong> Deployment and infrastructure management</li>\n          <li><strong>Security Specialist:</strong> Security review and implementation</li>\n        </ul>\n        <p className=\"text-gray-700 mt-2\">\n          Each team member brings extensive experience in their area of specialization and a track record \n          of successful project delivery.\n        </p>\n      </section>\n\n      {/* Pricing & Timeline */}\n      <section>\n        <h3 className=\"text-xl font-bold mb-3\">Pricing & Timeline</h3>\n        <p className=\"text-gray-700\">\n          Based on the technical requirements outlined in the RFP, we propose the following:\n        </p>\n        <div className=\"mt-2 border rounded-md p-4\">\n          <p className=\"text-gray-700\">\n            <strong>Estimated Budget Range:</strong> {\n              data.budgetRange === 'under_50k' ? 'Under $50,000' : \n              data.budgetRange === '50k_100k' ? '$50,000 - $100,000' :\n              data.budgetRange === '100k_250k' ? '$100,000 - $250,000' :\n              data.budgetRange === '250k_500k' ? '$250,000 - $500,000' :\n              data.budgetRange === 'over_500k' ? 'Over $500,000' :\n              'To be determined based on final scope'\n            }\n          </p>\n          <p className=\"text-gray-700 mt-1\">\n            <strong>Estimated Timeline:</strong> 4-6 months from project kickoff to full deployment\n          </p>\n          <p className=\"text-gray-700 mt-1\">\n            <strong>Project Completion Target:</strong> Prior to your deadline of {formatDate(data.submissionDate)}\n          </p>\n        </div>\n        <p className=\"text-gray-700 mt-2\">\n          A detailed technical implementation plan with specific milestones and deliverables will be \n          provided upon project initiation.\n        </p>\n      </section>\n\n      {/* Conclusion */}\n      <section className=\"border-t pt-6\">\n        <h3 className=\"text-xl font-bold mb-3\">Conclusion</h3>\n        <p className=\"text-gray-700\">\n          {data.companyName} is committed to delivering a high-quality technical solution that meets all \n          of {data.clientName}'s requirements for the {data.rfpTitle} project. Our experienced team, \n          proven methodology, and technical expertise make us the ideal partner for this initiative.\n        </p>\n        <p className=\"text-gray-700 mt-2\">\n          We look forward to the opportunity to discuss our proposal in more detail and answer any \n          questions you may have.\n        </p>\n        <p className=\"text-gray-700 mt-4\">\n          <strong>Technical Contact:</strong> For any technical questions or clarifications regarding \n          this proposal, please contact {data.pointOfContact}.\n        </p>\n      </section>\n    </div>\n  );\n}\n","size_bytes":12846},"client/src/components/ReferencePanel.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { FileText, BookOpen, Database, ExternalLink } from \"lucide-react\";\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from \"@/components/ui/accordion\";\nimport ReactMarkdown from 'react-markdown';\n\n// Define the structure of reference data\ninterface Reference {\n  id: number;\n  responseId: number;\n  category: string;\n  requirement: string;\n  response: string;\n  reference?: string;\n  score: number;\n  timestamp?: string;\n}\n\ninterface ReferencePanelProps {\n  responseId?: number;\n  showTitle?: boolean;\n}\n\nexport default function ReferencePanel({ responseId, showTitle = true }: ReferencePanelProps) {\n  const [loading, setLoading] = useState(false);\n  const [references, setReferences] = useState<Reference[]>([]);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchReferences = async () => {\n      if (!responseId) {\n        console.log(\"ReferencePanel: No responseId provided, skipping fetch\");\n        return;\n      }\n      \n      console.log(`ReferencePanel: Fetching references for responseId=${responseId}`);\n      setLoading(true);\n      setError(null);\n      \n      try {\n        const response = await fetch(`/api/excel-requirements/${responseId}/references`);\n        \n        if (!response.ok) {\n          throw new Error(\"Failed to fetch reference data\");\n        }\n        \n        const data = await response.json();\n        console.log(`ReferencePanel: Received ${data.length} references:`, data);\n        setReferences(data);\n      } catch (error) {\n        console.error(\"Error fetching references:\", error);\n        setError(\"Could not load reference information\");\n      } finally {\n        setLoading(false);\n      }\n    };\n    \n    fetchReferences();\n  }, [responseId]);\n\n  if (!responseId) {\n    return null;\n  }\n\n  const renderLoading = () => (\n    <div className=\"space-y-4\">\n      <Skeleton className=\"h-4 w-3/4\" />\n      <Skeleton className=\"h-20 w-full\" />\n      <Skeleton className=\"h-4 w-2/4\" />\n      <Skeleton className=\"h-20 w-full\" />\n    </div>\n  );\n\n  const renderError = () => (\n    <div className=\"text-center py-6 text-slate-600 dark:text-slate-300\">\n      <Database className=\"h-10 w-10 mx-auto mb-2 text-slate-400 dark:text-slate-500\" />\n      <p>{error}</p>\n    </div>\n  );\n\n  const renderNoReferences = () => (\n    <div className=\"text-center py-6 text-slate-600 dark:text-slate-300\">\n      <BookOpen className=\"h-10 w-10 mx-auto mb-2 text-slate-400 dark:text-slate-500\" />\n      <p>No reference information available for this response</p>\n    </div>\n  );\n\n  const renderReferences = () => (\n    <div className=\"space-y-4\">\n      {references.map((reference) => (\n        <div key={reference.id} className=\"border border-slate-200 dark:border-slate-700 rounded-md overflow-hidden\">\n          <Accordion type=\"single\" collapsible className=\"w-full\">\n            <AccordionItem value={`reference-${reference.id}`} className=\"border-none\">\n              <AccordionTrigger className=\"px-4 py-3 hover:bg-slate-50 dark:hover:bg-slate-800\">\n                <div className=\"flex items-center gap-3 text-left\">\n                  <FileText className=\"h-4 w-4 text-slate-500 dark:text-slate-400\" />\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-medium text-slate-900 dark:text-slate-100\">\n                        Reference {reference.reference || `#${reference.id}`}\n                      </span>\n                      <Badge variant=\"outline\" className=\"h-5 text-xs bg-slate-100 text-slate-800 dark:bg-slate-800 dark:text-slate-200 border-slate-200 dark:border-slate-700\">\n                        Score: {(reference.score * 100).toFixed(1)}%\n                      </Badge>\n                    </div>\n                    <p className=\"text-xs text-slate-600 dark:text-slate-400 mt-1\">\n                      {reference.category}\n                    </p>\n                  </div>\n                </div>\n              </AccordionTrigger>\n              <AccordionContent className=\"pb-4\">\n                <div className=\"px-4 space-y-3\">\n                  <div className=\"p-3 bg-slate-50 dark:bg-slate-900 rounded-md border border-slate-200 dark:border-slate-700\">\n                    <span className=\"block text-xs font-medium text-slate-600 dark:text-slate-300 mb-1\">Requirement:</span>\n                    <p className=\"text-sm text-slate-800 dark:text-slate-100\">{reference.requirement}</p>\n                  </div>\n                  <div className=\"p-3 bg-slate-50 dark:bg-slate-900 rounded-md border border-slate-200 dark:border-slate-700\">\n                    <span className=\"block text-xs font-medium text-slate-600 dark:text-slate-300 mb-1\">Response Text:</span>\n                    <div className=\"prose prose-sm max-w-none text-slate-800 dark:text-slate-100\">\n                      <ReactMarkdown>{reference.response}</ReactMarkdown>\n                    </div>\n                  </div>\n                  {reference.reference && (\n                    <div className=\"flex items-center gap-2 text-sm text-blue-600 dark:text-blue-400\">\n                      <ExternalLink className=\"h-4 w-4\" />\n                      <span>Reference ID: {reference.reference}</span>\n                    </div>\n                  )}\n                </div>\n              </AccordionContent>\n            </AccordionItem>\n          </Accordion>\n        </div>\n      ))}\n    </div>\n  );\n\n  // Debug the references data\n  useEffect(() => {\n    if (references && references.length > 0) {\n      console.log(\"ReferencePanel: Reference data structure sample:\", references[0]);\n    }\n  }, [references]);\n\n  return (\n    <Card className=\"mt-6\">\n      {showTitle && (\n        <div className=\"px-6 py-5 border-b border-slate-200 dark:border-slate-700\">\n          <h3 className=\"text-lg font-medium text-slate-800 dark:text-slate-100\">Reference Information</h3>\n          <p className=\"mt-1 text-sm text-slate-600 dark:text-slate-400\">\n            Historical reference data used to generate this response.\n          </p>\n        </div>\n      )}\n      \n      <CardContent className=\"p-6\">\n        {loading ? (\n          renderLoading()\n        ) : error ? (\n          renderError()\n        ) : references.length === 0 ? (\n          renderNoReferences()\n        ) : (\n          renderReferences()\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":6626},"client/src/lib/exportUtils.ts":{"content":"// Export utilities for RFP responses\n\nexport function generateMarkdownContent(data: any): string {\n  // Generate markdown content from data\n  return `# RFP Response\\n\\n${data.requirement}\\n\\n## Response\\n\\n${data.finalResponse || data.moaResponse || data.openaiResponse || ''}`;\n}\n\nexport function downloadMarkdownFile(content: string, filename: string) {\n  const blob = new Blob([content], { type: 'text/markdown' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n  URL.revokeObjectURL(url);\n}\n\nexport function sendEmailWithContent(content: string, recipient: string) {\n  // Placeholder for email sending functionality\n  console.log('Email sending not implemented yet');\n  return Promise.reject(new Error('Email functionality not implemented'));\n}\n\nexport async function downloadExcelFile(data: any[], filename: string) {\n  // Placeholder for Excel export - requires xlsx library\n  const XLSX = await import('xlsx');\n  const worksheet = XLSX.utils.json_to_sheet(data);\n  const workbook = XLSX.utils.book_new();\n  XLSX.utils.book_append_sheet(workbook, worksheet, 'RFP Responses');\n  XLSX.writeFile(workbook, filename);\n}\n","size_bytes":1277},"client/src/components/rfp-templates/GovernmentTemplate.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { RfpFormData } from \"@/lib/types\";\n\ninterface GovernmentTemplateProps {\n  data: RfpFormData;\n}\n\nexport default function GovernmentTemplate({ data }: GovernmentTemplateProps) {\n  const formatDate = (dateString: string) => {\n    if (!dateString) return '';\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  };\n\n  const currentDate = new Date().toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric'\n  });\n\n  return (\n    <div className=\"space-y-6 p-6 bg-white rounded-lg shadow-sm\">\n      {/* Letterhead and Date */}\n      <div className=\"text-right mb-8\">\n        <p className=\"font-bold text-lg\">{data.companyName}</p>\n        <p>{data.pointOfContact}</p>\n        <p>{currentDate}</p>\n      </div>\n\n      {/* Cover Letter */}\n      <section>\n        <p className=\"mb-4\">\n          {data.clientName}<br />\n          RE: Response to Solicitation {data.rfpId} - {data.rfpTitle}\n        </p>\n        \n        <p className=\"mb-2\">Dear Sir/Madam,</p>\n        \n        <p className=\"text-gray-700 mb-2\">\n          {data.companyName} is pleased to submit the enclosed proposal in response to {data.clientName}'s \n          Request for Proposal (Solicitation #{data.rfpId}) for {data.rfpTitle}.\n        </p>\n        \n        <p className=\"text-gray-700 mb-2\">\n          We have carefully reviewed the requirements outlined in the solicitation and are confident in our \n          ability to provide the requested services/products in full compliance with all terms, conditions, \n          and specifications contained in the RFP.\n        </p>\n        \n        <p className=\"text-gray-700 mb-2\">\n          Our proposal demonstrates our understanding of your requirements, our approach to meeting those \n          requirements, and our relevant qualifications and experience in similar projects.\n        </p>\n        \n        <p className=\"text-gray-700 mb-2\">\n          We look forward to the opportunity to serve {data.clientName} and contribute to the success of this \n          important initiative. Should you have any questions or require additional information, please do not \n          hesitate to contact me directly.\n        </p>\n        \n        <p className=\"mt-6 mb-2\">Sincerely,</p>\n        <p className=\"font-bold\">{data.pointOfContact}</p>\n        <p>{data.companyName}</p>\n      </section>\n\n      {/* Formal Title Page */}\n      <div className=\"page-break border-t-2 border-b-2 border-black py-10 my-10 text-center\">\n        <h1 className=\"text-3xl font-bold mb-6\">{data.rfpTitle}</h1>\n        <h2 className=\"text-2xl mb-8\">Request for Proposal Response</h2>\n        <h3 className=\"text-xl mb-2\">Solicitation Number: {data.rfpId}</h3>\n        <h3 className=\"text-xl mb-8\">Submission Deadline: {formatDate(data.submissionDate)}</h3>\n        \n        <div className=\"mt-12\">\n          <p className=\"text-lg font-bold\">{data.companyName}</p>\n          <p>Submitted to: {data.clientName}</p>\n          <p>Date: {currentDate}</p>\n        </div>\n      </div>\n\n      {/* Table of Contents */}\n      <section>\n        <h2 className=\"text-2xl font-bold mb-4\">Table of Contents</h2>\n        <ol className=\"list-decimal pl-6 text-gray-700\">\n          <li>Executive Summary</li>\n          <li>Statement of Compliance</li>\n          <li>Technical Response</li>\n          <li>Management Approach</li>\n          <li>Past Performance</li>\n          <li>Staffing Plan</li>\n          <li>Quality Assurance</li>\n          <li>Detailed Cost Proposal</li>\n          <li>Required Forms & Certifications</li>\n        </ol>\n      </section>\n\n      {/* Executive Summary */}\n      <section>\n        <h2 className=\"text-2xl font-bold mb-4\">1. Executive Summary</h2>\n        <p className=\"text-gray-700 mb-3\">\n          {data.companyName} is a qualified provider of {data.rfpTitle.toLowerCase().includes('services') ? 'services' : 'solutions'} \n          to government agencies and public sector organizations. We understand the specific requirements and challenges of the \n          {data.clientIndustry === 'government' ? ' government sector' : ` ${data.clientIndustry} sector`} and have developed our \n          proposal to address these needs comprehensively.\n        </p>\n        <p className=\"text-gray-700 mb-3\">\n          Our response to this RFP demonstrates our capability to deliver the requested \n          {data.rfpTitle.toLowerCase().includes('services') ? ' services' : ' solution'} in accordance with all specified requirements, \n          while providing best value to {data.clientName}.\n        </p>\n        <p className=\"text-gray-700\">\n          Key highlights of our proposal include:\n        </p>\n        <ul className=\"list-disc pl-6 mt-2 text-gray-700\">\n          <li>Full compliance with all RFP requirements and specifications</li>\n          <li>Extensive experience with similar government/public sector projects</li>\n          <li>Proven approach and methodology tailored to {data.clientName}'s needs</li>\n          <li>Qualified team with relevant expertise and certifications</li>\n          <li>Competitive pricing and superior value proposition</li>\n        </ul>\n      </section>\n\n      {/* Statement of Compliance */}\n      <section>\n        <h2 className=\"text-2xl font-bold mb-4\">2. Statement of Compliance</h2>\n        <p className=\"text-gray-700 mb-3\">\n          {data.companyName} hereby certifies that our proposal complies with all requirements, terms, and conditions \n          specified in Solicitation #{data.rfpId} for {data.rfpTitle}.\n        </p>\n        <p className=\"text-gray-700 mb-3\">\n          We acknowledge receipt of all amendments and addenda to the solicitation and have incorporated them into our response.\n        </p>\n        <p className=\"text-gray-700 mb-3\">\n          Our proposal remains valid for a period of 90 days from the submission date and we are prepared to enter into a \n          contract based on the terms outlined in the RFP.\n        </p>\n        <div className=\"border p-4 mt-4 bg-gray-50\">\n          <p className=\"text-gray-700 italic\">\n            \"We have reviewed all requirements and specifications contained in the RFP and certify our full compliance with each.\"\n          </p>\n        </div>\n      </section>\n\n      {/* Technical Response */}\n      <section>\n        <h2 className=\"text-2xl font-bold mb-4\">3. Technical Response</h2>\n        <p className=\"text-gray-700 mb-3\">\n          {data.companyName} proposes the following technical approach to meet the requirements outlined in the RFP:\n        </p>\n        <h3 className=\"text-lg font-semibold mb-2\">3.1 Understanding of Requirements</h3>\n        <p className=\"text-gray-700 mb-3\">\n          Based on our analysis of the RFP, we understand that {data.clientName} requires:\n        </p>\n        <p className=\"text-gray-700 mb-3 italic\">\n          \"{data.projectSummary}\"\n        </p>\n        <h3 className=\"text-lg font-semibold mb-2 mt-4\">3.2 Technical Approach</h3>\n        <p className=\"text-gray-700 mb-3\">\n          Our approach to addressing these requirements includes:\n        </p>\n        <ul className=\"list-disc pl-6 mt-2 text-gray-700\">\n          <li>Comprehensive needs assessment and requirements validation</li>\n          <li>Systems engineering methodology with formal documentation</li>\n          <li>Phased implementation with defined milestones and deliverables</li>\n          <li>Structured testing and validation procedures</li>\n          <li>Knowledge transfer and training for agency personnel</li>\n        </ul>\n        <h3 className=\"text-lg font-semibold mb-2 mt-4\">3.3 Technical Specifications</h3>\n        <p className=\"text-gray-700 mb-3\">\n          Our proposed solution meets or exceeds all technical specifications outlined in the RFP, including:\n        </p>\n        <ul className=\"list-disc pl-6 mt-2 text-gray-700\">\n          <li>Compliance with relevant government standards and regulations</li>\n          <li>Interoperability with existing systems</li>\n          <li>Scalability to accommodate future growth</li>\n          <li>Security features that meet federal requirements</li>\n          <li>Accessibility compliance (Section 508)</li>\n        </ul>\n      </section>\n\n      {/* Management Approach */}\n      <section>\n        <h2 className=\"text-2xl font-bold mb-4\">4. Management Approach</h2>\n        <p className=\"text-gray-700 mb-3\">\n          {data.companyName} will employ a structured management approach to ensure successful delivery:\n        </p>\n        <h3 className=\"text-lg font-semibold mb-2\">4.1 Project Management Methodology</h3>\n        <p className=\"text-gray-700 mb-3\">\n          We utilize a proven project management framework based on PMI methodologies and tailored for government \n          projects. This approach includes:\n        </p>\n        <ul className=\"list-disc pl-6 mt-2 text-gray-700\">\n          <li>Formal project initiation and planning</li>\n          <li>Regular progress reporting and status meetings</li>\n          <li>Rigorous risk management and mitigation</li>\n          <li>Change control procedures</li>\n          <li>Issue tracking and resolution</li>\n        </ul>\n        <h3 className=\"text-lg font-semibold mb-2 mt-4\">4.2 Project Schedule</h3>\n        <p className=\"text-gray-700 mb-3\">\n          Our preliminary project schedule outlines key milestones and deliverables, with completion targeted \n          before the deadline of {formatDate(data.submissionDate)}.\n        </p>\n        <h3 className=\"text-lg font-semibold mb-2 mt-4\">4.3 Communication Plan</h3>\n        <p className=\"text-gray-700 mb-3\">\n          We will establish clear communication channels and reporting mechanisms to ensure transparency \n          and keep stakeholders informed throughout the project lifecycle.\n        </p>\n      </section>\n\n      {/* Past Performance */}\n      <section>\n        <h2 className=\"text-2xl font-bold mb-4\">5. Past Performance</h2>\n        <p className=\"text-gray-700 mb-3\">\n          {data.companyName} has successfully delivered similar projects for government and public sector clients:\n        </p>\n        <div className=\"border p-4 mt-2 mb-4\">\n          <h4 className=\"font-semibold\">Reference Project 1</h4>\n          <p className=\"text-gray-700\"><strong>Client:</strong> Department of [Agency]</p>\n          <p className=\"text-gray-700\"><strong>Project:</strong> Similar to current RFP requirements</p>\n          <p className=\"text-gray-700\"><strong>Value:</strong> Within similar budget range</p>\n          <p className=\"text-gray-700\"><strong>Outcome:</strong> Successfully delivered on time and within budget</p>\n        </div>\n        <div className=\"border p-4 mb-4\">\n          <h4 className=\"font-semibold\">Reference Project 2</h4>\n          <p className=\"text-gray-700\"><strong>Client:</strong> [Similar Agency]</p>\n          <p className=\"text-gray-700\"><strong>Project:</strong> Related scope and requirements</p>\n          <p className=\"text-gray-700\"><strong>Value:</strong> Within similar budget range</p>\n          <p className=\"text-gray-700\"><strong>Outcome:</strong> Exceeded client expectations</p>\n        </div>\n        <p className=\"text-gray-700\">\n          Complete reference information, including contact details, will be provided upon request.\n        </p>\n      </section>\n\n      {/* Staffing Plan */}\n      <section>\n        <h2 className=\"text-2xl font-bold mb-4\">6. Staffing Plan</h2>\n        <p className=\"text-gray-700 mb-3\">\n          {data.companyName} will assign appropriately qualified personnel to fulfill all requirements of this project:\n        </p>\n        <h3 className=\"text-lg font-semibold mb-2\">6.1 Key Personnel</h3>\n        <p className=\"text-gray-700 mb-3\">\n          Our project team will include the following key roles:\n        </p>\n        <ul className=\"list-disc pl-6 mt-2 text-gray-700\">\n          <li><strong>Project Manager:</strong> Certified PMP with government experience</li>\n          <li><strong>Subject Matter Experts:</strong> Specialists in relevant domains</li>\n          <li><strong>Technical Lead:</strong> Senior technical architect</li>\n          <li><strong>Quality Assurance Manager:</strong> Dedicated to ensuring deliverable quality</li>\n          <li><strong>Contract Manager:</strong> Ensures compliance with contract terms</li>\n        </ul>\n        <h3 className=\"text-lg font-semibold mb-2 mt-4\">6.2 Qualifications and Experience</h3>\n        <p className=\"text-gray-700 mb-3\">\n          All personnel assigned to this project possess the necessary qualifications, security clearances, \n          and experience to successfully perform their roles.\n        </p>\n      </section>\n\n      {/* Quality Assurance */}\n      <section>\n        <h2 className=\"text-2xl font-bold mb-4\">7. Quality Assurance</h2>\n        <p className=\"text-gray-700 mb-3\">\n          {data.companyName} implements comprehensive quality assurance procedures to ensure deliverables \n          meet or exceed requirements:\n        </p>\n        <ul className=\"list-disc pl-6 mt-2 text-gray-700\">\n          <li><strong>Quality Management System:</strong> ISO 9001:2015 compliant processes</li>\n          <li><strong>Quality Control:</strong> Regular reviews and inspections</li>\n          <li><strong>Performance Metrics:</strong> Defined metrics to measure quality</li>\n          <li><strong>Continuous Improvement:</strong> Process for identifying and implementing improvements</li>\n        </ul>\n      </section>\n\n      {/* Detailed Cost Proposal */}\n      <section>\n        <h2 className=\"text-2xl font-bold mb-4\">8. Detailed Cost Proposal</h2>\n        <p className=\"text-gray-700 mb-3\">\n          {data.companyName} provides the following cost proposal for the services/products described in this response:\n        </p>\n        <div className=\"border p-4 mt-2\">\n          <p className=\"text-gray-700\">\n            <strong>Total Estimated Project Cost:</strong> {\n              data.budgetRange === 'under_50k' ? 'Under $50,000' : \n              data.budgetRange === '50k_100k' ? '$50,000 - $100,000' :\n              data.budgetRange === '100k_250k' ? '$100,000 - $250,000' :\n              data.budgetRange === '250k_500k' ? '$250,000 - $500,000' :\n              data.budgetRange === 'over_500k' ? 'Over $500,000' :\n              'To be determined based on final scope'\n            }\n          </p>\n          <p className=\"text-gray-700 mt-2\">\n            <strong>Cost Breakdown:</strong>\n          </p>\n          <ul className=\"list-disc pl-6 mt-1 text-gray-700\">\n            <li>Personnel Costs: [Percentage] of total</li>\n            <li>Equipment/Materials: [Percentage] of total</li>\n            <li>Other Direct Costs: [Percentage] of total</li>\n            <li>Indirect Costs: [Percentage] of total</li>\n          </ul>\n          <p className=\"text-gray-700 mt-2\">\n            <strong>Payment Schedule:</strong> In accordance with contract terms and deliverable acceptance\n          </p>\n        </div>\n        <p className=\"text-gray-700 mt-3\">\n          A detailed line-item cost breakdown is available upon request.\n        </p>\n      </section>\n\n      {/* Required Forms & Certifications */}\n      <section>\n        <h2 className=\"text-2xl font-bold mb-4\">9. Required Forms & Certifications</h2>\n        <p className=\"text-gray-700 mb-3\">\n          {data.companyName} has included all required forms and certifications as specified in the RFP:\n        </p>\n        <ul className=\"list-disc pl-6 mt-2 text-gray-700\">\n          <li>Representations and Certifications (SAM registration current)</li>\n          <li>Small Business Subcontracting Plan (if applicable)</li>\n          <li>Compliance with Federal Acquisition Regulation (FAR) requirements</li>\n          <li>Conflict of Interest Disclosure</li>\n          <li>Other required forms as specified in the RFP</li>\n        </ul>\n      </section>\n\n      {/* Conclusion */}\n      <section className=\"border-t pt-6 mt-8\">\n        <h2 className=\"text-2xl font-bold mb-4\">Conclusion</h2>\n        <p className=\"text-gray-700 mb-3\">\n          {data.companyName} appreciates the opportunity to submit this proposal in response to {data.clientName}'s \n          RFP for {data.rfpTitle}. We are confident in our ability to deliver the requested services/products in \n          full compliance with all requirements and to the highest standards of quality.\n        </p>\n        <p className=\"text-gray-700 mb-3\">\n          We look forward to the possibility of working with {data.clientName} on this important initiative and \n          are available to provide any additional information or clarification that may be required.\n        </p>\n        <div className=\"mt-6\">\n          <p className=\"font-bold\">Contact Information:</p>\n          <p>{data.pointOfContact}</p>\n          <p>{data.companyName}</p>\n        </div>\n      </section>\n    </div>\n  );\n}\n","size_bytes":17032},"client/src/components/mobile-nav-drawer.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Compass, Wrench, Brain, Map, X } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\n\nconst navItems = [\n  {\n    name: \"Conversation\",\n    path: \"/\",\n    icon: Compass,\n    description: \"Chat with the knowledge agent\"\n  },\n  {\n    name: \"Launchpad\",\n    path: \"/workshop\",\n    icon: Wrench,\n    description: \"Interactive tools and utilities\"\n  },\n  {\n    name: \"Quiz\",\n    path: \"/quiz\",\n    icon: Brain,\n    description: \"Test your knowledge\"\n  },\n  {\n    name: \"Atlas\",\n    path: \"/atlas\",\n    icon: Map,\n    description: \"Knowledge map and resources\"\n  }\n];\n\ninterface MobileNavDrawerProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport function MobileNavDrawer({ isOpen, onClose }: MobileNavDrawerProps) {\n  const [location] = useLocation();\n\n  return (\n    <>\n      {/* Backdrop */}\n      <div\n        className={cn(\n          \"fixed inset-0 bg-black/50 z-40 md:hidden transition-opacity duration-300\",\n          isOpen ? \"opacity-100 pointer-events-auto\" : \"opacity-0 pointer-events-none\"\n        )}\n        onClick={onClose}\n        data-testid=\"mobile-menu-backdrop\"\n      />\n\n      {/* Drawer */}\n      <div\n        className={cn(\n          \"fixed left-0 top-0 bottom-0 w-64 bg-card border-r border-border z-50 md:hidden transform transition-transform duration-300 ease-in-out\",\n          isOpen ? \"translate-x-0\" : \"-translate-x-full\"\n        )}\n        data-testid=\"mobile-menu-drawer\"\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b border-border\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center\">\n              <Compass className=\"w-5 h-5 text-primary\" />\n            </div>\n            <span className=\"font-semibold text-foreground\">Navigation</span>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={onClose}\n            className=\"w-9 h-9\"\n            data-testid=\"button-close-menu\"\n          >\n            <X className=\"w-5 h-5\" />\n          </Button>\n        </div>\n\n        {/* Navigation Items */}\n        <nav className=\"flex flex-col p-4 gap-2\">\n          {navItems.map((item) => {\n            const Icon = item.icon;\n            const isActive = location === item.path;\n\n            return (\n              <Link key={item.path} href={item.path}>\n                <div\n                  onClick={onClose}\n                  className={cn(\n                    \"flex items-center gap-3 p-3 rounded-lg transition-all cursor-pointer\",\n                    isActive\n                      ? \"bg-primary text-primary-foreground\"\n                      : \"text-foreground hover:bg-muted\"\n                  )}\n                  data-testid={`mobile-nav-${item.name.toLowerCase()}`}\n                >\n                  <Icon className=\"w-5 h-5\" />\n                  <div className=\"flex flex-col\">\n                    <span className=\"font-medium\">{item.name}</span>\n                    <span className=\"text-xs opacity-70\">{item.description}</span>\n                  </div>\n                </div>\n              </Link>\n            );\n          })}\n        </nav>\n      </div>\n    </>\n  );\n}\n","size_bytes":3325},"client/src/pages/Templates.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { \n  FileText, \n  Edit2, \n  Save, \n  X, \n  Plus, \n  Trash2, \n  ChevronDown,\n  ChevronRight,\n  History,\n  Download,\n  FolderOpen,\n  ArrowLeft\n} from 'lucide-react';\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from '@/components/ui/collapsible';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\nimport type { SolutionTemplate, TemplateSection, TemplateWorkItem, TemplateRevision } from '@shared/schema';\n\ninterface CompleteTemplate {\n  template: SolutionTemplate;\n  sections: Array<TemplateSection & { workItems: TemplateWorkItem[] }>;\n  revisions: TemplateRevision[];\n}\n\nexport default function Templates() {\n  const { toast } = useToast();\n  const [editingSectionId, setEditingSectionId] = useState<number | null>(null);\n  const [editingContent, setEditingContent] = useState<string>('');\n  const [expandedSections, setExpandedSections] = useState<Record<string, boolean>>({});\n  const [showRevisionHistory, setShowRevisionHistory] = useState(false);\n  const [templateExpanded, setTemplateExpanded] = useState(false);\n\n  // Fetch complete template\n  const { data: completeTemplate, isLoading } = useQuery({\n    queryKey: ['/api/solution-templates', 'complete'],\n    queryFn: async (): Promise<CompleteTemplate | null> => {\n      // First try to get default template\n      const defaultResponse = await fetch('/api/solution-templates/default', {\n        credentials: 'include'\n      });\n      \n      if (!defaultResponse.ok) {\n        // If no default template exists, create one\n        const createResponse = await apiRequest('POST', '/api/solution-templates/init');\n        if (!createResponse.ok) {\n          throw new Error('Failed to initialize template');\n        }\n        const newTemplate = await createResponse.json();\n        \n        // Get complete template\n        const completeResponse = await fetch(`/api/solution-templates/${newTemplate.id}/complete`, {\n          credentials: 'include'\n        });\n        return completeResponse.json();\n      }\n      \n      const defaultTemplate = await defaultResponse.json();\n      \n      // Get complete template with sections\n      const completeResponse = await fetch(`/api/solution-templates/${defaultTemplate.id}/complete`, {\n        credentials: 'include'\n      });\n      return completeResponse.json();\n    }\n  });\n\n  // Update section mutation\n  const updateSectionMutation = useMutation({\n    mutationFn: async ({ id, content }: { id: number; content: string }) => {\n      return apiRequest('PUT', `/api/template-sections/${id}`, { content });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/solution-templates'] });\n      setEditingSectionId(null);\n      toast({\n        title: \"Section Updated\",\n        description: \"Template section has been updated successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update section.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Add work item mutation\n  const addWorkItemMutation = useMutation({\n    mutationFn: async ({ sectionId, title }: { sectionId: number; title: string }) => {\n      // Get current work items count for order index\n      const section = completeTemplate?.sections.find(s => s.id === sectionId);\n      const orderIndex = section?.workItems.length || 0;\n      \n      return apiRequest('POST', '/api/template-work-items', {\n        sectionId,\n        title,\n        content: '',\n        orderIndex,\n        isIncluded: true\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/solution-templates'] });\n      toast({\n        title: \"Work Item Added\",\n        description: \"New work item has been added successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to add work item.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update work item mutation\n  const updateWorkItemMutation = useMutation({\n    mutationFn: async ({ id, updates }: { id: number; updates: Partial<TemplateWorkItem> }) => {\n      return apiRequest('PUT', `/api/template-work-items/${id}`, updates);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/solution-templates'] });\n      toast({\n        title: \"Work Item Updated\",\n        description: \"Work item has been updated successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update work item.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete work item mutation\n  const deleteWorkItemMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest('DELETE', `/api/template-work-items/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/solution-templates'] });\n      toast({\n        title: \"Work Item Deleted\",\n        description: \"Work item has been deleted successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete work item.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleStartEdit = (section: TemplateSection) => {\n    setEditingSectionId(section.id);\n    setEditingContent(section.content || '');\n  };\n\n  const handleSaveSection = () => {\n    if (editingSectionId) {\n      updateSectionMutation.mutate({\n        id: editingSectionId,\n        content: editingContent\n      });\n    }\n  };\n\n  const handleCancelEdit = () => {\n    setEditingSectionId(null);\n    setEditingContent('');\n  };\n\n  const toggleSection = (sectionType: string) => {\n    setExpandedSections(prev => ({\n      ...prev,\n      [sectionType]: !prev[sectionType]\n    }));\n  };\n\n  const getSectionIcon = (sectionType: string) => {\n    return <FileText className=\"w-5 h-5\" />;\n  };\n\n  const getSectionDescription = (sectionType: string) => {\n    const descriptions: Record<string, string> = {\n      heading: \"Document title and header information\",\n      revisionHistory: \"Track all changes made to this document\",\n      tableOfContents: \"Automatically generated navigation\",\n      changeRequirement: \"Explain why this change is being done\",\n      pdaReference: \"Enter or paste PDA reference number\",\n      pfasReference: \"Enter or paste PFAS document reference\",\n      businessImpact: \"Impact analysis of implementing or not implementing\",\n      affectedSystems: \"List of systems impacted by this change\",\n      solution: \"Detailed technical solution with work items\",\n      testScenarios: \"Test cases and validation criteria\"\n    };\n    return descriptions[sectionType] || \"\";\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-muted-foreground\">Loading template...</div>\n      </div>\n    );\n  }\n\n  if (!completeTemplate) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-muted-foreground\">No template found</div>\n      </div>\n    );\n  }\n\n  const { template, sections, revisions } = completeTemplate;\n\n  // Template card view (collapsed)\n  if (!templateExpanded) {\n    return (\n      <div className=\"max-w-4xl mx-auto pl-6 py-8\">\n        <div className=\"mb-6\">\n          <h1 className=\"text-2xl font-bold text-foreground\">Report Templates</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Select a template to view and customize\n          </p>\n        </div>\n\n        {/* Template Card */}\n        <Card \n          className=\"cursor-pointer hover:border-primary hover:shadow-lg transition-all duration-200\"\n          onClick={() => setTemplateExpanded(true)}\n          data-testid=\"card-template\"\n        >\n          <CardHeader>\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex items-start gap-4 flex-1\">\n                <div className=\"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                  <FileText className=\"w-6 h-6 text-primary\" />\n                </div>\n                <div className=\"flex-1\">\n                  <CardTitle className=\"text-xl flex items-center gap-2\">\n                    {template.title}\n                    {template.isDefault && (\n                      <Badge variant=\"secondary\" className=\"text-xs\">Default</Badge>\n                    )}\n                  </CardTitle>\n                  <CardDescription className=\"mt-2\">\n                    {template.description || \"Business Analyst standard format for system change documentation\"}\n                  </CardDescription>\n                  <div className=\"flex items-center gap-4 mt-4 text-sm text-muted-foreground\">\n                    <div className=\"flex items-center gap-1\">\n                      <FileText className=\"w-4 h-4\" />\n                      <span>{sections.length} sections</span>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <History className=\"w-4 h-4\" />\n                      <span>{revisions.length} revisions</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <FolderOpen className=\"w-5 h-5 text-muted-foreground flex-shrink-0 ml-4\" />\n            </div>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between pt-2 border-t border-border\">\n              <p className=\"text-sm text-muted-foreground\">\n                Click to view and edit template sections\n              </p>\n              <ChevronRight className=\"w-5 h-5 text-muted-foreground\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  // Expanded template view with all sections\n  return (\n    <div className=\"max-w-6xl mx-auto pl-6 py-6 space-y-6\">\n      {/* Header with Back Button */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setTemplateExpanded(false)}\n            data-testid=\"button-back-to-templates\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Templates\n          </Button>\n          <div className=\"border-l border-border h-6\"></div>\n          <div>\n            <h1 className=\"text-2xl font-bold text-foreground\">{template.title}</h1>\n            <p className=\"text-muted-foreground mt-1\">\n              Business Analyst standard format for system change documentation\n            </p>\n          </div>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setShowRevisionHistory(!showRevisionHistory)}\n            data-testid=\"button-show-history\"\n          >\n            <History className=\"w-4 h-4 mr-2\" />\n            History ({revisions.length})\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            data-testid=\"button-export-template\"\n          >\n            <Download className=\"w-4 h-4 mr-2\" />\n            Export\n          </Button>\n        </div>\n      </div>\n\n      {/* Revision History */}\n      {showRevisionHistory && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Revision History</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {revisions.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">No revisions yet</p>\n              ) : (\n                revisions.map((revision) => (\n                  <div key={revision.id} className=\"flex items-start gap-3 border-b border-border pb-3 last:border-0\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant=\"outline\">{revision.version}</Badge>\n                        <span className=\"text-sm text-muted-foreground\">\n                          {revision.changeDate ? new Date(revision.changeDate).toLocaleDateString() : 'N/A'}\n                        </span>\n                      </div>\n                      <p className=\"text-sm mt-1\">{revision.changeDescription}</p>\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Template Sections */}\n      <div className=\"space-y-4\">\n        {sections.map((section) => {\n          const isExpanded = expandedSections[section.sectionType] !== false;\n          const isEditing = editingSectionId === section.id;\n          const hasFocusArea = section.sectionType === 'solution';\n\n          return (\n            <Card key={section.id} className=\"overflow-hidden\">\n              <Collapsible open={isExpanded} onOpenChange={() => toggleSection(section.sectionType)}>\n                <CollapsibleTrigger asChild>\n                  <CardHeader className=\"cursor-pointer hover:bg-accent/50 transition-colors\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        {isExpanded ? (\n                          <ChevronDown className=\"w-5 h-5 text-muted-foreground\" />\n                        ) : (\n                          <ChevronRight className=\"w-5 h-5 text-muted-foreground\" />\n                        )}\n                        {getSectionIcon(section.sectionType)}\n                        <div>\n                          <CardTitle className=\"text-lg\">{section.title}</CardTitle>\n                          <p className=\"text-xs text-muted-foreground mt-1\">\n                            {getSectionDescription(section.sectionType)}\n                          </p>\n                        </div>\n                      </div>\n                      <Badge variant=\"outline\" className=\"ml-4\">\n                        {section.sectionType}\n                      </Badge>\n                    </div>\n                  </CardHeader>\n                </CollapsibleTrigger>\n\n                <CollapsibleContent>\n                  <CardContent className=\"pt-4 space-y-4\">\n                    {/* Section Content */}\n                    {isEditing ? (\n                      <div className=\"space-y-3\">\n                        <Textarea\n                          value={editingContent}\n                          onChange={(e) => setEditingContent(e.target.value)}\n                          placeholder=\"Enter content for this section...\"\n                          className=\"min-h-[200px] font-mono text-sm\"\n                          data-testid={`textarea-section-${section.id}`}\n                        />\n                        <div className=\"flex gap-2\">\n                          <Button\n                            size=\"sm\"\n                            onClick={handleSaveSection}\n                            disabled={updateSectionMutation.isPending}\n                            data-testid={`button-save-section-${section.id}`}\n                          >\n                            <Save className=\"w-4 h-4 mr-2\" />\n                            Save\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={handleCancelEdit}\n                            data-testid={`button-cancel-edit-${section.id}`}\n                          >\n                            <X className=\"w-4 h-4 mr-2\" />\n                            Cancel\n                          </Button>\n                        </div>\n                      </div>\n                    ) : (\n                      <div>\n                        {section.content ? (\n                          <div className=\"prose prose-sm max-w-none\">\n                            <pre className=\"whitespace-pre-wrap bg-muted p-4 rounded-md text-sm\">\n                              {section.content}\n                            </pre>\n                          </div>\n                        ) : (\n                          <p className=\"text-sm text-muted-foreground italic\">\n                            No content yet. Click Edit to add content.\n                          </p>\n                        )}\n                        {section.isEditable && (\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => handleStartEdit(section)}\n                            className=\"mt-3\"\n                            data-testid={`button-edit-section-${section.id}`}\n                          >\n                            <Edit2 className=\"w-4 h-4 mr-2\" />\n                            Edit\n                          </Button>\n                        )}\n                      </div>\n                    )}\n\n                    {/* Work Items for Solution Section */}\n                    {hasFocusArea && section.workItems && (\n                      <div className=\"mt-6 space-y-4\">\n                        <div className=\"flex items-center justify-between\">\n                          <h3 className=\"text-sm font-semibold\">Work Items</h3>\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => {\n                              const title = prompt(\"Enter work item title:\");\n                              if (title) {\n                                addWorkItemMutation.mutate({ sectionId: section.id, title });\n                              }\n                            }}\n                            data-testid=\"button-add-work-item\"\n                          >\n                            <Plus className=\"w-4 h-4 mr-2\" />\n                            Add Work Item\n                          </Button>\n                        </div>\n\n                        <div className=\"space-y-3\">\n                          {section.workItems.length === 0 ? (\n                            <p className=\"text-sm text-muted-foreground italic\">\n                              No work items yet. Add work items like \"Description of Change\", \"Logic and Validations\", etc.\n                            </p>\n                          ) : (\n                            section.workItems.map((workItem) => (\n                              <Card key={workItem.id} className=\"bg-muted/30\">\n                                <CardContent className=\"pt-4\">\n                                  <div className=\"flex items-start justify-between gap-3\">\n                                    <div className=\"flex-1\">\n                                      <div className=\"flex items-center gap-2\">\n                                        <h4 className=\"font-medium text-sm\">{workItem.title}</h4>\n                                        <Badge \n                                          variant={workItem.isIncluded ? \"default\" : \"secondary\"}\n                                          className=\"text-xs\"\n                                        >\n                                          {workItem.isIncluded ? \"Included\" : \"Optional\"}\n                                        </Badge>\n                                      </div>\n                                      {workItem.content && (\n                                        <p className=\"text-sm text-muted-foreground mt-2 whitespace-pre-wrap\">\n                                          {workItem.content}\n                                        </p>\n                                      )}\n                                    </div>\n                                    <div className=\"flex gap-1\">\n                                      <Button\n                                        size=\"sm\"\n                                        variant=\"ghost\"\n                                        onClick={() => {\n                                          const content = prompt(\"Edit work item content:\", workItem.content || \"\");\n                                          if (content !== null) {\n                                            updateWorkItemMutation.mutate({\n                                              id: workItem.id,\n                                              updates: { content }\n                                            });\n                                          }\n                                        }}\n                                        data-testid={`button-edit-work-item-${workItem.id}`}\n                                      >\n                                        <Edit2 className=\"w-4 h-4\" />\n                                      </Button>\n                                      <Button\n                                        size=\"sm\"\n                                        variant=\"ghost\"\n                                        onClick={() => {\n                                          if (confirm(\"Delete this work item?\")) {\n                                            deleteWorkItemMutation.mutate(workItem.id);\n                                          }\n                                        }}\n                                        data-testid={`button-delete-work-item-${workItem.id}`}\n                                      >\n                                        <Trash2 className=\"w-4 h-4 text-destructive\" />\n                                      </Button>\n                                    </div>\n                                  </div>\n                                </CardContent>\n                              </Card>\n                            ))\n                          )}\n                        </div>\n                      </div>\n                    )}\n                  </CardContent>\n                </CollapsibleContent>\n              </Collapsible>\n            </Card>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","size_bytes":22492},"client/src/components/forms/InvestmentForm.tsx":{"content":"import { useState } from \"react\"\nimport { useForm } from \"react-hook-form\"\nimport { zodResolver } from \"@hookform/resolvers/zod\"\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\"\nimport { apiRequest } from \"@/lib/queryClient\"\nimport { useToast } from \"@/hooks/use-toast\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport { Textarea } from \"@/components/ui/textarea\"\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\"\nimport { FileUpload } from \"@/components/ui/file-upload\"\nimport { MultiTabDocumentUpload } from \"@/components/documents/MultiTabDocumentUpload\"\nimport { Card, CardContent } from \"@/components/ui/card\"\nimport { TextEnhancementModal } from \"@/components/ai/TextEnhancementModal\"\nimport { insertInvestmentRequestSchema } from \"@shared/schema\"\nimport { z } from \"zod\"\nimport { useLocation } from \"wouter\"\nimport { Sparkles } from \"lucide-react\"\n\nconst formSchema = insertInvestmentRequestSchema.omit({\n  requestId: true,\n  requesterId: true,\n  currentApprovalStage: true,\n  slaDeadline: true,\n  status: true,\n}).extend({\n  reportDate: z.string().min(1, \"Date is required\"),\n  reportTitle: z.string().min(1, \"Report title is required\"),\n  createdBy: z.string().min(1, \"Creator name is required\"),\n})\n\ntype FormData = z.infer<typeof formSchema>\n\ninterface DocumentUploadTab {\n  id: string;\n  categoryId: number | null;\n  customCategoryName: string;\n  files: File[];\n}\n\nexport function InvestmentForm() {\n  const [, setLocation] = useLocation()\n  const [documentTabs, setDocumentTabs] = useState<DocumentUploadTab[]>([])\n  const [isEnhancementModalOpen, setIsEnhancementModalOpen] = useState(false)\n  const { toast } = useToast()\n  const queryClient = useQueryClient()\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      targetCompany: \"\",\n      investmentType: \"equity\",\n      reportDate: new Date().toISOString().split('T')[0],\n      reportTitle: \"\",\n      createdBy: \"\",\n      description: \"\",\n    },\n  })\n\n\n  const saveDraft = useMutation({\n    mutationFn: async (data: FormData) => {\n      // Convert form data to proper API format\n      const apiData = {\n        ...data,\n        status: \"draft\",\n      }\n      \n      const response = await apiRequest(\"POST\", \"/api/investments\", apiData)\n      const investment = await response.json()\n      \n      // Upload files from document tabs (draft) with improved error handling\n      if (documentTabs.length > 0) {\n        console.log(`Starting draft upload process for ${documentTabs.length} document tabs`)\n        \n        try {\n          // Process each tab sequentially to avoid race conditions\n          for (let i = 0; i < documentTabs.length; i++) {\n            const tab = documentTabs[i]\n            \n            if (tab.files.length > 0 && tab.categoryId) {\n              console.log(`Uploading draft files for tab ${i + 1}/${documentTabs.length}:`, tab.id)\n              \n              // Retry logic for each tab (unlimited retries for testing)\n              let uploadSuccess = false\n              let retryCount = 0\n              const maxRetries = 10 // Increased for testing purposes\n              \n              while (!uploadSuccess && retryCount < maxRetries) {\n                try {\n                  const formData = new FormData()\n                  tab.files.forEach((file) => {\n                    formData.append('documents', file)\n                  })\n                  formData.append('requestType', 'investment')\n                  formData.append('requestId', investment.id.toString())\n                  \n                  // Create category data for this tab\n                  const categoryData = {\n                    categoryId: tab.categoryId,\n                    customCategoryName: tab.customCategoryName || ''\n                  }\n                  formData.append('categories', JSON.stringify([categoryData]))\n                  \n                  // Add timeout to prevent hanging requests - increase for large files\n                  const controller = new AbortController()\n                  const timeoutId = setTimeout(() => controller.abort(), 120000) // 2 minute timeout for large files\n                  \n                  const uploadResponse = await fetch('/api/documents/upload', {\n                    method: 'POST',\n                    body: formData,\n                    credentials: 'include',\n                    signal: controller.signal,\n                  })\n                  \n                  clearTimeout(timeoutId)\n                  \n                  if (!uploadResponse.ok) {\n                    const errorText = await uploadResponse.text()\n                    throw new Error(`Draft upload failed with status ${uploadResponse.status}: ${errorText}`)\n                  }\n                  \n                  const result = await uploadResponse.json()\n                  const documentsCount = result.documents ? result.documents.length : (result.length || 0)\n                  console.log(`Draft files uploaded successfully for tab ${tab.id}:`, documentsCount, 'documents')\n                  \n                  // Check for partial upload warnings\n                  if (result.errors && result.errors.length > 0) {\n                    console.warn(`Partial draft upload for tab ${tab.id}:`, result.errors)\n                  }\n                  uploadSuccess = true\n                  \n                } catch (error) {\n                  retryCount++\n                  console.warn(`Draft upload attempt ${retryCount} failed for tab ${tab.id}:`, error)\n                  \n                  if (retryCount < maxRetries) {\n                    console.log(`Retrying draft upload for tab ${tab.id} in 2 seconds...`)\n                    await new Promise(resolve => setTimeout(resolve, 2000)) // Wait 2 seconds before retry\n                  } else {\n                    console.error(`All retry attempts failed for draft tab ${tab.id}`)\n                    let errorMessage = \"Failed to upload documents\";\n                    if (error instanceof Error) {\n                      if (error.name === 'AbortError') {\n                        errorMessage = \"Upload timeout - files may be too large or connection too slow\";\n                      } else if (error.message.includes('413')) {\n                        errorMessage = \"File too large - maximum size is 50MB per file\";\n                      } else if (error.message.includes('415')) {\n                        errorMessage = \"Unsupported file type - only PDF, DOC, XLS, TXT and images are allowed\";\n                      } else {\n                        errorMessage = error.message;\n                      }\n                    }\n                    throw new Error(`${errorMessage} after ${maxRetries} attempts`);\n                  }\n                }\n              }\n            } else if (tab.files.length > 0 && !tab.categoryId) {\n              console.warn(`Draft tab ${tab.id} has files but no category selected - skipping upload`)\n            }\n          }\n          \n          console.log(\"All draft document uploads completed successfully\")\n        } catch (uploadError) {\n          console.error(\"Draft document upload process failed:\", uploadError)\n          // Don't delete the draft if upload fails - user can manually upload later\n          console.log(\"Draft investment created but document upload failed - user can upload documents manually\")\n          throw new Error(`Draft created successfully, but failed to upload documents: ${uploadError instanceof Error ? uploadError.message : String(uploadError)}`)\n        }\n      }\n      \n      return investment\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/investments\"] })\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/stats\"] })\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/recent-requests\"] })\n      \n      toast({\n        title: \"Draft saved\",\n        description: \"Your report has been saved as a draft\",\n      })\n      \n      // Clear document tabs and redirect to My Reports\n      setDocumentTabs([])\n      setLocation(\"/investment-portal/investments\")\n    },\n    onError: (error: any) => {\n      console.error(\"Draft save error:\", error)\n      toast({\n        title: \"Error saving draft\",\n        description: error.message || \"Something went wrong\",\n        variant: \"destructive\",\n      })\n    },\n  })\n\n  const onSaveDraft = async () => {\n    // Trigger form validation before saving\n    const isValid = await form.trigger()\n    if (!isValid) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please fill in all required fields before saving\",\n        variant: \"destructive\",\n      })\n      return\n    }\n    \n    const currentData = form.getValues()\n    saveDraft.mutate(currentData)\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Basic Information */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <h3 className=\"text-lg font-semibold mb-4\">Basic Information</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"investmentType\">Report Type</Label>\n              <Select \n                value={form.watch(\"investmentType\")} \n                onValueChange={(value) => form.setValue(\"investmentType\", value)}\n              >\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select report type...\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"base_document\">Base Document</SelectItem>\n                  <SelectItem value=\"rfp_report\">RFP Report</SelectItem>\n                </SelectContent>\n              </Select>\n              {form.formState.errors.investmentType && (\n                <p className=\"text-sm text-red-600\">{form.formState.errors.investmentType.message}</p>\n              )}\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"targetCompany\">Subject / Client Name</Label>\n              <Input\n                id=\"targetCompany\"\n                placeholder=\"Enter subject or client name\"\n                {...form.register(\"targetCompany\")}\n              />\n              {form.formState.errors.targetCompany && (\n                <p className=\"text-sm text-red-600\">{form.formState.errors.targetCompany.message}</p>\n              )}\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mt-6\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"reportDate\">Date</Label>\n              <Input\n                id=\"reportDate\"\n                type=\"date\"\n                {...form.register(\"reportDate\")}\n              />\n              {form.formState.errors.reportDate && (\n                <p className=\"text-sm text-red-600\">{form.formState.errors.reportDate.message}</p>\n              )}\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"reportTitle\">Title of Report</Label>\n              <Input\n                id=\"reportTitle\"\n                placeholder=\"Enter report title\"\n                {...form.register(\"reportTitle\")}\n              />\n              {form.formState.errors.reportTitle && (\n                <p className=\"text-sm text-red-600\">{form.formState.errors.reportTitle.message}</p>\n              )}\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"createdBy\">Created By</Label>\n              <Input\n                id=\"createdBy\"\n                placeholder=\"Enter your name\"\n                {...form.register(\"createdBy\")}\n              />\n              {form.formState.errors.createdBy && (\n                <p className=\"text-sm text-red-600\">{form.formState.errors.createdBy.message}</p>\n              )}\n            </div>\n          </div>\n\n          <div className=\"mt-6\">\n            <Label htmlFor=\"description\">Report Description</Label>\n            <div className=\"relative\">\n              <Textarea\n                id=\"description\"\n                rows={4}\n                placeholder=\"Describe the report objectives and scope...\"\n                {...form.register(\"description\")}\n                className=\"mt-2\"\n              />\n              {/* AI Enhancement Button */}\n              <Button\n                type=\"button\"\n                size=\"sm\"\n                variant=\"outline\"\n                className=\"absolute bottom-2 right-2 h-8 w-8 p-0 hover:bg-primary hover:text-primary-foreground transition-colors\"\n                onClick={() => setIsEnhancementModalOpen(true)}\n                title=\"AI Text Enhancement\"\n              >\n                <Sparkles className=\"h-4 w-4\" />\n              </Button>\n            </div>\n            {form.formState.errors.description && (\n              <p className=\"text-sm text-red-600\">{form.formState.errors.description.message}</p>\n            )}\n          </div>\n\n        </CardContent>\n      </Card>\n\n      {/* Document Upload */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <h3 className=\"text-lg font-semibold mb-4\">Document Upload</h3>\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            Upload supporting documents for this report (optional)\n          </p>\n          <FileUpload\n            onFilesChange={(files) => {\n              // Update document tabs with simple structure - use default category 1\n              setDocumentTabs([{\n                id: 'documents',\n                categoryId: 1, // Default category for general documents\n                customCategoryName: 'Report Documents',\n                files: files\n              }]);\n            }}\n          />\n        </CardContent>\n      </Card>\n\n      {/* Form Actions */}\n      <div className=\"flex items-center justify-end space-x-4 pt-6 border-t\">\n        <Button \n          type=\"button\" \n          variant=\"outline\"\n          onClick={() => setLocation(\"/investment-portal\")}\n          data-testid=\"button-cancel\"\n        >\n          Cancel\n        </Button>\n        <Button\n          type=\"button\"\n          onClick={onSaveDraft}\n          disabled={saveDraft.isPending}\n          data-testid=\"button-save-draft\"\n        >\n          {saveDraft.isPending ? \"Saving...\" : \"Save as Draft\"}\n        </Button>\n      </div>\n\n      {/* AI Text Enhancement Modal */}\n      <TextEnhancementModal\n        isOpen={isEnhancementModalOpen}\n        onClose={() => setIsEnhancementModalOpen(false)}\n        originalText={form.watch(\"description\") || \"\"}\n        onApply={(enhancedText) => {\n          // Replace the original description with enhanced text\n          form.setValue(\"description\", enhancedText);\n          toast({\n            title: \"Text Enhanced\",\n            description: \"Your investment description has been improved and replaced with AI enhancement.\",\n          });\n        }}\n      />\n    </div>\n  )\n}\n","size_bytes":15132},"client/src/pages/MyInvestments.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { \n  Briefcase, \n  DollarSign, \n  Calendar, \n  TrendingUp, \n  Eye, \n  Filter, \n  X, \n  ChevronDown, \n  ChevronUp,\n  Clock,\n  CheckCircle,\n  AlertTriangle,\n  Trash2,\n  FileText,\n  User\n} from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { useState, useMemo } from \"react\";\nimport { InvestmentDetailsInline } from \"@/components/details/InvestmentDetailsInline\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\n// Filter interfaces\ninterface InvestmentFilters {\n  searchReportCode: string;\n  selectedCompanies: string[];\n  selectedReportTypes: string[];\n}\n\nexport default function MyInvestments() {\n  const [expandedInvestment, setExpandedInvestment] = useState<number | null>(null);\n  const [isFilterOpen, setIsFilterOpen] = useState(false);\n  const [activeTab, setActiveTab] = useState('all');\n  \n  // Filter state\n  const [filters, setFilters] = useState<InvestmentFilters>({\n    searchReportCode: '',\n    selectedCompanies: [],\n    selectedReportTypes: [],\n  });\n\n  const { data: investments, isLoading } = useQuery({\n    queryKey: [\"/api/investments\"],\n  });\n\n  const handleToggleDetails = (investmentId: number) => {\n    setExpandedInvestment(expandedInvestment === investmentId ? null : investmentId);\n  };\n\n  // Extract unique values for filter options\n  const uniqueCompanies = useMemo(() => {\n    return [...new Set(investments?.map((inv: any) => inv.targetCompany) || [])].sort();\n  }, [investments]);\n\n  const uniqueReportTypes = useMemo(() => {\n    return [...new Set(investments?.map((inv: any) => inv.investmentType) || [])].sort();\n  }, [investments]);\n\n  // Filter investments based on current filters\n  const filteredInvestments = useMemo(() => {\n    if (!investments) return [];\n    \n    return investments.filter((inv: any) => {\n      // Search by Report Code filter\n      if (filters.searchReportCode.trim()) {\n        const searchTerm = filters.searchReportCode.toLowerCase();\n        const reportCodeMatch = inv.reportCode && inv.reportCode.toLowerCase().includes(searchTerm);\n        const requestIdMatch = inv.requestId && inv.requestId.toLowerCase().includes(searchTerm);\n        if (!reportCodeMatch && !requestIdMatch) {\n          return false;\n        }\n      }\n      \n      // Company/Subject filter\n      if (filters.selectedCompanies.length > 0 && !filters.selectedCompanies.includes(inv.targetCompany)) {\n        return false;\n      }\n      \n      // Report type filter\n      if (filters.selectedReportTypes.length > 0 && !filters.selectedReportTypes.includes(inv.investmentType)) {\n        return false;\n      }\n      \n      return true;\n    });\n  }, [investments, filters]);\n\n  // Clear all filters\n  const clearFilters = () => {\n    setFilters({\n      searchReportCode: '',\n      selectedCompanies: [],\n      selectedReportTypes: [],\n    });\n  };\n\n  // Count active filters\n  const activeFilterCount = useMemo(() => {\n    let count = 0;\n    if (filters.searchReportCode.trim()) count++;\n    if (filters.selectedCompanies.length > 0) count++;\n    if (filters.selectedReportTypes.length > 0) count++;\n    return count;\n  }, [filters]);\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'pending':\n        return 'bg-yellow-100 text-yellow-800';\n      case 'approved':\n        return 'bg-green-100 text-green-800';\n      case 'rejected':\n        return 'bg-red-100 text-red-800';\n      case 'changes_requested':\n        return 'bg-blue-100 text-blue-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'pending':\n        return <Clock className=\"w-4 h-4\" />;\n      case 'approved':\n        return <CheckCircle className=\"w-4 h-4\" />;\n      case 'rejected':\n        return <AlertTriangle className=\"w-4 h-4\" />;\n      case 'changes_requested':\n        return <Eye className=\"w-4 h-4\" />;\n      default:\n        return <Clock className=\"w-4 h-4\" />;\n    }\n  };\n\n  const getRiskColor = (risk: string) => {\n    switch (risk) {\n      case 'high':\n        return 'bg-red-100 text-red-800';\n      case 'medium':\n        return 'bg-yellow-100 text-yellow-800';\n      case 'low':\n        return 'bg-green-100 text-green-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"space-y-4\">\n          {[...Array(5)].map((_, i) => (\n            <div key={i} className=\"bg-white p-6 rounded-lg shadow animate-pulse\">\n              <div className=\"h-4 bg-gray-200 rounded w-3/4 mb-2\"></div>\n              <div className=\"h-4 bg-gray-200 rounded w-1/2\"></div>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  // Filter logic based on actual approval states - now using filtered investments\n  const pendingInvestments = filteredInvestments?.filter((inv: any) => {\n    // Pending means not fully approved and not rejected\n    const status = inv.status.toLowerCase();\n    return !status.includes('approved') && !status.includes('rejected') && status !== 'approved';\n  }) || [];\n  \n  const approvedInvestments = filteredInvestments?.filter((inv: any) => {\n    // Approved means final approval status (only \"approved\", not partial approvals)\n    return inv.status.toLowerCase() === 'approved';\n  }) || [];\n  \n  const rejectedInvestments = filteredInvestments?.filter((inv: any) => {\n    // Rejected by any approver\n    const status = inv.status.toLowerCase();\n    return status === 'rejected' || status.includes('rejected');\n  }) || [];\n\n  return (\n    <div className=\"w-full h-full pl-6 py-6\">\n      <div className=\"w-full mb-6\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h1 className=\"text-2xl font-semibold\">My Reports</h1>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setIsFilterOpen(!isFilterOpen)}\n              className=\"flex items-center gap-2\"\n            >\n              <Filter className=\"h-4 w-4\" />\n              Filters\n              {activeFilterCount > 0 && (\n                <Badge variant=\"secondary\" className=\"ml-1\">\n                  {activeFilterCount}\n                </Badge>\n              )}\n              {isFilterOpen ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n            </Button>\n          </div>\n        </div>\n\n        {/* Filter Panel */}\n        <Collapsible open={isFilterOpen} onOpenChange={setIsFilterOpen}>\n          <CollapsibleContent>\n            <Card className=\"mb-4 p-4 border-2 border-dashed border-blue-200 dark:border-blue-800\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                \n                {/* Search by Report Code */}\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-medium\">Search by Report Code</Label>\n                  <Input\n                    type=\"text\"\n                    placeholder=\"Enter Report Code (e.g., RPT-2025-001)\"\n                    value={filters.searchReportCode}\n                    onChange={(e) => setFilters(prev => ({ ...prev, searchReportCode: e.target.value }))}\n                    className=\"w-full\"\n                  />\n                </div>\n                \n                {/* Company/Subject Filter */}\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-medium\">Subject / Client Name</Label>\n                  <Select \n                    value={filters.selectedCompanies.length > 0 ? filters.selectedCompanies[0] : \"all\"} \n                    onValueChange={(value) => \n                      setFilters(prev => ({ \n                        ...prev, \n                        selectedCompanies: value === \"all\" ? [] : [value] \n                      }))\n                    }\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select subject/client\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">All Subjects/Clients</SelectItem>\n                      {uniqueCompanies.map(company => (\n                        <SelectItem key={company} value={company}>{company}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* Report Type Filter */}\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-medium\">Report Type</Label>\n                  <Select \n                    value={filters.selectedReportTypes.length > 0 ? filters.selectedReportTypes[0] : \"all\"} \n                    onValueChange={(value) => \n                      setFilters(prev => ({ \n                        ...prev, \n                        selectedReportTypes: value === \"all\" ? [] : [value] \n                      }))\n                    }\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Select report type\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">All Types</SelectItem>\n                      {uniqueReportTypes.map(type => (\n                        <SelectItem key={type} value={type}>{type}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* Clear Filters Button */}\n                <div className=\"flex items-end\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={clearFilters}\n                    className=\"flex items-center gap-2\"\n                    disabled={activeFilterCount === 0}\n                  >\n                    <X className=\"h-4 w-4\" />\n                    Clear Filters\n                  </Button>\n                </div>\n              </div>\n            </Card>\n          </CollapsibleContent>\n        </Collapsible>\n\n        {/* Investment counts */}\n        <div className=\"flex gap-4 text-sm text-gray-600 mb-4\">\n          <span>{filteredInvestments.length} total</span>\n          <span>{pendingInvestments.length} pending</span>\n          <span>{approvedInvestments.length} approved</span>\n          <span>{rejectedInvestments.length} rejected</span>\n          {activeFilterCount > 0 && (\n            <span className=\"text-blue-600 font-medium\">\n              ({activeFilterCount} filter{activeFilterCount > 1 ? 's' : ''} applied)\n            </span>\n          )}\n        </div>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"all\">All ({filteredInvestments.length})</TabsTrigger>\n          <TabsTrigger value=\"pending\">Pending ({pendingInvestments.length})</TabsTrigger>\n          <TabsTrigger value=\"approved\">Approved ({approvedInvestments.length})</TabsTrigger>\n          <TabsTrigger value=\"rejected\">Rejected ({rejectedInvestments.length})</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"all\" className=\"space-y-4\">\n          <InvestmentList investments={filteredInvestments || []} onToggleDetails={handleToggleDetails} expandedInvestment={expandedInvestment} />\n        </TabsContent>\n\n        <TabsContent value=\"pending\" className=\"space-y-4\">\n          <InvestmentList investments={pendingInvestments} onToggleDetails={handleToggleDetails} expandedInvestment={expandedInvestment} />\n        </TabsContent>\n\n        <TabsContent value=\"approved\" className=\"space-y-4\">\n          <InvestmentList investments={approvedInvestments} onToggleDetails={handleToggleDetails} expandedInvestment={expandedInvestment} />\n        </TabsContent>\n\n        <TabsContent value=\"rejected\" className=\"space-y-4\">\n          <InvestmentList investments={rejectedInvestments} onToggleDetails={handleToggleDetails} expandedInvestment={expandedInvestment} />\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\nfunction InvestmentList({ investments, onToggleDetails, expandedInvestment }: { \n  investments: any[], \n  onToggleDetails: (id: number) => void, \n  expandedInvestment: number | null \n}) {\n  const { toast } = useToast();\n\n  const submitInvestmentMutation = useMutation({\n    mutationFn: async (investmentId: number) => {\n      const response = await apiRequest('POST', `/api/investments/${investmentId}/submit`, {});\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to submit investment');\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/investments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/approvals/my-tasks\"] });\n      toast({\n        title: \"Investment submitted\",\n        description: \"Your investment has been submitted for manager approval.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to submit investment\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const deleteInvestmentMutation = useMutation({\n    mutationFn: async (investmentId: number) => {\n      const response = await apiRequest('DELETE', `/api/investments/${investmentId}`);\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to delete investment');\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/investments\"] });\n      toast({\n        title: \"Investment deleted\",\n        description: \"The investment request has been successfully deleted.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to delete investment\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const canDeleteInvestment = (status: string) => {\n    const deletableStatuses = ['draft', 'rejected', 'admin_rejected', 'changes_requested', 'opportunity', 'Draft'];\n    return deletableStatuses.includes(status);\n  };\n\n  const handleDeleteInvestment = (investmentId: number) => {\n    deleteInvestmentMutation.mutate(investmentId);\n  };\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'Draft':\n        return 'bg-gray-100 text-gray-800';\n      case 'opportunity':\n        return 'bg-purple-100 text-purple-800';\n      case 'New':\n      case 'Modified':\n        return 'bg-blue-100 text-blue-800';\n      case 'Admin approved':\n      case 'Manager approved':\n      case 'Committee approved':\n      case 'Finance approved':\n      case 'approved':\n        return 'bg-green-100 text-green-800';\n      case 'admin_rejected':\n      case 'Manager rejected':\n      case 'Committee rejected':\n      case 'Finance rejected':\n      case 'rejected':\n        return 'bg-red-100 text-red-800';\n      case 'changes_requested':\n        return 'bg-orange-100 text-orange-800';\n      case 'pending':\n        return 'bg-yellow-100 text-yellow-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getRiskColor = (risk: string) => {\n    switch (risk) {\n      case 'high':\n        return 'bg-red-100 text-red-800';\n      case 'medium':\n        return 'bg-yellow-100 text-yellow-800';\n      case 'low':\n        return 'bg-green-100 text-green-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  if (investments.length === 0) {\n    return (\n      <div className=\"text-center py-8 text-gray-500\">\n        No investments found.\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {investments.map((investment) => (\n        <Card key={investment.id} className=\"hover:shadow-lg transition-shadow\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-3 mb-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Briefcase className=\"w-5 h-5 text-blue-600\" />\n                    <h3 className=\"font-semibold text-lg\">{investment.reportTitle || investment.targetCompany}</h3>\n                  </div>\n                  <Badge className={getStatusColor(investment.status)}>\n                    {investment.status}\n                  </Badge>\n                </div>\n                \n                {/* Report metadata */}\n                <div className=\"flex flex-wrap items-center gap-4 text-sm mb-3\">\n                  <div className=\"flex items-center gap-1 font-semibold text-blue-600\">\n                    <span>Report Code:</span>\n                    <span>{investment.reportCode}</span>\n                  </div>\n                  <div className=\"flex items-center gap-1 text-gray-600\">\n                    <span>Request ID:</span>\n                    <span className=\"font-medium\">{investment.requestId}</span>\n                  </div>\n                  <div className=\"flex items-center gap-1 font-semibold text-purple-600\">\n                    <span>Type:</span>\n                    <span className=\"capitalize\">{investment.investmentType.replace(/_/g, ' ')}</span>\n                  </div>\n                </div>\n                \n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700\">\n                  <div className=\"flex items-center gap-2\">\n                    <Briefcase className=\"w-4 h-4 text-blue-600\" />\n                    <div className=\"flex flex-col\">\n                      <span className=\"text-xs text-gray-500\">Subject</span>\n                      <span className=\"text-sm font-semibold\">{investment.targetCompany}</span>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <User className=\"w-4 h-4 text-purple-600\" />\n                    <div className=\"flex flex-col\">\n                      <span className=\"text-xs text-gray-500\">Author</span>\n                      <span className=\"text-sm font-semibold\">{investment.createdBy || 'Anonymous'}</span>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Calendar className=\"w-4 h-4 text-green-600\" />\n                    <div className=\"flex flex-col\">\n                      <span className=\"text-xs text-gray-500\">Created</span>\n                      <span className=\"text-sm font-semibold\">{format(new Date(investment.createdAt), 'MMM dd, yyyy')}</span>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <FileText className=\"w-4 h-4 text-orange-600\" />\n                    <div className=\"flex flex-col\">\n                      <span className=\"text-xs text-gray-500\">Documents</span>\n                      <span className=\"text-sm font-semibold\">{investment.documentCount || 0}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                {investment.description && (\n                  <p className=\"text-sm text-gray-600 mb-4\">{investment.description}</p>\n                )}\n              </div>\n              \n              {/* Action buttons */}\n              <div className=\"flex flex-col gap-2 ml-4\">\n                {investment.status?.toLowerCase() === 'draft' && (\n                  <Button \n                    variant=\"default\" \n                    size=\"sm\"\n                    onClick={() => submitInvestmentMutation.mutate(investment.id)}\n                    disabled={submitInvestmentMutation.isPending}\n                    data-testid={`button-submit-${investment.id}`}\n                    className=\"bg-blue-600 hover:bg-blue-700\"\n                  >\n                    {submitInvestmentMutation.isPending ? 'Submitting...' : 'Submit'}\n                  </Button>\n                )}\n                {canDeleteInvestment(investment.status) && (\n                  <AlertDialog>\n                    <AlertDialogTrigger asChild>\n                      <Button \n                        variant=\"destructive\" \n                        size=\"sm\"\n                        className=\"w-10 h-10 p-0\"\n                        disabled={deleteInvestmentMutation.isPending}\n                        data-testid={`button-delete-${investment.id}`}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </AlertDialogTrigger>\n                    <AlertDialogContent>\n                      <AlertDialogHeader>\n                        <AlertDialogTitle>Delete Investment Request</AlertDialogTitle>\n                        <AlertDialogDescription>\n                          Are you sure you want to delete this investment request for {investment.targetCompany}? \n                          This action cannot be undone.\n                        </AlertDialogDescription>\n                      </AlertDialogHeader>\n                      <AlertDialogFooter>\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\n                        <AlertDialogAction \n                          onClick={() => handleDeleteInvestment(investment.id)}\n                          className=\"bg-red-600 hover:bg-red-700\"\n                        >\n                          Delete\n                        </AlertDialogAction>\n                      </AlertDialogFooter>\n                    </AlertDialogContent>\n                  </AlertDialog>\n                )}\n              </div>\n            </div>\n            \n            <InvestmentDetailsInline\n              investment={investment}\n              isExpanded={expandedInvestment === investment.id}\n              onToggle={() => onToggleDetails(investment.id)}\n            />\n          </CardContent>\n        </Card>\n      ))}\n    </div>\n  );\n}\n","size_bytes":23130},"client/src/components/documents/DocumentAIAnalysis.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card } from \"@/components/ui/card\";\nimport { FileSearch, Loader2, Sparkles } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport MarkdownRenderer from \"@/components/documents/MarkdownRenderer\";\n\ninterface DocumentAIAnalysisProps {\n  document: any;\n}\n\nexport function DocumentAIAnalysis({ document }: DocumentAIAnalysisProps) {\n  const [question, setQuestion] = useState(\"\");\n  const [analysis, setAnalysis] = useState(\"\");\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const { toast } = useToast();\n\n  const handleAnalyze = async (customQuestion?: string) => {\n    const queryQuestion = customQuestion || question;\n    \n    setIsAnalyzing(true);\n    setAnalysis(\"\");\n\n    try {\n      const response = await fetch(`/api/documents/${document.id}/analyze`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          question: queryQuestion.trim() || undefined\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to analyze document\");\n      }\n\n      const data = await response.json();\n      setAnalysis(data.analysis);\n      toast({ title: \"Document analysis completed\" });\n    } catch (error) {\n      console.error(\"Document analysis error:\", error);\n      toast({ \n        title: \"Failed to analyze document\", \n        description: error instanceof Error ? error.message : \"Unknown error\",\n        variant: \"destructive\" \n      });\n    } finally {\n      setIsAnalyzing(false);\n    }\n  };\n\n  const quickActions = [\n    { label: \"Summarize\", question: \"Please provide a comprehensive summary of this document.\" },\n    { label: \"Key Points\", question: \"What are the key points and main takeaways from this document?\" },\n    { label: \"Data & Metrics\", question: \"Extract all important data, metrics, and numbers from this document.\" },\n  ];\n\n  return (\n    <div className=\"space-y-3\">\n      <div className=\"bg-purple-50 dark:bg-purple-950 border border-purple-200 dark:border-purple-800 rounded-lg p-3\">\n        <div className=\"flex items-start gap-2\">\n          <Sparkles className=\"h-4 w-4 text-purple-600 dark:text-purple-400 mt-0.5 flex-shrink-0\" />\n          <div className=\"flex-1\">\n            <h4 className=\"font-medium text-purple-900 dark:text-purple-100 text-sm mb-1\">\n              AI Document Analysis\n            </h4>\n            <p className=\"text-xs text-purple-700 dark:text-purple-300\">\n              Ask questions about <span className=\"font-medium\">{document.originalName}</span> or use quick actions below.\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Quick Actions */}\n      <div className=\"flex flex-wrap gap-2\">\n        {quickActions.map((action, index) => (\n          <Button\n            key={index}\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => handleAnalyze(action.question)}\n            disabled={isAnalyzing}\n            className=\"text-xs\"\n            data-testid={`button-quick-${action.label.toLowerCase().replace(/\\s+/g, '-')}`}\n          >\n            {action.label}\n          </Button>\n        ))}\n      </div>\n\n      {/* Custom Question */}\n      <div className=\"flex gap-2\">\n        <Input\n          placeholder=\"Ask a specific question about this document...\"\n          value={question}\n          onChange={(e) => setQuestion(e.target.value)}\n          onKeyDown={(e) => {\n            if (e.key === \"Enter\" && !isAnalyzing && question.trim()) {\n              handleAnalyze();\n            }\n          }}\n          disabled={isAnalyzing}\n          className=\"flex-1 text-sm\"\n          data-testid=\"input-document-question\"\n        />\n        <Button\n          onClick={() => handleAnalyze()}\n          disabled={isAnalyzing || !question.trim()}\n          size=\"sm\"\n          className=\"flex items-center gap-2\"\n          data-testid=\"button-analyze-document\"\n        >\n          {isAnalyzing ? (\n            <>\n              <Loader2 className=\"h-3 w-3 animate-spin\" />\n              Analyzing...\n            </>\n          ) : (\n            <>\n              <FileSearch className=\"h-3 w-3\" />\n              Analyze\n            </>\n          )}\n        </Button>\n      </div>\n\n      {/* Analysis Result */}\n      {analysis && (\n        <Card className=\"p-3 bg-gray-50 dark:bg-gray-900\" data-testid=\"card-analysis-result\">\n          <div className=\"space-y-2\">\n            <h4 className=\"font-medium text-gray-900 dark:text-gray-100 text-sm flex items-center gap-2\">\n              <Sparkles className=\"h-4 w-4 text-purple-600\" />\n              AI Analysis\n            </h4>\n            <div className=\"prose prose-sm max-w-none dark:prose-invert text-sm\">\n              <MarkdownRenderer content={analysis} />\n            </div>\n          </div>\n        </Card>\n      )}\n    </div>\n  );\n}\n","size_bytes":4948},"client/src/components/details/InvestmentDetailsInline.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\n\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { CheckCircle, AlertTriangle, Clock, Eye, ChevronDown, ChevronUp, Edit, Send, FileText, Upload, X, Save, Search, Download, Trash2 } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport DocumentAnalysisCard from \"@/components/documents/DocumentAnalysisCard\";\nimport { DocumentAIAnalysis } from \"@/components/documents/DocumentAIAnalysis\";\nimport { MarketRegulationResearch } from \"@/components/research/MarketRegulationResearch\";\nimport { EnhancedDocumentCategorySelector } from \"@/components/documents/EnhancedDocumentCategorySelector\";\nimport MarkdownRenderer from \"@/components/documents/MarkdownRenderer\";\nimport { ApprovalHistoryCard } from '@/components/approval/ApprovalHistoryCard';\nimport { ReportWorkChat } from \"@/components/report/ReportWorkChat\";\n\n// Edit form schema\nconst editFormSchema = z.object({\n  targetCompany: z.string().min(1, \"Target company is required\"),\n  investmentType: z.enum([\"equity\", \"debt\", \"real_estate\", \"alternative\"]),\n  description: z.string().optional(),\n});\n\ninterface InvestmentDetailsInlineProps {\n  investment: any;\n  isExpanded: boolean;\n  onToggle: () => void;\n}\n\nexport function InvestmentDetailsInline({ investment, isExpanded, onToggle }: InvestmentDetailsInlineProps) {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  const [isInlineEditing, setIsInlineEditing] = useState(false);\n  const [uploadedFiles, setUploadedFiles] = useState<File[]>([]);\n  const [filesToDelete, setFilesToDelete] = useState<number[]>([]);\n  const [selectedCategories, setSelectedCategories] = useState<any[]>([]);\n  const [isWorkChatOpen, setIsWorkChatOpen] = useState(false);\n  const [isDocumentsExpanded, setIsDocumentsExpanded] = useState(false);\n  const [isResearchExpanded, setIsResearchExpanded] = useState(false);\n  const [isApprovalExpanded, setIsApprovalExpanded] = useState(true);\n  const [isRationaleExpanded, setIsRationaleExpanded] = useState(true);\n\n  // Fetch detailed investment data when expanded\n  const { data: investmentDetails, isLoading: isInvestmentLoading } = useQuery({\n    queryKey: [`/api/investments/${investment?.id}`],\n    enabled: !!investment?.id && isExpanded,\n  });\n\n  // Fetch approval history\n  const { data: approvalHistory } = useQuery({\n    queryKey: [`/api/approvals/investment/${investment?.id}`],\n    enabled: !!investment?.id && isExpanded,\n  });\n\n  // Fetch documents\n  const { data: documents } = useQuery({\n    queryKey: [`/api/documents/investment/${investment?.id}`],\n    enabled: !!investment?.id && isExpanded,\n  });\n\n  // Edit form\n  const editForm = useForm<z.infer<typeof editFormSchema>>({\n    resolver: zodResolver(editFormSchema),\n    defaultValues: {\n      targetCompany: \"\",\n      investmentType: \"equity\",\n      description: \"\",\n    },\n  });\n\n  // Initialize form when investment details are loaded using useEffect\n  useEffect(() => {\n    if (investmentDetails && typeof investmentDetails === 'object' && 'targetCompany' in investmentDetails && !isInlineEditing) {\n      const details = investmentDetails as any;\n      editForm.reset({\n        targetCompany: details.targetCompany || \"\",\n        investmentType: details.investmentType || \"equity\",\n        description: details.description || \"\",\n      });\n    }\n  }, [investmentDetails, isInlineEditing]);\n\n  // Mutations\n  const editDraftMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof editFormSchema>) => {\n      return apiRequest('PUT', `/api/investments/${investment.id}`, data);\n    },\n    onSuccess: () => {\n      // Invalidate investment-specific queries\n      queryClient.invalidateQueries({ queryKey: [`/api/investments/${investment.id}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/investments'] });\n      \n      // Invalidate task and approval queries (for approvers to see changes)\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/approvals'] });\n      queryClient.invalidateQueries({ queryKey: [`/api/approvals/investment/${investment.id}`] });\n      \n      // Invalidate document queries\n      queryClient.invalidateQueries({ queryKey: ['/api/documents'] });\n      queryClient.invalidateQueries({ queryKey: [`/api/documents/investment/${investment.id}`] });\n      \n      // Invalidate dashboard queries (for approver dashboards)\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard/stats'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard/recent-requests'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      \n      // Invalidate task count for sidebar updates\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks/count'] });\n      \n      toast({ title: \"Investment updated successfully\" });\n      setIsInlineEditing(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to update investment\", variant: \"destructive\" });\n    },\n  });\n\n  const uploadFilesMutation = useMutation({\n    mutationFn: async () => {\n      if (uploadedFiles.length === 0) return;\n      \n      const formData = new FormData();\n      uploadedFiles.forEach((file) => {\n        formData.append('documents', file);\n      });\n      formData.append('requestType', 'investment');\n      formData.append('requestId', investment.id.toString());\n      \n      // Add categories data\n      if (selectedCategories.length > 0) {\n        formData.append('categories', JSON.stringify(selectedCategories));\n      }\n\n      const response = await fetch('/api/documents/upload', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`Upload failed: ${errorText}`);\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      // Invalidate document-specific queries\n      queryClient.invalidateQueries({ queryKey: [`/api/documents/investment/${investment.id}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/documents'] });\n      \n      // Invalidate investment-specific queries\n      queryClient.invalidateQueries({ queryKey: [`/api/investments/${investment.id}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/investments'] });\n      \n      // Invalidate task and approval queries (for approvers)\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/approvals'] });\n      queryClient.invalidateQueries({ queryKey: [`/api/approvals/investment/${investment.id}`] });\n      \n      // Invalidate dashboard queries (critical for approver visibility)\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard/stats'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard/recent-requests'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      \n      // Invalidate task count for sidebar updates\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks/count'] });\n      \n      setUploadedFiles([]);\n      toast({ title: \"Files uploaded successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to upload files\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteDocumentMutation = useMutation({\n    mutationFn: async () => {\n      const deletePromises = filesToDelete.map(documentId =>\n        apiRequest('DELETE', `/api/documents/${documentId}`)\n      );\n      return Promise.all(deletePromises);\n    },\n    onSuccess: () => {\n      // Invalidate document-specific queries\n      queryClient.invalidateQueries({ queryKey: [`/api/documents/investment/${investment.id}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/documents'] });\n      \n      // Invalidate investment-specific queries\n      queryClient.invalidateQueries({ queryKey: [`/api/investments/${investment.id}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/investments'] });\n      \n      // Invalidate task and approval queries (for approvers)\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/approvals'] });\n      queryClient.invalidateQueries({ queryKey: [`/api/approvals/investment/${investment.id}`] });\n      \n      // Invalidate dashboard queries (critical for approver visibility)\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard/stats'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard/recent-requests'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      \n      // Invalidate task count for sidebar updates\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks/count'] });\n      \n      setFilesToDelete([]);\n      toast({ title: \"Documents deleted successfully\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete documents\", variant: \"destructive\" });\n    },\n  });\n\n  const submitDraftMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest('POST', `/api/investments/${investment.id}/submit`);\n    },\n    onSuccess: () => {\n      // Invalidate investment-specific queries\n      queryClient.invalidateQueries({ queryKey: [`/api/investments/${investment.id}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/investments'] });\n      \n      // Invalidate task and approval queries (critical for approvers to see resubmission)\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/approvals'] });\n      queryClient.invalidateQueries({ queryKey: [`/api/approvals/investment/${investment.id}`] });\n      \n      // Invalidate document queries (so approvers see new documents)\n      queryClient.invalidateQueries({ queryKey: ['/api/documents'] });\n      queryClient.invalidateQueries({ queryKey: [`/api/documents/investment/${investment.id}`] });\n      \n      // Invalidate dashboard queries (critical for approver dashboards)\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard/stats'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard/recent-requests'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/dashboard'] });\n      \n      // Invalidate task count for sidebar updates\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks/count'] });\n      \n      toast({ title: \"Investment submitted for approval successfully\" });\n      setIsInlineEditing(false);\n    },\n    onError: () => {\n      toast({ title: \"Failed to submit investment\", variant: \"destructive\" });\n    },\n  });\n\n  // Handlers\n  const handleInlineEdit = () => {\n    setIsInlineEditing(true);\n  };\n\n  const handleSaveInlineEdit = async () => {\n    try {\n      // Validate form\n      const formData = editForm.getValues();\n      const validatedData = editFormSchema.parse(formData);\n      \n      // Save changes\n      await editDraftMutation.mutateAsync(validatedData);\n      \n      // Upload new files if any\n      if (uploadedFiles.length > 0) {\n        await uploadFilesMutation.mutateAsync();\n      }\n      \n      // Delete files if any\n      if (filesToDelete.length > 0) {\n        await deleteDocumentMutation.mutateAsync();\n      }\n    } catch (error) {\n      console.error('Save failed:', error);\n    }\n  };\n\n  const handleCancelInlineEdit = () => {\n    setIsInlineEditing(false);\n    setUploadedFiles([]);\n    setFilesToDelete([]);\n    // Reset form to original values\n    if (investmentDetails && typeof investmentDetails === 'object') {\n      const details = investmentDetails as any;\n      editForm.reset({\n        targetCompany: details.targetCompany || \"\",\n        investmentType: details.investmentType || \"equity\",\n        description: details.description || \"\",\n      });\n    }\n  };\n\n  const handleSubmitDraft = async () => {\n    try {\n      // First save any pending changes\n      if (isInlineEditing) {\n        const formData = editForm.getValues();\n        const validatedData = editFormSchema.parse(formData);\n        await editDraftMutation.mutateAsync(validatedData);\n        \n        // Upload new files if any\n        if (uploadedFiles.length > 0) {\n          await uploadFilesMutation.mutateAsync();\n        }\n        \n        // Delete files if any\n        if (filesToDelete.length > 0) {\n          await deleteDocumentMutation.mutateAsync();\n        }\n      }\n      \n      // Then submit for approval\n      await submitDraftMutation.mutateAsync();\n    } catch (error) {\n      console.error('Submit failed:', error);\n    }\n  };\n\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n    setUploadedFiles(prev => [...prev, ...files]);\n  };\n\n  const handleCategoriesChange = (categories: any[]) => {\n    setSelectedCategories(categories);\n  };\n\n  const handleRemoveUploadedFile = (index: number) => {\n    setUploadedFiles(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const handleDeleteDocument = (documentId: number) => {\n    setFilesToDelete(prev => [...prev, documentId]);\n  };\n\n  const handleUndoDelete = (documentId: number) => {\n    setFilesToDelete(prev => prev.filter(id => id !== documentId));\n  };\n\n  // Helper functions\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'draft':\n        return 'bg-gray-100 text-gray-800';\n      case 'New':\n      case 'Modified':\n        return 'bg-blue-100 text-blue-800';\n      case 'Manager approved':\n      case 'Committee approved':\n      case 'Finance approved':\n      case 'approved':\n        return 'bg-green-100 text-green-800';\n      case 'Manager rejected':\n      case 'Committee rejected':\n      case 'Finance rejected':\n      case 'rejected':\n        return 'bg-red-100 text-red-800';\n      case 'changes_requested':\n        return 'bg-orange-100 text-orange-800';\n      case 'pending':\n        return 'bg-yellow-100 text-yellow-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'opportunity':\n        return <AlertTriangle className=\"w-4 h-4\" />;\n      case 'Admin approved':\n      case 'Manager approved':\n      case 'Committee approved':\n      case 'Finance approved':\n      case 'approved':\n        return <CheckCircle className=\"w-4 h-4\" />;\n      case 'admin_rejected':\n      case 'Manager rejected':\n      case 'Committee rejected':\n      case 'Finance rejected':\n      case 'rejected':\n        return <AlertTriangle className=\"w-4 h-4\" />;\n      case 'changes_requested':\n        return <AlertTriangle className=\"w-4 h-4\" />;\n      case 'pending':\n        return <Clock className=\"w-4 h-4\" />;\n      default:\n        return <Clock className=\"w-4 h-4\" />;\n    }\n  };\n\n\n  return (\n    <Collapsible open={isExpanded} onOpenChange={onToggle}>\n      <CollapsibleTrigger asChild>\n        <Button variant=\"ghost\" size=\"sm\" className=\"w-full justify-between\">\n          <span className=\"flex items-center\">\n            <Eye className=\"w-4 h-4 mr-2\" />\n            View Details\n          </span>\n          {isExpanded ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n        </Button>\n      </CollapsibleTrigger>\n      \n      <CollapsibleContent className=\"mt-4\">\n        {isInvestmentLoading ? (\n          <div className=\"flex items-center justify-center p-8\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n          </div>\n        ) : investmentDetails && typeof investmentDetails === 'object' && 'targetCompany' in investmentDetails ? (\n          <div className=\"space-y-6\">\n            {/* I. Report Details Summary */}\n            <Card>\n              <CardHeader className=\"py-3\">\n                <CardTitle className=\"flex items-center gap-2 text-base\">\n                  <FileText className=\"h-4 w-4\" />\n                  Report Details\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"pt-0 pb-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Report Code:</span>\n                    <span className=\"font-medium text-blue-600 dark:text-blue-400\">{investment?.reportCode || investment?.requestId || 'N/A'}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Subject/Client:</span>\n                    <span className=\"font-medium\">{investment?.targetCompany || 'N/A'}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Type:</span>\n                    <span className=\"font-medium capitalize\">{investment?.investmentType?.replace('_', ' ') || 'N/A'}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Created:</span>\n                    <span className=\"font-medium\">{format(new Date(investment?.createdAt || new Date()), 'MMM dd, yyyy')}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Status:</span>\n                    <Badge className={getStatusColor(investment?.status || 'draft')}>\n                      {investment?.status || 'Draft'}\n                    </Badge>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* II. Analyst Notes / Description */}\n            <Card>\n              <CardHeader \n                className=\"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors py-3\"\n                onClick={() => setIsRationaleExpanded(!isRationaleExpanded)}\n              >\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"flex items-center gap-2 text-base\">\n                    <FileText className=\"h-4 w-4\" />\n                    Analyst Notes\n                  </CardTitle>\n                  {isRationaleExpanded ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n                </div>\n              </CardHeader>\n              {isRationaleExpanded && (\n                <CardContent className=\"pt-0 pb-4\">\n                \n                  {isInlineEditing ? (\n                  <Form {...editForm}>\n                    <div className=\"space-y-4\">\n                      <FormField\n                        control={editForm.control}\n                        name=\"description\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormControl>\n                              <Textarea \n                                placeholder=\"Enter investment description...\" \n                                rows={4}\n                                {...field} \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      \n                      {/* Additional editing fields */}\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <FormField\n                          control={editForm.control}\n                          name=\"targetCompany\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Subject/Client</FormLabel>\n                              <FormControl>\n                                <Input placeholder=\"Enter subject or client name\" {...field} />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={editForm.control}\n                          name=\"investmentType\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Report Type</FormLabel>\n                              <Select onValueChange={field.onChange} value={field.value}>\n                                <FormControl>\n                                  <SelectTrigger>\n                                    <SelectValue placeholder=\"Select report type\" />\n                                  </SelectTrigger>\n                                </FormControl>\n                                <SelectContent>\n                                  <SelectItem value=\"equity\">Equity</SelectItem>\n                                  <SelectItem value=\"debt\">Debt</SelectItem>\n                                  <SelectItem value=\"real_estate\">Real Estate</SelectItem>\n                                  <SelectItem value=\"alternative\">Alternative</SelectItem>\n                                  <SelectItem value=\"base_document\">Base Document</SelectItem>\n                                </SelectContent>\n                              </Select>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      </div>\n                    </div>\n                  </Form>\n                ) : (\n                  <div className=\"bg-gray-50 p-3 rounded border min-h-[60px]\">\n                    <MarkdownRenderer \n                      content={(investmentDetails && typeof investmentDetails === 'object' && 'description' in investmentDetails) \n                        ? (investmentDetails as any).description || 'No description provided by the analyst'\n                        : 'No description provided by the analyst'}\n                      className=\"text-gray-800\"\n                    />\n                  </div>\n                )}\n                \n                {/* Edit Draft Actions */}\n                {(investmentDetails && typeof investmentDetails === 'object' && 'status' in investmentDetails && \n                  ((investmentDetails as any).status?.toLowerCase() === 'draft' || (investmentDetails as any).status?.toLowerCase() === 'changes_requested')) && (\n                  <div className=\"mt-4 flex gap-2\">\n                    {isInlineEditing ? (\n                      <>\n                        <Button \n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={handleSaveInlineEdit}\n                          disabled={editDraftMutation.isPending || uploadFilesMutation.isPending || deleteDocumentMutation.isPending}\n                          className=\"flex items-center gap-2\"\n                        >\n                          <Save className=\"h-4 w-4\" />\n                          {editDraftMutation.isPending ? 'Saving...' : 'Save Changes'}\n                        </Button>\n                        <Button \n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={handleCancelInlineEdit}\n                          disabled={editDraftMutation.isPending || uploadFilesMutation.isPending || deleteDocumentMutation.isPending}\n                          className=\"flex items-center gap-2\"\n                        >\n                          <X className=\"h-4 w-4\" />\n                          Cancel\n                        </Button>\n                      </>\n                    ) : (\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\"\n                        onClick={handleInlineEdit}\n                        className=\"flex items-center gap-2\"\n                      >\n                        <Edit className=\"h-4 w-4\" />\n                        Edit Draft\n                      </Button>\n                    )}\n                  </div>\n                )}\n                \n                {/* Document Management - shown during inline editing */}\n                {isInlineEditing && (\n                  <div className=\"mt-6 p-4 border rounded-lg bg-gray-50\">\n                    <h5 className=\"font-medium mb-3\">Document Management</h5>\n                    \n                    {/* Enhanced Document Upload with Categories */}\n                    <div className=\"mb-4\">\n                      <label className=\"block text-sm font-medium mb-3\">Upload New Documents with Categories</label>\n                      <div className=\"space-y-4\">\n                        <EnhancedDocumentCategorySelector\n                          onCategoriesChange={setSelectedCategories}\n                          initialCategories={[]}\n                          disabled={false}\n                        />\n                        <div className=\"flex items-center gap-2\">\n                          <Input\n                            type=\"file\"\n                            multiple\n                            accept=\".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.csv\"\n                            onChange={handleFileUpload}\n                            className=\"flex-1\"\n                          />\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => document.querySelector('input[type=\"file\"]')?.click()}\n                            className=\"flex items-center gap-2\"\n                          >\n                            <Upload className=\"h-4 w-4\" />\n                            Browse\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                    \n                    {/* New Files Preview */}\n                    {uploadedFiles.length > 0 && (\n                      <div className=\"mb-4\">\n                        <label className=\"block text-sm font-medium mb-2\">New Files to Upload</label>\n                        <div className=\"space-y-2\">\n                          {uploadedFiles.map((file, index) => (\n                            <div key={index} className=\"flex items-center justify-between p-2 bg-blue-50 rounded border\">\n                              <div className=\"flex items-center gap-2\">\n                                <FileText className=\"h-4 w-4 text-blue-600\" />\n                                <span className=\"text-sm\">{file.name}</span>\n                                <span className=\"text-xs text-gray-500\">({(file.size / 1024 / 1024).toFixed(1)} MB)</span>\n                              </div>\n                              <Button\n                                type=\"button\"\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => handleRemoveUploadedFile(index)}\n                                className=\"text-red-600 hover:text-red-800\"\n                              >\n                                <X className=\"h-4 w-4\" />\n                              </Button>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n                    \n                    {/* Existing Documents */}\n                    {documents && Array.isArray(documents) && documents.length > 0 && (\n                      <div>\n                        <label className=\"block text-sm font-medium mb-2\">Existing Documents</label>\n                        <div className=\"space-y-2\">\n                          {Array.isArray(documents) && documents.map((doc: any) => (\n                            <div key={doc.id} className={`flex items-center justify-between p-2 rounded border ${\n                              filesToDelete.includes(doc.id) ? 'bg-red-50 border-red-200' : 'bg-white'\n                            }`}>\n                              <div className=\"flex items-center gap-2\">\n                                <FileText className={`h-4 w-4 ${filesToDelete.includes(doc.id) ? 'text-red-600' : 'text-gray-600'}`} />\n                                <span className={`text-sm ${filesToDelete.includes(doc.id) ? 'line-through text-red-600' : ''}`}>\n                                  {doc.fileName}\n                                </span>\n                              </div>\n                              <div className=\"flex items-center gap-2\">\n                                {filesToDelete.includes(doc.id) ? (\n                                  <Button\n                                    type=\"button\"\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    onClick={() => handleUndoDelete(doc.id)}\n                                    className=\"text-green-600 hover:text-green-800\"\n                                  >\n                                    Undo\n                                  </Button>\n                                ) : (\n                                  <Button\n                                    type=\"button\"\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    onClick={() => handleDeleteDocument(doc.id)}\n                                    className=\"text-red-600 hover:text-red-800\"\n                                  >\n                                    <X className=\"h-4 w-4\" />\n                                  </Button>\n                                )}\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n                    \n                    {uploadedFiles.length > 0 && (\n                      <div className=\"mt-3 p-3 bg-blue-50 rounded border\">\n                        <p className=\"text-sm text-blue-700\">\n                          <strong>Note:</strong> New documents will be automatically processed by AI for analysis and insights generation after upload.\n                        </p>\n                      </div>\n                    )}\n                  </div>\n                )}\n                </CardContent>\n              )}\n            </Card>\n\n            {/* III. Work on Report Section */}\n            {!isWorkChatOpen ? (\n              <Card>\n                <CardContent className=\"py-8\">\n                  <div className=\"text-center space-y-4\">\n                    <div className=\"flex justify-center\">\n                      <div className=\"h-12 w-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center\">\n                        <FileText className=\"h-6 w-6 text-white\" />\n                      </div>\n                    </div>\n                    <div>\n                      <h3 className=\"font-semibold text-lg mb-1\">Start Working on Your Report</h3>\n                      <p className=\"text-sm text-gray-500\">\n                        Use AI to draft your report with templates, document analysis, and expert knowledge\n                      </p>\n                    </div>\n                    <Button\n                      onClick={() => setIsWorkChatOpen(true)}\n                      className=\"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700\"\n                      data-testid=\"button-work-on-report\"\n                    >\n                      <FileText className=\"h-4 w-4 mr-2\" />\n                      Work on Report\n                    </Button>\n                    <div className=\"grid grid-cols-3 gap-3 pt-3 text-xs text-gray-500\">\n                      <div className=\"flex flex-col items-center gap-1\">\n                        <div className=\"h-8 w-8 rounded-full bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center\">\n                          <FileText className=\"h-4 w-4 text-blue-600\" />\n                        </div>\n                        <span>Templates</span>\n                      </div>\n                      <div className=\"flex flex-col items-center gap-1\">\n                        <div className=\"h-8 w-8 rounded-full bg-purple-50 dark:bg-purple-900/20 flex items-center justify-center\">\n                          <Upload className=\"h-4 w-4 text-purple-600\" />\n                        </div>\n                        <span>Documents</span>\n                      </div>\n                      <div className=\"flex flex-col items-center gap-1\">\n                        <div className=\"h-8 w-8 rounded-full bg-green-50 dark:bg-green-900/20 flex items-center justify-center\">\n                          <Search className=\"h-4 w-4 text-green-600\" />\n                        </div>\n                        <span>AI Knowledge</span>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ) : (\n              <ReportWorkChat\n                reportId={investment.id}\n                reportTitle={investment.reportTitle || investment.targetCompany}\n                onClose={() => setIsWorkChatOpen(false)}\n              />\n            )}\n\n            {/* IV. Attached Documents with AI Analysis */}\n            {documents && Array.isArray(documents) && documents.length > 0 && (\n              <Card>\n                <CardHeader \n                  className=\"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors py-3\"\n                  onClick={() => setIsDocumentsExpanded(!isDocumentsExpanded)}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"flex items-center gap-2 text-base\">\n                      <FileText className=\"h-4 w-4\" />\n                      Attached Documents\n                    </CardTitle>\n                    {isDocumentsExpanded ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n                  </div>\n                </CardHeader>\n                {isDocumentsExpanded && (\n                  <CardContent className=\"pt-0 pb-4\">\n                  <div className=\"space-y-4\">\n                    {Array.isArray(documents) && documents.map((doc: any) => (\n                      <div key={doc.id} className=\"border rounded-lg p-4 space-y-3\">\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center gap-2\">\n                            <FileText className=\"h-4 w-4 text-blue-600\" />\n                            <span className=\"font-medium text-sm\">{doc.originalName}</span>\n                            <span className=\"text-xs text-gray-500\">\n                              ({(doc.fileSize / 1024 / 1024).toFixed(2)} MB)\n                            </span>\n                          </div>\n                        </div>\n                        <DocumentAIAnalysis document={doc} />\n                      </div>\n                    ))}\n                  </div>\n                  </CardContent>\n                )}\n              </Card>\n            )}\n\n            {/* V. Market Regulation Research */}\n            <Card>\n              <CardHeader \n                className=\"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors py-3\"\n                onClick={() => setIsResearchExpanded(!isResearchExpanded)}\n              >\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"flex items-center gap-2 text-base\">\n                    <Search className=\"h-4 w-4\" />\n                    Market Regulation Research\n                  </CardTitle>\n                  {isResearchExpanded ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n                </div>\n              </CardHeader>\n              {isResearchExpanded && (\n                <CardContent className=\"pt-0 pb-4\">\n                  <MarketRegulationResearch \n                    projectContext={investment?.targetCompany ? `Project: ${investment.targetCompany}` : undefined}\n                  />\n                </CardContent>\n              )}\n            </Card>\n\n            {/* VI. Approval History */}\n            <ApprovalHistoryCard\n              requestType=\"investment\"\n              requestId={investment.id}\n              isExpanded={isApprovalExpanded}\n              onToggle={() => setIsApprovalExpanded(!isApprovalExpanded)}\n            />\n\n            {/* VII. Submit for Approval - At the bottom */}\n            {(investmentDetails && typeof investmentDetails === 'object' && 'status' in investmentDetails && \n              ((investmentDetails as any).status?.toLowerCase() === 'draft' || (investmentDetails as any).status?.toLowerCase() === 'changes_requested')) && !isInlineEditing && (\n              <Card className=\"border-2 border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-950/20\">\n                <CardContent className=\"py-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <h3 className=\"font-semibold text-lg mb-1\">Ready to submit?</h3>\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                        {(investmentDetails as any).status?.toLowerCase() === 'changes_requested' \n                          ? 'Review your changes and resubmit for approval when ready.'\n                          : 'Submit this draft report for approval once you\\'ve completed all sections.'}\n                      </p>\n                    </div>\n                    <Button \n                      size=\"lg\"\n                      onClick={handleSubmitDraft}\n                      disabled={submitDraftMutation.isPending}\n                      className=\"flex items-center gap-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700\"\n                      data-testid=\"button-submit-for-approval\"\n                    >\n                      <Send className=\"h-4 w-4\" />\n                      {submitDraftMutation.isPending ? 'Submitting...' : \n                       (investmentDetails && typeof investmentDetails === 'object' && 'status' in investmentDetails && \n                        (investmentDetails as any).status?.toLowerCase() === 'changes_requested') ? 'Resubmit for Approval' : 'Submit for Approval'}\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        ) : (\n          <div className=\"text-center p-8 text-gray-500\">\n            No investment details available\n          </div>\n        )}\n      </CollapsibleContent>\n    </Collapsible>\n  );\n}","size_bytes":40048},"client/src/components/research/MarketRegulationResearch.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card } from \"@/components/ui/card\";\nimport { Search, Loader2, BookOpen } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport MarkdownRenderer from \"@/components/documents/MarkdownRenderer\";\n\ninterface MarketRegulationResearchProps {\n  projectContext?: string;\n}\n\nexport function MarketRegulationResearch({ projectContext }: MarketRegulationResearchProps) {\n  const [question, setQuestion] = useState(\"\");\n  const [context, setContext] = useState(projectContext || \"\");\n  const [answer, setAnswer] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [searchHistory, setSearchHistory] = useState<Array<{ question: string; answer: string; timestamp: string }>>([]);\n  const { toast } = useToast();\n\n  const handleSearch = async () => {\n    if (!question.trim()) {\n      toast({ title: \"Please enter a question\", variant: \"destructive\" });\n      return;\n    }\n\n    setIsLoading(true);\n    setAnswer(\"\");\n\n    try {\n      const response = await fetch(\"/api/research/regulation\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          question: question.trim(),\n          projectContext: context.trim() || undefined\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to research regulation\");\n      }\n\n      const data = await response.json();\n      setAnswer(data.answer);\n      setSearchHistory(prev => [{\n        question: data.question,\n        answer: data.answer,\n        timestamp: data.timestamp\n      }, ...prev.slice(0, 4)]); // Keep last 5 searches\n\n      toast({ title: \"Research completed successfully\" });\n    } catch (error) {\n      console.error(\"Market regulation research error:\", error);\n      toast({ \n        title: \"Failed to research regulation\", \n        description: error instanceof Error ? error.message : \"Unknown error\",\n        variant: \"destructive\" \n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const loadFromHistory = (item: { question: string; answer: string }) => {\n    setQuestion(item.question);\n    setAnswer(item.answer);\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-4\">\n        <div className=\"flex items-start gap-3\">\n          <BookOpen className=\"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0\" />\n          <div className=\"flex-1\">\n            <h4 className=\"font-medium text-blue-900 dark:text-blue-100 mb-1\">Market Regulation Research Portal</h4>\n            <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n              AI-powered research assistant for market regulations, compliance requirements, and industry standards. \n              Ask specific questions about regulatory compliance for your project.\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Project Context (Optional) */}\n      <div className=\"space-y-2\">\n        <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n          Project Context (Optional)\n        </label>\n        <Textarea\n          placeholder=\"E.g., We are implementing PFAS remediation for automotive manufacturing...\"\n          value={context}\n          onChange={(e) => setContext(e.target.value)}\n          rows={2}\n          className=\"resize-none\"\n          data-testid=\"input-regulation-context\"\n        />\n        <p className=\"text-xs text-gray-500\">Provide project context to get more relevant regulatory guidance.</p>\n      </div>\n\n      {/* Regulation Question */}\n      <div className=\"space-y-2\">\n        <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n          Regulation Question <span className=\"text-red-500\">*</span>\n        </label>\n        <div className=\"flex gap-2\">\n          <Input\n            placeholder=\"E.g., What are the EPA regulations for PFAS disposal in 2025?\"\n            value={question}\n            onChange={(e) => setQuestion(e.target.value)}\n            onKeyDown={(e) => {\n              if (e.key === \"Enter\" && !isLoading) {\n                handleSearch();\n              }\n            }}\n            disabled={isLoading}\n            className=\"flex-1\"\n            data-testid=\"input-regulation-question\"\n          />\n          <Button\n            onClick={handleSearch}\n            disabled={isLoading || !question.trim()}\n            className=\"flex items-center gap-2\"\n            data-testid=\"button-search-regulation\"\n          >\n            {isLoading ? (\n              <>\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                Researching...\n              </>\n            ) : (\n              <>\n                <Search className=\"h-4 w-4\" />\n                Research\n              </>\n            )}\n          </Button>\n        </div>\n      </div>\n\n      {/* Answer Display */}\n      {answer && (\n        <Card className=\"p-4 bg-gray-50 dark:bg-gray-900\" data-testid=\"card-regulation-answer\">\n          <div className=\"space-y-2\">\n            <h4 className=\"font-medium text-gray-900 dark:text-gray-100 flex items-center gap-2\">\n              <Search className=\"h-4 w-4 text-green-600\" />\n              Research Results\n            </h4>\n            <div className=\"prose prose-sm max-w-none dark:prose-invert\">\n              <MarkdownRenderer content={answer} />\n            </div>\n          </div>\n        </Card>\n      )}\n\n      {/* Search History */}\n      {searchHistory.length > 0 && (\n        <div className=\"space-y-2\">\n          <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Recent Searches</h4>\n          <div className=\"space-y-2\">\n            {searchHistory.map((item, index) => (\n              <button\n                key={index}\n                onClick={() => loadFromHistory(item)}\n                className=\"w-full text-left p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors\"\n                data-testid={`button-history-${index}`}\n              >\n                <p className=\"text-sm font-medium text-gray-900 dark:text-gray-100 line-clamp-1\">\n                  {item.question}\n                </p>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {new Date(item.timestamp).toLocaleString()}\n                </p>\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":6656},"client/src/components/report/ReportWorkChat.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Loader2, Send, FileText, X, ChevronRight, Bot, User } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport MarkdownRenderer from \"@/components/documents/MarkdownRenderer\";\n\ninterface ReportWorkChatProps {\n  reportId: number;\n  reportTitle: string;\n  onClose: () => void;\n}\n\ninterface ChatMessage {\n  id: string;\n  role: \"user\" | \"assistant\";\n  content: string;\n  timestamp: Date;\n}\n\nexport function ReportWorkChat({ reportId, reportTitle, onClose }: ReportWorkChatProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [selectedTemplateId, setSelectedTemplateId] = useState<number | null>(null);\n  const [selectedSection, setSelectedSection] = useState<string | null>(null);\n  const [question, setQuestion] = useState(\"\");\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\n  const scrollRef = useRef<HTMLDivElement>(null);\n\n  // Fetch available investment templates\n  const { data: templates } = useQuery({\n    queryKey: ['/api/templates/investment'],\n  });\n\n  // Parse template data to get sections when template is selected\n  const templateSections = selectedTemplateId && templates \n    ? (() => {\n        const template = (templates as any[]).find((t: any) => t.id === selectedTemplateId);\n        if (template && template.templateData) {\n          try {\n            // Handle both string and pre-parsed object formats\n            const data = typeof template.templateData === 'string' \n              ? JSON.parse(template.templateData)\n              : template.templateData;\n            return data.sections || [];\n          } catch (e) {\n            console.error('Failed to parse template data:', e);\n            return [];\n          }\n        }\n        return [];\n      })()\n    : [];\n\n  // Fetch report details for context\n  const { data: reportDetails } = useQuery({\n    queryKey: [`/api/investments/${reportId}`],\n  });\n\n  // Fetch documents for context\n  const { data: documents } = useQuery({\n    queryKey: [`/api/documents/investment/${reportId}`],\n  });\n\n  // Auto-scroll to bottom when messages change\n  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  }, [messages]);\n\n  // Add welcome message when documents load (only if messages array is empty)\n  useEffect(() => {\n    if (documents !== undefined && messages.length === 0) {\n      setMessages([{\n        id: '0',\n        role: 'assistant',\n        content: `Welcome! I'm here to help you work on \"${reportTitle}\". \n      \nI have access to:\n- Your report description and context\n- ${documents.length > 0 ? `All ${documents.length} attached document(s)` : 'Your report metadata (you can upload documents to enhance my context)'}\n- External knowledge from EKG service\n- Historical insights from our vector store\n\nPlease select a template and section to get started, or ask me any questions about your report.`,\n        timestamp: new Date()\n      }]);\n    }\n  }, [documents, reportTitle, messages.length]); // Only set if messages is empty\n\n  const chatMutation = useMutation({\n    mutationFn: async (data: { question: string; templateId?: number; sectionName?: string }) => {\n      const response = await apiRequest(\"POST\", `/api/reports/${reportId}/chat`, {\n        question: data.question,\n        templateId: data.templateId,\n        sectionName: data.sectionName,\n        conversationHistory: messages.map(m => ({ role: m.role, content: m.content }))\n      });\n      return response;\n    },\n    onSuccess: (data) => {\n      setMessages(prev => [...prev, {\n        id: Date.now().toString(),\n        role: 'assistant',\n        content: data.answer,\n        timestamp: new Date()\n      }]);\n      setQuestion(\"\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to get AI response\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const handleSubmit = () => {\n    if (!question.trim()) return;\n\n    // Add user message\n    const userMessage: ChatMessage = {\n      id: Date.now().toString(),\n      role: 'user',\n      content: question,\n      timestamp: new Date()\n    };\n    setMessages(prev => [...prev, userMessage]);\n\n    // Send to AI\n    chatMutation.mutate({\n      question: question.trim(),\n      templateId: selectedTemplateId || undefined,\n      sectionName: selectedSection || undefined\n    });\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSubmit();\n    }\n  };\n\n  return (\n    <Card className=\"w-full h-[700px] flex flex-col\">\n      <CardHeader className=\"border-b space-y-4 pb-4\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <FileText className=\"h-5 w-5\" />\n            Work on Report: {reportTitle}\n          </CardTitle>\n          <Button variant=\"ghost\" size=\"sm\" onClick={onClose} data-testid=\"button-close-chat\">\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n\n        {/* Template and Section Selection */}\n        <div className=\"grid grid-cols-2 gap-3\">\n          <div className=\"space-y-1.5\">\n            <label className=\"text-sm font-medium\">Template</label>\n            <Select\n              value={selectedTemplateId?.toString() || \"\"}\n              onValueChange={(val) => {\n                setSelectedTemplateId(parseInt(val));\n                setSelectedSection(null);\n              }}\n            >\n              <SelectTrigger data-testid=\"select-template\">\n                <SelectValue placeholder=\"Select template...\" />\n              </SelectTrigger>\n              <SelectContent>\n                {templates?.map((template: any) => (\n                  <SelectItem key={template.id} value={template.id.toString()}>\n                    {template.name}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"space-y-1.5\">\n            <label className=\"text-sm font-medium\">Section</label>\n            <Select\n              value={selectedSection || \"\"}\n              onValueChange={setSelectedSection}\n              disabled={!selectedTemplateId}\n            >\n              <SelectTrigger data-testid=\"select-section\">\n                <SelectValue placeholder=\"Select section...\" />\n              </SelectTrigger>\n              <SelectContent>\n                {templateSections?.map((section: any, idx: number) => (\n                  <SelectItem key={idx} value={section.name || section.title || section}>\n                    {section.name || section.title || section}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        {/* Context Info */}\n        <div className=\"flex gap-2 flex-wrap\">\n          {reportDetails?.description && (\n            <Badge variant=\"outline\" className=\"text-xs\">\n              Has Description\n            </Badge>\n          )}\n          <Badge variant=\"outline\" className=\"text-xs\">\n            {documents?.length || 0} Document(s)\n          </Badge>\n          {selectedTemplateId && (\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              {templates?.find((t: any) => t.id === selectedTemplateId)?.name}\n            </Badge>\n          )}\n          {selectedSection && (\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              Section: {selectedSection}\n            </Badge>\n          )}\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"flex-1 flex flex-col p-0 overflow-hidden\">\n        {/* Messages Area */}\n        <ScrollArea className=\"flex-1 p-6\" ref={scrollRef}>\n          <div className=\"space-y-4\">\n            {messages.map((message) => (\n              <div\n                key={message.id}\n                className={`flex gap-3 ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}\n              >\n                {message.role === 'assistant' && (\n                  <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0\">\n                    <Bot className=\"h-4 w-4 text-white\" />\n                  </div>\n                )}\n                <div\n                  className={`max-w-[80%] rounded-lg px-4 py-3 ${\n                    message.role === 'user'\n                      ? 'bg-blue-600 text-white'\n                      : 'bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100'\n                  }`}\n                  data-testid={`message-${message.role}-${message.id}`}\n                >\n                  {message.role === 'assistant' ? (\n                    <MarkdownRenderer content={message.content} />\n                  ) : (\n                    <p className=\"whitespace-pre-wrap\">{message.content}</p>\n                  )}\n                </div>\n                {message.role === 'user' && (\n                  <div className=\"h-8 w-8 rounded-full bg-blue-600 flex items-center justify-center flex-shrink-0\">\n                    <User className=\"h-4 w-4 text-white\" />\n                  </div>\n                )}\n              </div>\n            ))}\n            {chatMutation.isPending && (\n              <div className=\"flex gap-3 justify-start\">\n                <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0\">\n                  <Bot className=\"h-4 w-4 text-white\" />\n                </div>\n                <div className=\"bg-gray-100 dark:bg-gray-800 rounded-lg px-4 py-3\">\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                </div>\n              </div>\n            )}\n          </div>\n        </ScrollArea>\n\n        {/* Input Area */}\n        <div className=\"border-t p-4\">\n          <div className=\"flex gap-2\">\n            <Textarea\n              value={question}\n              onChange={(e) => setQuestion(e.target.value)}\n              onKeyDown={handleKeyPress}\n              placeholder={\n                selectedTemplateId && selectedSection\n                  ? `Ask about ${selectedSection} or request help drafting it...`\n                  : \"Ask me anything about your report...\"\n              }\n              className=\"min-h-[80px] resize-none\"\n              disabled={chatMutation.isPending}\n              data-testid=\"input-chat-question\"\n            />\n            <Button\n              onClick={handleSubmit}\n              disabled={!question.trim() || chatMutation.isPending}\n              className=\"h-[80px]\"\n              data-testid=\"button-send-message\"\n            >\n              {chatMutation.isPending ? (\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n              ) : (\n                <Send className=\"h-4 w-4\" />\n              )}\n            </Button>\n          </div>\n          <p className=\"text-xs text-gray-500 mt-2\">\n            Press Enter to send, Shift+Enter for new line\n          </p>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":11714},"client/src/pages/InvestmentPortal.tsx":{"content":"import { useState } from \"react\";\nimport { Route, Switch, useLocation } from \"wouter\";\nimport { LayoutDashboard, TrendingUp, Briefcase, CheckSquare, FileText, Menu, X, ChevronLeft, ChevronRight, LogIn } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useUser } from \"@/lib/auth\";\nimport DashboardPage from \"@/pages/Dashboard\";\nimport NewInvestmentPage from \"@/pages/NewInvestment\";\nimport MyInvestmentsPage from \"@/pages/MyInvestments\";\nimport MyTasksPage from \"@/pages/MyTasks\";\nimport TemplatesPage from \"@/pages/Templates\";\n\nexport default function InvestmentPortal() {\n  const [location, setLocation] = useLocation();\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n  const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(false);\n  const user = useUser();\n\n  const navItems = [\n    {\n      name: \"Dashboard\",\n      icon: LayoutDashboard,\n      path: \"/investment-portal\",\n      description: \"Overview & Analytics\"\n    },\n    {\n      name: \"New Report\",\n      icon: TrendingUp,\n      path: \"/investment-portal/new\",\n      description: \"Create Report\"\n    },\n    {\n      name: \"My Reports\",\n      icon: Briefcase,\n      path: \"/investment-portal/investments\",\n      description: \"Track Reports\"\n    },\n    {\n      name: \"My Tasks\",\n      icon: CheckSquare,\n      path: \"/investment-portal/tasks\",\n      description: \"Approvals & Actions\"\n    },\n    {\n      name: \"Templates\",\n      icon: FileText,\n      path: \"/investment-portal/templates\",\n      description: \"Report Templates\"\n    }\n  ];\n\n  // Show login prompt if not authenticated\n  if (!user) {\n    return (\n      <div className=\"flex h-full bg-background items-center justify-center p-6\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader className=\"text-center\">\n            <div className=\"flex justify-center mb-4\">\n              <div className=\"rounded-full bg-primary/10 p-3\">\n                <LogIn className=\"w-8 h-8 text-primary\" />\n              </div>\n            </div>\n            <CardTitle className=\"text-2xl\">Login Required</CardTitle>\n            <CardDescription className=\"text-base mt-2\">\n              Please login to access the Report Portal\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <p className=\"text-sm text-muted-foreground text-center\">\n              The Report Portal requires authentication to create and manage reports. Click the user icon in the top-right corner to login.\n            </p>\n            <div className=\"bg-muted p-4 rounded-lg\">\n              <p className=\"text-xs font-semibold text-foreground mb-2\">Test Accounts:</p>\n              <div className=\"space-y-1 text-xs text-muted-foreground\">\n                <p>â€¢ <span className=\"font-mono\">john_ba</span> / <span className=\"font-mono\">password123</span></p>\n                <p>â€¢ <span className=\"font-mono\">sarah_ba</span> / <span className=\"font-mono\">password123</span></p>\n                <p>â€¢ <span className=\"font-mono\">M1</span> / <span className=\"font-mono\">password123</span> (Manager)</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex h-full bg-background\">\n      {/* Sidebar - Desktop */}\n      <div className={`hidden md:flex md:flex-col bg-card border-r border-border transition-all duration-300 ${\n        isSidebarCollapsed ? 'md:w-16' : 'md:w-64'\n      }`}>\n        <div className=\"p-4 border-b border-border flex items-center justify-between\">\n          {!isSidebarCollapsed && (\n            <div className=\"flex-1\">\n              <h2 className=\"text-lg font-bold text-foreground\">Report Portal</h2>\n              <p className=\"text-xs text-muted-foreground mt-1\">Document Generation System</p>\n            </div>\n          )}\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setIsSidebarCollapsed(!isSidebarCollapsed)}\n            className=\"flex-shrink-0\"\n            data-testid=\"button-toggle-sidebar\"\n          >\n            {isSidebarCollapsed ? <ChevronRight className=\"w-4 h-4\" /> : <ChevronLeft className=\"w-4 h-4\" />}\n          </Button>\n        </div>\n        \n        <nav className=\"flex-1 overflow-y-auto p-3 space-y-1\">\n          {navItems.map((item) => {\n            const Icon = item.icon;\n            const isActive = location === item.path;\n            \n            return (\n              <button\n                key={item.path}\n                onClick={() => setLocation(item.path)}\n                className={`w-full flex items-start gap-3 px-3 py-2.5 rounded-lg transition-all ${\n                  isActive\n                    ? \"bg-primary text-primary-foreground shadow-sm\"\n                    : \"text-muted-foreground hover:bg-accent hover:text-accent-foreground\"\n                } ${isSidebarCollapsed ? 'justify-center' : ''}`}\n                data-testid={`nav-${item.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                title={isSidebarCollapsed ? item.name : ''}\n              >\n                <Icon className=\"w-5 h-5 mt-0.5 flex-shrink-0\" />\n                {!isSidebarCollapsed && (\n                  <div className=\"text-left\">\n                    <div className=\"font-medium text-sm\">{item.name}</div>\n                    <div className={`text-xs ${isActive ? 'text-primary-foreground/80' : 'text-muted-foreground'}`}>\n                      {item.description}\n                    </div>\n                  </div>\n                )}\n              </button>\n            );\n          })}\n        </nav>\n\n        {!isSidebarCollapsed && (\n          <div className=\"p-3 border-t border-border\">\n            <div className=\"text-xs text-muted-foreground text-center\">\n              Report Management System\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Mobile Header & Menu */}\n      <div className=\"md:hidden fixed top-0 left-0 right-0 z-50 bg-card border-b border-border\">\n        <div className=\"flex items-center justify-between p-4\">\n          <div>\n            <h2 className=\"text-lg font-bold text-foreground\">Report Portal</h2>\n            <p className=\"text-xs text-muted-foreground\">Document Generation System</p>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}\n          >\n            {isMobileMenuOpen ? <X className=\"w-5 h-5\" /> : <Menu className=\"w-5 h-5\" />}\n          </Button>\n        </div>\n\n        {isMobileMenuOpen && (\n          <nav className=\"border-t border-border p-3 space-y-1 bg-card\">\n            {navItems.map((item) => {\n              const Icon = item.icon;\n              const isActive = location === item.path;\n              \n              return (\n                <button\n                  key={item.path}\n                  onClick={() => {\n                    setLocation(item.path);\n                    setIsMobileMenuOpen(false);\n                  }}\n                  className={`w-full flex items-start gap-3 px-3 py-2.5 rounded-lg transition-all ${\n                    isActive\n                      ? \"bg-primary text-primary-foreground\"\n                      : \"text-muted-foreground hover:bg-accent hover:text-accent-foreground\"\n                  }`}\n                >\n                  <Icon className=\"w-5 h-5 mt-0.5 flex-shrink-0\" />\n                  <div className=\"text-left\">\n                    <div className=\"font-medium text-sm\">{item.name}</div>\n                    <div className={`text-xs ${isActive ? 'text-primary-foreground/80' : 'text-muted-foreground'}`}>\n                      {item.description}\n                    </div>\n                  </div>\n                </button>\n              );\n            })}\n          </nav>\n        )}\n      </div>\n\n      {/* Main Content */}\n      <div className=\"flex-1 w-full min-w-0 overflow-auto md:mt-0 mt-20\">\n        {location === \"/investment-portal\" && <DashboardPage />}\n        {location === \"/investment-portal/new\" && <NewInvestmentPage />}\n        {location === \"/investment-portal/investments\" && <MyInvestmentsPage />}\n        {location === \"/investment-portal/tasks\" && <MyTasksPage />}\n        {location === \"/investment-portal/templates\" && <TemplatesPage />}\n      </div>\n    </div>\n  );\n}\n","size_bytes":8437},"client/src/pages/NewInvestment.tsx":{"content":"import { InvestmentForm } from \"@/components/forms/InvestmentForm\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\n\nexport default function NewInvestment() {\n  return (\n    <div className=\"w-full h-full pl-6 py-6\">\n      <Card className=\"max-w-4xl mx-auto\">\n        <CardHeader>\n          <CardTitle className=\"text-2xl\">New Report Request</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <InvestmentForm />\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":514},"client/src/pages/MyTasks.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useState, useEffect } from \"react\";\nimport { Clock, CheckSquare, AlertTriangle, Calendar, User, Download, FileText, File, ChevronDown, ChevronUp, CheckCircle, XCircle, Eye, Search, DollarSign, TrendingUp, Edit, Trash2 } from \"lucide-react\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\nimport { format } from \"date-fns\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport DocumentAnalysisCard from '@/components/documents/DocumentAnalysisCard';\nimport UnifiedSearchInterface from '@/components/documents/UnifiedSearchInterface';\nimport InvestmentRationaleModal from '@/components/rationale/InvestmentRationaleModal';\nimport MarkdownRenderer from '@/components/documents/MarkdownRenderer';\nimport { ApprovalHistoryCard } from '@/components/approval/ApprovalHistoryCard';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\n\nexport default function MyTasks() {\n  const [expandedTask, setExpandedTask] = useState<number | null>(null);\n  const [comments, setComments] = useState(\"\");\n  const [isDocumentsExpanded, setIsDocumentsExpanded] = useState(false);\n  const [isResearchExpanded, setIsResearchExpanded] = useState(false);\n  const [isRationaleExpanded, setIsRationaleExpanded] = useState(false);\n  const [isRationaleModalOpen, setIsRationaleModalOpen] = useState(false);\n  const [editingRationaleId, setEditingRationaleId] = useState<number | null>(null);\n  const [editingRationaleContent, setEditingRationaleContent] = useState('');\n  const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false);\n  const [rationaleToDelete, setRationaleToDelete] = useState<number | null>(null);\n  const [activeTab, setActiveTab] = useState<\"active\" | \"completed\">(\"active\");\n\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch approval tasks for the logged-in manager\n  const { data: approvals = [], isLoading } = useQuery({\n    queryKey: [\"/api/approvals/my-tasks\"],\n  });\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'pending':\n        return 'bg-yellow-100 text-yellow-800';\n      case 'completed':\n        return 'bg-green-100 text-green-800';\n      case 'overdue':\n        return 'bg-red-100 text-red-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case 'high':\n        return 'bg-red-100 text-red-800';\n      case 'medium':\n        return 'bg-yellow-100 text-yellow-800';\n      case 'low':\n        return 'bg-blue-100 text-blue-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getTaskIcon = (taskType: string) => {\n    switch (taskType) {\n      case 'approval':\n        return CheckSquare;\n      case 'review':\n        return Clock;\n      case 'changes_requested':\n        return AlertTriangle;\n      default:\n        return CheckSquare;\n    }\n  };\n\n  const handleTaskAction = (task: any) => {\n    setExpandedTask(expandedTask === task.id ? null : task.id);\n    setComments(\"\");\n  };\n\n  const processApproval = useMutation({\n    mutationFn: async ({ approvalId, action }: { approvalId: number; action: 'approve' | 'reject' | 'changes_requested' }) => {\n      const approval = approvals?.find((a: any) => a.id === approvalId);\n      if (!approval) throw new Error('Approval not found');\n      \n      const response = await apiRequest(\"PUT\", `/api/approvals/${approvalId}`, {\n        status: action === 'approve' ? 'approved' : action === 'reject' ? 'rejected' : 'changes_requested',\n        rejectionReason: action === 'reject' ? comments : undefined,\n        comments: comments, // Send comments for all actions (approve, reject, changes_requested)\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/approvals/my-tasks\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/dashboard/recent-requests\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/investments\"] });\n      \n      toast({\n        title: \"Approval processed\",\n        description: \"The request has been processed successfully\",\n      });\n      \n      setExpandedTask(null);\n      setComments(\"\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error processing approval\",\n        description: error.message || \"Something went wrong\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n\n\n  if (isLoading) {\n    return (\n      <div className=\"w-full h-full pl-6 py-6\">\n        <div className=\"space-y-4\">\n          {[...Array(5)].map((_, i) => (\n            <div key={i} className=\"bg-white p-6 rounded-lg shadow animate-pulse\">\n              <div className=\"h-4 bg-gray-200 rounded w-3/4 mb-2\"></div>\n              <div className=\"h-4 bg-gray-200 rounded w-1/2\"></div>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  const pendingApprovals = approvals?.filter((approval: any) => approval.status === 'pending') || [];\n  const completedApprovals = approvals?.filter((approval: any) => approval.status === 'approved' || approval.status === 'rejected') || [];\n  const overdueApprovals = approvals?.filter((approval: any) => approval.status === 'overdue') || [];\n  \n  // Combine pending and overdue approvals for the \"Active\" tab\n  const activeApprovals = [...overdueApprovals, ...pendingApprovals];\n\n  return (\n    <div className=\"w-full h-full pl-6 py-6\">\n      <div className=\"mb-6\">\n        <h1 className=\"text-2xl font-semibold mb-2\">My Tasks</h1>\n        <div className=\"flex gap-4 text-sm text-gray-600\">\n          <span>{activeApprovals.length} active</span>\n          <span>{completedApprovals.length} completed</span>\n        </div>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={(value) => setActiveTab(value as \"active\" | \"completed\")} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"active\" className=\"flex items-center gap-2\">\n            Active Tasks\n            {activeApprovals.length > 0 && (\n              <Badge variant=\"secondary\" className=\"ml-1\">\n                {activeApprovals.length}\n              </Badge>\n            )}\n          </TabsTrigger>\n          <TabsTrigger value=\"completed\" className=\"flex items-center gap-2\">\n            Completed Tasks\n            {completedApprovals.length > 0 && (\n              <Badge variant=\"secondary\" className=\"ml-1\">\n                {completedApprovals.length}\n              </Badge>\n            )}\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"active\" className=\"mt-6\">\n          <div className=\"space-y-6\">\n            {/* Overdue Tasks Section (within Active tab) */}\n            {overdueApprovals.length > 0 && (\n              <div>\n                <h2 className=\"text-lg font-semibold mb-4 text-red-600\">Overdue Tasks</h2>\n                <div className=\"space-y-4\">\n                  {overdueApprovals.map((task: any) => (\n                    <TaskCard \n                      key={task.id} \n                      task={task} \n                      onAction={handleTaskAction}\n                      isExpanded={expandedTask === task.id}\n                      onProcessApproval={processApproval}\n                      comments={comments}\n                      setComments={setComments}\n                      onPreview={() => {}}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* Pending Tasks Section (within Active tab) */}\n            <div>\n              <h2 className=\"text-lg font-semibold mb-4\">Pending Tasks</h2>\n              <div className=\"space-y-4\">\n                {pendingApprovals.length === 0 ? (\n                  <Card>\n                    <CardContent className=\"py-8 text-center\">\n                      <CheckSquare className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                      <p className=\"text-gray-600\">No pending tasks</p>\n                      <p className=\"text-sm text-gray-500 mt-2\">\n                        You're all caught up! Check back later for new tasks.\n                      </p>\n                    </CardContent>\n                  </Card>\n                ) : (\n                  pendingApprovals.map((task: any) => (\n                    <TaskCard \n                      key={task.id} \n                      task={task} \n                      onAction={handleTaskAction}\n                      isExpanded={expandedTask === task.id}\n                      onProcessApproval={processApproval}\n                      comments={comments}\n                      setComments={setComments}\n                      onPreview={() => {}}\n                    />\n                  ))\n                )}\n              </div>\n            </div>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"completed\" className=\"mt-6\">\n          <div className=\"space-y-4\">\n            {completedApprovals.length === 0 ? (\n              <Card>\n                <CardContent className=\"py-8 text-center\">\n                  <CheckCircle className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                  <p className=\"text-gray-600\">No completed tasks</p>\n                  <p className=\"text-sm text-gray-500 mt-2\">\n                    Completed tasks will appear here after you finish them.\n                  </p>\n                </CardContent>\n              </Card>\n            ) : (\n              completedApprovals.map((task: any) => (\n                <TaskCard \n                  key={task.id} \n                  task={task} \n                  onAction={handleTaskAction}\n                  isExpanded={expandedTask === task.id}\n                  onProcessApproval={processApproval}\n                  comments={comments}\n                  setComments={setComments}\n                  onPreview={() => {}}\n                />\n              ))\n            )}\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      {/* Preview now opens in new tab, no dialog needed */}\n    </div>\n  );\n}\n\nfunction TaskCard({ \n  task, \n  onAction, \n  isExpanded, \n  onProcessApproval,\n  comments,\n  setComments,\n  onPreview\n}: { \n  task: any; \n  onAction: (task: any) => void;\n  isExpanded: boolean;\n  onProcessApproval: any;\n  comments: string;\n  setComments: (comments: string) => void;\n  onPreview: (document: any) => void;\n}) {\n  const Icon = getTaskIcon(task.taskType);\n  const [analyzingDocument, setAnalyzingDocument] = useState<number | null>(null);\n  \n  // State for section expand/collapse functionality\n  const [isDocumentsExpanded, setIsDocumentsExpanded] = useState(false);\n  const [isResearchExpanded, setIsResearchExpanded] = useState(false);\n  const [isRationaleExpanded, setIsRationaleExpanded] = useState(false);\n  const [isApprovalExpanded, setIsApprovalExpanded] = useState(true); // Keep approval history expanded by default\n  const [isRationaleModalOpen, setIsRationaleModalOpen] = useState(false);\n  const [editingRationaleId, setEditingRationaleId] = useState<number | null>(null);\n  const [editingRationaleContent, setEditingRationaleContent] = useState('');\n  const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false);\n  const [rationaleToDelete, setRationaleToDelete] = useState<number | null>(null);\n\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const { data: requestData } = useQuery({\n    queryKey: [`/api/${task.requestType.replace('_', '-')}s/${task.requestId}`],\n    enabled: isExpanded,\n  });\n\n  const { data: approvalHistory } = useQuery({\n    queryKey: [`/api/approvals/${task.requestType}/${task.requestId}`],\n    enabled: isExpanded,\n  });\n\n  const { data: documents } = useQuery({\n    queryKey: [`/api/documents/${task.requestType}/${task.requestId}`],\n    enabled: isExpanded,\n  });\n\n  // Fetch rationales for investment tasks\n  const { data: rationales } = useQuery({\n    queryKey: [`/api/investments/${task.requestId}/rationales`],\n    enabled: isExpanded && task.requestType === 'investment',\n  });\n\n  // Auto-expand rationale section when rationales exist\n  useEffect(() => {\n    if (rationales && rationales.length > 0 && !isRationaleExpanded) {\n      setIsRationaleExpanded(true);\n    }\n  }, [rationales]);\n\n  // DocumentAnalysisCard component now handles the analysis results directly\n\n  const getFileIcon = (mimeType: string) => {\n    if (mimeType.includes('pdf')) {\n      return <FileText className=\"h-5 w-5 text-red-500\" />;\n    }\n    return <File className=\"h-5 w-5 text-gray-500\" />;\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'approved':\n      case 'approve':\n        return <CheckCircle className=\"h-5 w-5 text-green-600\" />;\n      case 'rejected':\n        return <XCircle className=\"h-5 w-5 text-red-600\" />;\n      case 'pending':\n        return <Clock className=\"h-5 w-5 text-yellow-600\" />;\n      default:\n        return <User className=\"h-5 w-5 text-gray-600\" />;\n    }\n  };\n\n  const handleDownload = async (document: any) => {\n    try {\n      console.log('Starting download for document:', document);\n      // Use direct link approach for better browser compatibility\n      const link = window.document.createElement('a');\n      link.href = `/api/documents/download/${document.id}`;\n      link.download = document.originalName;\n      link.target = '_blank';\n      window.document.body.appendChild(link);\n      link.click();\n      window.document.body.removeChild(link);\n      console.log('Download initiated successfully');\n    } catch (error) {\n      console.error('Download failed:', error);\n      alert('Download failed. Please try again or contact support.');\n    }\n  };\n\n  // Rationale mutation functions\n  const saveRationaleEdit = useMutation({\n    mutationFn: async ({ rationaleId, content }: { rationaleId: number; content: string }) => {\n      const response = await apiRequest('PUT', `/api/investments/${task.requestId}/rationales/${rationaleId}`, { content });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/investments/${task.requestId}/rationales`] });\n      setEditingRationaleId(null);\n      setEditingRationaleContent('');\n      toast({ title: \"Rationale updated successfully\" });\n    },\n    onError: () => {\n      toast({ \n        title: \"Error updating rationale\", \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  const deleteRationale = useMutation({\n    mutationFn: async (rationaleId: number) => {\n      const response = await apiRequest('DELETE', `/api/investments/${task.requestId}/rationales/${rationaleId}`, {});\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/investments/${task.requestId}/rationales`] });\n      setDeleteConfirmOpen(false);\n      setRationaleToDelete(null);\n      toast({ title: \"Rationale deleted successfully\" });\n    },\n    onError: () => {\n      toast({ \n        title: \"Error deleting rationale\", \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  const downloadRationale = async (rationale: any) => {\n    try {\n      // Import jsPDF dynamically\n      const jsPDF = (await import('jspdf')).default;\n      const doc = new jsPDF();\n      \n      // Set up the document\n      doc.setFontSize(16);\n      doc.text('Investment Rationale', 20, 20);\n      \n      doc.setFontSize(12);\n      doc.text(`Investment: ${requestData?.targetCompany || 'N/A'}`, 20, 35);\n      doc.text(`Author: ${rationale.authorName}`, 20, 45);\n      doc.text(`Created: ${format(new Date(rationale.createdAt), 'MMM dd, yyyy HH:mm')}`, 20, 55);\n      doc.text(`Type: ${rationale.type === 'manual' ? 'Manual Entry' : 'AI Generated'}`, 20, 65);\n      \n      // Process the content to handle spacing issues\n      let processedContent = rationale.content\n        .replace(/\\s+/g, ' ') // Replace multiple spaces with single space\n        .replace(/(\\w)\\s+(\\w)/g, '$1$2') // Remove spaces between letters within words\n        .replace(/([a-z])\\s*-\\s*([a-z])/gi, '$1-$2') // Fix hyphenated words\n        .replace(/\\*\\*(.*?)\\*\\*/g, '$1') // Remove markdown bold\n        .replace(/##\\s*(.*?)[\\r\\n]/g, '$1\\n') // Clean headers\n        .trim();\n      \n      // Add content with proper text wrapping\n      const lines = doc.splitTextToSize(processedContent, 170); // 170mm width for A4\n      doc.text(lines, 20, 80);\n      \n      // Save the PDF\n      doc.save(`investment-rationale-${rationale.id}.pdf`);\n      \n      toast({ title: \"Rationale downloaded successfully\" });\n    } catch (error) {\n      console.error('PDF download failed:', error);\n      toast({ \n        title: \"Error downloading rationale\", \n        variant: \"destructive\" \n      });\n    }\n  };\n\n\n\n  \n  return (\n    <>\n    <Card className={`hover:shadow-md transition-shadow ${\n      task.status === 'overdue' ? 'border-l-4 border-red-500' : ''\n    }`}>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex items-start gap-4 flex-1\">\n            <div className={`w-10 h-10 rounded-full flex items-center justify-center ${\n              task.status === 'overdue' ? 'bg-red-100' : \n              task.status === 'completed' ? 'bg-green-100' : 'bg-blue-100'\n            }`}>\n              <Icon className={`h-5 w-5 ${\n                task.status === 'overdue' ? 'text-red-600' : \n                task.status === 'completed' ? 'text-green-600' : 'text-blue-600'\n              }`} />\n            </div>\n            \n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-3 mb-2\">\n                <h3 className=\"font-semibold\">{task.title}</h3>\n                <Badge className={getStatusColor(task.status)}>\n                  {task.status}\n                </Badge>\n                <Badge className={getPriorityColor(task.priority)}>\n                  {task.priority}\n                </Badge>\n              </div>\n              \n              <p className=\"text-gray-600 mb-3\">{task.description}</p>\n              \n              {/* Show Request ID and Investment Type on main card */}\n              <div className=\"flex items-center gap-4 text-sm mb-3\">\n                <div className=\"flex items-center gap-1 font-semibold text-blue-600\">\n                  <span>Request ID:</span>\n                  <span>{task.requestId}</span>\n                </div>\n                <div className=\"flex items-center gap-1 font-semibold text-purple-600\">\n                  <span>Type:</span>\n                  <span className=\"capitalize\">{task.investmentType || task.requestType.replace('_', ' ')}</span>\n                </div>\n              </div>\n              \n              {/* Add 3-column grid for proposal details */}\n              {requestData && (\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <DollarSign className=\"w-4 h-4 text-green-600\" />\n                    <span className=\"text-sm text-gray-600\">Amount:</span>\n                    <span className=\"font-semibold\">${requestData.amount}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <TrendingUp className=\"w-4 h-4 text-blue-600\" />\n                    <span className=\"text-sm text-gray-600\">Expected Return:</span>\n                    <span className=\"font-semibold\">\n                      {requestData.expectedReturnType === 'range' && requestData.expectedReturnMin && requestData.expectedReturnMax\n                        ? `${requestData.expectedReturnMin}% - ${requestData.expectedReturnMax}%`\n                        : `${requestData.expectedReturn}%`\n                      }\n                    </span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Calendar className=\"w-4 h-4 text-gray-600\" />\n                    <span className=\"text-sm text-gray-600\">Created:</span>\n                    <span className=\"font-semibold\">{format(new Date(requestData.createdAt), 'MMM dd, yyyy')}</span>\n                  </div>\n                </div>\n              )}\n              \n              {/* Show description if available */}\n              {requestData?.description && (\n                <p className=\"text-sm text-gray-600 mb-4\">{requestData.description}</p>\n              )}\n              \n              <div className=\"flex items-center gap-4 text-sm text-gray-500\">\n                <div className=\"flex items-center gap-1\">\n                  <Calendar className=\"h-4 w-4\" />\n                  {task.dueDate ? format(new Date(task.dueDate), 'MMM dd, yyyy') : 'No due date'}\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <User className=\"h-4 w-4\" />\n                  {task.requestType.replace('_', ' ')}\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\" size=\"sm\" onClick={() => onAction(task)}>\n              {isExpanded ? <ChevronUp className=\"h-4 w-4 mr-1\" /> : <ChevronDown className=\"h-4 w-4 mr-1\" />}\n              {isExpanded ? 'Hide Details' : 'View Details'}\n            </Button>\n          </div>\n        </div>\n\n        {/* Expanded Details */}\n        {isExpanded && requestData && (\n          <div className=\"mt-6 space-y-6 pt-6 border-t\">\n            {/* I. Attached Documents */}\n            {documents && documents.length > 0 && (\n              <Card>\n                <CardHeader \n                  className=\"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors py-3\"\n                  onClick={() => setIsDocumentsExpanded(!isDocumentsExpanded)}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"flex items-center gap-2 text-base\">\n                      <FileText className=\"h-4 w-4\" />\n                      Attached Documents\n                    </CardTitle>\n                    {isDocumentsExpanded ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n                  </div>\n                </CardHeader>\n                {isDocumentsExpanded && (\n                  <CardContent className=\"pt-0 pb-4\">\n                    <div className=\"space-y-3\">\n                      {documents.map((document: any) => (\n                        <DocumentAnalysisCard\n                          key={document.id}\n                          document={document}\n                          requestType={task.requestType}\n                          requestId={task.requestId}\n                          hideRiskAssessment={true}\n                          hideKeyInfoHeader={true}\n                          simplifiedView={true}\n                        />\n                      ))}\n                    </div>\n                  </CardContent>\n                )}\n              </Card>\n            )}\n\n            {/* II. Research & Analysis */}\n            {documents && documents.length > 0 && (\n              <Card>\n                <CardHeader \n                  className=\"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors py-3\"\n                  onClick={() => setIsResearchExpanded(!isResearchExpanded)}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"flex items-center gap-2 text-base\">\n                      <Search className=\"h-4 w-4\" />\n                      Research & Analysis\n                    </CardTitle>\n                    {isResearchExpanded ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n                  </div>\n                </CardHeader>\n                {isResearchExpanded && (\n                  <CardContent className=\"pt-0 pb-4\">\n                    <UnifiedSearchInterface \n                      documents={documents}\n                      requestId={task.requestId}\n                      requestType={task.requestType}\n                      isExpanded={isResearchExpanded}\n                      onExpandedChange={setIsResearchExpanded}\n                    />\n                  </CardContent>\n                )}\n              </Card>\n            )}\n\n            {/* III. Analyst Notes */}\n            <Card>\n              <CardHeader \n                className=\"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors py-3\"\n                onClick={() => setIsRationaleExpanded(!isRationaleExpanded)}\n              >\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"flex items-center gap-2 text-base\">\n                    <FileText className=\"h-4 w-4\" />\n                    Analyst Notes\n                  </CardTitle>\n                  {isRationaleExpanded ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n                </div>\n              </CardHeader>\n              {isRationaleExpanded && (\n                <CardContent className=\"pt-0 pb-4\">\n                  {/* Show Analyst's Original Notes */}\n                  <div className=\"bg-gray-50 p-3 rounded border min-h-[60px] mb-4\">\n                    <MarkdownRenderer \n                      content={requestData?.description || 'No description provided by the analyst'}\n                      className=\"text-gray-800\"\n                    />\n                  </div>\n                </CardContent>\n              )}\n            </Card>\n\n            {/* IV. Investment Rationale (Formal Analysis) */}\n            <Card>\n              <CardHeader \n                className=\"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors py-3\"\n                onClick={() => setIsRationaleExpanded(!isRationaleExpanded)}\n              >\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"flex items-center gap-2 text-base\">\n                    <FileText className=\"h-4 w-4\" />\n                    Investment Rationale\n                    {rationales && rationales.length > 0 && (\n                      <Badge variant=\"secondary\">{rationales.length}</Badge>\n                    )}\n                  </CardTitle>\n                  {isRationaleExpanded ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n                </div>\n              </CardHeader>\n              {isRationaleExpanded && (\n                <CardContent className=\"pt-0 pb-4\">\n                  {/* Investment Rationales */}\n                  {rationales && rationales.length > 0 ? (\n                    <div className=\"space-y-4\">\n                      {rationales.map((rationale: any) => (\n                        <Card key={rationale.id} className=\"bg-gray-50 border-l-4 border-blue-500\">\n                          <CardContent className=\"p-4\">\n                            <div className=\"flex items-start justify-between mb-3\">\n                              <div className=\"flex-1\">\n                                <div className=\"flex items-center gap-2 mb-2\">\n                                  <span className=\"text-xs text-gray-500\">\n                                    by {rationale.author?.firstName} {rationale.author?.lastName} â€¢ {format(new Date(rationale.createdAt), 'MMM dd, yyyy HH:mm')}\n                                  </span>\n                                </div>\n                                \n                                {editingRationaleId === rationale.id ? (\n                                  <div className=\"space-y-3\">\n                                    <Textarea\n                                      value={editingRationaleContent}\n                                      onChange={(e) => setEditingRationaleContent(e.target.value)}\n                                      rows={10}\n                                      className=\"w-full\"\n                                    />\n                                    <div className=\"flex justify-end gap-2\">\n                                      <Button\n                                        variant=\"outline\"\n                                        size=\"sm\"\n                                        onClick={() => {\n                                          setEditingRationaleId(null);\n                                          setEditingRationaleContent('');\n                                        }}\n                                      >\n                                        Cancel\n                                      </Button>\n                                      <Button\n                                        size=\"sm\"\n                                        onClick={() => saveRationaleEdit.mutate({\n                                          rationaleId: rationale.id,\n                                          content: editingRationaleContent\n                                        })}\n                                        disabled={saveRationaleEdit.isPending}\n                                      >\n                                        {saveRationaleEdit.isPending ? 'Saving...' : 'Save Changes'}\n                                      </Button>\n                                    </div>\n                                  </div>\n                                ) : (\n                                  <div className=\"prose prose-sm max-w-none\">\n                                    <div className=\"text-sm bg-gray-50 dark:bg-gray-800 p-3 rounded border\">\n                                      <MarkdownRenderer content={rationale.content} />\n                                    </div>\n                                  </div>\n                                )}\n                              </div>\n                              \n                              {editingRationaleId !== rationale.id && (\n                                <div className=\"flex gap-1 ml-4\">\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    onClick={() => downloadRationale(rationale)}\n                                    className=\"h-8 w-8 p-0\"\n                                  >\n                                    <Download className=\"h-3 w-3\" />\n                                  </Button>\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    onClick={() => {\n                                      setEditingRationaleId(rationale.id);\n                                      setEditingRationaleContent(rationale.content);\n                                    }}\n                                    className=\"h-8 w-8 p-0\"\n                                  >\n                                    <Edit className=\"h-3 w-3\" />\n                                  </Button>\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    onClick={() => {\n                                      setRationaleToDelete(rationale.id);\n                                      setDeleteConfirmOpen(true);\n                                    }}\n                                    className=\"h-8 w-8 p-0 text-red-600 hover:text-red-700\"\n                                  >\n                                    <Trash2 className=\"h-3 w-3\" />\n                                  </Button>\n                                </div>\n                              )}\n                            </div>\n                          </CardContent>\n                        </Card>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-6 text-gray-500\">\n                      <FileText className=\"h-8 w-8 mx-auto mb-2 text-gray-400\" />\n                      <p className=\"text-sm\">No investment rationale added yet.</p>\n                    </div>\n                  )}\n                  \n                  {/* Add Rationale Button */}\n                  <div className=\"pt-3 border-t\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => setIsRationaleModalOpen(true)}\n                      className=\"flex items-center gap-2\"\n                    >\n                      <FileText className=\"h-4 w-4\" />\n                      Add Investment Rationale\n                    </Button>\n                  </div>\n                </CardContent>\n              )}\n            </Card>\n\n            {/* IV. Approval History */}\n            <ApprovalHistoryCard\n              requestType={task.requestType}\n              requestId={task.requestId}\n              isExpanded={isApprovalExpanded}\n              onToggle={() => setIsApprovalExpanded(!isApprovalExpanded)}\n            />\n\n\n\n            {/* Comments and Actions */}\n            {task.status === 'pending' && (\n              <div className=\"bg-gray-50 p-4 rounded-lg\">\n                {task.taskType === 'changes_requested' ? (\n                  // Actions for changes requested tasks\n                  <div className=\"space-y-4\">\n                    <div className=\"text-center\">\n                      <h4 className=\"font-semibold mb-2 text-orange-800\">Changes Requested</h4>\n                      <p className=\"text-sm text-gray-600 mb-4\">\n                        Please review the requested changes and update your proposal accordingly.\n                      </p>\n                      <Button\n                        onClick={() => window.location.href = '/investments'}\n                        className=\"flex items-center gap-2\"\n                      >\n                        <FileText className=\"h-4 w-4\" />\n                        Go to My Investments\n                      </Button>\n                    </div>\n                  </div>\n                ) : (\n                  // Actions for approval tasks\n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label htmlFor=\"comments\">Comments (Required)</Label>\n                      <Textarea\n                        id=\"comments\"\n                        rows={3}\n                        placeholder=\"Please provide your comments or feedback...\"\n                        value={comments}\n                        onChange={(e) => setComments(e.target.value)}\n                        className=\"mt-2\"\n                        required\n                      />\n                      {comments.trim() === '' && (\n                        <p className=\"text-sm text-red-500 mt-1\">\n                          Comments are required before approving or rejecting\n                        </p>\n                      )}\n                    </div>\n\n                    <div className=\"flex items-center justify-end space-x-4\">\n                      <Button\n                        variant=\"destructive\"\n                        onClick={() => onProcessApproval.mutate({ approvalId: task.id, action: 'reject' })}\n                        disabled={onProcessApproval.isPending || comments.trim() === ''}\n                        data-testid={`button-reject-${task.id}`}\n                      >\n                        <XCircle className=\"h-4 w-4 mr-2\" />\n                        Reject\n                      </Button>\n                      <Button\n                        variant=\"secondary\"\n                        onClick={() => onProcessApproval.mutate({ approvalId: task.id, action: 'changes_requested' })}\n                        disabled={onProcessApproval.isPending || comments.trim() === ''}\n                        data-testid={`button-changes-${task.id}`}\n                      >\n                        <FileText className=\"h-4 w-4 mr-2\" />\n                        Request Changes\n                      </Button>\n                      <Button\n                        onClick={() => onProcessApproval.mutate({ approvalId: task.id, action: 'approve' })}\n                        disabled={onProcessApproval.isPending || comments.trim() === ''}\n                        data-testid={`button-approve-${task.id}`}\n                      >\n                        <CheckCircle className=\"h-4 w-4 mr-2\" />\n                        Approve\n                      </Button>\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n    \n    {/* Investment Rationale Modal */}\n    <InvestmentRationaleModal\n      isOpen={isRationaleModalOpen}\n      onClose={() => setIsRationaleModalOpen(false)}\n      investmentId={task.requestId}\n      investmentType={requestData?.investmentType}\n    />\n    \n    {/* Delete Confirmation Dialog */}\n    <AlertDialog open={deleteConfirmOpen} onOpenChange={setDeleteConfirmOpen}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>Delete Investment Rationale</AlertDialogTitle>\n          <AlertDialogDescription>\n            Are you sure you want to delete this investment rationale? This action cannot be undone.\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel onClick={() => {\n            setDeleteConfirmOpen(false);\n            setRationaleToDelete(null);\n          }}>\n            Cancel\n          </AlertDialogCancel>\n          <AlertDialogAction\n            onClick={() => {\n              if (rationaleToDelete) {\n                deleteRationale.mutate(rationaleToDelete);\n              }\n            }}\n            className=\"bg-red-600 hover:bg-red-700\"\n          >\n            Delete\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  </>\n  );\n}\n\nfunction getTaskIcon(taskType: string) {\n  switch (taskType) {\n    case 'approval':\n      return CheckSquare;\n    case 'review':\n      return Clock;\n    case 'changes_requested':\n      return AlertTriangle;\n    default:\n      return CheckSquare;\n  }\n}\n\nfunction getStatusColor(status: string) {\n  switch (status) {\n    case 'pending':\n      return 'bg-yellow-100 text-yellow-800';\n    case 'completed':\n    case 'approved':\n    case 'approve':\n    case 'Admin approved':\n    case 'Manager approved':\n    case 'Committee approved':\n    case 'Finance approved':\n      return 'bg-green-100 text-green-800';\n    case 'overdue':\n    case 'rejected':\n    case 'admin_rejected':\n    case 'Manager rejected':\n    case 'Committee rejected':\n    case 'Finance rejected':\n      return 'bg-red-100 text-red-800';\n    default:\n      return 'bg-gray-100 text-gray-800';\n  }\n}\n\nfunction getStatusColorForBadge(status: string) {\n  switch (status) {\n    case 'opportunity':\n      return 'bg-purple-100 text-purple-800';\n    case 'Admin approved':\n    case 'Manager approved':\n    case 'Committee approved':\n    case 'Finance approved':\n    case 'approved':\n      return 'bg-green-100 text-green-800';\n    case 'admin_rejected':\n    case 'Manager rejected':\n    case 'Committee rejected':\n    case 'Finance rejected':\n    case 'rejected':\n      return 'bg-red-100 text-red-800';\n    case 'changes_requested':\n      return 'bg-orange-100 text-orange-800';\n    case 'pending':\n      return 'bg-yellow-100 text-yellow-800';\n    default:\n      return 'bg-gray-100 text-gray-800';\n  }\n}\n\nfunction getStatusIcon(status: string) {\n  switch (status) {\n    case 'Admin approved':\n    case 'Manager approved':\n    case 'Committee approved':\n    case 'Finance approved':\n    case 'approved':\n      return <CheckCircle className=\"w-4 h-4\" />;\n    case 'admin_rejected':\n    case 'Manager rejected':\n    case 'Committee rejected':\n    case 'Finance rejected':\n    case 'rejected':\n      return <XCircle className=\"w-4 h-4\" />;\n    case 'changes_requested':\n      return <AlertTriangle className=\"w-4 h-4\" />;\n    case 'pending':\n      return <Clock className=\"w-4 h-4\" />;\n    default:\n      return <Clock className=\"w-4 h-4\" />;\n  }\n}\n\nfunction getPriorityColor(priority: string) {\n  switch (priority) {\n    case 'high':\n      return 'bg-red-100 text-red-800';\n    case 'medium':\n      return 'bg-yellow-100 text-yellow-800';\n    case 'low':\n      return 'bg-blue-100 text-blue-800';\n    default:\n      return 'bg-gray-100 text-gray-800';\n  }\n}\n","size_bytes":41374},"client/src/pages/Dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { StatsCard } from \"@/components/cards/StatsCard\";\nimport { RequestsTable } from \"@/components/tables/RequestsTable\";\nimport { TaskList } from \"@/components/tasks/TaskList\";\nimport ProposalSummaryCard from \"@/components/dashboard/ProposalSummaryCard\";\nimport RiskProfileChart from \"@/components/dashboard/RiskProfileChart\";\nimport ValueDistributionChart from \"@/components/dashboard/ValueDistributionChart\";\nimport DecisionSupportWidget from \"@/components/dashboard/DecisionSupportWidget\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Link } from \"wouter\";\nimport { useUser } from \"@/lib/auth\";\nimport { DashboardStats, RecentRequest } from \"@/lib/types\";\nimport { useState, useMemo } from \"react\";\nimport { \n  Clock, \n  Briefcase, \n  DollarSign, \n  AlertTriangle, \n  PlusCircle, \n  FileText,\n  TrendingUp,\n  Shield,\n  ChevronUp,\n  ChevronDown,\n  BarChart3,\n  PieChart,\n  Target,\n  Filter,\n  X,\n  ArrowUp\n} from \"lucide-react\";\n\n// Define filter interface for proposals\ninterface ProposalFilters {\n  selectedCompanies: string[];\n  selectedRiskLevels: string[];\n  selectedInvestmentTypes: string[];\n  expectedReturnMode: 'range' | 'specific';\n  expectedReturnRange: number[];\n  expectedReturnSpecific: string;\n  amountRange: number[];\n  amountMin: string;\n  amountMax: string;\n}\n\nexport default function Dashboard() {\n  const user = useUser();\n  \n  // Section visibility state\n  const [sectionsCollapsed, setSectionsCollapsed] = useState<Record<string, boolean>>({\n    overview: false,\n    proposalSummary: false,\n    decisionSupport: false,\n    analytics: false,\n    proposals: false,\n    quickActions: false,\n    tasks: false\n  });\n\n  // Proposal filter state\n  const [proposalFilters, setProposalFilters] = useState<ProposalFilters>({\n    selectedCompanies: [],\n    selectedRiskLevels: [],\n    selectedInvestmentTypes: [],\n    expectedReturnMode: 'range',\n    expectedReturnRange: [0, 50],\n    expectedReturnSpecific: '',\n    amountRange: [0, 10000000],\n    amountMin: '',\n    amountMax: ''\n  });\n\n  const [isProposalFilterOpen, setIsProposalFilterOpen] = useState(false);\n\n  // Legacy stats for backward compatibility\n  const { data: stats, isLoading: statsLoading } = useQuery<DashboardStats>({\n    queryKey: [\"/api/dashboard/stats\"],\n  });\n\n  // Enhanced stats for new dashboard\n  const { data: enhancedStats = {}, isLoading: enhancedStatsLoading } = useQuery<any>({\n    queryKey: [\"/api/dashboard/enhanced-stats\"],\n  });\n\n  const { data: recentRequests = [], isLoading: requestsLoading } = useQuery<RecentRequest[]>({\n    queryKey: [\"/api/dashboard/recent-requests\"],\n  });\n\n  const { data: myTasks = [], isLoading: tasksLoading } = useQuery<any[]>({\n    queryKey: [\"/api/tasks\"],\n  });\n\n  const userRole = user?.role || 'analyst';\n  \n  // Show Quick Actions only for roles that can create proposals\n  const showQuickActions = ['analyst', 'admin'].includes(userRole);\n\n  // Toggle section visibility\n  const toggleSection = (section: string) => {\n    setSectionsCollapsed(prev => ({\n      ...prev,\n      [section]: !prev[section]\n    }));\n  };\n\n  // Scroll to section\n  const scrollToSection = (sectionId: string) => {\n    const element = document.getElementById(sectionId);\n    if (element) {\n      element.scrollIntoView({ behavior: 'smooth' });\n    }\n  };\n\n  // Scroll to top\n  const scrollToTop = () => {\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n  };\n\n  // Filter proposals based on filters\n  const filteredProposals = useMemo(() => {\n    if (!recentRequests) return [];\n\n    return recentRequests.filter(proposal => {\n      // Company filter\n      if (proposalFilters.selectedCompanies.length > 0) {\n        const companyMatch = proposalFilters.selectedCompanies.includes(proposal.targetCompany || '');\n        if (!companyMatch) return false;\n      }\n\n      // Risk level filter\n      if (proposalFilters.selectedRiskLevels.length > 0) {\n        const riskMatch = proposalFilters.selectedRiskLevels.includes(proposal.riskLevel || '');\n        if (!riskMatch) return false;\n      }\n\n      // Investment type filter\n      if (proposalFilters.selectedInvestmentTypes.length > 0) {\n        const typeMatch = proposalFilters.selectedInvestmentTypes.includes(proposal.investmentType || '');\n        if (!typeMatch) return false;\n      }\n\n      // Expected return filter\n      if (proposalFilters.expectedReturnMode === 'range') {\n        const expectedReturn = parseFloat(proposal.expectedReturn || '0');\n        const [minReturn, maxReturn] = proposalFilters.expectedReturnRange;\n        if (expectedReturn < minReturn || expectedReturn > maxReturn) return false;\n      } else if (proposalFilters.expectedReturnSpecific) {\n        const expectedReturn = parseFloat(proposal.expectedReturn || '0');\n        const specificReturn = parseFloat(proposalFilters.expectedReturnSpecific);\n        if (expectedReturn !== specificReturn) return false;\n      }\n\n      // Amount filter\n      const amount = parseFloat(proposal.amount || '0');\n      const [minAmount, maxAmount] = proposalFilters.amountRange;\n      const userMinAmount = proposalFilters.amountMin ? parseFloat(proposalFilters.amountMin) : minAmount;\n      const userMaxAmount = proposalFilters.amountMax ? parseFloat(proposalFilters.amountMax) : maxAmount;\n      \n      if (amount < userMinAmount || amount > userMaxAmount) return false;\n\n      return true;\n    });\n  }, [recentRequests, proposalFilters]);\n\n  // Get unique companies for filter dropdown\n  const uniqueCompanies = useMemo(() => {\n    if (!recentRequests) return [];\n    const companies = recentRequests.map(r => r.targetCompany).filter(Boolean);\n    return Array.from(new Set(companies));\n  }, [recentRequests]);\n\n  // Clear all filters\n  const clearAllFilters = () => {\n    setProposalFilters({\n      selectedCompanies: [],\n      selectedRiskLevels: [],\n      selectedInvestmentTypes: [],\n      expectedReturnMode: 'range',\n      expectedReturnRange: [0, 50],\n      expectedReturnSpecific: '',\n      amountRange: [0, 10000000],\n      amountMin: '',\n      amountMax: ''\n    });\n  };\n\n  // Count active filters\n  const activeFilterCount = useMemo(() => {\n    let count = 0;\n    if (proposalFilters.selectedCompanies.length > 0) count++;\n    if (proposalFilters.selectedRiskLevels.length > 0) count++;\n    if (proposalFilters.selectedInvestmentTypes.length > 0) count++;\n    if (proposalFilters.expectedReturnSpecific || (proposalFilters.expectedReturnRange[0] > 0 || proposalFilters.expectedReturnRange[1] < 50)) count++;\n    if (proposalFilters.amountMin || proposalFilters.amountMax || (proposalFilters.amountRange[0] > 0 || proposalFilters.amountRange[1] < 10000000)) count++;\n    return count;\n  }, [proposalFilters]);\n\n  if (statsLoading || enhancedStatsLoading || requestsLoading || tasksLoading) {\n    return (\n      <div className=\"p-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n          {[...Array(4)].map((_, i) => (\n            <div key={i} className=\"bg-card p-6 rounded-lg shadow animate-pulse\">\n              <div className=\"h-4 bg-muted rounded w-3/4 mb-2\"></div>\n              <div className=\"h-8 bg-muted rounded w-1/2\"></div>\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n  \n  return (\n    <div className=\"w-full h-full pl-6 py-6 space-y-6\">\n      {/* Overview Section */}\n      <div id=\"overview\" className=\"space-y-4\">\n        <Collapsible \n            open={!sectionsCollapsed.overview} \n            onOpenChange={() => toggleSection('overview')}\n          >\n            <CollapsibleTrigger asChild>\n              <Button variant=\"ghost\" className=\"w-full justify-between p-4 h-auto\">\n                <div className=\"flex items-center gap-2\">\n                  <BarChart3 className=\"h-5 w-5\" />\n                  <h3 className=\"text-lg font-semibold\">Overview</h3>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <div\n                    className=\"hover:bg-accent rounded-sm p-1 cursor-pointer\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      scrollToTop();\n                    }}\n                  >\n                    <ArrowUp className=\"h-4 w-4\" />\n                  </div>\n                  {sectionsCollapsed.overview ? \n                    <ChevronDown className=\"h-4 w-4\" /> : \n                    <ChevronUp className=\"h-4 w-4\" />\n                  }\n                </div>\n              </Button>\n            </CollapsibleTrigger>\n            <CollapsibleContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4\">\n                <StatsCard\n                  title=\"My Pending Tasks\"\n                  value={stats?.pendingApprovals || 0}\n                  icon={Clock}\n                  color=\"primary\"\n                />\n                <StatsCard\n                  title=\"Active Reports\"\n                  value={stats?.activeInvestments || 0}\n                  icon={Briefcase}\n                  color=\"success\"\n                />\n                <StatsCard\n                  title=\"Cash Requests\"\n                  value={stats?.cashRequests || 0}\n                  icon={DollarSign}\n                  color=\"warning\"\n                />\n                <StatsCard\n                  title=\"SLA Issues\"\n                  value={stats?.slaBreaches || 0}\n                  icon={AlertTriangle}\n                  color=\"destructive\"\n                />\n              </div>\n            </CollapsibleContent>\n          </Collapsible>\n        </div>\n\n        {/* Enhanced Dashboard Content */}\n        {enhancedStats && (\n          <div className=\"space-y-4\">\n            {/* Proposal Summary Section */}\n            {enhancedStats?.proposalSummary && (\n              <div id=\"proposal-summary\" className=\"space-y-4\">\n                <Collapsible \n                  open={!sectionsCollapsed.proposalSummary} \n                  onOpenChange={() => toggleSection('proposalSummary')}\n                >\n                  <CollapsibleTrigger asChild>\n                    <Button variant=\"ghost\" className=\"w-full justify-between p-4 h-auto\">\n                      <div className=\"flex items-center gap-2\">\n                        <Target className=\"h-5 w-5\" />\n                        <h3 className=\"text-lg font-semibold\">Proposal Summary</h3>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <div\n                          className=\"hover:bg-accent rounded-sm p-1 cursor-pointer\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            scrollToTop();\n                          }}\n                        >\n                          <ArrowUp className=\"h-4 w-4\" />\n                        </div>\n                        {sectionsCollapsed.proposalSummary ? \n                          <ChevronDown className=\"h-4 w-4\" /> : \n                          <ChevronUp className=\"h-4 w-4\" />\n                        }\n                      </div>\n                    </Button>\n                  </CollapsibleTrigger>\n                  <CollapsibleContent>\n                    <div className=\"mt-4\">\n                      <ProposalSummaryCard \n                        data={enhancedStats.proposalSummary} \n                        userRole={userRole}\n                      />\n                    </div>\n                  </CollapsibleContent>\n                </Collapsible>\n              </div>\n            )}\n\n            {/* Decision Support Section */}\n            {enhancedStats?.decisionSupport && (\n              <div id=\"decision-support\" className=\"space-y-4\">\n                <Collapsible \n                  open={!sectionsCollapsed.decisionSupport} \n                  onOpenChange={() => toggleSection('decisionSupport')}\n                >\n                  <CollapsibleTrigger asChild>\n                    <Button variant=\"ghost\" className=\"w-full justify-between p-4 h-auto\">\n                      <div className=\"flex items-center gap-2\">\n                        <Shield className=\"h-5 w-5\" />\n                        <h3 className=\"text-lg font-semibold\">Decision Support</h3>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <div\n                          className=\"hover:bg-accent rounded-sm p-1 cursor-pointer\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            scrollToTop();\n                          }}\n                        >\n                          <ArrowUp className=\"h-4 w-4\" />\n                        </div>\n                        {sectionsCollapsed.decisionSupport ? \n                          <ChevronDown className=\"h-4 w-4\" /> : \n                          <ChevronUp className=\"h-4 w-4\" />\n                        }\n                      </div>\n                    </Button>\n                  </CollapsibleTrigger>\n                  <CollapsibleContent>\n                    <div className=\"mt-4\">\n                      <DecisionSupportWidget \n                        data={enhancedStats.decisionSupport} \n                        userRole={userRole}\n                      />\n                    </div>\n                  </CollapsibleContent>\n                </Collapsible>\n              </div>\n            )}\n\n            {/* Analytics Section */}\n            <div id=\"analytics\" className=\"space-y-4\">\n              <Collapsible \n                open={!sectionsCollapsed.analytics} \n                onOpenChange={() => toggleSection('analytics')}\n              >\n                <CollapsibleTrigger asChild>\n                  <Button variant=\"ghost\" className=\"w-full justify-between p-4 h-auto\">\n                    <div className=\"flex items-center gap-2\">\n                      <PieChart className=\"h-5 w-5\" />\n                      <h3 className=\"text-lg font-semibold\">Analytics</h3>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div\n                        className=\"hover:bg-accent rounded-sm p-1 cursor-pointer\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          scrollToTop();\n                        }}\n                      >\n                        <ArrowUp className=\"h-4 w-4\" />\n                      </div>\n                      {sectionsCollapsed.analytics ? \n                        <ChevronDown className=\"h-4 w-4\" /> : \n                        <ChevronUp className=\"h-4 w-4\" />\n                      }\n                    </div>\n                  </Button>\n                </CollapsibleTrigger>\n                <CollapsibleContent>\n                  <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-4\">\n                    {enhancedStats?.riskProfile && <RiskProfileChart data={enhancedStats.riskProfile} />}\n                    {enhancedStats?.valueDistribution && <ValueDistributionChart data={enhancedStats.valueDistribution} />}\n                  </div>\n                </CollapsibleContent>\n              </Collapsible>\n            </div>\n\n            {/* Proposals Section */}\n            <div id=\"proposals\" className=\"space-y-4\">\n              <Collapsible \n                open={!sectionsCollapsed.proposals} \n                onOpenChange={() => toggleSection('proposals')}\n              >\n                <CollapsibleTrigger asChild>\n                  <Button variant=\"ghost\" className=\"w-full justify-between p-4 h-auto\">\n                    <div className=\"flex items-center gap-2\">\n                      <Briefcase className=\"h-5 w-5\" />\n                      <h3 className=\"text-lg font-semibold\">Proposals</h3>\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {filteredProposals.length}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div\n                        className=\"hover:bg-accent rounded-sm p-1 cursor-pointer\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          scrollToTop();\n                        }}\n                      >\n                        <ArrowUp className=\"h-4 w-4\" />\n                      </div>\n                      {sectionsCollapsed.proposals ? \n                        <ChevronDown className=\"h-4 w-4\" /> : \n                        <ChevronUp className=\"h-4 w-4\" />\n                      }\n                    </div>\n                  </Button>\n                </CollapsibleTrigger>\n                <CollapsibleContent>\n                  <Card className=\"mt-4\">\n                    <CardHeader>\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle>Proposals</CardTitle>\n                        <div className=\"flex items-center gap-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setIsProposalFilterOpen(!isProposalFilterOpen)}\n                            className=\"flex items-center gap-2\"\n                          >\n                            <Filter className=\"h-4 w-4\" />\n                            Filters\n                            {activeFilterCount > 0 && (\n                              <Badge variant=\"secondary\" className=\"ml-1\">\n                                {activeFilterCount}\n                              </Badge>\n                            )}\n                          </Button>\n                          <Link href=\"/investments\">\n                            <Button variant=\"ghost\" size=\"sm\">\n                              View All\n                            </Button>\n                          </Link>\n                        </div>\n                      </div>\n                    </CardHeader>\n                    \n                    {/* Filter Panel */}\n                    {isProposalFilterOpen && (\n                      <div className=\"px-6 pb-4 border-b\">\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg\">\n                          {/* Company Filter */}\n                          <div>\n                            <label className=\"text-sm font-medium mb-2 block\">Client/Company</label>\n                            <Select \n                              value={proposalFilters.selectedCompanies.length > 0 ? proposalFilters.selectedCompanies[0] : \"all\"}\n                              onValueChange={(value) => {\n                                if (value === \"all\") {\n                                  setProposalFilters(prev => ({ ...prev, selectedCompanies: [] }));\n                                } else {\n                                  setProposalFilters(prev => ({ ...prev, selectedCompanies: [value] }));\n                                }\n                              }}\n                            >\n                              <SelectTrigger>\n                                <SelectValue placeholder=\"Select company\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                <SelectItem value=\"all\">All Companies</SelectItem>\n                                {uniqueCompanies.map(company => (\n                                  <SelectItem key={company} value={company}>{company}</SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </div>\n\n                          {/* Risk Level Filter */}\n                          <div>\n                            <label className=\"text-sm font-medium mb-2 block\">Risk Level</label>\n                            <div className=\"space-y-2\">\n                              {['low', 'medium', 'high'].map(level => (\n                                <div key={level} className=\"flex items-center space-x-2\">\n                                  <Checkbox\n                                    id={level}\n                                    checked={proposalFilters.selectedRiskLevels.includes(level)}\n                                    onCheckedChange={(checked) => {\n                                      if (checked) {\n                                        setProposalFilters(prev => ({\n                                          ...prev,\n                                          selectedRiskLevels: [...prev.selectedRiskLevels, level]\n                                        }));\n                                      } else {\n                                        setProposalFilters(prev => ({\n                                          ...prev,\n                                          selectedRiskLevels: prev.selectedRiskLevels.filter(l => l !== level)\n                                        }));\n                                      }\n                                    }}\n                                  />\n                                  <label htmlFor={level} className=\"text-sm capitalize\">{level}</label>\n                                </div>\n                              ))}\n                            </div>\n                          </div>\n\n                          {/* Report Type Filter */}\n                          <div>\n                            <label className=\"text-sm font-medium mb-2 block\">Report Type</label>\n                            <Select \n                              value={proposalFilters.selectedInvestmentTypes.length > 0 ? proposalFilters.selectedInvestmentTypes[0] : \"all\"}\n                              onValueChange={(value) => {\n                                if (value === \"all\") {\n                                  setProposalFilters(prev => ({ ...prev, selectedInvestmentTypes: [] }));\n                                } else {\n                                  setProposalFilters(prev => ({ ...prev, selectedInvestmentTypes: [value] }));\n                                }\n                              }}\n                            >\n                              <SelectTrigger>\n                                <SelectValue placeholder=\"Select type\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                <SelectItem value=\"all\">All Types</SelectItem>\n                                <SelectItem value=\"equity\">Equity</SelectItem>\n                                <SelectItem value=\"debt\">Debt</SelectItem>\n                                <SelectItem value=\"real_estate\">Real Estate</SelectItem>\n                                <SelectItem value=\"alternative\">Alternative</SelectItem>\n                              </SelectContent>\n                            </Select>\n                          </div>\n\n                          {/* Expected Returns Filter */}\n                          <div>\n                            <label className=\"text-sm font-medium mb-2 block\">Expected Returns (%)</label>\n                            <div className=\"space-y-2\">\n                              <div className=\"flex items-center space-x-2\">\n                                <Checkbox\n                                  checked={proposalFilters.expectedReturnMode === 'range'}\n                                  onCheckedChange={(checked) => {\n                                    if (checked) {\n                                      setProposalFilters(prev => ({ ...prev, expectedReturnMode: 'range' }));\n                                    }\n                                  }}\n                                />\n                                <label className=\"text-sm\">Range</label>\n                              </div>\n                              {proposalFilters.expectedReturnMode === 'range' && (\n                                <div className=\"px-3\">\n                                  <Slider\n                                    value={proposalFilters.expectedReturnRange}\n                                    onValueChange={(value) => setProposalFilters(prev => ({ ...prev, expectedReturnRange: value }))}\n                                    max={50}\n                                    min={0}\n                                    step={1}\n                                    className=\"w-full\"\n                                  />\n                                  <div className=\"flex justify-between text-xs text-muted-foreground\">\n                                    <span>{proposalFilters.expectedReturnRange[0]}%</span>\n                                    <span>{proposalFilters.expectedReturnRange[1]}%</span>\n                                  </div>\n                                </div>\n                              )}\n                              <div className=\"flex items-center space-x-2\">\n                                <Checkbox\n                                  checked={proposalFilters.expectedReturnMode === 'specific'}\n                                  onCheckedChange={(checked) => {\n                                    if (checked) {\n                                      setProposalFilters(prev => ({ ...prev, expectedReturnMode: 'specific' }));\n                                    }\n                                  }}\n                                />\n                                <label className=\"text-sm\">Specific</label>\n                              </div>\n                              {proposalFilters.expectedReturnMode === 'specific' && (\n                                <div className=\"px-3\">\n                                  <Input\n                                    type=\"number\"\n                                    placeholder=\"Enter %\"\n                                    value={proposalFilters.expectedReturnSpecific}\n                                    onChange={(e) => setProposalFilters(prev => ({ ...prev, expectedReturnSpecific: e.target.value }))}\n                                    className=\"w-full\"\n                                  />\n                                </div>\n                              )}\n                            </div>\n                          </div>\n\n                          {/* Amount Filter */}\n                          <div>\n                            <label className=\"text-sm font-medium mb-2 block\">Amount Range</label>\n                            <div className=\"space-y-2\">\n                              <div className=\"grid grid-cols-2 gap-2\">\n                                <Input\n                                  type=\"number\"\n                                  placeholder=\"Min\"\n                                  value={proposalFilters.amountMin}\n                                  onChange={(e) => setProposalFilters(prev => ({ ...prev, amountMin: e.target.value }))}\n                                />\n                                <Input\n                                  type=\"number\"\n                                  placeholder=\"Max\"\n                                  value={proposalFilters.amountMax}\n                                  onChange={(e) => setProposalFilters(prev => ({ ...prev, amountMax: e.target.value }))}\n                                />\n                              </div>\n                            </div>\n                          </div>\n\n                          {/* Clear Filters */}\n                          <div className=\"flex items-end\">\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={clearAllFilters}\n                              className=\"w-full\"\n                            >\n                              <X className=\"h-4 w-4 mr-2\" />\n                              Clear All\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n                    \n                    <CardContent>\n                      <RequestsTable requests={filteredProposals} />\n                    </CardContent>\n                  </Card>\n                </CollapsibleContent>\n              </Collapsible>\n            </div>\n\n            {/* Quick Actions Section */}\n            {showQuickActions && (\n              <div id=\"quick-actions\" className=\"space-y-4\">\n                <Collapsible \n                  open={!sectionsCollapsed.quickActions} \n                  onOpenChange={() => toggleSection('quickActions')}\n                >\n                  <CollapsibleTrigger asChild>\n                    <Button variant=\"ghost\" className=\"w-full justify-between p-4 h-auto\">\n                      <div className=\"flex items-center gap-2\">\n                        <PlusCircle className=\"h-5 w-5\" />\n                        <h3 className=\"text-lg font-semibold\">Quick Actions</h3>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <div\n                          className=\"hover:bg-accent rounded-sm p-1 cursor-pointer\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            scrollToTop();\n                          }}\n                        >\n                          <ArrowUp className=\"h-4 w-4\" />\n                        </div>\n                        {sectionsCollapsed.quickActions ? \n                          <ChevronDown className=\"h-4 w-4\" /> : \n                          <ChevronUp className=\"h-4 w-4\" />\n                        }\n                      </div>\n                    </Button>\n                  </CollapsibleTrigger>\n                  <CollapsibleContent>\n                    <Card className=\"mt-4\">\n                      <CardHeader>\n                        <CardTitle>Quick Actions</CardTitle>\n                      </CardHeader>\n                      <CardContent className=\"space-y-3\">\n                        <Link href=\"/new-investment\">\n                          <Button className=\"w-full justify-start\">\n                            <PlusCircle className=\"mr-2 h-4 w-4\" />\n                            New Investment Request\n                          </Button>\n                        </Link>\n                        <Link href=\"/cash-requests\">\n                          <Button variant=\"outline\" className=\"w-full justify-start\">\n                            <DollarSign className=\"mr-2 h-4 w-4\" />\n                            New Cash Request\n                          </Button>\n                        </Link>\n                        <Link href=\"/templates\">\n                          <Button variant=\"ghost\" className=\"w-full justify-start\">\n                            <FileText className=\"mr-2 h-4 w-4\" />\n                            Use Template\n                          </Button>\n                        </Link>\n                      </CardContent>\n                    </Card>\n                  </CollapsibleContent>\n                </Collapsible>\n              </div>\n            )}\n\n            {/* My Tasks Section */}\n            <div id=\"tasks\" className=\"space-y-4\">\n              <Collapsible \n                open={!sectionsCollapsed.tasks} \n                onOpenChange={() => toggleSection('tasks')}\n              >\n                <CollapsibleTrigger asChild>\n                  <Button variant=\"ghost\" className=\"w-full justify-between p-4 h-auto\">\n                    <div className=\"flex items-center gap-2\">\n                      <Clock className=\"h-5 w-5\" />\n                      <h3 className=\"text-lg font-semibold\">My Tasks</h3>\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {myTasks?.length || 0}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div\n                        className=\"hover:bg-accent rounded-sm p-1 cursor-pointer\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          scrollToTop();\n                        }}\n                      >\n                        <ArrowUp className=\"h-4 w-4\" />\n                      </div>\n                      {sectionsCollapsed.tasks ? \n                        <ChevronDown className=\"h-4 w-4\" /> : \n                        <ChevronUp className=\"h-4 w-4\" />\n                      }\n                    </div>\n                  </Button>\n                </CollapsibleTrigger>\n                <CollapsibleContent>\n                  <Card className=\"mt-4\">\n                    <CardHeader>\n                      <CardTitle>My Tasks</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <TaskList tasks={myTasks || []} />\n                    </CardContent>\n                  </Card>\n                </CollapsibleContent>\n              </Collapsible>\n            </div>\n          </div>\n        )}\n    </div>\n  );\n}\n","size_bytes":33617}},"version":2}